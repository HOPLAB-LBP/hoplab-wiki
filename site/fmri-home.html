
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="getstarted.html">
      
      
        <link rel="next" href="contribute.html">
      
      
      <link rel="icon" href="assets/hoplab_favicon_white.ico">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.23">
    
    
      
        <title>Functional MRI - Hoplab Wiki</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.6543a935.min.css">
      
      


    
    
      
        <script src="assets/external/unpkg.com/iframe-worker/shim.js"></script>
      
    
    
      
        
        
        
        <link rel="stylesheet" href="assets/external/fonts.googleapis.com/css.49ea35f2.css">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="stylesheets/extra.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#functional-mri" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Hoplab Wiki" class="md-header__button md-logo" aria-label="Hoplab Wiki" data-md-component="logo">
      
  <img src="assets/thicker_white_brain.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Hoplab Wiki
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Functional MRI
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Hoplab Wiki" class="md-nav__button md-logo" aria-label="Hoplab Wiki" data-md-component="logo">
      
  <img src="assets/thicker_white_brain.svg" alt="logo">

    </a>
    Hoplab Wiki
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="getstarted.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Get started in the lab
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="fmri-home.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Functional MRI
  </span>
  

      </a>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="contribute.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contribute
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="functional-mri">Functional MRI<a class="headerlink" href="#functional-mri" title="Permanent link">&para;</a></h1>
<p>This page is a work in progress and it is based on what I do in my fMRI pipeline. This info may change once we agree on shared practices.</p>
<p>IMPORTANT: talk to Joan and Elahe to check on what they do, and standardize.</p>
<p>TODO: Add info and links about fmri tasks, preprocessing, GLM, ROIs, MVPA/RSA.</p>
<p>TODO: info on how to install main tools used for the fmri workflow for different OSs.</p>
<p>TODO: info about instruments and procedures at the hospital.</p>
<p>A template folder structure, along with the code to reproduce these analyses, can be found at [PLACEHOLDER]</p>
<h1 id="general-notes">General Notes<a class="headerlink" href="#general-notes" title="Permanent link">&para;</a></h1>
<h3 id="how-to-store-raw-data">How to store raw data<a class="headerlink" href="#how-to-store-raw-data" title="Permanent link">&para;</a></h3>
<p>In order to avoid error while converting into BIDS format, the raw data (i.e., the data collected from the scanner, behavioural measure, eye-tracking) should be stored in a folder with the following structure:</p>
<div class="highlight"><pre><span></span><code>sourcedata
└── sub-01
    ├── bh
    │   ├── 20240503104938_log_41-1-2_exp.tsv
    │   ├── 20240503105558_41_1_exp.mat
    │   ├── 20240503105640_log_41-2-1_exp.tsv
    │   ├── 20240503110226_41_2_exp.mat
    │   ├── 20240503110241_log_41-3-2_exp.tsv
    └── nifti
        ├── SUBJECTNAME_WIP_CS_3DTFE_8_1.nii
        ├── SUBJECTNAME_WIP_Functional_run1_13_1.nii
        └── SUBJECTNAME_WIP_Functional_run2_12_1.nii
</code></pre></div>
<h3 id="how-to-get-images-from-the-scanner">How to get images from the scanner<a class="headerlink" href="#how-to-get-images-from-the-scanner" title="Permanent link">&para;</a></h3>
<p>For optimal BIDS conversion of fMRI data, it is recommended to initially collect DICOM files (not NIfTI or PAR/REC) at the scanner. Although this adds an extra conversion step and takes longer, it ensures proper conversion into BIDS format. Here is the recommended process:</p>
<ol>
<li>
<p><strong>Initial DICOM Collection</strong>:</p>
<ul>
<li>Collect DICOM files for each modality (e.g., T1 and BOLD) for one subject.</li>
<li>Convert these DICOM files to NIfTI format, which will generate JSON sidecar files.</li>
</ul>
</li>
<li>
<p><strong>Template Creation</strong>:</p>
<ul>
<li>Rename the JSON files for T1 and BOLD image to <code>sub-xx_T1w.json</code> and <code>sub-xx_task-exp_run-x_bold.json</code></li>
<li>Move the JSON files into <code>misc/</code>.</li>
</ul>
</li>
<li>
<p><strong>Subsequent Data Collection</strong>:</p>
<ul>
<li>After creating the template JSON files, collect future data in NIfTI format to save time. The <code>01_nifti-to-BIDS.m</code> script will use the JSON templates to populate the BIDS folders, provided that the fMRI sequence remained unchaged (in that case you need to generate new templates from the DICOM files).</li>
</ul>
</li>
</ol>
<h3 id="missing-fields-in-json-files">Missing fields in JSON files<a class="headerlink" href="#missing-fields-in-json-files" title="Permanent link">&para;</a></h3>
<p>Despite these steps, some BIDS fields in the sidecar JSON files may remain empty due to limitations of the Philips scanner, not the conversion tools. The most relevant fields that are left empty due to these limitations are <code>SliceTiming</code> and <code>PhaseEncodingDirection</code>.</p>
<ul>
<li>
<p><strong>SliceTiming</strong>:</p>
<ul>
<li>This field is used by fMRIPrep during slice timing correction.</li>
<li>It can be populated using the <code>/utils/get_philips_MB_slicetiming.py</code> script, assuming you have access to a DICOM file and know the multiband factor (default is 2, as used in our lab).</li>
<li>Note: The script assumes an interleaved, foot-to-head acquisition, and will not work for other types of acquisitions.</li>
</ul>
</li>
<li>
<p><strong>PhaseEncodingDirection</strong>:</p>
<ul>
<li>This BIDS tag allows tools to undistort images.</li>
<li>While the Philips DICOM header distinguishes the phase encoding axis (e.g., anterior-posterior vs. left-right), it does not encode the polarity (A-&gt;P vs. P-&gt;A).</li>
<li>You will need to check at the scanner or consult with Ron whether the polarity is AP or PA, and correct the <code>?</code> in the JSON file to <code>+</code> or <code>-</code>.</li>
</ul>
</li>
</ul>
<p>For more details on Philips DICOM conversion, refer to the following resources:</p>
<ul>
<li><a href="https://github.com/rordenlab/dcm2niix/tree/master/Philips#missing-information">Philips DICOM Missing Information - dcm2niix</a></li>
<li><a href="https://github.com/rordenlab/dcm2niix/tree/master/PARREC">PARREC Conversion - dcm2niix</a></li>
</ul>
<h3 id="where-to-find-additional-info-on-the-fmri-sequence">Where to find additional info on the fMRI sequence<a class="headerlink" href="#where-to-find-additional-info-on-the-fmri-sequence" title="Permanent link">&para;</a></h3>
<p>Additional information on the sequence can be found at the scanner by following these steps:</p>
<pre><code>- TODO: document the correct steps to get info on the geometry etc. we need to start new examination, load our sequence, click on one run/T1, and go in the geometry tab. here we have info about polarity, direction etc.
</code></pre>
<h3 id="bids-standards">BIDS standards<a class="headerlink" href="#bids-standards" title="Permanent link">&para;</a></h3>
<p>TODO: add info about the BIDS standard, and how we use it (from raw to BIDS + derivatives)</p>
<h1 id="workflow">Workflow<a class="headerlink" href="#workflow" title="Permanent link">&para;</a></h1>
<h2 id="behavioral-data">Behavioral Data<a class="headerlink" href="#behavioral-data" title="Permanent link">&para;</a></h2>
<p>TODO: here Tim should describe name and format of the logfiles</p>
<p>TODO: add ref to fMRI task repo</p>
<p>The fMRI task script should give two files per run as output. Here is a description of the naming structure and file content:</p>
<ol>
<li><code>&lt;timestamp&gt;_log_&lt;subID&gt;-&lt;run&gt;-&lt;buttonMapping&gt;_&lt;taskName&gt;.tsv</code>: [PLACEHOLDER]</li>
<li><code>&lt;timestamp&gt;_log_&lt;subID&gt;_&lt;run&gt;_&lt;taskName&gt;.mat</code>: [PLACEHOLDER]</li>
</ol>
<p>If the behavioural data is stored in a <code>sourcedata/sub-xx/bh/</code> folder consistent to the one described <a href="#how-to-store-raw-data">above</a>, you can run the <code>02_behavioural-to-BIDS.m</code> script, after editing the parameters at the top of the script. This script iterates through subject-specific directories, targeting behavioral .mat files, then processes and exports trial-related data into BIDS-compliant TSV event files. </p>
<p>TODO: above, we need to phrase better and add more info about what these parameters are, possibly with a screenshot of the code. Also, in the code make more clear where the parameters are.
TODO: perhaps wrap nifti and bh 2 BIDS in a single script that takes some input arguments? 
TODO: we need to add more info about how these files are saved, and more in general about the BIDS structure</p>
<p>Ensure that each resulting tsv file has at least three columns representing: <code>onset</code>, <code>duration</code>, <code>trial_type</code>.</p>
<h2 id="eye-tracking-data">Eye-Tracking Data<a class="headerlink" href="#eye-tracking-data" title="Permanent link">&para;</a></h2>
<p><strong>Pre-requisite:</strong> To convert EDF files into more easy-to-read ASC files, you need to install the EyeLink Developers Kit / API. More info and how-to:</p>
<ul>
<li>
<p><a href="https://www.sr-research.com/support/thread-13.html">EyeLink Developers Kit / API</a></p>
</li>
<li>
<p>Run the ET script to convert to ASC in BIDS format.</p>
</li>
</ul>
<p><strong>Note:</strong> BEP020 has not been approved yet. Not sure if the events MSG should be included here or not.</p>
<h2 id="fmri-data">fMRI Data<a class="headerlink" href="#fmri-data" title="Permanent link">&para;</a></h2>
<h3 id="bids-conversion">BIDS conversion<a class="headerlink" href="#bids-conversion" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Convert DICOM to BIDS (NIfTI):</strong></p>
<ul>
<li><strong>Prerequisites:</strong><ul>
<li><code>dcm2nii</code></li>
<li>Raw data should be organized as: <code>/sourcedata/sub-&lt;xx&gt;/dicom</code></li>
<li>MATLAB</li>
</ul>
</li>
</ul>
<p>1.1. Download <code>dicm2nii</code> from <a href="https://github.com/xiangruili/dicm2nii">dicm2nii</a>, unzip, and add to the MATLAB path.</p>
<p>1.2. Open MATLAB and type <code>anonymize_dicm</code> in the console. Enter and it will ask you to select the folder where the files are and the folder in which you want to save it: <code>/sourcedata/sub-&lt;xx&gt;/dicom_Anon</code>.</p>
<p>1.3. Run the <code>dicm2nii</code> MATLAB function from the unzipped file. Just write <code>dicm2nii</code> in the command window. A pop-up will appear: select DICOM folder (Dicom_Anon. files) and result folder (Dicom_Converted). Untick the compress box and make sure you select save JSON file. Start conversion. A pop-up appears: subject (only number of the subject, e.g., 01). Type: <code>func</code> (T2 scans) and <code>anat</code> (T1 scans). Under modality, we need <code>task-{name of the task}_run-{number of run}_bold</code>, e.g., <code>task-exp_run-2_bold</code>. Modality for anatomical scans is <code>T1W</code>. This pop-up will appear for each run of the fMRI sequence.</p>
<p>At the end of this process, we have a new folder called <code>dicom_converted</code> structured as follows:
<div class="highlight"><pre><span></span><code>dicom_converted
├── sub-01
│   ├── anat
│   │   ├── sub-01_T1w.json
│   │   └── sub-01_T1w.nii.gz
│   ├── func
│   │   ├── sub-01_task-exp_run-1_bold.json
│   │   └── sub-01_task-exp_run-1_bold.nii.gz
│   └── dcmHeaders.mat
└── participants.tsv
</code></pre></div></p>
<p>Copy your <code>sub-01</code> folder from <code>dicom_converted</code> into the BIDS folder (make a new one if you don't have one).</p>
<p><strong>Note:</strong> The pop-up only appeared with the first participant and then does it automatically. This is quite annoying as it never gets the participant number right so you have to manually go in and change it. It also only worked when providing it with (enhanced) DICOM files.</p>
</li>
<li>
<p><strong>Validate the BIDS directory (and solve errors):</strong></p>
<ul>
<li><a href="https://bids-standard.github.io/bids-validator/">BIDS Validator</a></li>
</ul>
</li>
</ol>
<h3 id="surface-preprocessing-fastsurfer">Surface preprocessing (FastSurfer)<a class="headerlink" href="#surface-preprocessing-fastsurfer" title="Permanent link">&para;</a></h3>
<h3 id="minimal-preprocessing-fmriprep">Minimal preprocessing (fMRIprep)<a class="headerlink" href="#minimal-preprocessing-fmriprep" title="Permanent link">&para;</a></h3>
<p>TODO: explain how to install docker and fmriprep-docker</p>
<div class="highlight"><pre><span></span><code>fmriprep-docker<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>/data/BIDS<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>/data/BIDS/derivatives/fmriprep<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>participant<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--work-dir<span class="w"> </span>/chess/temp<span class="w"> </span><span class="se">\ </span>
<span class="w">    </span>--mem-mb<span class="w"> </span><span class="m">13000</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--n-cpus<span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--resource-monitor<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-vv<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--output-spaces<span class="w"> </span>MNI152NLin2009cAsym:res-2<span class="w"> </span>anat<span class="w"> </span>fsnative<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--fs-license-file<span class="w"> </span>/misc/.license<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--bold2t1w-dof<span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--task<span class="w"> </span>exp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--dummy-scans<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--fs-subjects-dir<span class="w"> </span>/data/BIDS/derivatives/fastsurfer<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--notrack<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--participant-label<span class="w"> </span><span class="m">37</span><span class="w"> </span><span class="m">38</span><span class="w"> </span><span class="m">39</span><span class="w"> </span><span class="m">40</span>
</code></pre></div>
<h4 id="how-to-interpret-fmriprep-visual-reports">How to interpret fMRIprep visual reports<a class="headerlink" href="#how-to-interpret-fmriprep-visual-reports" title="Permanent link">&para;</a></h4>
<h3 id="quality-check-mriqc">Quality check (mriqc)<a class="headerlink" href="#quality-check-mriqc" title="Permanent link">&para;</a></h3>
<p>TODO: explain how to save and run this below
TODO: explain that the one below may fail, in that case run the single commands separately</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Iterate over subject numbers</span>
<span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">37</span>..40<span class="o">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="c1"># Skip subject 0, 5, 14, 31</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$i</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$i</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$i</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$i</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="k">continue</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="c1"># Format subject number with leading zeros</span>
<span class="w">    </span><span class="nv">subID</span><span class="o">=</span><span class="k">$(</span><span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;sub-%02d&quot;</span><span class="w"> </span><span class="nv">$i</span><span class="k">)</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Processing </span><span class="nv">$subID</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Docker command with dynamic subject ID using sudo</span>
<span class="w">    </span>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--rm<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>/data/BIDS/derivatives/fmriprep:/data:ro<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>/data/BIDS/derivatives/mriqc:/out<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>/temp_mriqc:/scratch<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>nipreps/mriqc:latest<span class="w"> </span>/data<span class="w"> </span>/out<span class="w"> </span>participant<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--participant-label<span class="w"> </span><span class="si">${</span><span class="nv">subID</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--nprocs<span class="w"> </span><span class="m">16</span><span class="w"> </span>--mem-gb<span class="w"> </span><span class="m">40</span><span class="w"> </span>--float32<span class="w"> </span><span class="se">\</span>
<span class="w">     </span>--work-dir<span class="w"> </span>/scratch<span class="w"> </span><span class="se">\</span>
<span class="w">     </span>--verbose-reports<span class="w"> </span>--resource-monitor<span class="w"> </span>-vv

<span class="w">    </span><span class="c1"># Wait or perform other actions between runs if needed</span>
<span class="w">    </span>sleep<span class="w"> </span><span class="m">0</span>.5
<span class="k">done</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Running group analysis&quot;</span>

docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--rm<span class="w"> </span><span class="se">\</span>
-v<span class="w"> </span>/data/BIDS/derivatives/fmriprep:/data:ro<span class="w"> </span><span class="se">\</span>
-v<span class="w"> </span>/data/BIDS/derivatives/mriqc:/out<span class="w"> </span><span class="se">\</span>
-v<span class="w"> </span>/temp_mriqc:/scratch<span class="w"> </span><span class="se">\</span>
nipreps/mriqc:latest<span class="w"> </span>/data<span class="w"> </span>/out<span class="w"> </span>group<span class="w"> </span><span class="se">\</span>
--nprocs<span class="w"> </span><span class="m">16</span><span class="w"> </span>--mem-gb<span class="w"> </span><span class="m">40</span><span class="w"> </span>--float32<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--work-dir<span class="w"> </span>/scratch<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--verbose-reports<span class="w"> </span>--resource-monitor<span class="w"> </span>-vv

sleep<span class="w"> </span><span class="m">0</span>.5

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Running classifier&quot;</span>
docker<span class="w"> </span>run<span class="w"> </span><span class="se">\</span>
-v<span class="w"> </span>/temp_mriqc:/scratch<span class="w"> </span><span class="se">\</span>
-v<span class="w"> </span>/data/BIDS/derivatives/mriqc:/resdir<span class="w"> </span><span class="se">\</span>
-w<span class="w"> </span>/scratch<span class="w"> </span>--entrypoint<span class="o">=</span>mriqc_clf<span class="w"> </span>poldracklab/mriqc:latest<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--load-classifier<span class="w"> </span>-X<span class="w"> </span>/resdir/group_T1w.tsv
</code></pre></div>
<h3 id="running-a-glm-in-spm">Running a GLM in SPM<a class="headerlink" href="#running-a-glm-in-spm" title="Permanent link">&para;</a></h3>
<p>TODO: show code snippets perhaps? or just reference to the code</p>
<h3 id="regions-of-interest">Regions of Interest<a class="headerlink" href="#regions-of-interest" title="Permanent link">&para;</a></h3>
<h4 id="rois-from-localizers">ROIs from localizers<a class="headerlink" href="#rois-from-localizers" title="Permanent link">&para;</a></h4>
<h4 id="hcp-glasser-parcellation">HCP Glasser parcellation<a class="headerlink" href="#hcp-glasser-parcellation" title="Permanent link">&para;</a></h4>
<h4 id="other-parcelsatlases">Other parcels/atlases<a class="headerlink" href="#other-parcelsatlases" title="Permanent link">&para;</a></h4>
<h3 id="mvparsa">MVPA/RSA<a class="headerlink" href="#mvparsa" title="Permanent link">&para;</a></h3>
<h3 id="plotting-and-reporting">Plotting and reporting<a class="headerlink" href="#plotting-and-reporting" title="Permanent link">&para;</a></h3>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": ".", "features": [], "search": "assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.ebd0bdb7.min.js"></script>
      
        <script src="assets/external/unpkg.com/mermaid@10/dist/mermaid.min.js"></script>
      
    
  </body>
</html>