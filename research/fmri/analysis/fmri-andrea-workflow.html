
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="fmri-mvpa.html">
      
      
        <link rel="next" href="../../eeg/index.html">
      
      
      <link rel="icon" href="../../../assets/hoplab_favicon_white.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.42">
    
    
      
        <title>fMRI workflow example - Hoplab Wiki</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
        <script src="../../../assets/external/unpkg.com/iframe-worker/shim.js"></script>
      
    
    
      
        
        
        
        <link rel="stylesheet" href="../../../assets/external/fonts.googleapis.com/css.49ea35f2.css">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-71T36SYGT2"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-71T36SYGT2",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-71T36SYGT2",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#fmri-workflow-example" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../index.html" title="Hoplab Wiki" class="md-header__button md-logo" aria-label="Hoplab Wiki" data-md-component="logo">
      
  <img src="../../../assets/thicker_white_brain.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Hoplab Wiki
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              fMRI workflow example
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/HOPLAB-LBP/hoplab-wiki/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    HOPLAB-LBP/hoplab-wiki
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html" class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../get-started/index.html" class="md-tabs__link">
          
  
    
  
  Getting started

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../index.html" class="md-tabs__link">
          
  
    
  
  Research

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../outreach.html" class="md-tabs__link">
        
  
    
  
  Science outreach

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../contribute.html" class="md-tabs__link">
        
  
    
  
  Contribute

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../index.html" title="Hoplab Wiki" class="md-nav__button md-logo" aria-label="Hoplab Wiki" data-md-component="logo">
      
  <img src="../../../assets/thicker_white_brain.svg" alt="logo">

    </a>
    Hoplab Wiki
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/HOPLAB-LBP/hoplab-wiki/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    HOPLAB-LBP/hoplab-wiki
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../get-started/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../get-started/useful-links.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Useful links
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../get-started/mailing-lists.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mailing lists
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../get-started/practical-setup.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practical set-up
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../get-started/computer-setup.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Computer set-up
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../get-started/admin-procedures.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Administrative procedures
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../get-started/student-starter-pack.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Student starter pack
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Research
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Research
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../ethics/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Ethical approval
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_2" id="__nav_3_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Ethical approval
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ethics/MEC.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EC onderzoek
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ethics/SMEC.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SMEC
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../coding/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Coding practices
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Coding practices
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../behaviour/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Behaviour
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_4" id="__nav_3_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Behaviour
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../behaviour/participants.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Find participants
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../behaviour/experimental-setup.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Set up your experiment
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    fMRI
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_5" id="__nav_3_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            fMRI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fmri-get-started.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    First steps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fmri-procedure.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scanning procedure and info
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5_4" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Analysis workflow
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_5_4" id="__nav_3_5_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_5_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_5_4">
            <span class="md-nav__icon md-icon"></span>
            Analysis workflow
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-general.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    0. General information
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-setup-env.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Set-up you environment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-bids-conversion.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. BIDS conversion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-prepocessing-qa.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Pre-processing and QA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-glm.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. First-level analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-rois.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. Regions of interest
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-mvpa.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. Multi-variate analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    fMRI workflow example
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="fmri-andrea-workflow.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    fMRI workflow example
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#from-raw-data-to-bids" class="md-nav__link">
    <span class="md-ellipsis">
      From Raw Data to BIDS
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pre-processing-fmri-data-in-bids-format" class="md-nav__link">
    <span class="md-ellipsis">
      Pre-processing fMRI Data in BIDS Format
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#processing-eye-tracking-data-with-bidsmreye" class="md-nav__link">
    <span class="md-ellipsis">
      Processing Eye-Tracking Data with bidsmreye
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#first-level-analysis-general-linear-model-glm" class="md-nav__link">
    <span class="md-ellipsis">
      First-Level Analysis – General Linear Model (GLM)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generating-and-organizing-regions-of-interest-rois" class="md-nav__link">
    <span class="md-ellipsis">
      Generating and Organizing Regions of Interest (ROIs)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multi-variate-pattern-analysis-mvpa" class="md-nav__link">
    <span class="md-ellipsis">
      Multi-Variate Pattern Analysis (MVPA)
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../eeg/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    EEG
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            EEG
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../eyetracking/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Eye-tracking
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            Eye-tracking
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../dnn/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Neural Networks
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            Neural Networks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../outreach.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Science outreach
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contribute.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contribute
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#from-raw-data-to-bids" class="md-nav__link">
    <span class="md-ellipsis">
      From Raw Data to BIDS
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pre-processing-fmri-data-in-bids-format" class="md-nav__link">
    <span class="md-ellipsis">
      Pre-processing fMRI Data in BIDS Format
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#processing-eye-tracking-data-with-bidsmreye" class="md-nav__link">
    <span class="md-ellipsis">
      Processing Eye-Tracking Data with bidsmreye
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#first-level-analysis-general-linear-model-glm" class="md-nav__link">
    <span class="md-ellipsis">
      First-Level Analysis – General Linear Model (GLM)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generating-and-organizing-regions-of-interest-rois" class="md-nav__link">
    <span class="md-ellipsis">
      Generating and Organizing Regions of Interest (ROIs)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multi-variate-pattern-analysis-mvpa" class="md-nav__link">
    <span class="md-ellipsis">
      Multi-Variate Pattern Analysis (MVPA)
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/HOPLAB-LBP/hoplab-wiki/edit/main/docs/research/fmri/analysis/fmri-andrea-workflow.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="fmri-workflow-example">fMRI workflow example<a class="headerlink" href="#fmri-workflow-example" title="Permanent link">&para;</a></h1>
<p>This page is a work in progress and is based on my (Andrea) fMRI pipeline. This information may change once we agree on shared practices.</p>
<p>The code to reproduce these analyses can be found <a href="https://github.com/costantinoai/chess-expertise-2024">here</a>.</p>
<p>For information on how to set up the working environment, install, and configure the packages mentioned in this document, refer to <a href="fmri-setup-env.html">Set-up your fMRI environment</a> and <a href="../../coding/index.html">Coding practices</a></p>
<hr />
<h2 id="from-raw-data-to-bids">From Raw Data to BIDS<a class="headerlink" href="#from-raw-data-to-bids" title="Permanent link">&para;</a></h2>
<h3 id="collecting-raw-data">Collecting Raw Data<a class="headerlink" href="#collecting-raw-data" title="Permanent link">&para;</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is essential to ensure that no personal identifiers are present in any of the files that leave the hospital. Use my script for anonymizing filenames and data.</p>
</div>
<p><strong>At the hospital:</strong></p>
<ul>
<li>Take fMRI scans from the hospital computer. Specify which buttons to select in the GUI.</li>
<li>Anonymize the filenames using my script to ensure subject privacy.</li>
<li>Extract behavioral (bh) and eye-tracking (et) data from the output folders on the experiment PC.</li>
<li>Copy all files into a <code>sourcedata/</code> folder organized with subfolders: <code>bh</code>, <code>nifti</code>, and <code>et</code>.</li>
</ul>
<hr />
<h3 id="converting-fmri-data-to-bids">Converting fMRI Data to BIDS<a class="headerlink" href="#converting-fmri-data-to-bids" title="Permanent link">&para;</a></h3>
<h4 id="step-1-preparing-for-the-first-subject">Step 1: Preparing for the First Subject<a class="headerlink" href="#step-1-preparing-for-the-first-subject" title="Permanent link">&para;</a></h4>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>This step should only be performed for the first subject in your dataset. It can be skipped if anatomical and functional JSON templates are already available in <code>code/misc/</code>. See <a href="fmri-general.html#how-to-get-images-from-the-scanner">this guide</a> for more info on the template files.</p>
</div>
<ol>
<li>
<p><strong>Convert DICOM to BIDS (NIfTI):</strong></p>
<ol>
<li>
<p><strong>Prerequisites:</strong></p>
<ul>
<li><code>dcm2nii</code></li>
<li>Raw data should be organized as: <code>/sourcedata/sub-&lt;xx&gt;/dicom</code></li>
<li>MATLAB</li>
</ul>
</li>
<li>
<p>Download <code>dicm2nii</code> from <a href="https://github.com/xiangruili/dicm2nii">dicm2nii</a>, unzip, and add to the MATLAB path.</p>
</li>
<li>
<p>Open MATLAB and type <code>anonymize_dicm</code> in the console. Select the folder where the files are and the output folder: <code>/sourcedata/sub-&lt;xx&gt;/dicom_Anon</code>.</p>
</li>
<li>
<p>Run <code>dicm2nii</code> in MATLAB. Select the DICOM folder and result folder (e.g., <code>dicom_converted</code>). Untick the compress box and ensure to save the JSON file.</p>
</li>
</ol>
<p>The output folder structure should be as follows:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>dicom_converted
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>├──<span class="w"> </span>sub-01
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>│<span class="w">   </span>├──<span class="w"> </span>anat
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>sub-01_T1w.json
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>sub-01_T1w.nii.gz
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>│<span class="w">   </span>├──<span class="w"> </span>func
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>sub-01_task-exp_run-1_bold.json
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>sub-01_task-exp_run-1_bold.nii.gz
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>│<span class="w">   </span>└──<span class="w"> </span>dcmHeaders.mat
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>└──<span class="w"> </span>participants.tsv
</span></code></pre></div>
<ul>
<li>Copy the <code>sub-01</code> folder from <code>dicom_converted</code> into the BIDS folder.</li>
</ul>
</li>
<li>
<p><strong>Validate the BIDS Directory:</strong></p>
<ul>
<li>Use the <a href="https://bids-standard.github.io/bids-validator/">BIDS Validator</a> to check for any errors.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="step-2-processing-subsequent-subjects">Step 2: Processing Subsequent Subjects<a class="headerlink" href="#step-2-processing-subsequent-subjects" title="Permanent link">&para;</a></h4>
<p>If the raw data is organized in a <code>sourcedata/sub-xx</code> folder, and JSON templates are already created:</p>
<ul>
<li>Anonymize/deface the images.</li>
<li>Run <code>script01</code> to move and rename the raw files into the BIDS folder, creating a <code>sub-xx</code> folder for each subject.</li>
</ul>
<hr />
<h3 id="converting-behavioral-data-to-bids">Converting Behavioral Data to BIDS<a class="headerlink" href="#converting-behavioral-data-to-bids" title="Permanent link">&para;</a></h3>
<ul>
<li>Run <code>script02</code> to convert behavioral <code>.mat</code> data into <code>events.tsv</code> files following the BIDS specification. This will parse the trial data from the <code>.mat</code> file and create new <code>.tsv</code> files for each subject and run.</li>
</ul>
<p>The fMRI task script should output two files per run:</p>
<ol>
<li>
<p><code>&lt;timestamp&gt;_log_&lt;subID&gt;-&lt;run&gt;-&lt;buttonMapping&gt;_&lt;taskName&gt;.tsv</code> : This is the human-readable log file produced by the task. Here is an extract from the file:</p>
<table>
<thead>
<tr>
<th>EVENT_TYPE</th>
<th>EVENT_NAME</th>
<th>DATETIME</th>
<th>EXP_ONSET</th>
<th>ACTUAL_ONSET</th>
<th>DELTA</th>
<th>EVENT_ID</th>
</tr>
</thead>
<tbody>
<tr>
<td>START</td>
<td>-</td>
<td>2024-05-03 10:49:43.099</td>
<td>-</td>
<td>0</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>FLIP</td>
<td>Instr</td>
<td>2024-05-03 10:50:11.399</td>
<td>-</td>
<td>28.300201</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>RESP</td>
<td>KeyPress</td>
<td>2024-05-03 10:50:34.160</td>
<td>-</td>
<td>51.063114</td>
<td>-</td>
<td>51</td>
</tr>
<tr>
<td>FLIP</td>
<td>TgrWait</td>
<td>2024-05-03 10:50:34.216</td>
<td>-</td>
<td>51.117046</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>PULSE</td>
<td>Trigger</td>
<td>2024-05-03 10:50:40.000</td>
<td>-</td>
<td>56.904357</td>
<td>-</td>
<td>53</td>
</tr>
</tbody>
</table>
</li>
<li>
<p><code>&lt;timestamp&gt;_log_&lt;subID&gt;_&lt;run&gt;_&lt;taskName&gt;.mat</code>: This MATLAB file contains all the parameters to reproduce the experimental run, and stores input parameters and results.</p>
</li>
</ol>
<p>Ensure that each resulting TSV file has at least three columns: <code>onset</code>, <code>duration</code>, and <code>trial_type</code>.</p>
<p>If the behavioural data is stored in a sourcedata/sub-xx/bh/ folder consistent to the one described <a href="fmri-general.html#how-to-store-raw-data">above</a>, you can run the script02_behavioural-to-BIDS.m script, after editing the parameters at the top of the script. This script iterates through subject-specific directories targeting behavioral .mat files, then processes and exports trial-related info into BIDS-compliant TSV event files in the BIDS folder provided as parameters.</p>
<hr />
<h3 id="converting-eye-tracking-data-to-bids">Converting Eye-Tracking Data to BIDS<a class="headerlink" href="#converting-eye-tracking-data-to-bids" title="Permanent link">&para;</a></h3>
<p><strong>Pre-requisite:</strong> Install the EyeLink Developers Kit/API to convert EDF files into ASC files. Refer to the official setup guide:</p>
<ul>
<li>
<p><a href="https://www.sr-research.com/support/thread-13.html">EyeLink Developers Kit/API</a></p>
</li>
<li>
<p>Run the eye-tracking (ET) conversion script to convert the data to ASC in BIDS format.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>BEP020 has not been approved yet. Consider whether event messages should be included in the BIDS structure.</p>
</div>
</li>
</ul>
<hr />
<h2 id="pre-processing-fmri-data-in-bids-format">Pre-processing fMRI Data in BIDS Format<a class="headerlink" href="#pre-processing-fmri-data-in-bids-format" title="Permanent link">&para;</a></h2>
<h3 id="quality-control-with-mriqc">Quality Control with MRIQC<a class="headerlink" href="#quality-control-with-mriqc" title="Permanent link">&para;</a></h3>
<p>Use <a href="https://mriqc.readthedocs.io/en/latest/">MRIQC</a> to perform quality control checks on your fMRI data:</p>
<div class="language-sh highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">mriqc_batch.sh</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span>
<span class="normal"><a href="#__codelineno-1-22">22</a></span>
<span class="normal"><a href="#__codelineno-1-23">23</a></span>
<span class="normal"><a href="#__codelineno-1-24">24</a></span>
<span class="normal"><a href="#__codelineno-1-25">25</a></span>
<span class="normal"><a href="#__codelineno-1-26">26</a></span>
<span class="normal"><a href="#__codelineno-1-27">27</a></span>
<span class="normal"><a href="#__codelineno-1-28">28</a></span>
<span class="normal"><a href="#__codelineno-1-29">29</a></span>
<span class="normal"><a href="#__codelineno-1-30">30</a></span>
<span class="normal"><a href="#__codelineno-1-31">31</a></span>
<span class="normal"><a href="#__codelineno-1-32">32</a></span>
<span class="normal"><a href="#__codelineno-1-33">33</a></span>
<span class="normal"><a href="#__codelineno-1-34">34</a></span>
<span class="normal"><a href="#__codelineno-1-35">35</a></span>
<span class="normal"><a href="#__codelineno-1-36">36</a></span>
<span class="normal"><a href="#__codelineno-1-37">37</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="ch">#!/bin/bash</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">0</span>..40<span class="o">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$i</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$i</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$i</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$i</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">        </span><span class="k">continue</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="w">    </span><span class="k">fi</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="w">    </span><span class="nv">subID</span><span class="o">=</span><span class="k">$(</span><span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;sub-%02d&quot;</span><span class="w"> </span><span class="nv">$i</span><span class="k">)</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Processing </span><span class="nv">$subID</span><span class="s2">&quot;</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="w">    </span>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--rm<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="w">        </span>-v<span class="w"> </span>/data/BIDS:/data:ro<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="w">        </span>-v<span class="w"> </span>/data/BIDS/derivatives/mriqc:/out<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="w">        </span>-v<span class="w"> </span>/temp_mriqc:/scratch<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="w">        </span>nipreps/mriqc:latest<span class="w"> </span>/data<span class="w"> </span>/out<span class="w"> </span>participant<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="w">        </span>--participant-label<span class="w"> </span><span class="si">${</span><span class="nv">subID</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="w">        </span>--nprocs<span class="w"> </span><span class="m">16</span><span class="w"> </span>--mem-gb<span class="w"> </span><span class="m">40</span><span class="w"> </span>--float32<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="w">        </span>--work-dir<span class="w"> </span>/scratch<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="w">        </span>--verbose-reports<span class="w"> </span>--resource-monitor<span class="w"> </span>-vv
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="w">    </span>sleep<span class="w"> </span><span class="m">0</span>.5
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="k">done</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19"></a>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Running group analysis&quot;</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21"></a>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--rm<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22"></a><span class="w">    </span>-v<span class="w"> </span>/data/BIDS:/data:ro<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23"></a><span class="w">    </span>-v<span class="w"> </span>/data/BIDS/derivatives/mriqc:/out<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24"></a><span class="w">    </span>-v<span class="w"> </span>/temp_mriqc:/scratch<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25"></a><span class="w">    </span>nipreps/mriqc:latest<span class="w"> </span>/data<span class="w"> </span>/out<span class="w"> </span>group<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26"></a><span class="w">    </span>--nprocs<span class="w"> </span><span class="m">16</span><span class="w"> </span>--mem-gb<span class="w"> </span><span class="m">40</span><span class="w"> </span>--float32<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27"></a><span class="w">    </span>--work-dir<span class="w"> </span>/scratch<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28"></a><span class="w">    </span>--verbose-reports<span class="w"> </span>--resource-monitor<span class="w"> </span>-vv
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29"></a>
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30"></a>sleep<span class="w"> </span><span class="m">0</span>.5
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31"></a>
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Running classifier&quot;</span>
</span><span id="__span-1-33"><a id="__codelineno-1-33" name="__codelineno-1-33"></a>docker<span class="w"> </span>run<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-34"><a id="__codelineno-1-34" name="__codelineno-1-34"></a><span class="w">    </span>-v<span class="w"> </span>/temp_mriqc:/scratch<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-35"><a id="__codelineno-1-35" name="__codelineno-1-35"></a><span class="w">    </span>-v<span class="w"> </span>/data/BIDS/derivatives/mriqc:/resdir<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-36"><a id="__codelineno-1-36" name="__codelineno-1-36"></a><span class="w">    </span>-w<span class="w"> </span>/scratch<span class="w"> </span>--entrypoint<span class="o">=</span>mriqc_clf<span class="w"> </span>poldracklab/mriqc:latest<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-37"><a id="__codelineno-1-37" name="__codelineno-1-37"></a><span class="w">    </span>--load-classifier<span class="w"> </span>-X<span class="w"> </span>/resdir/group_T1w.tsv
</span></code></pre></div></td></tr></table></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>JSON files may include <code>NaN</code> values that are incompatible with MRIQC. Use <code>./utils/sanitize_json.py</code> to fix this issue before running MRIQC.</p>
</div>
<hr />
<h3 id="minimal-preprocessing-with-fmriprep">Minimal Preprocessing with fMRIprep<a class="headerlink" href="#minimal-preprocessing-with-fmriprep" title="Permanent link">&para;</a></h3>
<p>With your BIDS data organized, the next step is preprocessing using <a href="https://fmriprep.org/en/stable/">fMRIprep</a>:</p>
<ul>
<li>Install Docker (and WSL if on Windows) and configure it for use with fMRIprep.</li>
<li>Install <code>fmriprep-docker</code> with <code>pip install fmriprep-docker</code>.</li>
<li>Ensure Docker has access to the folders you will be using (e.g., BIDS folder, temporary work directory).</li>
</ul>
<p>To run <code>fmriprep</code> for a single subject, use the following command:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>fmriprep-docker<span class="w"> </span>/data/projects/chess/data/BIDS<span class="w"> </span>/data/projects/chess/data/BIDS/derivatives/fmriprep<span class="w"> </span>participant<span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span>--work-dir<span class="w"> </span>//data/projects/chess/data/temp_fmriprep<span class="w"> </span>--mem-mb<span class="w"> </span><span class="m">10000</span><span class="w"> </span>--n-cpus<span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span>--output-spaces<span class="w"> </span>MNI152NLin2009cAsym:res-2<span class="w"> </span>anat<span class="w"> </span>fsnative<span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span>--fs-license-file<span class="w"> </span>/data/projects/chess/misc/.license<span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">    </span>--bold2t1w-dof<span class="w"> </span><span class="m">9</span><span class="w"> </span>--task<span class="w"> </span>exp<span class="w"> </span>--dummy-scans<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">    </span>--fs-subjects-dir<span class="w"> </span>/data/projects/chess/data/BIDS/derivatives/fastsurfer<span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">    </span>--notrack<span class="w"> </span>--participant-label<span class="w"> </span><span class="m">41</span>
</span></code></pre></div>
<details class="tip">
<summary>Use CIFTI output for surface data</summary>
<p>If you plan to run analysis on <strong>surface data</strong>, consider using <strong>CIFTI output images</strong> from fMRIPrep. While this approach hasn't been directly tested here, CIFTI outputs can provide several advantages:</p>
<ul>
<li><strong>Surface analysis in SPM</strong> (see <a href="https://neurostars.org/t/analyzing-func-gii-files-with-spm12/852/2">this</a> conversation on Neurostars).</li>
<li><strong>CIFTI images</strong> include cortical BOLD time series projected onto the surface using templates like the <strong>Glasser2016 parcellation</strong> (which is also used for MVPA).</li>
<li>This method allows for direct analysis of surface data in formats like <code>.gii</code>, which can be compatible with <strong>SPM</strong> for further analysis.</li>
<li>Using CIFTI outputs could simplify the process of obtaining <strong>surface-based parcellations</strong> and make the data more directly usable in subject space, potentially eliminating the need for complex and time-consuming transformations.</li>
<li>It may also provide a <strong>more accurate representation of cortical activity</strong> by avoiding interpolation errors that can occur when mapping from volume to surface space.</li>
</ul>
<p>If you decide to explore this option, make sure to include the cifti falg in <code>--output-spaces</code> when running <code>fmriprep-docker</code>. This setup will produce CIFTI files (<code>.dtseries.nii</code>) along with standard volumetric outputs, giving you flexibility in how you proceed with your analysis.</p>
</details>
<details class="warning">
<summary>Allocating resources to fMRIprep</summary>
<p><strong>Running fMRIPrep is resource and time intensive</strong>, especially with high-resolution data. Here are some practical tips to optimize the process:</p>
<ul>
<li><strong>Time Estimate</strong>: Processing a single subject can take between <strong>4-8 hours</strong> depending on your system's specifications (e.g., CPU, RAM). Plan accordingly if you have many subjects.</li>
<li>
<p><strong>Optimize Resource Allocation</strong>: Adjust the <code>--n-cpus</code> and <code>--mem-mb</code> arguments to make the best use of your available hardware:</p>
<ul>
<li><strong>n-cpus</strong>: Allocate about 70-80% of your CPU cores to avoid system slowdowns (e.g., <code>--n-cpus 12</code> on a 16-core system).</li>
<li><strong>mem-mb</strong>: Use around <strong>80-90% of your total RAM</strong>, leaving some free for the operating system (e.g., <code>--mem-mb 32000</code> on a 40 GB system).</li>
</ul>
</li>
<li>
<p><strong>Monitor Resource Usage</strong>: While running fMRIPrep, open a system monitor like <strong>Task Manager</strong> (Windows), <strong>Activity Monitor</strong> (Mac), or <strong>htop</strong> (Linux) to observe CPU and memory usage:</p>
<ul>
<li>Aim for <strong>high CPU usage</strong> (close to maximum) and <strong>RAM usage</strong> that is slightly below your system’s capacity.</li>
<li>If memory usage exceeds available RAM, the process might crash due to <strong>Out of Memory (OOM)</strong> errors or cause <strong>disk space issues</strong> if using a <code>--work-dir</code> that fills up.</li>
</ul>
</li>
<li>
<p><strong>Adjust Settings if Necessary</strong>: If you encounter OOM errors or the process is slower than expected:</p>
<ul>
<li><strong>Lower <code>--mem-mb</code></strong>: Decrease memory allocation incrementally (e.g., by 2-4 GB at a time).</li>
<li><strong>Reduce <code>--n-cpus</code></strong>: Using fewer cores can help balance the load and prevent crashes.</li>
<li><strong>Use a dedicated <code>--work-dir</code></strong>: Specify a work directory on a <strong>high-speed SSD</strong> or similar to reduce I/O bottlenecks and ensure there's enough disk space for temporary files.</li>
</ul>
</li>
</ul>
</details>
<p>If the run finishes successfully (check the last line of your terminal output), you should have a new <code>BIDS/derivatives/fmriprep/sub-xx</code> folder. See <a href="https://fmriprep.org/en/stable/outputs.html">here</a> for a complete list of outputs generated by fMRIPrep. Make sure that inside your <code>anat</code> and <code>func</code> folders you have all the scans (anatomical and functional for all runs) in the specified spaces. Since we specified <code>fsnative</code> as a space and did not use the <code>--no-recon-all</code> flag, fMRIPrep will also produce surface data in <code>BIDS/derivatives/fastsurfer/sub-xx</code>.</p>
<hr />
<h3 id="interpreting-fmriprep-visual-reports">Interpreting fMRIPrep Visual Reports<a class="headerlink" href="#interpreting-fmriprep-visual-reports" title="Permanent link">&para;</a></h3>
<p>Check the <code>sub-xx.html</code> report to ensure everything ran smoothly. Pay particular attention to:</p>
<ul>
<li><strong>Registrations</strong>: Verify the alignment between functional and anatomical images.</li>
<li><strong>Framewise Displacement (FD) Values</strong>: Look for runs with unusually high FD values, as these may indicate motion artifacts or poor data quality.</li>
</ul>
<p>For more details, refer to the general guidelines outlined <a href="fmri-prepocessing-qa.html#interpreting-fmriprep-and-mriqc-reports">here</a>, and to the following links:</p>
<ul>
<li><a href="https://fmriprep.org/en/stable/outputs.html#confounds">fMRIPrep Output Confounds</a></li>
<li><a href="https://www.youtube.com/watch?v=fQHEKSzFKDc&amp;list=PLIQIswOrUH6_szyxn9Fy-2cxd3vjlklde&amp;index=3">Video on Reviewing fMRIPrep Outputs</a></li>
</ul>
<hr />
<h2 id="processing-eye-tracking-data-with-bidsmreye">Processing Eye-Tracking Data with <code>bidsmreye</code><a class="headerlink" href="#processing-eye-tracking-data-with-bidsmreye" title="Permanent link">&para;</a></h2>
<p>To process eye-tracking data using <code>bidsmreye</code>, run the following Docker command:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--rm<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">    </span>-v<span class="w"> </span>/data/projects/chess/data/BIDS/derivatives/fmriprep:/data<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span>-v<span class="w"> </span>/data/projects/chess/temp_bidsmreye:/out<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span>cpplab/bidsmreye:0.5.0<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span>/data<span class="w"> </span>/out<span class="w"> </span>participant<span class="w"> </span>all<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">    </span>--space<span class="w"> </span>T1w<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">    </span>--reset_database<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">    </span>--verbose
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In my experience, <code>bidsmreye</code> worked only when using the <code>T1w</code> fMRIPrep output space.</p>
</div>
<hr />
<h2 id="first-level-analysis-general-linear-model-glm">First-Level Analysis – General Linear Model (GLM)<a class="headerlink" href="#first-level-analysis-general-linear-model-glm" title="Permanent link">&para;</a></h2>
<p>After preprocessing, proceed to the first-level analysis with the GLM. Running the GLM and setting contrasts is straightforward using <code>script03</code>. Make sure to adjust the following parameters:</p>
<ul>
<li><strong>Paths</strong>:</li>
<li><code>fmriprepRoot</code>: Path to the fMRIPrep folder.</li>
<li><code>BIDSRoot</code>: Path to your BIDS folder.</li>
<li><code>outRoot</code>: Path to save GLM results (ideally in the derivatives folder, in a <code>fmriprep-spm</code> folder).</li>
<li>
<p><code>tempDir</code>: Directory for temporary files, such as uncompressed or smoothed files.</p>
</li>
<li>
<p><strong>Subject Selection</strong>:</p>
<p>Leave a new line before listing subjects.</p>
</li>
<li>
<p><code>selectedSubjectsList</code>: A list of integers like <code>[41, 42, 43, 44]</code> or use <code>'*'</code> to analyze all subjects.</p>
</li>
<li>
<p><code>selectedRuns</code>: List of runs to analyze.</p>
</li>
<li>
<p><strong>Contrasts Setup</strong>:</p>
<div class="language-matlab highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">selectedTasks</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;exp&#39;</span><span class="p">;</span><span class="w">  </span><span class="c">% The name of the task. Must match the task name in your BIDS filenames.</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="n">selectedTasks</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">contrasts</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;Check &gt; No-Check&#39;</span><span class="p">};</span><span class="w">  </span><span class="c">% Name of the contrast.</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="n">selectedTasks</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">weights</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">struct</span><span class="p">(</span><span class="s">&#39;C_WILDCARD___WILDCARD_&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;NC_WILDCARD___WILDCARD_&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">);</span><span class="w">  </span><span class="c">% Weights for each regressor.</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="n">selectedTasks</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">smoothBool</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w">  </span><span class="c">% Whether to smooth images before GLM. Useful for localizers.</span>
</span></code></pre></div>
</li>
</ul>
<p>If everything is configured correctly, the script will generate new <code>sub-xx</code> folders in your output directory. These folders will contain subdirectories for each analysis task, with <code>beta_000x.nii</code> files for each regressor (including confounds and conditions).</p>
<hr />
<h3 id="verifying-the-design-matrix">Verifying the Design Matrix<a class="headerlink" href="#verifying-the-design-matrix" title="Permanent link">&para;</a></h3>
<p>It is advisable to verify that the design matrix is set up correctly:</p>
<ol>
<li>Open the SPM GUI by typing <code>spm fmri</code> in the MATLAB Command Window.</li>
<li>Click on <strong>Results</strong> and select the <code>SPM.mat</code> file located in your <code>BIDS/fmriprep-spm/{space}/sub-xx/{task_name}/</code> directory.</li>
<li>
<p>This will open the SPM Contrast Manager, showing the design matrix and assigned contrasts. Ensure the following:</p>
<ul>
<li>No overlapping or unusually long conditions.</li>
<li>The correct number of runs.</li>
<li>Confound regressors are positioned at the end of each run.</li>
<li>Contrast weights are assigned correctly.</li>
</ul>
</li>
<li>
<p>Select your contrast and click <strong>Done</strong>.</p>
</li>
<li>In the next window, set the following options:<ul>
<li><strong>Apply masking</strong>: None</li>
<li><strong>P-value adjustment</strong>: None</li>
<li><strong>Threshold</strong>: <code>0.001</code></li>
<li><strong>Extent threshold</strong>: <code>0</code></li>
</ul>
</li>
</ol>
<p>This will display the results of the contrast (thresholded t-map) on the top right, along with a list of significantly active clusters in the bottom right panel.</p>
<hr />
<h3 id="visualizing-activations">Visualizing Activations<a class="headerlink" href="#visualizing-activations" title="Permanent link">&para;</a></h3>
<p>To visualize activations on a volume or surface:</p>
<ol>
<li>Click <strong>Display</strong> -&gt; <strong>overlays...</strong> in the SPM GUI.</li>
<li>Select <strong>sections</strong> for volume plotting or <strong>render</strong> for surface plotting.</li>
<li>Choose the subject's anatomical image from <code>BIDS/derivatives/fmriprep/sub-xx/anat</code>.<ul>
<li>For volume plots, select the <code>.nii</code> file corresponding to the same space as your GLM (usually MNI).</li>
<li>For surface plots, select the pial or inflated brain image.</li>
</ul>
</li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>SPM cannot read <code>.nii.gz</code> files directly, so you must decompress them into <code>.nii</code> files. This can be done with any decompression tool by right-clicking on the file in your file explorer. Once decompressed, use the SPM GUI to select the <code>.nii</code> file.</p>
</div>
<hr />
<h2 id="generating-and-organizing-regions-of-interest-rois">Generating and Organizing Regions of Interest (ROIs)<a class="headerlink" href="#generating-and-organizing-regions-of-interest-rois" title="Permanent link">&para;</a></h2>
<h3 id="rois-from-functional-localizers">ROIs from Functional Localizers<a class="headerlink" href="#rois-from-functional-localizers" title="Permanent link">&para;</a></h3>
<p>To run MVPA, you need Regions of Interest (ROIs) to select your voxels. You can obtain ROIs through:</p>
<ul>
<li><strong>Functional Localizers</strong>: Perform a localizer task in the scanner, then run a GLM on the preprocessed and smoothed data. For example, <code>Faces &gt; Objects</code> to identify the <strong>FFA</strong>.</li>
<li><strong>Pre-defined Anatomical Masks</strong>: Use anatomical masks in the same space as your subjects (e.g., MNI). Ensure the mask resolution matches the resolution of your data (e.g., resample/reslice if necessary using tools like <strong>ANTs</strong>, <strong>SPM</strong>, or Python libraries like <strong>nilearn</strong> or <strong>nibabel</strong>).</li>
</ul>
<hr />
<h3 id="hcp-glasser-parcellation">HCP Glasser Parcellation<a class="headerlink" href="#hcp-glasser-parcellation" title="Permanent link">&para;</a></h3>
<p>In my pipeline, I use the <a href="https://figshare.com/articles/dataset/HCP-MMP1_0_projected_on_fsaverage/3498446">Glasser2016 parcellation projected on <code>fsaverage</code></a>, which includes 180 ROIs per hemisphere. This process involves converting Glasser parcellation annotation files to labels and mapping them from <code>fsaverage</code> to the subject's T1 and MNI spaces. Use the <code>HPC-to-subject.sh</code> script for automation (see the top of the script file for usage notes).</p>
<hr />
<h2 id="multi-variate-pattern-analysis-mvpa">Multi-Variate Pattern Analysis (MVPA)<a class="headerlink" href="#multi-variate-pattern-analysis-mvpa" title="Permanent link">&para;</a></h2>
<h3 id="running-decoding-with-svm">Running Decoding with SVM<a class="headerlink" href="#running-decoding-with-svm" title="Permanent link">&para;</a></h3>
<p>After organizing your ROIs, proceed with the MVPA analysis:</p>
<ul>
<li>Use <code>script04</code> to perform independent cross-validated SVM classification on each subject and ROI.</li>
<li>The script outputs decoding accuracy for each ROI of the HCP parcellation.</li>
</ul>
<p>The results are saved in a <code>BIDS/derivatives/mvpa</code> folder organized according to the BIDS structure. Each subject's folder will contain a <code>.tsv</code> file with the decoding accuracy results.</p>
<hr />
<h3 id="plotting-and-reporting">Plotting and Reporting<a class="headerlink" href="#plotting-and-reporting" title="Permanent link">&para;</a></h3>
<p>The Glasser parcellation includes parcels at three levels, with each higher level grouping several ROIs into a single ROI. In my pipeline, the analysis is performed at the lowest level (180 parcels per hemisphere), then averaged across ROIs within a larger ROI using <code>script06</code>.</p>
<ul>
<li>The script computes the significance of each decoding accuracy against chance.</li>
<li>It generates plots of significant accuracies on an inflated brain for each grouping level.</li>
</ul>
<p>For example:</p>
<p><img alt="Decoding Example" src="../../../assets/external/raw.githubusercontent.com/HOPLAB-LBP/hoplab-wiki/main/docs/assets/combined_brain_grid.png"></p>
<hr />
<p><strong>TODO:</strong> Add links to folder structure and/or data.
<strong>TODO:</strong> Add information about defacing/anonymizing raw data (including filenames) using my script.
<strong>TODO:</strong> Improve and add details for the parameters required in the <code>script02_behavioural-to-BIDS.m</code>.
<strong>TODO:</strong> Wrap NIfTI and behavioral data to BIDS conversion into a single script that accepts input arguments.
<strong>TODO:</strong> Provide more details on how behavioral files are saved and on the BIDS structure.
<strong>TODO:</strong> Include references to other commonly used atlases for ROI generation.
<strong>TODO:</strong> Explain how to save and run the <code>mriqc</code> commands.
<strong>TODO:</strong> Refine the phrasing and add more info on the parameters for GLM and contrasts setup.
<strong>TODO:</strong> Possibly include screenshots for better clarity (e.g., code sections).</p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">October 20, 2024 01:17:23</span>
  </span>

    
    
    
      
  
  <span class="md-source-file__fact">
    <span class="md-icon" title="Contributors">
      
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 4a4 4 0 0 1 4 4 4 4 0 0 1-4 4 4 4 0 0 1-4-4 4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4"/></svg>
      
    </span>
    <nav>
      
        <a href="mailto:59078281+costantinoai@users.noreply.github.com">costantinoai</a>
    </nav>
  </span>

    
    
  </aside>


  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        Was this page helpful?
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page was helpful" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page could be improved" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              Thanks for your feedback!
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              Thanks for your feedback! Help us improve this page by opening a new <a href="https://github.com/HOPLAB-LBP/hoplab-wiki/issues/new/?title=[Feedback]+fMRI%20workflow%20example+-+/research/fmri/analysis/fmri-andrea-workflow.html" target="_blank" rel="noopener">Issue</a>, or contact a Wiki manager.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      <a href="#__consent">Change cookie settings</a>            
    

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  


  
    
  



  


<h4>Cookie consent</h4>
<p>Please, consider disabling your ad-blocker and allowing cookies for this Wiki .  We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="github" checked>
          <span class="task-list-indicator"></span>
          GitHub
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.tabs.link", "content.code.copy", "content.code.select", "content.action.edit", "navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.sections", "search.highlight", "navigation.indexes"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="../../../assets/external/unpkg.com/mermaid@11/dist/mermaid.min.js"></script>
      
    
  </body>
</html>