
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="fmri-mvpa.html">
      
      
        <link rel="next" href="../../eeg/index.html">
      
      
      <link rel="icon" href="../../../assets/hoplab_favicon_white.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.40">
    
    
      
        <title>fMRI workflow example - Hoplab Wiki</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.8c3ca2c6.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
        <script src="../../../assets/external/unpkg.com/iframe-worker/shim.js"></script>
      
    
    
      
        
        
        
        <link rel="stylesheet" href="../../../assets/external/fonts.googleapis.com/css.49ea35f2.css">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#functional-mri" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../index.html" title="Hoplab Wiki" class="md-header__button md-logo" aria-label="Hoplab Wiki" data-md-component="logo">
      
  <img src="../../../assets/thicker_white_brain.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Hoplab Wiki
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              fMRI workflow example
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/HOPLAB-LBP/hoplab-wiki/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    HOPLAB-LBP/hoplab-wiki
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html" class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../get-started/index.html" class="md-tabs__link">
          
  
    
  
  Getting started

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../index.html" class="md-tabs__link">
          
  
    
  
  Research

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../outreach.html" class="md-tabs__link">
        
  
    
  
  Science outreach

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../contribute.html" class="md-tabs__link">
        
  
    
  
  Contribute

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../index.html" title="Hoplab Wiki" class="md-nav__button md-logo" aria-label="Hoplab Wiki" data-md-component="logo">
      
  <img src="../../../assets/thicker_white_brain.svg" alt="logo">

    </a>
    Hoplab Wiki
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/HOPLAB-LBP/hoplab-wiki/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    HOPLAB-LBP/hoplab-wiki
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../get-started/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../get-started/useful-links.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Useful links
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../get-started/mailing-lists.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mailing lists
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../get-started/practical-setup.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practical set-up
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../get-started/computer-setup.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Computer set-up
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../get-started/admin-procedures.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Administrative procedures
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../get-started/student-starter-pack.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Student starter pack
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../get-started/social-activities.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Social activities
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Research
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Research
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../ethics/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Ethical approval
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_2" id="__nav_3_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Ethical approval
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ethics/MEC.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EC onderzoek
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ethics/SMEC.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SMEC
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../coding/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Coding practices
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Coding practices
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../behaviour/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Behaviour
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_4" id="__nav_3_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Behaviour
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../behaviour/participants.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Find participants
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../behaviour/experimental-setup.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Set up your experiment
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    fMRI
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_5" id="__nav_3_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            fMRI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fmri-get-started.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    First steps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fmri-hospital.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hospital information
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fmri-general.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    General information
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5_5" checked>
        
          
          <label class="md-nav__link" for="__nav_3_5_5" id="__nav_3_5_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Analysis workflow
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_5_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_5_5">
            <span class="md-nav__icon md-icon"></span>
            Analysis workflow
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-setup-env.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Set-up you environment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-bids-conversion.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. BIDS conversion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-prepocessing-qa.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Pre-processing and QA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-glm.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. First-level analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-rois.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. Regions of interest
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-mvpa.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. Multi-variate analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    fMRI workflow example
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="fmri-andrea-workflow.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    fMRI workflow example
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#from-raw-data-to-bids" class="md-nav__link">
    <span class="md-ellipsis">
      From raw data to BIDS
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fmri-bids-pre-processing" class="md-nav__link">
    <span class="md-ellipsis">
      fMRI BIDS pre-processing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bidsmreye" class="md-nav__link">
    <span class="md-ellipsis">
      bidsmreye
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#first-level-analysis-glm" class="md-nav__link">
    <span class="md-ellipsis">
      First-level analysis -- GLM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generate-and-organize-your-regions-of-interest-masks" class="md-nav__link">
    <span class="md-ellipsis">
      Generate and organize your Regions of Interest masks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multi-variate-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Multi-variate analysis
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../eeg/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    EEG
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            EEG
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../eyetracking/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Eye-tracking
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            Eye-tracking
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../dnn/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Neural Networks
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            Neural Networks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../outreach.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Science outreach
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contribute.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contribute
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/HOPLAB-LBP/hoplab-wiki/edit/main/docs/research/fmri/analysis/fmri-andrea-workflow.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="functional-mri">Functional MRI<a class="headerlink" href="#functional-mri" title="Permanent link">&para;</a></h1>
<p>This page is a work in progress and it is based on what I do in my fMRI pipeline. This info may change once we agree on shared practices.</p>
<p>The code to reproduce these analyses can be found <a href="https://github.com/costantinoai/chess-expertise-2024">here</a>.</p>
<ul>
<li><strong>TODO:</strong>  add links to folder structure and/or data</li>
</ul>
<h2 id="from-raw-data-to-bids">From raw data to BIDS<a class="headerlink" href="#from-raw-data-to-bids" title="Permanent link">&para;</a></h2>
<h3 id="collect-raw-data">Collect raw data<a class="headerlink" href="#collect-raw-data" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>TODO:</strong>  add info about defacing/anonymizing (also the filenames.. use my script). </li>
</ul>
<p>at the hospital:
  - take fmri scans from the hospital computer. in the gui, specify what buttons to select.
  - anonymize the fnames with the script i use. this is important to protect subjects privacy (no names should be in the files that leave the hospital)
  - take bh and et data from the output folders in the exp PC
  - copy all the files into a sourcedata/ folder in bh, nifti, et folders</p>
<h3 id="fmri-data-to-bids">fMRI data to BIDS<a class="headerlink" href="#fmri-data-to-bids" title="Permanent link">&para;</a></h3>
<h4 id="for-your-first-subject">For your first subject:<a class="headerlink" href="#for-your-first-subject" title="Permanent link">&para;</a></h4>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>This step should only be performed for the first subject in your dataset, and can be skipped if the anatomical and functional JSON templates are available in <code>code/misc/</code> (see <a href="../fmri-general.html#how-to-get-images-from-the-scanner">here</a> for more info on the template files)</p>
</div>
<ol>
<li>
<p><strong>Convert DICOM to BIDS (NIfTI):</strong></p>
<ul>
<li><strong>Prerequisites:</strong><ul>
<li><code>dcm2nii</code></li>
<li>Raw data should be organized as: <code>/sourcedata/sub-&lt;xx&gt;/dicom</code></li>
<li>MATLAB</li>
</ul>
</li>
</ul>
<p>1.1. Download <code>dicm2nii</code> from <a href="https://github.com/xiangruili/dicm2nii">dicm2nii</a>, unzip, and add to the MATLAB path.</p>
<p>1.2. Open MATLAB and type <code>anonymize_dicm</code> in the console. Enter and it will ask you to select the folder where the files are and the folder in which you want to save it: <code>/sourcedata/sub-&lt;xx&gt;/dicom_Anon</code>.</p>
</li>
<li>
<p><strong>TODO:</strong> for simplicity, probably a good idea to check out and add to pipeline this <a href="https://github.com/PeerHerholz/BIDSonym">https://github.com/PeerHerholz/BIDSonym</a></p>
<p>1.3. Run the <code>dicm2nii</code> MATLAB function from the unzipped file. Just write <code>dicm2nii</code> in the command window. A pop-up will appear: select DICOM folder (Dicom_Anon. files) and result folder (Dicom_Converted). Untick the compress box and make sure you select save JSON file. Start conversion. A pop-up appears: subject (only number of the subject, e.g., 01). Type: <code>func</code> (T2 scans) and <code>anat</code> (T1 scans). Under modality, we need <code>task-{name of the task}_run-{number of run}_bold</code>, e.g., <code>task-exp_run-2_bold</code>. Modality for anatomical scans is <code>T1W</code>. This pop-up will appear for each run of the fMRI sequence.</p>
<p>At the end of this process, we have a new folder called <code>dicom_converted</code> structured as follows:
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>dicom_converted
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>├── sub-01
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>│   ├── anat
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>│   │   ├── sub-01_T1w.json
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>│   │   └── sub-01_T1w.nii.gz
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>│   ├── func
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>│   │   ├── sub-01_task-exp_run-1_bold.json
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>│   │   └── sub-01_task-exp_run-1_bold.nii.gz
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>│   └── dcmHeaders.mat
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>└── participants.tsv
</span></code></pre></div></p>
<p>Copy your <code>sub-01</code> folder from <code>dicom_converted</code> into the BIDS folder (make a new one if you don't have one).</p>
</li>
</ol>
<p><strong>NOTE:</strong> The pop-up only appeared with the first participant and then does it automatically. This is quite annoying as it never gets the participant number right so you have to manually go in and change it. It also only worked when providing it with (enhanced) DICOM files.</p>
<ol>
<li><strong>Validate the BIDS directory (and solve errors):</strong><ul>
<li><a href="https://bids-standard.github.io/bids-validator/">BIDS Validator</a></li>
</ul>
</li>
</ol>
<h4 id="after-your-first-subject">After your first subject:<a class="headerlink" href="#after-your-first-subject" title="Permanent link">&para;</a></h4>
<p>This step assumes that your raw data is organized in a <code>sourcedata/sub-xx</code> folder, and that you already created the JSON templates in the <code>misc/</code> folder, as described in <a href="../fmri-general.html#how-to-store-raw-data">here</a>. </p>
<p>Now I have my source data folder. We need to.
  - anonymize/deface the images
  - run the script01 to move and rename the raw files into the main BIDS folder. This will create a sub-xx folder for each raw sub data</p>
<h3 id="behavioral-data-to-bids">Behavioral Data to BIDS<a class="headerlink" href="#behavioral-data-to-bids" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>TODO:</strong> here Tim should describe name and format of the logfiles</li>
<li><strong>TODO:</strong> add ref to fMRI task repo</li>
</ul>
<p>Run the script02 to convert the behavioural mat data into events.tsv files following the BIDS specification. This will parse the trial data from the mat file, and create new tsv files into each sub-xx folder corresponding to each run. </p>
<p>The fMRI task script should give two files per run as output (see the folder structure <a href="../fmri-general.html#how-to-store-raw-data">here</a>). Here is a description of the naming structure and file content:</p>
<ol>
<li><code>&lt;timestamp&gt;_log_&lt;subID&gt;-&lt;run&gt;-&lt;buttonMapping&gt;_&lt;taskName&gt;.tsv</code>: This is the human-readable log file produced by the task. Here is an extract from the file:</li>
</ol>
<table>
<thead>
<tr>
<th>EVENT_TYPE</th>
<th>EVENT_NAME</th>
<th>DATETIME</th>
<th>EXP_ONSET</th>
<th>ACTUAL_ONSET</th>
<th>DELTA</th>
<th>EVENT_ID</th>
</tr>
</thead>
<tbody>
<tr>
<td>START</td>
<td>-</td>
<td>2024-05-03 10:49:43.099</td>
<td>-</td>
<td>0</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>FLIP</td>
<td>Instr</td>
<td>2024-05-03 10:50:11.399</td>
<td>-</td>
<td>28.300201</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>RESP</td>
<td>KeyPress</td>
<td>2024-05-03 10:50:34.160</td>
<td>-</td>
<td>51.063114</td>
<td>-</td>
<td>51</td>
</tr>
<tr>
<td>FLIP</td>
<td>TgrWait</td>
<td>2024-05-03 10:50:34.216</td>
<td>-</td>
<td>51.117046</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>PULSE</td>
<td>Trigger</td>
<td>2024-05-03 10:50:40.000</td>
<td>-</td>
<td>56.904357</td>
<td>-</td>
<td>53</td>
</tr>
</tbody>
</table>
<ol>
<li><code>&lt;timestamp&gt;_log_&lt;subID&gt;_&lt;run&gt;_&lt;taskName&gt;.mat</code>: This MATLAB file contains all the parameters to reproduce the experimental run, and stores input parameters and results.</li>
</ol>
<p>If the behavioural data is stored in a <code>sourcedata/sub-xx/bh/</code> folder consistent to the one described <a href="../fmri-general.html#how-to-store-raw-data">above</a>, you can run the <code>script02_behavioural-to-BIDS.m</code> script, after editing the parameters at the top of the script. This script iterates through subject-specific directories targeting behavioral .mat files, then processes and exports trial-related info into BIDS-compliant TSV event files in the BIDS folder provided as parameters.</p>
<ul>
<li><strong>TODO:</strong> above, we need to phrase better and add more info about what these parameters are, possibly with a screenshot of the code. Also, in the code make more clear where the parameters are.</li>
<li><strong>TODO:</strong> perhaps wrap nifti and bh 2 BIDS in a single script that takes some input arguments? </li>
<li><strong>TODO:</strong> we need to add more info about how these files are saved, and more in general about the BIDS structure</li>
</ul>
<p>Ensure that each resulting tsv file has at least three columns representing: <code>onset</code>, <code>duration</code>, <code>trial_type</code>.</p>
<h3 id="eye-tracking-data-to-bids">Eye-Tracking Data to BIDS<a class="headerlink" href="#eye-tracking-data-to-bids" title="Permanent link">&para;</a></h3>
<p><strong>Pre-requisite:</strong> To convert EDF files into more easy-to-read ASC files, you need to install the EyeLink Developers Kit / API. More info and how-to:</p>
<ul>
<li>
<p><a href="https://www.sr-research.com/support/thread-13.html">EyeLink Developers Kit / API</a></p>
</li>
<li>
<p>Run the ET script to convert to ASC in BIDS format.</p>
</li>
<li>
<p><strong>NOTE:</strong> BEP020 has not been approved yet. Not sure if the events MSG should be included here or not.</p>
</li>
</ul>
<p><a href="https://github.com/s-ccs/pyedfread">https://github.com/s-ccs/pyedfread</a></p>
<h2 id="fmri-bids-pre-processing">fMRI BIDS pre-processing<a class="headerlink" href="#fmri-bids-pre-processing" title="Permanent link">&para;</a></h2>
<h3 id="quality-check">Quality check<a class="headerlink" href="#quality-check" title="Permanent link">&para;</a></h3>
<p>link: <a href="https://mriqc.readthedocs.io/en/latest/">mriqc</a></p>
<ul>
<li>
<p><strong>TODO:</strong> explain how to save and run this below</p>
</li>
<li>
<p><strong>TODO:</strong> explain that the one below may fail, in that case run the single commands separately</p>
</li>
</ul>
<div class="language-sh highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">mriqc_batch.sh</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span>
<span class="normal"><a href="#__codelineno-1-22">22</a></span>
<span class="normal"><a href="#__codelineno-1-23">23</a></span>
<span class="normal"><a href="#__codelineno-1-24">24</a></span>
<span class="normal"><a href="#__codelineno-1-25">25</a></span>
<span class="normal"><a href="#__codelineno-1-26">26</a></span>
<span class="normal"><a href="#__codelineno-1-27">27</a></span>
<span class="normal"><a href="#__codelineno-1-28">28</a></span>
<span class="normal"><a href="#__codelineno-1-29">29</a></span>
<span class="normal"><a href="#__codelineno-1-30">30</a></span>
<span class="normal"><a href="#__codelineno-1-31">31</a></span>
<span class="normal"><a href="#__codelineno-1-32">32</a></span>
<span class="normal"><a href="#__codelineno-1-33">33</a></span>
<span class="normal"><a href="#__codelineno-1-34">34</a></span>
<span class="normal"><a href="#__codelineno-1-35">35</a></span>
<span class="normal"><a href="#__codelineno-1-36">36</a></span>
<span class="normal"><a href="#__codelineno-1-37">37</a></span>
<span class="normal"><a href="#__codelineno-1-38">38</a></span>
<span class="normal"><a href="#__codelineno-1-39">39</a></span>
<span class="normal"><a href="#__codelineno-1-40">40</a></span>
<span class="normal"><a href="#__codelineno-1-41">41</a></span>
<span class="normal"><a href="#__codelineno-1-42">42</a></span>
<span class="normal"><a href="#__codelineno-1-43">43</a></span>
<span class="normal"><a href="#__codelineno-1-44">44</a></span>
<span class="normal"><a href="#__codelineno-1-45">45</a></span>
<span class="normal"><a href="#__codelineno-1-46">46</a></span>
<span class="normal"><a href="#__codelineno-1-47">47</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="ch">#!/bin/bash</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="c1">## Iterate over subject numbers</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">0</span>..40<span class="o">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="w">    </span><span class="c1">## Skip subject 0, 5, 14, 31</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$i</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$i</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$i</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$i</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="w">        </span><span class="k">continue</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="w">    </span><span class="k">fi</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9"></a>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="w">    </span><span class="c1">## Format subject number with leading zeros</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="w">    </span><span class="nv">subID</span><span class="o">=</span><span class="k">$(</span><span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;sub-%02d&quot;</span><span class="w"> </span><span class="nv">$i</span><span class="k">)</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Processing </span><span class="nv">$subID</span><span class="s2">&quot;</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13"></a>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="w">    </span><span class="c1">## Docker command with dynamic subject ID using sudo</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="w">    </span>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--rm<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="w">    </span>-v<span class="w"> </span>/data/BIDS:/data:ro<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="w">    </span>-v<span class="w"> </span>/data/BIDS/derivatives/mriqc:/out<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="w">    </span>-v<span class="w"> </span>/temp_mriqc:/scratch<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="w">    </span>nipreps/mriqc:latest<span class="w"> </span>/data<span class="w"> </span>/out<span class="w"> </span>participant<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20"></a><span class="w">    </span>--participant-label<span class="w"> </span><span class="si">${</span><span class="nv">subID</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21"></a><span class="w">    </span>--nprocs<span class="w"> </span><span class="m">16</span><span class="w"> </span>--mem-gb<span class="w"> </span><span class="m">40</span><span class="w"> </span>--float32<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22"></a><span class="w">     </span>--work-dir<span class="w"> </span>/scratch<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23"></a><span class="w">     </span>--verbose-reports<span class="w"> </span>--resource-monitor<span class="w"> </span>-vv
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24"></a>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25"></a><span class="w">    </span><span class="c1">## Wait or perform other actions between runs if needed</span>
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26"></a><span class="w">    </span>sleep<span class="w"> </span><span class="m">0</span>.5
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27"></a><span class="k">done</span>
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28"></a>
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Running group analysis&quot;</span>
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30"></a>
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31"></a>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--rm<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32"></a>-v<span class="w"> </span>/data/BIDS:/data:ro<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-33"><a id="__codelineno-1-33" name="__codelineno-1-33"></a>-v<span class="w"> </span>/data/BIDS/derivatives/mriqc:/out<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-34"><a id="__codelineno-1-34" name="__codelineno-1-34"></a>-v<span class="w"> </span>/temp_mriqc:/scratch<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-35"><a id="__codelineno-1-35" name="__codelineno-1-35"></a>nipreps/mriqc:latest<span class="w"> </span>/data<span class="w"> </span>/out<span class="w"> </span>group<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-36"><a id="__codelineno-1-36" name="__codelineno-1-36"></a>--nprocs<span class="w"> </span><span class="m">16</span><span class="w"> </span>--mem-gb<span class="w"> </span><span class="m">40</span><span class="w"> </span>--float32<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-37"><a id="__codelineno-1-37" name="__codelineno-1-37"></a><span class="w"> </span>--work-dir<span class="w"> </span>/scratch<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-38"><a id="__codelineno-1-38" name="__codelineno-1-38"></a><span class="w"> </span>--verbose-reports<span class="w"> </span>--resource-monitor<span class="w"> </span>-vv
</span><span id="__span-1-39"><a id="__codelineno-1-39" name="__codelineno-1-39"></a>
</span><span id="__span-1-40"><a id="__codelineno-1-40" name="__codelineno-1-40"></a>sleep<span class="w"> </span><span class="m">0</span>.5
</span><span id="__span-1-41"><a id="__codelineno-1-41" name="__codelineno-1-41"></a>
</span><span id="__span-1-42"><a id="__codelineno-1-42" name="__codelineno-1-42"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Running classifier&quot;</span>
</span><span id="__span-1-43"><a id="__codelineno-1-43" name="__codelineno-1-43"></a>docker<span class="w"> </span>run<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-44"><a id="__codelineno-1-44" name="__codelineno-1-44"></a>-v<span class="w"> </span>/temp_mriqc:/scratch<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-45"><a id="__codelineno-1-45" name="__codelineno-1-45"></a>-v<span class="w"> </span>/data/BIDS/derivatives/mriqc:/resdir<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-46"><a id="__codelineno-1-46" name="__codelineno-1-46"></a>-w<span class="w"> </span>/scratch<span class="w"> </span>--entrypoint<span class="o">=</span>mriqc_clf<span class="w"> </span>poldracklab/mriqc:latest<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-47"><a id="__codelineno-1-47" name="__codelineno-1-47"></a><span class="w"> </span>--load-classifier<span class="w"> </span>-X<span class="w"> </span>/resdir/group_T1w.tsv
</span></code></pre></div></td></tr></table></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In some cases, the JSON files corresponding to each nifti file can include <code>NaN</code> values, which are not compatible with JSON encoders and will raise an error when running mriqc. A quick (and dirty) solution would be to sanitize all the JSON files before running mriqc. I made a small utility script that can help with that. See <code>./utils/sanitize_json.py</code>.</p>
</div>
<h3 id="minimal-preprocessing-with-fmriprep">Minimal preprocessing with fMRIprep<a class="headerlink" href="#minimal-preprocessing-with-fmriprep" title="Permanent link">&para;</a></h3>
<p>link: <a href="https://fmriprep.org/en/stable/">fMRIprep</a></p>
<p>Now we have our base (raw) data organized in a BIDS folder. this is our starting point for any other analysis. What now?
The main steps we need to follow are: fmriprep, GLM. rois. mvpa</p>
<p>For fmriprep: (fmriprep, docker, fmripre-docker)
  - install docker (and WSL if on windows). Assign resources (RAM, disk, cpus) reasonably (&lt; 80% of your system capacity).
  - install fmriprep-docker. this is as easy as <code>pip install fmriprep-docker</code>.
  - share with docker the folders you are going to use. these are you BIDS folder, and a <code>temp_fmriprep</code> folder.
  - run fmripre-docker. Below you can see my terminal call to pre-process sub-41. The arguments I use (and a lot more that I don't use) are explained <a href="https://fmriprep.org/en/stable/usage.html">here</a>. Make sure you are familiar with these.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>fmriprep-docker<span class="w"> </span>/data/projects/chess/data/BIDS<span class="w"> </span>/data/projects/chess/data/BIDS/derivatives/fmriprep<span class="w"> </span>participant<span class="w"> </span>--work-dir<span class="w"> </span>//data/projects/chess/data/temp_fmriprep<span class="w"> </span>--mem-mb<span class="w"> </span><span class="m">10000</span><span class="w"> </span>--n-cpus<span class="w"> </span><span class="m">16</span><span class="w"> </span>--output-spaces<span class="w"> </span>MNI152NLin2009cAsym:res-2<span class="w"> </span>anat<span class="w"> </span>fsnative<span class="w"> </span>--fs-license-file<span class="w"> </span>/data/projects/chess/misc/.license<span class="w"> </span>--bold2t1w-dof<span class="w"> </span><span class="m">9</span><span class="w"> </span>--task<span class="w"> </span>exp<span class="w"> </span>--dummy-scans<span class="w"> </span><span class="m">0</span><span class="w"> </span>--fs-subjects-dir<span class="w"> </span>/data/projects/chess/data/BIDS/derivatives/fastsurfer<span class="w"> </span>--notrack<span class="w"> </span>--participant-label<span class="w"> </span><span class="m">41</span>
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>if you want to run analysis on surface data, you may want to consider getting CIFTI output images from fmriprep. I did not test this, but it should produce cortical BOLD series projected from the Glasser2016 template (the same parcellation I use for MVPA). In theory, SPM should be able to analyze .gii surface data, and bt getting the CIFTI outputs you should already have the parcellation projected to subject space for subsequent analyses. Or at least it should give a Glasser parcellation on subject/MNI space that is directly usable for MVPA, therefore skipping the quite time-sonsuming and complicate step to produce the HPC ROIs (see below)</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>this call is very resource and time intensive. It will take several hours (4-8, depending on your PC specs) at full capacity to preprocess a single subject. If you need to process many subjects, you may want to play with the ncpus and mem-mb parameters to be sure that you are using all the available resources. A good test of this is to open the task manager on windows, and check the CPU and RAM usage during a run. Ideally, we want the CPU to be always at max speed, and the RAM to be 10 GB below the maximum. If the RAM needed by the process is higher than the RAM available, you will get Out of Memory errors, or No more space on disk errors if you did not specify a work-dir folder. If this happens, lower the mem-mb and n-cpus until tyou find the right spot.</p>
</div>
<p>If the run finishes successfully (check the last line of your terminal output), you should have a new <code>BIDS/derivatives/fmriprep/sub-xx</code> folder (see <a href="https://fmriprep.org/en/stable/outputs.html">here</a> for a complete list of outputs generated by fmriprep). make sure that inside you <code>anat</code> and <code>func</code> folders you have all the scans (anatomical, functional all runs) in the spaces you specified. Since we specified fsnative as space and we did not use the no-recon-all flag, fmriprep will also produce surface data in <code>BIDS/derivatives/fastsurfer/sub-xx</code>.</p>
<h4 id="how-to-interpret-fmriprep-visual-reports">How to interpret fMRIprep visual reports<a class="headerlink" href="#how-to-interpret-fmriprep-visual-reports" title="Permanent link">&para;</a></h4>
<p>Check the sub-xx.hmtl report to make sure everything run smoothly. Specifically, check the registrations, and look for particularly high FD values in the functional runs -- they may be indicative of poor data. See <a href="https://fmriprep.org/en/stable/outputs.html#confounds">this page</a> for a description of the confounds and <a href="https://www.youtube.com/watch?v=fQHEKSzFKDc&amp;list=PLIQIswOrUH6_szyxn9Fy-2cxd3vjlklde&amp;index=3">this video</a> for more information on what to look for.</p>
<h2 id="bidsmreye">bidsmreye<a class="headerlink" href="#bidsmreye" title="Permanent link">&para;</a></h2>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--rm<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>-v<span class="w"> </span>/data/projects/chess/data/BIDS/derivatives/fmriprep:/data<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>-v<span class="w"> </span>/data/projects/chess/temp_bidsmreye:/out<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>cpplab/bidsmreye:0.5.0<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>/data<span class="w"> </span>/out<span class="w"> </span>participant<span class="w"> </span>all<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>--space<span class="w"> </span>T1w<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>--reset_database<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>--verbose
</span></code></pre></div>
<p>For me, bidsmreye only worked using the T1w fmriprep output space. </p>
<h2 id="first-level-analysis-glm">First-level analysis -- GLM<a class="headerlink" href="#first-level-analysis-glm" title="Permanent link">&para;</a></h2>
<p>Once we are done with preprocessing, it's time for GLM. Running the GLM and setting the contrasts is as easy as running script03. Remember to double-check the parameters at the top of the file. Specifically, you will need to adjust:
  - read/write folder, including the fmriprep folder in <code>fmriprepRoot</code>, your BIDS folder in <code>BIDSRoot</code>, the folder you want to save your GLM results to (it should ideally be in the derivatives folder, in a <code>fmriprep-spm</code> folder) in <code>outRoot</code>, and a directory to store your temporary files (e.g., uncompressed, since SPM can't read compressed gz files, and/or smoothed files) in <code>tempDir</code>.
  - the list of subjects you want to analyze in <code>selectedSubjectsList</code>. It must be list of integers like <code>selectedSubjectsList = [41,42,43,44];</code> or <code>selectedSubjectsList = '*';</code> to perform the analysis on all subjects.
  - the list of runs you want to analyze in <code>selectedRuns</code>.
  - The contrasts you want to set to get the corresponding t-maps. Here is an example for my task:
  <div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>selectedTasks(1).name = &#39;exp&#39;; % The name of the task to analyze. Must correspond to the task in your BIDS filenames
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>selectedTasks(1).contrasts = {&#39;Check &gt; No-Check&#39;}; % The name of the contrast
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>selectedTasks(1).weights(1) = struct(&#39;C_WILDCARD___WILDCARD_&#39;, 1, &#39;NC_WILDCARD___WILDCARD_&#39;, -1); % The weights assigned to each regressor. See function adjust_contrasts.m for more information on how to set this correctly.
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>selectedTasks(1).smoothBool = false; % Whether to smooth the images before GLM. Useful for localizers.
</span></code></pre></div></p>
<p>If everything was set correctly, this script should run smoothly and produce new <code>sub-xx</code> folders in your output folder. You can check whether the subject folder contains a sub-folder for each analyses task, along with <code>beta_000x.nii</code> files for each regressor (i.e., each confound and condition * number of runs).</p>
<p>At this stage, it is strongly advisable to check whether the design matrix was correctly specified. To do so, you can open the SPM GUI by typing <code>spm fmri</code> in your Matlab Command Window, then click on 'Results' and select the SPM.mat file inside your bets images directory in <code>BIDS/fmriprep-spm/{space}/sub-xx/{task_name}/</code>. This will open the SPM Contrast Manager, that will show the design matrix and assigned contrasts. Make sure the matrix looks reasonable (no overlapping or extremely long conditions, correct number of runs, confound regressors at the end of each run, etc.), and that the contrast weights were assigned correctly. </p>
<p>Now, select your contrast and click 'Done'. In the next window, select apply masking -&gt; None, p value adjustment -&gt; None -&gt; 0.001, threshold -&gt; 0. And voila'! You will see the results of the contrast -- that is, your thresholded t map for this subject -- on the top right, along with a list of significantly active cluster on the bottom right panel.</p>
<p>If you want, you can visualize these activations on a volume of your subject (or on the surface if you have performed recon-all). To do so you can click on 'Display' -&gt; 'overlays...' and select 'sections' if you want to plot on the volume, or <code>render</code> if you want to plot on surface. This will open a new windows, where you need to select the subject anatomical image. This image will be in the <code>BIDS/derivatives/fmriprep/sub-xx/anat</code> folder. If you plot on sections, you need to select the nii file corresponding to the same space your GLM was performed on (usually MNI). If you plot on surface, select the pial or inflated brain.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>As I mentioned above, SPM cannot import nii.gz files directly, so you will need to decompress the anatomical image into a .nii. This can be done very easily with any decompressing tool by right-clicking the file in your file explorer. Once the file is decompressed, select it with the SPM GUI.</p>
</div>
<p>Once we double-checked the results of the GLM, and we are sure we are happy with it, we'll need generate our ROI masks and perform the multi-variate analysis (MVPA and RSA). This will be done in <a href="https://cosmomvpa.org/documentation.html">cosmomvpa</a>. </p>
<h2 id="generate-and-organize-your-regions-of-interest-masks">Generate and organize your Regions of Interest masks<a class="headerlink" href="#generate-and-organize-your-regions-of-interest-masks" title="Permanent link">&para;</a></h2>
<h5 id="rois-from-localizers">ROIs from localizers<a class="headerlink" href="#rois-from-localizers" title="Permanent link">&para;</a></h5>
<p>To run the MVPA you will need some Regions of Interest (ROIs) to select your voxels. One way to do this, is to perform a functional localizer task in the scanner, and run a GLM on the pre-processed and smoothed data for that task to select only voxels active in a given condition (e.g., Faces &gt; Objects to get FFA). Another way could be using pre-defined anatomical masks, mapped in the same space as your subjects (usually, MNI). If you use an anatomical mask, make sure it is in the same space as your subjects, and it has the same resolution. If the resolution of your data (usually, 2<em>2</em>2) is different from the resolution of your parcel (1<em>1</em>1), you will need to resample/reslice the anatomical mask to match the resolution of your data. Thic can be done in ANTs, SPM, or many python libraries (e.g., nilearn/nibabel).</p>
<h5 id="hcp-glasser-parcellation">HCP Glasser parcellation<a class="headerlink" href="#hcp-glasser-parcellation" title="Permanent link">&para;</a></h5>
<p>In my pipeline, I use the <a href="https://figshare.com/articles/dataset/HCP-MMP1_0_projected_on_fsaverage/3498446">Glasser2016 parcellation projected on fsaverage</a>, comprising 180 ROIs per hemisphere. This part is a bit tricky to understand for new-comers because is full of jargon and uses tools that are not very user-friendly. In a nutshell, the Glasser parcellation (aka HCP-MMP1 parcellation) annotation files that you can find on that website are converted to labels, and mapped from the fsaverage to the subject's T1 and MNI volume spaces. This can be done automatically using the <code>HPC-to-subject.sh</code> script (see top of the file for more information and usage notes).</p>
<h5 id="other-parcelsatlases">Other parcels/atlases<a class="headerlink" href="#other-parcelsatlases" title="Permanent link">&para;</a></h5>
<p><strong>TODO:</strong> link a few other atlases</p>
<h2 id="multi-variate-analysis">Multi-variate analysis<a class="headerlink" href="#multi-variate-analysis" title="Permanent link">&para;</a></h2>
<h3 id="run-decoding-svm">Run decoding SVM<a class="headerlink" href="#run-decoding-svm" title="Permanent link">&para;</a></h3>
<p>Once we produced and organized our ROIs, it's time for MVPA. Again, running the MVPA analysis is as easy as running a script. In my pipeline, script04 runs independent cross-validated SVM classification analysis on each subject and ROI, and returns the decoding accuracy for each roi of the HPC parcellation.</p>
<p>The script produces a <code>BIDS/derivatives/mvpa</code> folder organized in a BIDS structure, with folders for each subject including a tsv file with the decoding accuracy results. </p>
<h3 id="plotting-and-reporting">Plotting and reporting<a class="headerlink" href="#plotting-and-reporting" title="Permanent link">&para;</a></h3>
<p>The Glasser parcellation has percels at three levels, where each higher level groups several ROIs into a single ROI. In my pipeline, I run the analysis at the lowest level (180 parcels per hemisphere), and average the results of the ROIs within a bigger ROI to get the average accuracy of the bigger ROI. This can be done with the script06. This script prepares the average accuracies at each level by averaging the accuracies at the lowest level, compute the significance against chance for each decoding accuracy, and plots the significant accuracies on an inflated brain for each grouping level. For instance:</p>
<p><img alt="Decoding Example" src="../../../assets/external/raw.githubusercontent.com/HOPLAB-LBP/hoplab-wiki/main/docs/assets/combined_brain_grid.png"></p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">August 13, 2024 14:56:40</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.tabs.link", "content.code.copy", "content.code.select", "content.action.edit", "navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.expand", "navigation.sections", "toc.integrate", "search.highlight", "navigation.indexes"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.525ec568.min.js"></script>
      
        <script src="../../../assets/external/unpkg.com/mermaid@11/dist/mermaid.min.js"></script>
      
    
  </body>
</html>