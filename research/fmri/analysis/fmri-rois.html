
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="fmri-glm-script.html">
      
      
        <link rel="next" href="fmri-mvpa.html">
      
      
      <link rel="icon" href="../../../assets/hoplab_favicon_white.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.44">
    
    
      
        <title>5. Regions of interest - Hoplab Wiki</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
        <script src="../../../assets/external/unpkg.com/iframe-worker/shim.js"></script>
      
    
    
      
        
        
        
        <link rel="stylesheet" href="../../../assets/external/fonts.googleapis.com/css.49ea35f2.css">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-71T36SYGT2"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-71T36SYGT2",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-71T36SYGT2",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#regions-of-interest-rois" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../index.html" title="Hoplab Wiki" class="md-header__button md-logo" aria-label="Hoplab Wiki" data-md-component="logo">
      
  <img src="../../../assets/thicker_white_brain.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Hoplab Wiki
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              5. Regions of interest
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/HOPLAB-LBP/hoplab-wiki/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    HOPLAB-LBP/hoplab-wiki
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html" class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../get-started/index.html" class="md-tabs__link">
          
  
    
  
  Getting started

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../index.html" class="md-tabs__link">
          
  
    
  
  Research

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../outreach.html" class="md-tabs__link">
        
  
    
  
  Science outreach

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../contribute.html" class="md-tabs__link">
        
  
    
  
  Contribute

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../index.html" title="Hoplab Wiki" class="md-nav__button md-logo" aria-label="Hoplab Wiki" data-md-component="logo">
      
  <img src="../../../assets/thicker_white_brain.svg" alt="logo">

    </a>
    Hoplab Wiki
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/HOPLAB-LBP/hoplab-wiki/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    HOPLAB-LBP/hoplab-wiki
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../get-started/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../get-started/useful-links.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Useful links
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../get-started/mailing-lists.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mailing lists
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../get-started/practical-setup.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practical set-up
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../get-started/computer-setup.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Computer set-up
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../get-started/admin-procedures.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Administrative procedures
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../get-started/student-starter-pack.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Student starter pack
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Research
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Research
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../ethics/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Ethical approval
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_2" id="__nav_3_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Ethical approval
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ethics/MEC.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EC onderzoek
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ethics/SMEC.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SMEC
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../coding/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Coding practices
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Coding practices
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../behaviour/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Behaviour
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_4" id="__nav_3_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Behaviour
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../behaviour/bh-participants.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Find participants
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../behaviour/experimental-setup/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Set up your experiment
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_4_3" id="__nav_3_4_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_3">
            <span class="md-nav__icon md-icon"></span>
            Set up your experiment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../behaviour/experimental-setup/pavlovia.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Online Experiments (Pavlovia)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../behaviour/bh-tasks/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Behavioural tasks
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_4_4" id="__nav_3_4_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_4">
            <span class="md-nav__icon md-icon"></span>
            Behavioural tasks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../behaviour/bh-tasks/mds-task.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MDS task
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    fMRI
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_5" id="__nav_3_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            fMRI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fmri-get-started.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    First steps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fmri-procedure.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scanning procedure and info
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5_4" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Analysis workflow
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_5_4" id="__nav_3_5_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_5_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_5_4">
            <span class="md-nav__icon md-icon"></span>
            Analysis workflow
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-general.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    0. General information
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-setup-env.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Set-up you environment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-bids-conversion.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. BIDS conversion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-prepocessing-qa.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Pre-processing and QA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-glm.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4a. First-level analysis - GUI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-glm-script.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4b. First-level analysis - Scripting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    5. Regions of interest
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="fmri-rois.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    5. Regions of interest
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#commonly-used-roi-types" class="md-nav__link">
    <span class="md-ellipsis">
      Commonly Used ROI Types
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#intersecting-roi-masks-with-glm-results" class="md-nav__link">
    <span class="md-ellipsis">
      Intersecting ROI Masks with GLM Results
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-mvpa.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. Multi-variate analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-andrea-workflow.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fMRI workflow example
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fmri-nimare.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Meta-analysis with NiMARE
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../eeg/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    EEG
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            EEG
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../eyetracking/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Eye-tracking
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            Eye-tracking
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../dnn/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Neural Networks
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            Neural Networks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../outreach.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Science outreach
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contribute.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contribute
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#commonly-used-roi-types" class="md-nav__link">
    <span class="md-ellipsis">
      Commonly Used ROI Types
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#intersecting-roi-masks-with-glm-results" class="md-nav__link">
    <span class="md-ellipsis">
      Intersecting ROI Masks with GLM Results
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/HOPLAB-LBP/hoplab-wiki/edit/main/docs/research/fmri/analysis/fmri-rois.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="regions-of-interest-rois">Regions of Interest (ROIs)<a class="headerlink" href="#regions-of-interest-rois" title="Permanent link">&para;</a></h1>
<p>When conducting fMRI analyses, we often focus on specific brain regions based on theoretical or empirical questions. These <strong>Regions of Interest (ROIs)</strong> are defined areas in the brain that we hypothesize to be relevant to a particular cognitive function or task.</p>
<p>By restricting the analysis to ROIs, researchers can improve <strong>statistical power</strong>, focus on <strong>hypothesized brain areas</strong>, and extrat data for <strong>multivariate pattern analyses</strong> (MVPA).</p>
<h2 id="commonly-used-roi-types">Commonly Used ROI Types<a class="headerlink" href="#commonly-used-roi-types" title="Permanent link">&para;</a></h2>
<p>The following types of ROIs are commonly used in fMRI research:</p>
<ol>
<li><strong>Anatomical ROIs</strong>: These are based on anatomical landmarks, often derived from standard brain atlases.</li>
<li><strong>Functional ROIs</strong>: Defined based on brain activation patterns observed in functional localizer tasks.</li>
<li><strong>Spherical ROIs</strong>: Spheres around specific MNI coordinates, offering a quick, automated way to generate ROIs.</li>
</ol>
<h3 id="example-creating-spherical-rois-with-the-gui">Example: Creating Spherical ROIs with the GUI<a class="headerlink" href="#example-creating-spherical-rois-with-the-gui" title="Permanent link">&para;</a></h3>
<p><strong>TODO</strong>: add info and screenshots on how to do this using marsbar GUI</p>
<h3 id="example-creating-spherical-rois-with-a-script">Example: Creating Spherical ROIs with a Script<a class="headerlink" href="#example-creating-spherical-rois-with-a-script" title="Permanent link">&para;</a></h3>
<p>Below is an example MATLAB script designed to creare bilateral ROIs. This script leverages <strong>MarsBaR</strong> and <strong>SPM</strong> to generate spherical ROIs around given MNI coordinates. The ROIs are saved as NIfTI files, which can be further used in analyses such as <strong>multivariate decoding</strong>.</p>
<details class="example">
<summary>Script for Creating Spherical ROIs in MATLAB</summary>
<div class="language-matlab highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">makeROISpheres.m</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">  1</a></span>
<span class="normal"><a href="#__codelineno-0-2">  2</a></span>
<span class="normal"><a href="#__codelineno-0-3">  3</a></span>
<span class="normal"><a href="#__codelineno-0-4">  4</a></span>
<span class="normal"><a href="#__codelineno-0-5">  5</a></span>
<span class="normal"><a href="#__codelineno-0-6">  6</a></span>
<span class="normal"><a href="#__codelineno-0-7">  7</a></span>
<span class="normal"><a href="#__codelineno-0-8">  8</a></span>
<span class="normal"><a href="#__codelineno-0-9">  9</a></span>
<span class="normal"><a href="#__codelineno-0-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-0-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-0-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-0-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-0-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-0-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-0-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-0-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="c">% MATLAB Script for Generating Spherical ROIs</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="c">% ================================================</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="c">% This script creates spherical ROIs with specified MNI coordinates, radii, and a reference image.</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="c">% Dependencies: MarsBaR, SPM, hop_roi_sphere function.</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="c">%</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="c">% Author: Andrea Costantino</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="c">% Date: October 2024</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="c">% Define output paths and options</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="n">outRoot</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;./chess-expertise-2024/results/test&#39;</span><span class="p">;</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="n">opt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">struct</span><span class="p">();</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="n">opt</span><span class="p">.</span><span class="n">space</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;MNI152NLin2009cAsym_res-2&#39;</span><span class="p">;</span><span class="w"> </span><span class="c">% Coordinate space</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="n">opt</span><span class="p">.</span><span class="n">dir</span><span class="p">.</span><span class="n">output</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="n">outRoot</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;rois&#39;</span><span class="p">);</span><span class="w"> </span><span class="c">% Output directory for ROIs</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="c">% Define the reference image path (any BOLD or beta image for this subject)</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="n">m</span><span class="p">.</span><span class="n">referencePath</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;./BIDS/derivatives/fmriprep/sub-01/func/sub-01_task-exp_run-2_space-MNI152NLin2009cAsym_res-2_desc-preproc_bold.nii.gz&#39;</span><span class="p">;</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="c">% Define ROI parameters</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="n">m</span><span class="p">.</span><span class="n">radii</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">];</span><span class="w"> </span><span class="c">% Radii for the spherical ROIs in mm</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="n">m</span><span class="p">.</span><span class="n">roisToCreate</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">struct</span><span class="p">(</span><span class="k">...</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="w">    </span><span class="s">&#39;area&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;FFA&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;LOC&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;PPA&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;TPJ&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;PCC1&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="w">             </span><span class="s">&#39;CoS_PPA1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;pMTL_OTJ&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;OTJ&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;pMTG&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;SMG1&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="w">             </span><span class="s">&#39;CoS_PPA2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;RSC_PCC&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;SMG2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;pMTG_OTJ&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Caudatus&#39;</span><span class="p">},</span><span class="w"> </span><span class="k">...</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">    </span><span class="s">&#39;coordsL&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{[</span><span class="o">-</span><span class="mi">38</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">58</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">14</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="o">-</span><span class="mi">44</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">77</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">12</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">10</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="o">-</span><span class="mi">56</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">47</span><span class="p">,</span><span class="w"> </span><span class="mi">33</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">34</span><span class="p">],</span><span class="w"> </span><span class="k">...</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="w">                </span><span class="p">[</span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="mi">39</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="o">-</span><span class="mi">47</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">69</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="o">-</span><span class="mi">47</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">69</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">54</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">36</span><span class="p">,</span><span class="w"> </span><span class="mi">36</span><span class="p">],</span><span class="w"> </span><span class="k">...</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="w">                </span><span class="p">[</span><span class="o">-</span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">43</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">11</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">75</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="o">-</span><span class="mi">63</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">31</span><span class="p">,</span><span class="w"> </span><span class="mi">33</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="o">-</span><span class="mi">35</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">]},</span><span class="w"> </span><span class="k">...</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="w">    </span><span class="s">&#39;coordsR&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{[</span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">55</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">12</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">44</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">78</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">13</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">54</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">12</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">56</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">47</span><span class="p">,</span><span class="w"> </span><span class="mi">33</span><span class="p">],</span><span class="w"> </span><span class="p">[],</span><span class="w"> </span><span class="k">...</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="w">                </span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">48</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">69</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">55</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">69</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">58</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">52</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">63</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">27</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">],</span><span class="w"> </span><span class="k">...</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="w">                </span><span class="p">[</span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">52</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">38</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">36</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">13</span><span class="p">],</span><span class="w"> </span><span class="p">[],</span><span class="w"> </span><span class="p">[</span><span class="mi">51</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">69</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">]}</span><span class="w"> </span><span class="k">...</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="p">);</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="c">% Display ROI parameters for verification</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;Preparing to create ROIs with the following parameters:\n&#39;</span><span class="p">);</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="k">for</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">roisToCreate</span><span class="p">)</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="w">    </span><span class="n">currROI</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">roisToCreate</span><span class="p">(</span><span class="nb">i</span><span class="p">);</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="w">    </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;  ROI: %s\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">currROI</span><span class="p">.</span><span class="n">area</span><span class="p">);</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="w">    </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;    MNI coordinates (left): [%s]\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">num2str</span><span class="p">(</span><span class="n">currROI</span><span class="p">.</span><span class="n">coordsL</span><span class="p">));</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="w">    </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;    MNI coordinates (right): [%s]\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">num2str</span><span class="p">(</span><span class="n">currROI</span><span class="p">.</span><span class="n">coordsR</span><span class="p">));</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="k">end</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="c">% Generate the ROIs</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="n">hop_roi_sphere</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">);</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="c">%% Helper function to create and save spherical ROIs</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="k">function</span><span class="w"> </span><span class="nf">hop_roi_sphere</span><span class="p">(</span>opt, m<span class="p">)</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="w">    </span><span class="c">% Generates spherical ROIs and saves them as NIfTI files.</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="w">    </span><span class="c">% Parameters:</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="w">    </span><span class="c">%   opt - Contains output directory and coordinate space information.</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="w">    </span><span class="c">%   m - Contains reference image path, radii, and ROI coordinates.</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">radius</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">radii</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="w">        </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;\nCreating ROIs with radius: %d mm\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">radius</span><span class="p">);</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="w">        </span><span class="c">% Set output folder for current radius</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="w">        </span><span class="n">outputFolder</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">dir</span><span class="p">.</span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="nb">sprintf</span><span class="p">(</span><span class="s">&#39;radius_%dmm&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">radius</span><span class="p">));</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="nb">exist</span><span class="p">(</span><span class="n">outputFolder</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;dir&#39;</span><span class="p">),</span><span class="w"> </span><span class="nb">mkdir</span><span class="p">(</span><span class="n">outputFolder</span><span class="p">);</span><span class="w"> </span><span class="k">end</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="w">        </span><span class="c">% Load reference space using SPM functions</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="w">        </span><span class="n">refSPM</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">spm_vol</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">referencePath</span><span class="p">);</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="w">        </span><span class="n">referenceSpace</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">mars_space</span><span class="p">(</span><span class="n">refSPM</span><span class="p">);</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="w">        </span><span class="c">% Iterate through each ROI definition</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">roisToCreate</span><span class="p">)</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="w">            </span><span class="n">currROI</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">roisToCreate</span><span class="p">(</span><span class="nb">i</span><span class="p">);</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="w">            </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;\nProcessing ROI: %s\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">currROI</span><span class="p">.</span><span class="n">area</span><span class="p">);</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="w">            </span><span class="c">% Left hemisphere ROI</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">currROI</span><span class="p">.</span><span class="n">coordsL</span><span class="p">)</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="w">                </span><span class="n">create_and_save_roi</span><span class="p">(</span><span class="n">currROI</span><span class="p">.</span><span class="n">coordsL</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;L&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">currROI</span><span class="p">.</span><span class="n">area</span><span class="p">,</span><span class="w"> </span><span class="n">radius</span><span class="p">,</span><span class="w"> </span><span class="n">opt</span><span class="p">,</span><span class="w"> </span><span class="n">referenceSpace</span><span class="p">,</span><span class="w"> </span><span class="n">outputFolder</span><span class="p">);</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="w">            </span><span class="k">end</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="w">            </span><span class="c">% Right hemisphere ROI</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">currROI</span><span class="p">.</span><span class="n">coordsR</span><span class="p">)</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="w">                </span><span class="n">create_and_save_roi</span><span class="p">(</span><span class="n">currROI</span><span class="p">.</span><span class="n">coordsR</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;R&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">currROI</span><span class="p">.</span><span class="n">area</span><span class="p">,</span><span class="w"> </span><span class="n">radius</span><span class="p">,</span><span class="w"> </span><span class="n">opt</span><span class="p">,</span><span class="w"> </span><span class="n">referenceSpace</span><span class="p">,</span><span class="w"> </span><span class="n">outputFolder</span><span class="p">);</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="w">            </span><span class="k">end</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="w">            </span><span class="c">% Bilateral ROI</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">currROI</span><span class="p">.</span><span class="n">coordsL</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">currROI</span><span class="p">.</span><span class="n">coordsR</span><span class="p">)</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="w">                </span><span class="n">create_and_save_roi_bilateral</span><span class="p">(</span><span class="n">currROI</span><span class="p">.</span><span class="n">coordsL</span><span class="p">,</span><span class="w"> </span><span class="n">currROI</span><span class="p">.</span><span class="n">coordsR</span><span class="p">,</span><span class="w"> </span><span class="n">currROI</span><span class="p">.</span><span class="n">area</span><span class="p">,</span><span class="w"> </span><span class="n">radius</span><span class="p">,</span><span class="w"> </span><span class="n">opt</span><span class="p">,</span><span class="w"> </span><span class="n">referenceSpace</span><span class="p">,</span><span class="w"> </span><span class="n">outputFolder</span><span class="p">);</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="w">            </span><span class="k">end</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="w">        </span><span class="k">end</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="k">end</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="k">function</span><span class="w"> </span><span class="nf">create_and_save_roi</span><span class="p">(</span>coords, hemi, area, radius, opt, referenceSpace, outputFolder<span class="p">)</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="w">    </span><span class="c">% Creates and saves a sphere ROI for given coordinates.</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="w">    </span><span class="c">% Parameters:</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="w">    </span><span class="c">%   coords - MNI coordinates for the ROI center.</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="w">    </span><span class="c">%   hemi - &#39;L&#39; or &#39;R&#39; indicating hemisphere.</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="w">    </span><span class="c">%   area - Label for the ROI.</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="w">    </span><span class="c">%   radius - Sphere radius in mm.</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="w">    </span><span class="c">%   opt - Options struct with output and space information.</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="w">    </span><span class="c">%   referenceSpace - MarsBaR space object for the brain reference.</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="w">    </span><span class="c">%   outputFolder - Directory to save the NIfTI file.</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="w">    </span><span class="n">roiLabel</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">sprintf</span><span class="p">(</span><span class="s">&#39;hemi-%s_label-%s&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">hemi</span><span class="p">,</span><span class="w"> </span><span class="nb">area</span><span class="p">);</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="w">    </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;  Creating %s ROI with radius %d mm\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">roiLabel</span><span class="p">,</span><span class="w"> </span><span class="n">radius</span><span class="p">);</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="w">    </span><span class="c">% Create sphere ROI with MarsBaR</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="w">    </span><span class="n">sphereROI</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">maroi_sphere</span><span class="p">(</span><span class="nb">struct</span><span class="p">(</span><span class="s">&#39;centre&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">coords</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;radius&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">radius</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;label&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">roiLabel</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;reference&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">referenceSpace</span><span class="p">));</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="w">    </span><span class="c">% Save ROI as NIfTI file</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="w">    </span><span class="n">filename</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="n">outputFolder</span><span class="p">,</span><span class="w"> </span><span class="nb">sprintf</span><span class="p">(</span><span class="s">&#39;hemi-%s_space-%s_radius-%dmm_label-%s.nii&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">hemi</span><span class="p">,</span><span class="w"> </span><span class="n">opt</span><span class="p">.</span><span class="n">space</span><span class="p">,</span><span class="w"> </span><span class="n">radius</span><span class="p">,</span><span class="w"> </span><span class="nb">area</span><span class="p">));</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="w">    </span><span class="n">save_as_image</span><span class="p">(</span><span class="n">sphereROI</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="p">);</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="w">    </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;  Saved ROI: %s\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="p">);</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="k">end</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="k">function</span><span class="w"> </span><span class="nf">create_and_save_roi_bilateral</span><span class="p">(</span>coordsL, coordsR, area, radius, opt, referenceSpace, outputFolder<span class="p">)</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="w">    </span><span class="c">% Creates and saves a bilateral ROI by combining left and right coordinates.</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="w">    </span><span class="c">% Parameters are identical to create_and_save_roi, but it combines two sets of coordinates.</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="w">    </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;  Creating bilateral ROI with radius %d mm for area %s\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">radius</span><span class="p">,</span><span class="w"> </span><span class="nb">area</span><span class="p">);</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="w">    </span><span class="c">% Create left and right hemisphere ROIs</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="w">    </span><span class="n">leftROI</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">maroi_sphere</span><span class="p">(</span><span class="nb">struct</span><span class="p">(</span><span class="s">&#39;centre&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">coordsL</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;radius&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">radius</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;label&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">sprintf</span><span class="p">(</span><span class="s">&#39;hemi-L_label-%s&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">area</span><span class="p">)));</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="w">    </span><span class="n">rightROI</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">maroi_sphere</span><span class="p">(</span><span class="nb">struct</span><span class="p">(</span><span class="s">&#39;centre&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">coordsR</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;radius&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">radius</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;label&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">sprintf</span><span class="p">(</span><span class="s">&#39;hemi-R_label-%s&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">area</span><span class="p">)));</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="w">    </span><span class="c">% Resample and combine hemispheres</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="w">    </span><span class="n">resampledLeftROI</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">maroi_matrix</span><span class="p">(</span><span class="n">leftROI</span><span class="p">,</span><span class="w"> </span><span class="n">referenceSpace</span><span class="p">);</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="w">    </span><span class="n">resampledRightROI</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">maroi_matrix</span><span class="p">(</span><span class="n">rightROI</span><span class="p">,</span><span class="w"> </span><span class="n">referenceSpace</span><span class="p">);</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="w">    </span><span class="n">combinedData</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="nb">struct</span><span class="p">(</span><span class="n">resampledLeftROI</span><span class="p">).</span><span class="n">dat</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="nb">struct</span><span class="p">(</span><span class="n">resampledRightROI</span><span class="p">).</span><span class="n">dat</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.5</span><span class="p">);</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="w">    </span><span class="n">bilateralROI</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">maroi_matrix</span><span class="p">(</span><span class="nb">struct</span><span class="p">(</span><span class="s">&#39;dat&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">combinedData</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;mat&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">referenceSpace</span><span class="p">.</span><span class="n">mat</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;label&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">sprintf</span><span class="p">(</span><span class="s">&#39;hemi-B_label-%s&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">area</span><span class="p">)));</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="w">    </span><span class="c">% Save as bilateral NIfTI file</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="w">    </span><span class="n">filename</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="n">outputFolder</span><span class="p">,</span><span class="w"> </span><span class="nb">sprintf</span><span class="p">(</span><span class="s">&#39;hemi-B_space-%s_radius-%dmm_label-%s.nii&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">opt</span><span class="p">.</span><span class="n">space</span><span class="p">,</span><span class="w"> </span><span class="n">radius</span><span class="p">,</span><span class="w"> </span><span class="nb">area</span><span class="p">));</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="w">    </span><span class="n">save_as_image</span><span class="p">(</span><span class="n">bilateralROI</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="p">);</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="w">    </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;  Saved bilateral ROI: %s\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="p">);</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="k">end</span>
</span></code></pre></div></td></tr></table></div>
</details>
<p>This script will output a folder as follow:
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>rois
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>└──<span class="w"> </span>radius_5mm
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span>├──<span class="w"> </span>hemi-B_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-Caudatus.nii
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span>├──<span class="w"> </span>hemi-B_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-CoS_PPA1.nii
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span>├──<span class="w"> </span>hemi-B_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-CoS_PPA2.nii
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span>├──<span class="w"> </span>hemi-B_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-FFA.nii
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">    </span>├──<span class="w"> </span>hemi-B_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-LOC.nii
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">    </span>├──<span class="w"> </span>hemi-B_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-OTJ.nii
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">    </span>├──<span class="w"> </span>hemi-B_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-pMTG.nii
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">    </span>├──<span class="w"> </span>hemi-B_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-pMTG_OTJ.nii
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">    </span>├──<span class="w"> </span>hemi-B_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-pMTL_OTJ.nii
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">    </span>├──<span class="w"> </span>hemi-B_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-PPA.nii
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">    </span>├──<span class="w"> </span>hemi-B_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-RSC_PCC.nii
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">    </span>├──<span class="w"> </span>hemi-B_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-SMG1.nii
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">    </span>├──<span class="w"> </span>hemi-B_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-TPJ.nii
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="w">    </span>├──<span class="w"> </span>hemi-L_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-Caudatus.nii
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="w">    </span>├──<span class="w"> </span>hemi-L_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-CoS_PPA1.nii
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="w">    </span>├──<span class="w"> </span>hemi-L_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-CoS_PPA2.nii
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="w">    </span>├──<span class="w"> </span>hemi-L_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-FFA.nii
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="w">    </span>├──<span class="w"> </span>hemi-L_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-LOC.nii
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="w">    </span>├──<span class="w"> </span>hemi-L_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-OTJ.nii
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="w">    </span>├──<span class="w"> </span>hemi-L_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-PCC1.nii
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="w">    </span>├──<span class="w"> </span>hemi-L_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-pMTG.nii
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="w">    </span>├──<span class="w"> </span>hemi-L_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-pMTG_OTJ.nii
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a><span class="w">    </span>├──<span class="w"> </span>hemi-L_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-pMTL_OTJ.nii
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="w">    </span>├──<span class="w"> </span>hemi-L_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-PPA.nii
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="w">    </span>├──<span class="w"> </span>hemi-L_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-RSC_PCC.nii
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="w">    </span>├──<span class="w"> </span>hemi-L_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-SMG1.nii
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a><span class="w">    </span>├──<span class="w"> </span>hemi-L_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-SMG2.nii
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a><span class="w">    </span>├──<span class="w"> </span>hemi-L_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-TPJ.nii
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a><span class="w">    </span>├──<span class="w"> </span>hemi-R_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-Caudatus.nii
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a><span class="w">    </span>├──<span class="w"> </span>hemi-R_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-CoS_PPA1.nii
</span><span id="__span-1-33"><a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a><span class="w">    </span>├──<span class="w"> </span>hemi-R_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-CoS_PPA2.nii
</span><span id="__span-1-34"><a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a><span class="w">    </span>├──<span class="w"> </span>hemi-R_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-FFA.nii
</span><span id="__span-1-35"><a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a><span class="w">    </span>├──<span class="w"> </span>hemi-R_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-LOC.nii
</span><span id="__span-1-36"><a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a><span class="w">    </span>├──<span class="w"> </span>hemi-R_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-OTJ.nii
</span><span id="__span-1-37"><a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a><span class="w">    </span>├──<span class="w"> </span>hemi-R_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-pMTG.nii
</span><span id="__span-1-38"><a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a><span class="w">    </span>├──<span class="w"> </span>hemi-R_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-pMTG_OTJ.nii
</span><span id="__span-1-39"><a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a><span class="w">    </span>├──<span class="w"> </span>hemi-R_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-pMTL_OTJ.nii
</span><span id="__span-1-40"><a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a><span class="w">    </span>├──<span class="w"> </span>hemi-R_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-PPA.nii
</span><span id="__span-1-41"><a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a><span class="w">    </span>├──<span class="w"> </span>hemi-R_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-RSC_PCC.nii
</span><span id="__span-1-42"><a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a><span class="w">    </span>├──<span class="w"> </span>hemi-R_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-SMG1.nii
</span><span id="__span-1-43"><a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a><span class="w">    </span>└──<span class="w"> </span>hemi-R_space-MNI152NLin2009cAsym_res-2_radius-5mm_label-TPJ.nii
</span></code></pre></div></p>
<p>With right (<code>hemi-R</code>), left (<code>hemi-L</code>) and bilateral (<code>hemi-B</code>) masks.</p>
<p>The size of the ROIs is defined in millimeters, and is a list of <strong>radii</strong> such as <code>m.radii = [5, 10];</code> (see line 19 of the <code>makeROISpheres.m</code> script).</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The bilateral masks will be generated automatically only when both R and L coordinates are provided for a given ROI. If only R or L coordinates are provided, only the R or L mask will be saved.</p>
</div>
<hr />
<h2 id="intersecting-roi-masks-with-glm-results">Intersecting ROI Masks with GLM Results<a class="headerlink" href="#intersecting-roi-masks-with-glm-results" title="Permanent link">&para;</a></h2>
<p>In our lab, we apply an additional refinement step to <strong>Region of Interest (ROI)</strong> masks to precisely target the most relevant brain voxels. This involves intersecting the mask (e.g., a spherical or anatomical ROI) with the <strong>significant activation</strong> of a specific contrast. This approach is particularly beneficial for analyses like <strong>multivariate pattern analysis (MVPA)</strong>, where targeted voxel selection is crucial for decoding tasks.</p>
<p>For instance, suppose we want to perform an MVPA to determine if we can distinguish between <em>Female</em> and <em>Male</em> faces in the <strong>Fusiform Face Area (FFA)</strong>. Here’s how we might set up the analysis:</p>
<ol>
<li>
<p><strong>Create an Initial ROI Mask</strong>:</p>
<ul>
<li>First, we create a NIfTI file with values of 1 in the FFA region and 0 elsewhere. This mask can be created either anatomically (using an atlas) or by defining a spherical mask centered on FFA coordinates.</li>
</ul>
</li>
<li>
<p><strong>Run a First-Level Analysis to Identify Activation in the ROI</strong>:</p>
<ul>
<li>In <strong>SPM</strong>, perform a First-Level analysis to obtain significant activation for a relevant contrast, such as <em>Faces vs. Objects</em>. This will produce a <strong>t-map</strong> that indicates the t values of all voxels for the given contrast.</li>
</ul>
<div class="admonition question">
<p class="admonition-title">What contrasts should I use?</p>
<ul>
<li>If we use a <strong>localizer run</strong> (i.e., a run where participants are shown categories for functional localization), then we can set up contrasts based on well-established literature. For example, for the FFA, the <em>Faces &gt; Objects</em> contrast is commonly used; for LOC, <em>Objects &gt; Scrambled</em> is typical.</li>
<li>If we use the <strong>experimental task run</strong> (i.e., when participants perform the main task), we generally choose contrasts that reflect overall activity in the region. For example, we might use an <em>All &gt; Rest</em> contrast where all experimental conditions are positive and rest blocks are negative, capturing the regions most active during the task overall.</li>
</ul>
</div>
</li>
<li>
<p><strong>Threshold the Activation Map</strong>  </p>
<ul>
<li>Apply a statistical threshold to the t-map, setting a significance level (e.g., p &lt; .001) to identify the voxels significantly active for the contrast of interest.</li>
</ul>
</li>
<li>
<p><strong>Intersect Masked and Activated Voxels</strong>  </p>
<ul>
<li>Generate a new ROI that includes only the voxels both significantly active in the contrast and within the initial mask (e.g., sphere or anatomical region).</li>
</ul>
</li>
<li>
<p><strong>Extract beta values from selected voxels</strong>  </p>
<ul>
<li>We use the generated ROI to filter voxels in the beta images (the <code>beta_00*.nii</code> images in the SPM GLM output folder) for further MVPA.</li>
</ul>
</li>
</ol>
<p>This approach has two key benefits:</p>
<ol>
<li><strong>Selective Targeting of Relevant Voxels</strong>: It ensures that the ROI captures only the voxels relevant for the cognitive function of interest, maximizing information and minimizing potential noise from uninformative voxels.</li>
<li><strong>Feature Reduction</strong>: Reducing the number of features (voxels) helps improve the classifier's performance by mitigating the <strong>Curse of Dimensionality</strong> (see this <a href="https://www.datacamp.com/blog/curse-of-dimensionality-machine-learning">article on dimensionality reduction</a> for more info).</li>
</ol>
<h3 id="example-generating-refined-rois-by-intersecting-masks-with-activation-maps">Example: Generating Refined ROIs by Intersecting Masks with Activation Maps<a class="headerlink" href="#example-generating-refined-rois-by-intersecting-masks-with-activation-maps" title="Permanent link">&para;</a></h3>
<p>The following MATLAB script refines ROIs by intersecting an initial mask (e.g., anatomical or spherical) with a subject-specific activation map from an SPM contrast. This approach is particularly valuable for targeted analyses, such as <strong>multivariate pattern analysis (MVPA)</strong>.</p>
<h4 id="script-workflow">Script Workflow<a class="headerlink" href="#script-workflow" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>Thresholding</strong>: Applies a statistical threshold to the contrast map, identifying only voxels with significant activation.</li>
<li><strong>Intersection</strong>: Intersects these significant voxels with the ROI mask to focus on relevant areas within the predefined region.</li>
<li><strong>Voxel Count Check</strong>: Ensures the resulting ROI contains a minimum number of significant voxels (default: 25). If the voxel count is too low, the significance threshold is incrementally relaxed until the minimum count is met.</li>
<li><strong>Saving Results</strong>: Exports the final ROI in both NIfTI (<code>.nii</code>) and MATLAB (<code>.mat</code>) formats, making it ready for further analysis.</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Finding Contrast Names in SPM</p>
<p>To find the exact names of contrasts in an SPM model, load the SPM.mat file and check <code>SPM.xCon.name</code>. This allows you to confirm the contrast names required for the <code>contrastName</code> field in <code>roisStruct</code>.</p>
</div>
<details class="example">
<summary>Script to Create ROIs from an Image Mask and Statistical Activation Map</summary>
<div class="language-matlab highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">intersectROIandGLM.m</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">  1</a></span>
<span class="normal"><a href="#__codelineno-2-2">  2</a></span>
<span class="normal"><a href="#__codelineno-2-3">  3</a></span>
<span class="normal"><a href="#__codelineno-2-4">  4</a></span>
<span class="normal"><a href="#__codelineno-2-5">  5</a></span>
<span class="normal"><a href="#__codelineno-2-6">  6</a></span>
<span class="normal"><a href="#__codelineno-2-7">  7</a></span>
<span class="normal"><a href="#__codelineno-2-8">  8</a></span>
<span class="normal"><a href="#__codelineno-2-9">  9</a></span>
<span class="normal"><a href="#__codelineno-2-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-2-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-2-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-2-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-2-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-2-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-2-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-2-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-2-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-2-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-2-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-2-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-2-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-2-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-2-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-2-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-2-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-2-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-2-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-2-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-2-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-2-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-2-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-2-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-2-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-2-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-2-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-2-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-2-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-2-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-2-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-2-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-2-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-2-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-2-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-2-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-2-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-2-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-2-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-2-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-2-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-2-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-2-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-2-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-2-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-2-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-2-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-2-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-2-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-2-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-2-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-2-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-2-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-2-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-2-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-2-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-2-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-2-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-2-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-2-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-2-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-2-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-2-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-2-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-2-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-2-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-2-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-2-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-2-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-2-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-2-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-2-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-2-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-2-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-2-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-2-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-2-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-2-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-2-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-2-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-2-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-2-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-2-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-2-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-2-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-2-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-2-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-2-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-2-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-2-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-2-100">100</a></span>
<span class="normal"><a href="#__codelineno-2-101">101</a></span>
<span class="normal"><a href="#__codelineno-2-102">102</a></span>
<span class="normal"><a href="#__codelineno-2-103">103</a></span>
<span class="normal"><a href="#__codelineno-2-104">104</a></span>
<span class="normal"><a href="#__codelineno-2-105">105</a></span>
<span class="normal"><a href="#__codelineno-2-106">106</a></span>
<span class="normal"><a href="#__codelineno-2-107">107</a></span>
<span class="normal"><a href="#__codelineno-2-108">108</a></span>
<span class="normal"><a href="#__codelineno-2-109">109</a></span>
<span class="normal"><a href="#__codelineno-2-110">110</a></span>
<span class="normal"><a href="#__codelineno-2-111">111</a></span>
<span class="normal"><a href="#__codelineno-2-112">112</a></span>
<span class="normal"><a href="#__codelineno-2-113">113</a></span>
<span class="normal"><a href="#__codelineno-2-114">114</a></span>
<span class="normal"><a href="#__codelineno-2-115">115</a></span>
<span class="normal"><a href="#__codelineno-2-116">116</a></span>
<span class="normal"><a href="#__codelineno-2-117">117</a></span>
<span class="normal"><a href="#__codelineno-2-118">118</a></span>
<span class="normal"><a href="#__codelineno-2-119">119</a></span>
<span class="normal"><a href="#__codelineno-2-120">120</a></span>
<span class="normal"><a href="#__codelineno-2-121">121</a></span>
<span class="normal"><a href="#__codelineno-2-122">122</a></span>
<span class="normal"><a href="#__codelineno-2-123">123</a></span>
<span class="normal"><a href="#__codelineno-2-124">124</a></span>
<span class="normal"><a href="#__codelineno-2-125">125</a></span>
<span class="normal"><a href="#__codelineno-2-126">126</a></span>
<span class="normal"><a href="#__codelineno-2-127">127</a></span>
<span class="normal"><a href="#__codelineno-2-128">128</a></span>
<span class="normal"><a href="#__codelineno-2-129">129</a></span>
<span class="normal"><a href="#__codelineno-2-130">130</a></span>
<span class="normal"><a href="#__codelineno-2-131">131</a></span>
<span class="normal"><a href="#__codelineno-2-132">132</a></span>
<span class="normal"><a href="#__codelineno-2-133">133</a></span>
<span class="normal"><a href="#__codelineno-2-134">134</a></span>
<span class="normal"><a href="#__codelineno-2-135">135</a></span>
<span class="normal"><a href="#__codelineno-2-136">136</a></span>
<span class="normal"><a href="#__codelineno-2-137">137</a></span>
<span class="normal"><a href="#__codelineno-2-138">138</a></span>
<span class="normal"><a href="#__codelineno-2-139">139</a></span>
<span class="normal"><a href="#__codelineno-2-140">140</a></span>
<span class="normal"><a href="#__codelineno-2-141">141</a></span>
<span class="normal"><a href="#__codelineno-2-142">142</a></span>
<span class="normal"><a href="#__codelineno-2-143">143</a></span>
<span class="normal"><a href="#__codelineno-2-144">144</a></span>
<span class="normal"><a href="#__codelineno-2-145">145</a></span>
<span class="normal"><a href="#__codelineno-2-146">146</a></span>
<span class="normal"><a href="#__codelineno-2-147">147</a></span>
<span class="normal"><a href="#__codelineno-2-148">148</a></span>
<span class="normal"><a href="#__codelineno-2-149">149</a></span>
<span class="normal"><a href="#__codelineno-2-150">150</a></span>
<span class="normal"><a href="#__codelineno-2-151">151</a></span>
<span class="normal"><a href="#__codelineno-2-152">152</a></span>
<span class="normal"><a href="#__codelineno-2-153">153</a></span>
<span class="normal"><a href="#__codelineno-2-154">154</a></span>
<span class="normal"><a href="#__codelineno-2-155">155</a></span>
<span class="normal"><a href="#__codelineno-2-156">156</a></span>
<span class="normal"><a href="#__codelineno-2-157">157</a></span>
<span class="normal"><a href="#__codelineno-2-158">158</a></span>
<span class="normal"><a href="#__codelineno-2-159">159</a></span>
<span class="normal"><a href="#__codelineno-2-160">160</a></span>
<span class="normal"><a href="#__codelineno-2-161">161</a></span>
<span class="normal"><a href="#__codelineno-2-162">162</a></span>
<span class="normal"><a href="#__codelineno-2-163">163</a></span>
<span class="normal"><a href="#__codelineno-2-164">164</a></span>
<span class="normal"><a href="#__codelineno-2-165">165</a></span>
<span class="normal"><a href="#__codelineno-2-166">166</a></span>
<span class="normal"><a href="#__codelineno-2-167">167</a></span>
<span class="normal"><a href="#__codelineno-2-168">168</a></span>
<span class="normal"><a href="#__codelineno-2-169">169</a></span>
<span class="normal"><a href="#__codelineno-2-170">170</a></span>
<span class="normal"><a href="#__codelineno-2-171">171</a></span>
<span class="normal"><a href="#__codelineno-2-172">172</a></span>
<span class="normal"><a href="#__codelineno-2-173">173</a></span>
<span class="normal"><a href="#__codelineno-2-174">174</a></span>
<span class="normal"><a href="#__codelineno-2-175">175</a></span>
<span class="normal"><a href="#__codelineno-2-176">176</a></span>
<span class="normal"><a href="#__codelineno-2-177">177</a></span>
<span class="normal"><a href="#__codelineno-2-178">178</a></span>
<span class="normal"><a href="#__codelineno-2-179">179</a></span>
<span class="normal"><a href="#__codelineno-2-180">180</a></span>
<span class="normal"><a href="#__codelineno-2-181">181</a></span>
<span class="normal"><a href="#__codelineno-2-182">182</a></span>
<span class="normal"><a href="#__codelineno-2-183">183</a></span>
<span class="normal"><a href="#__codelineno-2-184">184</a></span>
<span class="normal"><a href="#__codelineno-2-185">185</a></span>
<span class="normal"><a href="#__codelineno-2-186">186</a></span>
<span class="normal"><a href="#__codelineno-2-187">187</a></span>
<span class="normal"><a href="#__codelineno-2-188">188</a></span>
<span class="normal"><a href="#__codelineno-2-189">189</a></span>
<span class="normal"><a href="#__codelineno-2-190">190</a></span>
<span class="normal"><a href="#__codelineno-2-191">191</a></span>
<span class="normal"><a href="#__codelineno-2-192">192</a></span>
<span class="normal"><a href="#__codelineno-2-193">193</a></span>
<span class="normal"><a href="#__codelineno-2-194">194</a></span>
<span class="normal"><a href="#__codelineno-2-195">195</a></span>
<span class="normal"><a href="#__codelineno-2-196">196</a></span>
<span class="normal"><a href="#__codelineno-2-197">197</a></span>
<span class="normal"><a href="#__codelineno-2-198">198</a></span>
<span class="normal"><a href="#__codelineno-2-199">199</a></span>
<span class="normal"><a href="#__codelineno-2-200">200</a></span>
<span class="normal"><a href="#__codelineno-2-201">201</a></span>
<span class="normal"><a href="#__codelineno-2-202">202</a></span>
<span class="normal"><a href="#__codelineno-2-203">203</a></span>
<span class="normal"><a href="#__codelineno-2-204">204</a></span>
<span class="normal"><a href="#__codelineno-2-205">205</a></span>
<span class="normal"><a href="#__codelineno-2-206">206</a></span>
<span class="normal"><a href="#__codelineno-2-207">207</a></span>
<span class="normal"><a href="#__codelineno-2-208">208</a></span>
<span class="normal"><a href="#__codelineno-2-209">209</a></span>
<span class="normal"><a href="#__codelineno-2-210">210</a></span>
<span class="normal"><a href="#__codelineno-2-211">211</a></span>
<span class="normal"><a href="#__codelineno-2-212">212</a></span>
<span class="normal"><a href="#__codelineno-2-213">213</a></span>
<span class="normal"><a href="#__codelineno-2-214">214</a></span>
<span class="normal"><a href="#__codelineno-2-215">215</a></span>
<span class="normal"><a href="#__codelineno-2-216">216</a></span>
<span class="normal"><a href="#__codelineno-2-217">217</a></span>
<span class="normal"><a href="#__codelineno-2-218">218</a></span>
<span class="normal"><a href="#__codelineno-2-219">219</a></span>
<span class="normal"><a href="#__codelineno-2-220">220</a></span>
<span class="normal"><a href="#__codelineno-2-221">221</a></span>
<span class="normal"><a href="#__codelineno-2-222">222</a></span>
<span class="normal"><a href="#__codelineno-2-223">223</a></span>
<span class="normal"><a href="#__codelineno-2-224">224</a></span>
<span class="normal"><a href="#__codelineno-2-225">225</a></span>
<span class="normal"><a href="#__codelineno-2-226">226</a></span>
<span class="normal"><a href="#__codelineno-2-227">227</a></span>
<span class="normal"><a href="#__codelineno-2-228">228</a></span>
<span class="normal"><a href="#__codelineno-2-229">229</a></span>
<span class="normal"><a href="#__codelineno-2-230">230</a></span>
<span class="normal"><a href="#__codelineno-2-231">231</a></span>
<span class="normal"><a href="#__codelineno-2-232">232</a></span>
<span class="normal"><a href="#__codelineno-2-233">233</a></span>
<span class="normal"><a href="#__codelineno-2-234">234</a></span>
<span class="normal"><a href="#__codelineno-2-235">235</a></span>
<span class="normal"><a href="#__codelineno-2-236">236</a></span>
<span class="normal"><a href="#__codelineno-2-237">237</a></span>
<span class="normal"><a href="#__codelineno-2-238">238</a></span>
<span class="normal"><a href="#__codelineno-2-239">239</a></span>
<span class="normal"><a href="#__codelineno-2-240">240</a></span>
<span class="normal"><a href="#__codelineno-2-241">241</a></span>
<span class="normal"><a href="#__codelineno-2-242">242</a></span>
<span class="normal"><a href="#__codelineno-2-243">243</a></span>
<span class="normal"><a href="#__codelineno-2-244">244</a></span>
<span class="normal"><a href="#__codelineno-2-245">245</a></span>
<span class="normal"><a href="#__codelineno-2-246">246</a></span>
<span class="normal"><a href="#__codelineno-2-247">247</a></span>
<span class="normal"><a href="#__codelineno-2-248">248</a></span>
<span class="normal"><a href="#__codelineno-2-249">249</a></span>
<span class="normal"><a href="#__codelineno-2-250">250</a></span>
<span class="normal"><a href="#__codelineno-2-251">251</a></span>
<span class="normal"><a href="#__codelineno-2-252">252</a></span>
<span class="normal"><a href="#__codelineno-2-253">253</a></span>
<span class="normal"><a href="#__codelineno-2-254">254</a></span>
<span class="normal"><a href="#__codelineno-2-255">255</a></span>
<span class="normal"><a href="#__codelineno-2-256">256</a></span>
<span class="normal"><a href="#__codelineno-2-257">257</a></span>
<span class="normal"><a href="#__codelineno-2-258">258</a></span>
<span class="normal"><a href="#__codelineno-2-259">259</a></span>
<span class="normal"><a href="#__codelineno-2-260">260</a></span>
<span class="normal"><a href="#__codelineno-2-261">261</a></span>
<span class="normal"><a href="#__codelineno-2-262">262</a></span>
<span class="normal"><a href="#__codelineno-2-263">263</a></span>
<span class="normal"><a href="#__codelineno-2-264">264</a></span>
<span class="normal"><a href="#__codelineno-2-265">265</a></span>
<span class="normal"><a href="#__codelineno-2-266">266</a></span>
<span class="normal"><a href="#__codelineno-2-267">267</a></span>
<span class="normal"><a href="#__codelineno-2-268">268</a></span>
<span class="normal"><a href="#__codelineno-2-269">269</a></span>
<span class="normal"><a href="#__codelineno-2-270">270</a></span>
<span class="normal"><a href="#__codelineno-2-271">271</a></span>
<span class="normal"><a href="#__codelineno-2-272">272</a></span>
<span class="normal"><a href="#__codelineno-2-273">273</a></span>
<span class="normal"><a href="#__codelineno-2-274">274</a></span>
<span class="normal"><a href="#__codelineno-2-275">275</a></span>
<span class="normal"><a href="#__codelineno-2-276">276</a></span>
<span class="normal"><a href="#__codelineno-2-277">277</a></span>
<span class="normal"><a href="#__codelineno-2-278">278</a></span>
<span class="normal"><a href="#__codelineno-2-279">279</a></span>
<span class="normal"><a href="#__codelineno-2-280">280</a></span>
<span class="normal"><a href="#__codelineno-2-281">281</a></span>
<span class="normal"><a href="#__codelineno-2-282">282</a></span>
<span class="normal"><a href="#__codelineno-2-283">283</a></span>
<span class="normal"><a href="#__codelineno-2-284">284</a></span>
<span class="normal"><a href="#__codelineno-2-285">285</a></span>
<span class="normal"><a href="#__codelineno-2-286">286</a></span>
<span class="normal"><a href="#__codelineno-2-287">287</a></span>
<span class="normal"><a href="#__codelineno-2-288">288</a></span>
<span class="normal"><a href="#__codelineno-2-289">289</a></span>
<span class="normal"><a href="#__codelineno-2-290">290</a></span>
<span class="normal"><a href="#__codelineno-2-291">291</a></span>
<span class="normal"><a href="#__codelineno-2-292">292</a></span>
<span class="normal"><a href="#__codelineno-2-293">293</a></span>
<span class="normal"><a href="#__codelineno-2-294">294</a></span>
<span class="normal"><a href="#__codelineno-2-295">295</a></span>
<span class="normal"><a href="#__codelineno-2-296">296</a></span>
<span class="normal"><a href="#__codelineno-2-297">297</a></span>
<span class="normal"><a href="#__codelineno-2-298">298</a></span>
<span class="normal"><a href="#__codelineno-2-299">299</a></span>
<span class="normal"><a href="#__codelineno-2-300">300</a></span>
<span class="normal"><a href="#__codelineno-2-301">301</a></span>
<span class="normal"><a href="#__codelineno-2-302">302</a></span>
<span class="normal"><a href="#__codelineno-2-303">303</a></span>
<span class="normal"><a href="#__codelineno-2-304">304</a></span>
<span class="normal"><a href="#__codelineno-2-305">305</a></span>
<span class="normal"><a href="#__codelineno-2-306">306</a></span>
<span class="normal"><a href="#__codelineno-2-307">307</a></span>
<span class="normal"><a href="#__codelineno-2-308">308</a></span>
<span class="normal"><a href="#__codelineno-2-309">309</a></span>
<span class="normal"><a href="#__codelineno-2-310">310</a></span>
<span class="normal"><a href="#__codelineno-2-311">311</a></span>
<span class="normal"><a href="#__codelineno-2-312">312</a></span>
<span class="normal"><a href="#__codelineno-2-313">313</a></span>
<span class="normal"><a href="#__codelineno-2-314">314</a></span>
<span class="normal"><a href="#__codelineno-2-315">315</a></span>
<span class="normal"><a href="#__codelineno-2-316">316</a></span>
<span class="normal"><a href="#__codelineno-2-317">317</a></span>
<span class="normal"><a href="#__codelineno-2-318">318</a></span>
<span class="normal"><a href="#__codelineno-2-319">319</a></span>
<span class="normal"><a href="#__codelineno-2-320">320</a></span>
<span class="normal"><a href="#__codelineno-2-321">321</a></span>
<span class="normal"><a href="#__codelineno-2-322">322</a></span>
<span class="normal"><a href="#__codelineno-2-323">323</a></span>
<span class="normal"><a href="#__codelineno-2-324">324</a></span>
<span class="normal"><a href="#__codelineno-2-325">325</a></span>
<span class="normal"><a href="#__codelineno-2-326">326</a></span>
<span class="normal"><a href="#__codelineno-2-327">327</a></span>
<span class="normal"><a href="#__codelineno-2-328">328</a></span>
<span class="normal"><a href="#__codelineno-2-329">329</a></span>
<span class="normal"><a href="#__codelineno-2-330">330</a></span>
<span class="normal"><a href="#__codelineno-2-331">331</a></span>
<span class="normal"><a href="#__codelineno-2-332">332</a></span>
<span class="normal"><a href="#__codelineno-2-333">333</a></span>
<span class="normal"><a href="#__codelineno-2-334">334</a></span>
<span class="normal"><a href="#__codelineno-2-335">335</a></span>
<span class="normal"><a href="#__codelineno-2-336">336</a></span>
<span class="normal"><a href="#__codelineno-2-337">337</a></span>
<span class="normal"><a href="#__codelineno-2-338">338</a></span>
<span class="normal"><a href="#__codelineno-2-339">339</a></span>
<span class="normal"><a href="#__codelineno-2-340">340</a></span>
<span class="normal"><a href="#__codelineno-2-341">341</a></span>
<span class="normal"><a href="#__codelineno-2-342">342</a></span>
<span class="normal"><a href="#__codelineno-2-343">343</a></span>
<span class="normal"><a href="#__codelineno-2-344">344</a></span>
<span class="normal"><a href="#__codelineno-2-345">345</a></span>
<span class="normal"><a href="#__codelineno-2-346">346</a></span>
<span class="normal"><a href="#__codelineno-2-347">347</a></span>
<span class="normal"><a href="#__codelineno-2-348">348</a></span>
<span class="normal"><a href="#__codelineno-2-349">349</a></span>
<span class="normal"><a href="#__codelineno-2-350">350</a></span>
<span class="normal"><a href="#__codelineno-2-351">351</a></span>
<span class="normal"><a href="#__codelineno-2-352">352</a></span>
<span class="normal"><a href="#__codelineno-2-353">353</a></span>
<span class="normal"><a href="#__codelineno-2-354">354</a></span>
<span class="normal"><a href="#__codelineno-2-355">355</a></span>
<span class="normal"><a href="#__codelineno-2-356">356</a></span>
<span class="normal"><a href="#__codelineno-2-357">357</a></span>
<span class="normal"><a href="#__codelineno-2-358">358</a></span>
<span class="normal"><a href="#__codelineno-2-359">359</a></span>
<span class="normal"><a href="#__codelineno-2-360">360</a></span>
<span class="normal"><a href="#__codelineno-2-361">361</a></span>
<span class="normal"><a href="#__codelineno-2-362">362</a></span>
<span class="normal"><a href="#__codelineno-2-363">363</a></span>
<span class="normal"><a href="#__codelineno-2-364">364</a></span>
<span class="normal"><a href="#__codelineno-2-365">365</a></span>
<span class="normal"><a href="#__codelineno-2-366">366</a></span>
<span class="normal"><a href="#__codelineno-2-367">367</a></span>
<span class="normal"><a href="#__codelineno-2-368">368</a></span>
<span class="normal"><a href="#__codelineno-2-369">369</a></span>
<span class="normal"><a href="#__codelineno-2-370">370</a></span>
<span class="normal"><a href="#__codelineno-2-371">371</a></span>
<span class="normal"><a href="#__codelineno-2-372">372</a></span>
<span class="normal"><a href="#__codelineno-2-373">373</a></span>
<span class="normal"><a href="#__codelineno-2-374">374</a></span>
<span class="normal"><a href="#__codelineno-2-375">375</a></span>
<span class="normal"><a href="#__codelineno-2-376">376</a></span>
<span class="normal"><a href="#__codelineno-2-377">377</a></span>
<span class="normal"><a href="#__codelineno-2-378">378</a></span>
<span class="normal"><a href="#__codelineno-2-379">379</a></span>
<span class="normal"><a href="#__codelineno-2-380">380</a></span>
<span class="normal"><a href="#__codelineno-2-381">381</a></span>
<span class="normal"><a href="#__codelineno-2-382">382</a></span>
<span class="normal"><a href="#__codelineno-2-383">383</a></span>
<span class="normal"><a href="#__codelineno-2-384">384</a></span>
<span class="normal"><a href="#__codelineno-2-385">385</a></span>
<span class="normal"><a href="#__codelineno-2-386">386</a></span>
<span class="normal"><a href="#__codelineno-2-387">387</a></span>
<span class="normal"><a href="#__codelineno-2-388">388</a></span>
<span class="normal"><a href="#__codelineno-2-389">389</a></span>
<span class="normal"><a href="#__codelineno-2-390">390</a></span>
<span class="normal"><a href="#__codelineno-2-391">391</a></span>
<span class="normal"><a href="#__codelineno-2-392">392</a></span>
<span class="normal"><a href="#__codelineno-2-393">393</a></span>
<span class="normal"><a href="#__codelineno-2-394">394</a></span>
<span class="normal"><a href="#__codelineno-2-395">395</a></span>
<span class="normal"><a href="#__codelineno-2-396">396</a></span>
<span class="normal"><a href="#__codelineno-2-397">397</a></span>
<span class="normal"><a href="#__codelineno-2-398">398</a></span>
<span class="normal"><a href="#__codelineno-2-399">399</a></span>
<span class="normal"><a href="#__codelineno-2-400">400</a></span>
<span class="normal"><a href="#__codelineno-2-401">401</a></span>
<span class="normal"><a href="#__codelineno-2-402">402</a></span>
<span class="normal"><a href="#__codelineno-2-403">403</a></span>
<span class="normal"><a href="#__codelineno-2-404">404</a></span>
<span class="normal"><a href="#__codelineno-2-405">405</a></span>
<span class="normal"><a href="#__codelineno-2-406">406</a></span>
<span class="normal"><a href="#__codelineno-2-407">407</a></span>
<span class="normal"><a href="#__codelineno-2-408">408</a></span>
<span class="normal"><a href="#__codelineno-2-409">409</a></span>
<span class="normal"><a href="#__codelineno-2-410">410</a></span>
<span class="normal"><a href="#__codelineno-2-411">411</a></span>
<span class="normal"><a href="#__codelineno-2-412">412</a></span>
<span class="normal"><a href="#__codelineno-2-413">413</a></span>
<span class="normal"><a href="#__codelineno-2-414">414</a></span>
<span class="normal"><a href="#__codelineno-2-415">415</a></span>
<span class="normal"><a href="#__codelineno-2-416">416</a></span>
<span class="normal"><a href="#__codelineno-2-417">417</a></span>
<span class="normal"><a href="#__codelineno-2-418">418</a></span>
<span class="normal"><a href="#__codelineno-2-419">419</a></span>
<span class="normal"><a href="#__codelineno-2-420">420</a></span>
<span class="normal"><a href="#__codelineno-2-421">421</a></span>
<span class="normal"><a href="#__codelineno-2-422">422</a></span>
<span class="normal"><a href="#__codelineno-2-423">423</a></span>
<span class="normal"><a href="#__codelineno-2-424">424</a></span>
<span class="normal"><a href="#__codelineno-2-425">425</a></span>
<span class="normal"><a href="#__codelineno-2-426">426</a></span>
<span class="normal"><a href="#__codelineno-2-427">427</a></span>
<span class="normal"><a href="#__codelineno-2-428">428</a></span>
<span class="normal"><a href="#__codelineno-2-429">429</a></span>
<span class="normal"><a href="#__codelineno-2-430">430</a></span>
<span class="normal"><a href="#__codelineno-2-431">431</a></span>
<span class="normal"><a href="#__codelineno-2-432">432</a></span>
<span class="normal"><a href="#__codelineno-2-433">433</a></span>
<span class="normal"><a href="#__codelineno-2-434">434</a></span>
<span class="normal"><a href="#__codelineno-2-435">435</a></span>
<span class="normal"><a href="#__codelineno-2-436">436</a></span>
<span class="normal"><a href="#__codelineno-2-437">437</a></span>
<span class="normal"><a href="#__codelineno-2-438">438</a></span>
<span class="normal"><a href="#__codelineno-2-439">439</a></span>
<span class="normal"><a href="#__codelineno-2-440">440</a></span>
<span class="normal"><a href="#__codelineno-2-441">441</a></span>
<span class="normal"><a href="#__codelineno-2-442">442</a></span>
<span class="normal"><a href="#__codelineno-2-443">443</a></span>
<span class="normal"><a href="#__codelineno-2-444">444</a></span>
<span class="normal"><a href="#__codelineno-2-445">445</a></span>
<span class="normal"><a href="#__codelineno-2-446">446</a></span>
<span class="normal"><a href="#__codelineno-2-447">447</a></span>
<span class="normal"><a href="#__codelineno-2-448">448</a></span>
<span class="normal"><a href="#__codelineno-2-449">449</a></span>
<span class="normal"><a href="#__codelineno-2-450">450</a></span>
<span class="normal"><a href="#__codelineno-2-451">451</a></span>
<span class="normal"><a href="#__codelineno-2-452">452</a></span>
<span class="normal"><a href="#__codelineno-2-453">453</a></span>
<span class="normal"><a href="#__codelineno-2-454">454</a></span>
<span class="normal"><a href="#__codelineno-2-455">455</a></span>
<span class="normal"><a href="#__codelineno-2-456">456</a></span>
<span class="normal"><a href="#__codelineno-2-457">457</a></span>
<span class="normal"><a href="#__codelineno-2-458">458</a></span>
<span class="normal"><a href="#__codelineno-2-459">459</a></span>
<span class="normal"><a href="#__codelineno-2-460">460</a></span>
<span class="normal"><a href="#__codelineno-2-461">461</a></span>
<span class="normal"><a href="#__codelineno-2-462">462</a></span>
<span class="normal"><a href="#__codelineno-2-463">463</a></span>
<span class="normal"><a href="#__codelineno-2-464">464</a></span>
<span class="normal"><a href="#__codelineno-2-465">465</a></span>
<span class="normal"><a href="#__codelineno-2-466">466</a></span>
<span class="normal"><a href="#__codelineno-2-467">467</a></span>
<span class="normal"><a href="#__codelineno-2-468">468</a></span>
<span class="normal"><a href="#__codelineno-2-469">469</a></span>
<span class="normal"><a href="#__codelineno-2-470">470</a></span>
<span class="normal"><a href="#__codelineno-2-471">471</a></span>
<span class="normal"><a href="#__codelineno-2-472">472</a></span>
<span class="normal"><a href="#__codelineno-2-473">473</a></span>
<span class="normal"><a href="#__codelineno-2-474">474</a></span>
<span class="normal"><a href="#__codelineno-2-475">475</a></span>
<span class="normal"><a href="#__codelineno-2-476">476</a></span>
<span class="normal"><a href="#__codelineno-2-477">477</a></span>
<span class="normal"><a href="#__codelineno-2-478">478</a></span>
<span class="normal"><a href="#__codelineno-2-479">479</a></span>
<span class="normal"><a href="#__codelineno-2-480">480</a></span>
<span class="normal"><a href="#__codelineno-2-481">481</a></span>
<span class="normal"><a href="#__codelineno-2-482">482</a></span>
<span class="normal"><a href="#__codelineno-2-483">483</a></span>
<span class="normal"><a href="#__codelineno-2-484">484</a></span>
<span class="normal"><a href="#__codelineno-2-485">485</a></span>
<span class="normal"><a href="#__codelineno-2-486">486</a></span>
<span class="normal"><a href="#__codelineno-2-487">487</a></span>
<span class="normal"><a href="#__codelineno-2-488">488</a></span>
<span class="normal"><a href="#__codelineno-2-489">489</a></span>
<span class="normal"><a href="#__codelineno-2-490">490</a></span>
<span class="normal"><a href="#__codelineno-2-491">491</a></span>
<span class="normal"><a href="#__codelineno-2-492">492</a></span>
<span class="normal"><a href="#__codelineno-2-493">493</a></span>
<span class="normal"><a href="#__codelineno-2-494">494</a></span>
<span class="normal"><a href="#__codelineno-2-495">495</a></span>
<span class="normal"><a href="#__codelineno-2-496">496</a></span>
<span class="normal"><a href="#__codelineno-2-497">497</a></span>
<span class="normal"><a href="#__codelineno-2-498">498</a></span>
<span class="normal"><a href="#__codelineno-2-499">499</a></span>
<span class="normal"><a href="#__codelineno-2-500">500</a></span>
<span class="normal"><a href="#__codelineno-2-501">501</a></span>
<span class="normal"><a href="#__codelineno-2-502">502</a></span>
<span class="normal"><a href="#__codelineno-2-503">503</a></span>
<span class="normal"><a href="#__codelineno-2-504">504</a></span>
<span class="normal"><a href="#__codelineno-2-505">505</a></span>
<span class="normal"><a href="#__codelineno-2-506">506</a></span>
<span class="normal"><a href="#__codelineno-2-507">507</a></span>
<span class="normal"><a href="#__codelineno-2-508">508</a></span>
<span class="normal"><a href="#__codelineno-2-509">509</a></span>
<span class="normal"><a href="#__codelineno-2-510">510</a></span>
<span class="normal"><a href="#__codelineno-2-511">511</a></span>
<span class="normal"><a href="#__codelineno-2-512">512</a></span>
<span class="normal"><a href="#__codelineno-2-513">513</a></span>
<span class="normal"><a href="#__codelineno-2-514">514</a></span>
<span class="normal"><a href="#__codelineno-2-515">515</a></span>
<span class="normal"><a href="#__codelineno-2-516">516</a></span>
<span class="normal"><a href="#__codelineno-2-517">517</a></span>
<span class="normal"><a href="#__codelineno-2-518">518</a></span>
<span class="normal"><a href="#__codelineno-2-519">519</a></span>
<span class="normal"><a href="#__codelineno-2-520">520</a></span>
<span class="normal"><a href="#__codelineno-2-521">521</a></span>
<span class="normal"><a href="#__codelineno-2-522">522</a></span>
<span class="normal"><a href="#__codelineno-2-523">523</a></span>
<span class="normal"><a href="#__codelineno-2-524">524</a></span>
<span class="normal"><a href="#__codelineno-2-525">525</a></span>
<span class="normal"><a href="#__codelineno-2-526">526</a></span>
<span class="normal"><a href="#__codelineno-2-527">527</a></span>
<span class="normal"><a href="#__codelineno-2-528">528</a></span>
<span class="normal"><a href="#__codelineno-2-529">529</a></span>
<span class="normal"><a href="#__codelineno-2-530">530</a></span>
<span class="normal"><a href="#__codelineno-2-531">531</a></span>
<span class="normal"><a href="#__codelineno-2-532">532</a></span>
<span class="normal"><a href="#__codelineno-2-533">533</a></span>
<span class="normal"><a href="#__codelineno-2-534">534</a></span>
<span class="normal"><a href="#__codelineno-2-535">535</a></span>
<span class="normal"><a href="#__codelineno-2-536">536</a></span>
<span class="normal"><a href="#__codelineno-2-537">537</a></span>
<span class="normal"><a href="#__codelineno-2-538">538</a></span>
<span class="normal"><a href="#__codelineno-2-539">539</a></span>
<span class="normal"><a href="#__codelineno-2-540">540</a></span>
<span class="normal"><a href="#__codelineno-2-541">541</a></span>
<span class="normal"><a href="#__codelineno-2-542">542</a></span>
<span class="normal"><a href="#__codelineno-2-543">543</a></span>
<span class="normal"><a href="#__codelineno-2-544">544</a></span>
<span class="normal"><a href="#__codelineno-2-545">545</a></span>
<span class="normal"><a href="#__codelineno-2-546">546</a></span>
<span class="normal"><a href="#__codelineno-2-547">547</a></span>
<span class="normal"><a href="#__codelineno-2-548">548</a></span>
<span class="normal"><a href="#__codelineno-2-549">549</a></span>
<span class="normal"><a href="#__codelineno-2-550">550</a></span>
<span class="normal"><a href="#__codelineno-2-551">551</a></span>
<span class="normal"><a href="#__codelineno-2-552">552</a></span>
<span class="normal"><a href="#__codelineno-2-553">553</a></span>
<span class="normal"><a href="#__codelineno-2-554">554</a></span>
<span class="normal"><a href="#__codelineno-2-555">555</a></span>
<span class="normal"><a href="#__codelineno-2-556">556</a></span>
<span class="normal"><a href="#__codelineno-2-557">557</a></span>
<span class="normal"><a href="#__codelineno-2-558">558</a></span>
<span class="normal"><a href="#__codelineno-2-559">559</a></span>
<span class="normal"><a href="#__codelineno-2-560">560</a></span>
<span class="normal"><a href="#__codelineno-2-561">561</a></span>
<span class="normal"><a href="#__codelineno-2-562">562</a></span>
<span class="normal"><a href="#__codelineno-2-563">563</a></span>
<span class="normal"><a href="#__codelineno-2-564">564</a></span>
<span class="normal"><a href="#__codelineno-2-565">565</a></span>
<span class="normal"><a href="#__codelineno-2-566">566</a></span>
<span class="normal"><a href="#__codelineno-2-567">567</a></span>
<span class="normal"><a href="#__codelineno-2-568">568</a></span>
<span class="normal"><a href="#__codelineno-2-569">569</a></span>
<span class="normal"><a href="#__codelineno-2-570">570</a></span>
<span class="normal"><a href="#__codelineno-2-571">571</a></span>
<span class="normal"><a href="#__codelineno-2-572">572</a></span>
<span class="normal"><a href="#__codelineno-2-573">573</a></span>
<span class="normal"><a href="#__codelineno-2-574">574</a></span>
<span class="normal"><a href="#__codelineno-2-575">575</a></span>
<span class="normal"><a href="#__codelineno-2-576">576</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="c">% MATLAB Script for Creating ROI Files from Activation Maps and Image Masks</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="c">% =========================================================================</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="c">% This script generates an ROI from an existing ROI mask and an activation contrast map.</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="c">%</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="c">% Dependencies: Requires MarsBaR and SPM to be installed.</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="c">%</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="c">% Author: Andrea Costantino</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="c">% Date: 7 July 2023</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9"></a>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="nb">clc</span><span class="p">;</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="nb">clear</span><span class="p">;</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12"></a>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="c">%% Set Parameters</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="c">% Define paths for data directories, GLM results, MarsBaR, and ROI storage.</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="n">derivativesDir</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;/data/projects/chess/data/BIDS/derivatives&#39;</span><span class="p">;</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="n">GLMroot</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="n">derivativesDir</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;SPM/GLM/&#39;</span><span class="p">);</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="n">marsabPath</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="n">derivativesDir</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;marsbar&#39;</span><span class="p">);</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18"></a><span class="n">roisRoot</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="n">marsabPath</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;rois-noloc&#39;</span><span class="p">);</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="n">outRoot</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="n">marsabPath</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;rois+loc&#39;</span><span class="p">);</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20"></a>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21"></a><span class="c">%% Define ROI Details</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22"></a>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23"></a><span class="c">% Example ROIs: Specify ROI name, path to the image file, task, and contrast name.</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24"></a><span class="n">roisStruct</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">roiName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;FFA&#39;</span><span class="p">;</span>
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25"></a><span class="n">roisStruct</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">roiImgPath</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="n">roisRoot</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;radius_10/ROI-FFA_radius-10_space-MNI_resampled-to-sub_binary.nii&#39;</span><span class="p">);</span>
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26"></a><span class="n">roisStruct</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">taskName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;exp&#39;</span><span class="p">;</span>
</span><span id="__span-2-27"><a id="__codelineno-2-27" name="__codelineno-2-27"></a><span class="n">roisStruct</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">contrastName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;All &gt; Rest&#39;</span><span class="p">;</span>
</span><span id="__span-2-28"><a id="__codelineno-2-28" name="__codelineno-2-28"></a><span class="n">roisStruct</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">outFolder</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;radius_10+exp&#39;</span><span class="p">;</span>
</span><span id="__span-2-29"><a id="__codelineno-2-29" name="__codelineno-2-29"></a>
</span><span id="__span-2-30"><a id="__codelineno-2-30" name="__codelineno-2-30"></a><span class="c">% LOC - Objects &gt; Scrambled</span>
</span><span id="__span-2-31"><a id="__codelineno-2-31" name="__codelineno-2-31"></a><span class="n">roisStruct</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">roiName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;LOC&#39;</span><span class="p">;</span>
</span><span id="__span-2-32"><a id="__codelineno-2-32" name="__codelineno-2-32"></a><span class="n">roisStruct</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">roiImgPath</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="n">roisRoot</span><span class="p">,</span><span class="s">&#39;radius_10/ROI-LOC_radius-10_space-MNI_resampled-to-sub_binary.nii&#39;</span><span class="p">);</span>
</span><span id="__span-2-33"><a id="__codelineno-2-33" name="__codelineno-2-33"></a><span class="n">roisStruct</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">taskName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;loc&#39;</span><span class="p">;</span>
</span><span id="__span-2-34"><a id="__codelineno-2-34" name="__codelineno-2-34"></a><span class="n">roisStruct</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">contrastName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;Objects &gt; Scrambled&#39;</span><span class="p">;</span>
</span><span id="__span-2-35"><a id="__codelineno-2-35" name="__codelineno-2-35"></a><span class="n">roisStruct</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">outFolder</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;radius_10+loc&#39;</span><span class="p">;</span>
</span><span id="__span-2-36"><a id="__codelineno-2-36" name="__codelineno-2-36"></a>
</span><span id="__span-2-37"><a id="__codelineno-2-37" name="__codelineno-2-37"></a><span class="c">% Define here more ROIs if needed</span>
</span><span id="__span-2-38"><a id="__codelineno-2-38" name="__codelineno-2-38"></a>
</span><span id="__span-2-39"><a id="__codelineno-2-39" name="__codelineno-2-39"></a><span class="c">%% Select Subjects</span>
</span><span id="__span-2-40"><a id="__codelineno-2-40" name="__codelineno-2-40"></a><span class="c">% Define which subjects to process. Use &#39;*&#39; for all subjects.</span>
</span><span id="__span-2-41"><a id="__codelineno-2-41" name="__codelineno-2-41"></a><span class="n">selectedSubjectsList</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;*&#39;</span><span class="p">;</span>
</span><span id="__span-2-42"><a id="__codelineno-2-42" name="__codelineno-2-42"></a><span class="n">subPaths</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">findSubjectsFolders</span><span class="p">(</span><span class="n">GLMroot</span><span class="p">,</span><span class="w"> </span><span class="n">selectedSubjectsList</span><span class="p">);</span>
</span><span id="__span-2-43"><a id="__codelineno-2-43" name="__codelineno-2-43"></a>
</span><span id="__span-2-44"><a id="__codelineno-2-44" name="__codelineno-2-44"></a><span class="c">%% Initialize MarsBaR and SPM</span>
</span><span id="__span-2-45"><a id="__codelineno-2-45" name="__codelineno-2-45"></a><span class="c">% Start the MarsBaR toolbox and set SPM defaults for fMRI.</span>
</span><span id="__span-2-46"><a id="__codelineno-2-46" name="__codelineno-2-46"></a><span class="n">marsbar</span><span class="p">(</span><span class="s">&#39;on&#39;</span><span class="p">);</span>
</span><span id="__span-2-47"><a id="__codelineno-2-47" name="__codelineno-2-47"></a><span class="n">spm</span><span class="p">(</span><span class="s">&#39;defaults&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;fmri&#39;</span><span class="p">);</span>
</span><span id="__span-2-48"><a id="__codelineno-2-48" name="__codelineno-2-48"></a>
</span><span id="__span-2-49"><a id="__codelineno-2-49" name="__codelineno-2-49"></a><span class="c">%% Process Each Subject</span>
</span><span id="__span-2-50"><a id="__codelineno-2-50" name="__codelineno-2-50"></a><span class="k">for</span><span class="w"> </span><span class="n">subRow</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">subPaths</span><span class="p">)</span>
</span><span id="__span-2-51"><a id="__codelineno-2-51" name="__codelineno-2-51"></a><span class="w">    </span><span class="c">% Subject name and preparation</span>
</span><span id="__span-2-52"><a id="__codelineno-2-52" name="__codelineno-2-52"></a><span class="w">    </span><span class="n">subName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">subPaths</span><span class="p">(</span><span class="n">subRow</span><span class="p">).</span><span class="n">name</span><span class="p">;</span>
</span><span id="__span-2-53"><a id="__codelineno-2-53" name="__codelineno-2-53"></a><span class="w">    </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;\n###### Processing %s ######\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">subName</span><span class="p">);</span>
</span><span id="__span-2-54"><a id="__codelineno-2-54" name="__codelineno-2-54"></a>
</span><span id="__span-2-55"><a id="__codelineno-2-55" name="__codelineno-2-55"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">roiNum</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">roisStruct</span><span class="p">)</span>
</span><span id="__span-2-56"><a id="__codelineno-2-56" name="__codelineno-2-56"></a><span class="w">        </span><span class="c">% Output directory setup</span>
</span><span id="__span-2-57"><a id="__codelineno-2-57" name="__codelineno-2-57"></a><span class="w">        </span><span class="n">outDir</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">createOutputDir</span><span class="p">(</span><span class="n">outRoot</span><span class="p">,</span><span class="w"> </span><span class="n">roisStruct</span><span class="p">(</span><span class="n">roiNum</span><span class="p">).</span><span class="n">outFolder</span><span class="p">,</span><span class="w"> </span><span class="n">subName</span><span class="p">);</span>
</span><span id="__span-2-58"><a id="__codelineno-2-58" name="__codelineno-2-58"></a>
</span><span id="__span-2-59"><a id="__codelineno-2-59" name="__codelineno-2-59"></a><span class="w">        </span><span class="c">% Ensure subject has the specified task, or skip this ROI</span>
</span><span id="__span-2-60"><a id="__codelineno-2-60" name="__codelineno-2-60"></a><span class="w">        </span><span class="n">subPath</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="n">subPaths</span><span class="p">(</span><span class="n">subRow</span><span class="p">).</span><span class="n">folder</span><span class="p">,</span><span class="w"> </span><span class="n">subPaths</span><span class="p">(</span><span class="n">subRow</span><span class="p">).</span><span class="n">name</span><span class="p">);</span>
</span><span id="__span-2-61"><a id="__codelineno-2-61" name="__codelineno-2-61"></a><span class="w">        </span><span class="n">subHasTask</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">checkSubjectHasTask</span><span class="p">(</span><span class="n">subPath</span><span class="p">,</span><span class="w"> </span><span class="n">roisStruct</span><span class="p">(</span><span class="n">roiNum</span><span class="p">).</span><span class="n">taskName</span><span class="p">,</span><span class="w"> </span><span class="n">subName</span><span class="p">);</span>
</span><span id="__span-2-62"><a id="__codelineno-2-62" name="__codelineno-2-62"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="n">subHasTask</span>
</span><span id="__span-2-63"><a id="__codelineno-2-63" name="__codelineno-2-63"></a><span class="w">            </span><span class="k">continue</span><span class="p">;</span>
</span><span id="__span-2-64"><a id="__codelineno-2-64" name="__codelineno-2-64"></a><span class="w">        </span><span class="k">end</span>
</span><span id="__span-2-65"><a id="__codelineno-2-65" name="__codelineno-2-65"></a>
</span><span id="__span-2-66"><a id="__codelineno-2-66" name="__codelineno-2-66"></a><span class="w">        </span><span class="c">% Load ROI image data</span>
</span><span id="__span-2-67"><a id="__codelineno-2-67" name="__codelineno-2-67"></a><span class="w">        </span><span class="p">[</span><span class="n">roiImg</span><span class="p">,</span><span class="w"> </span><span class="n">roiStruct</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">loadROIImageData</span><span class="p">(</span><span class="n">roisStruct</span><span class="p">(</span><span class="n">roiNum</span><span class="p">).</span><span class="n">roiImgPath</span><span class="p">);</span>
</span><span id="__span-2-68"><a id="__codelineno-2-68" name="__codelineno-2-68"></a>
</span><span id="__span-2-69"><a id="__codelineno-2-69" name="__codelineno-2-69"></a><span class="w">        </span><span class="c">% Load SPM model for the subject and task</span>
</span><span id="__span-2-70"><a id="__codelineno-2-70" name="__codelineno-2-70"></a><span class="w">        </span><span class="n">GLMdir</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="n">GLMroot</span><span class="p">,</span><span class="w"> </span><span class="n">subName</span><span class="p">,</span><span class="w"> </span><span class="n">roisStruct</span><span class="p">(</span><span class="n">roiNum</span><span class="p">).</span><span class="n">taskName</span><span class="p">);</span>
</span><span id="__span-2-71"><a id="__codelineno-2-71" name="__codelineno-2-71"></a><span class="w">        </span><span class="p">[</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">loadSuccess</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">loadSPMModel</span><span class="p">(</span><span class="n">GLMdir</span><span class="p">,</span><span class="w"> </span><span class="n">subName</span><span class="p">,</span><span class="w"> </span><span class="n">roisStruct</span><span class="p">(</span><span class="n">roiNum</span><span class="p">).</span><span class="n">taskName</span><span class="p">);</span>
</span><span id="__span-2-72"><a id="__codelineno-2-72" name="__codelineno-2-72"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="n">loadSuccess</span>
</span><span id="__span-2-73"><a id="__codelineno-2-73" name="__codelineno-2-73"></a><span class="w">            </span><span class="k">continue</span><span class="p">;</span>
</span><span id="__span-2-74"><a id="__codelineno-2-74" name="__codelineno-2-74"></a><span class="w">        </span><span class="k">end</span>
</span><span id="__span-2-75"><a id="__codelineno-2-75" name="__codelineno-2-75"></a>
</span><span id="__span-2-76"><a id="__codelineno-2-76" name="__codelineno-2-76"></a><span class="w">        </span><span class="c">% Load and threshold the contrast map (p &lt; 0.001)</span>
</span><span id="__span-2-77"><a id="__codelineno-2-77" name="__codelineno-2-77"></a><span class="w">        </span><span class="p">[</span><span class="n">tConImg</span><span class="p">,</span><span class="w"> </span><span class="n">tStruct</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">loadTContrastImage</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">roisStruct</span><span class="p">(</span><span class="n">roiNum</span><span class="p">).</span><span class="n">contrastName</span><span class="p">,</span><span class="w"> </span><span class="n">GLMdir</span><span class="p">);</span>
</span><span id="__span-2-78"><a id="__codelineno-2-78" name="__codelineno-2-78"></a><span class="w">        </span><span class="p">[</span><span class="n">thresholdedImage</span><span class="p">,</span><span class="w"> </span><span class="n">finalPThresh</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">calculateAndApplyThreshold</span><span class="p">(</span><span class="n">tConImg</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">);</span>
</span><span id="__span-2-79"><a id="__codelineno-2-79" name="__codelineno-2-79"></a>
</span><span id="__span-2-80"><a id="__codelineno-2-80" name="__codelineno-2-80"></a><span class="w">        </span><span class="c">% Check alignment between ROI and contrast map</span>
</span><span id="__span-2-81"><a id="__codelineno-2-81" name="__codelineno-2-81"></a><span class="w">        </span><span class="nb">assert</span><span class="p">(</span><span class="nb">isequal</span><span class="p">(</span><span class="n">roiStruct</span><span class="p">.</span><span class="n">mat</span><span class="p">,</span><span class="w"> </span><span class="n">tStruct</span><span class="p">.</span><span class="n">mat</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;Affine matrices do not match.&#39;</span><span class="p">);</span>
</span><span id="__span-2-82"><a id="__codelineno-2-82" name="__codelineno-2-82"></a><span class="w">        </span><span class="nb">assert</span><span class="p">(</span><span class="nb">isequal</span><span class="p">(</span><span class="n">roiStruct</span><span class="p">.</span><span class="n">dim</span><span class="p">,</span><span class="w"> </span><span class="n">tStruct</span><span class="p">.</span><span class="n">dim</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;Image dimensions do not match.&#39;</span><span class="p">);</span>
</span><span id="__span-2-83"><a id="__codelineno-2-83" name="__codelineno-2-83"></a>
</span><span id="__span-2-84"><a id="__codelineno-2-84" name="__codelineno-2-84"></a><span class="w">        </span><span class="c">% Intersect thresholded T map and ROI mask</span>
</span><span id="__span-2-85"><a id="__codelineno-2-85" name="__codelineno-2-85"></a><span class="w">        </span><span class="n">finalRoi</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">createIntersectedROI</span><span class="p">(</span><span class="n">thresholdedImage</span><span class="p">,</span><span class="w"> </span><span class="n">roiImg</span><span class="p">,</span><span class="w"> </span><span class="n">tStruct</span><span class="p">,</span><span class="w"> </span><span class="n">roisStruct</span><span class="p">(</span><span class="n">roiNum</span><span class="p">).</span><span class="n">roiName</span><span class="p">,</span><span class="w"> </span><span class="n">roisStruct</span><span class="p">(</span><span class="n">roiNum</span><span class="p">).</span><span class="n">contrastName</span><span class="p">);</span>
</span><span id="__span-2-86"><a id="__codelineno-2-86" name="__codelineno-2-86"></a>
</span><span id="__span-2-87"><a id="__codelineno-2-87" name="__codelineno-2-87"></a><span class="w">        </span><span class="c">% Save final ROI to file</span>
</span><span id="__span-2-88"><a id="__codelineno-2-88" name="__codelineno-2-88"></a><span class="w">        </span><span class="n">saveROI</span><span class="p">(</span><span class="n">finalRoi</span><span class="p">,</span><span class="w"> </span><span class="n">roisStruct</span><span class="p">(</span><span class="n">roiNum</span><span class="p">).</span><span class="n">roiImgPath</span><span class="p">,</span><span class="w"> </span><span class="n">finalPThresh</span><span class="p">,</span><span class="w"> </span><span class="n">roisStruct</span><span class="p">(</span><span class="n">roiNum</span><span class="p">).</span><span class="n">taskName</span><span class="p">,</span><span class="w"> </span><span class="n">roisStruct</span><span class="p">(</span><span class="n">roiNum</span><span class="p">).</span><span class="n">contrastName</span><span class="p">,</span><span class="w"> </span><span class="n">outDir</span><span class="p">);</span>
</span><span id="__span-2-89"><a id="__codelineno-2-89" name="__codelineno-2-89"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-2-90"><a id="__codelineno-2-90" name="__codelineno-2-90"></a>
</span><span id="__span-2-91"><a id="__codelineno-2-91" name="__codelineno-2-91"></a><span class="w">    </span><span class="c">% Save a copy of the script for replicability</span>
</span><span id="__span-2-92"><a id="__codelineno-2-92" name="__codelineno-2-92"></a><span class="w">    </span><span class="n">saveScriptForReplicability</span><span class="p">(</span><span class="n">outDir</span><span class="p">);</span>
</span><span id="__span-2-93"><a id="__codelineno-2-93" name="__codelineno-2-93"></a><span class="k">end</span>
</span><span id="__span-2-94"><a id="__codelineno-2-94" name="__codelineno-2-94"></a>
</span><span id="__span-2-95"><a id="__codelineno-2-95" name="__codelineno-2-95"></a><span class="c">%% Helper functions</span>
</span><span id="__span-2-96"><a id="__codelineno-2-96" name="__codelineno-2-96"></a><span class="k">function</span><span class="w"> </span><span class="nf">saveScriptForReplicability</span><span class="p">(</span>outDir<span class="p">)</span>
</span><span id="__span-2-97"><a id="__codelineno-2-97" name="__codelineno-2-97"></a><span class="w">    </span><span class="c">% Copies the currently running script to the specified output directory for replicability.</span>
</span><span id="__span-2-98"><a id="__codelineno-2-98" name="__codelineno-2-98"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-99"><a id="__codelineno-2-99" name="__codelineno-2-99"></a><span class="w">    </span><span class="c">% This function identifies the full path of the currently executing script and copies it</span>
</span><span id="__span-2-100"><a id="__codelineno-2-100" name="__codelineno-2-100"></a><span class="w">    </span><span class="c">% to the given output directory. This process aids in ensuring that analyses can be</span>
</span><span id="__span-2-101"><a id="__codelineno-2-101" name="__codelineno-2-101"></a><span class="w">    </span><span class="c">% replicated or reviewed in the future with the exact code version used.</span>
</span><span id="__span-2-102"><a id="__codelineno-2-102" name="__codelineno-2-102"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-103"><a id="__codelineno-2-103" name="__codelineno-2-103"></a><span class="w">    </span><span class="c">% Parameters:</span>
</span><span id="__span-2-104"><a id="__codelineno-2-104" name="__codelineno-2-104"></a><span class="w">    </span><span class="c">%   outDir: The directory where the script should be copied for future reference.</span>
</span><span id="__span-2-105"><a id="__codelineno-2-105" name="__codelineno-2-105"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-106"><a id="__codelineno-2-106" name="__codelineno-2-106"></a><span class="w">    </span><span class="c">% Example usage:</span>
</span><span id="__span-2-107"><a id="__codelineno-2-107" name="__codelineno-2-107"></a><span class="w">    </span><span class="c">%   saveScriptForReplicability(&#39;/path/to/output/dir&#39;);</span>
</span><span id="__span-2-108"><a id="__codelineno-2-108" name="__codelineno-2-108"></a>
</span><span id="__span-2-109"><a id="__codelineno-2-109" name="__codelineno-2-109"></a><span class="w">    </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;Saving current script for replicability...\n&#39;</span><span class="p">);</span>
</span><span id="__span-2-110"><a id="__codelineno-2-110" name="__codelineno-2-110"></a>
</span><span id="__span-2-111"><a id="__codelineno-2-111" name="__codelineno-2-111"></a><span class="w">    </span><span class="c">% Get the full path of the currently executing script</span>
</span><span id="__span-2-112"><a id="__codelineno-2-112" name="__codelineno-2-112"></a><span class="w">    </span><span class="n">fileNameAndLocation</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">mfilename</span><span class="p">(</span><span class="s">&#39;fullpath&#39;</span><span class="p">);</span>
</span><span id="__span-2-113"><a id="__codelineno-2-113" name="__codelineno-2-113"></a>
</span><span id="__span-2-114"><a id="__codelineno-2-114" name="__codelineno-2-114"></a><span class="w">    </span><span class="c">% Extract the directory, file name, and extension of the current script</span>
</span><span id="__span-2-115"><a id="__codelineno-2-115" name="__codelineno-2-115"></a><span class="w">    </span><span class="p">[</span><span class="nb">path</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fileparts</span><span class="p">(</span><span class="n">fileNameAndLocation</span><span class="p">);</span>
</span><span id="__span-2-116"><a id="__codelineno-2-116" name="__codelineno-2-116"></a>
</span><span id="__span-2-117"><a id="__codelineno-2-117" name="__codelineno-2-117"></a><span class="w">    </span><span class="c">% Construct the output file name and location</span>
</span><span id="__span-2-118"><a id="__codelineno-2-118" name="__codelineno-2-118"></a><span class="w">    </span><span class="n">outputFileNameAndLocation</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="n">outDir</span><span class="p">,</span><span class="w"> </span><span class="nb">strcat</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;.m&#39;</span><span class="p">));</span>
</span><span id="__span-2-119"><a id="__codelineno-2-119" name="__codelineno-2-119"></a>
</span><span id="__span-2-120"><a id="__codelineno-2-120" name="__codelineno-2-120"></a><span class="w">    </span><span class="c">% Define the current script&#39;s file path</span>
</span><span id="__span-2-121"><a id="__codelineno-2-121" name="__codelineno-2-121"></a><span class="w">    </span><span class="n">currentfile</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">strcat</span><span class="p">(</span><span class="n">fileNameAndLocation</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;.m&#39;</span><span class="p">);</span>
</span><span id="__span-2-122"><a id="__codelineno-2-122" name="__codelineno-2-122"></a>
</span><span id="__span-2-123"><a id="__codelineno-2-123" name="__codelineno-2-123"></a><span class="w">    </span><span class="c">% Copy the script file to the output directory</span>
</span><span id="__span-2-124"><a id="__codelineno-2-124" name="__codelineno-2-124"></a><span class="w">    </span><span class="k">try</span>
</span><span id="__span-2-125"><a id="__codelineno-2-125" name="__codelineno-2-125"></a><span class="w">        </span><span class="nb">copyfile</span><span class="p">(</span><span class="n">currentfile</span><span class="p">,</span><span class="w"> </span><span class="n">outputFileNameAndLocation</span><span class="p">);</span>
</span><span id="__span-2-126"><a id="__codelineno-2-126" name="__codelineno-2-126"></a><span class="w">        </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;Script copied to output folder: %s\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">outputFileNameAndLocation</span><span class="p">);</span>
</span><span id="__span-2-127"><a id="__codelineno-2-127" name="__codelineno-2-127"></a><span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="n">ME</span>
</span><span id="__span-2-128"><a id="__codelineno-2-128" name="__codelineno-2-128"></a><span class="w">        </span><span class="nb">warning</span><span class="p">(</span><span class="s">&#39;Failed to copy script to output folder: %s&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">ME</span><span class="p">.</span><span class="n">message</span><span class="p">);</span>
</span><span id="__span-2-129"><a id="__codelineno-2-129" name="__codelineno-2-129"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-2-130"><a id="__codelineno-2-130" name="__codelineno-2-130"></a><span class="k">end</span>
</span><span id="__span-2-131"><a id="__codelineno-2-131" name="__codelineno-2-131"></a>
</span><span id="__span-2-132"><a id="__codelineno-2-132" name="__codelineno-2-132"></a><span class="k">function</span><span class="w"> </span><span class="nf">saveROI</span><span class="p">(</span>finalRoi, roiImgPath, pThresh, taskName, contrastName, outDir<span class="p">)</span>
</span><span id="__span-2-133"><a id="__codelineno-2-133" name="__codelineno-2-133"></a><span class="w">    </span><span class="c">% Saves the ROI to the specified output directory in both NIfTI and .mat formats.</span>
</span><span id="__span-2-134"><a id="__codelineno-2-134" name="__codelineno-2-134"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-135"><a id="__codelineno-2-135" name="__codelineno-2-135"></a><span class="w">    </span><span class="c">% This function constructs the output file name using the base ROI name, task name,</span>
</span><span id="__span-2-136"><a id="__codelineno-2-136" name="__codelineno-2-136"></a><span class="w">    </span><span class="c">% a simplified contrast name, and the p-value threshold used. It saves the ROI object</span>
</span><span id="__span-2-137"><a id="__codelineno-2-137" name="__codelineno-2-137"></a><span class="w">    </span><span class="c">% as an image and as a MATLAB file, logging each step.</span>
</span><span id="__span-2-138"><a id="__codelineno-2-138" name="__codelineno-2-138"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-139"><a id="__codelineno-2-139" name="__codelineno-2-139"></a><span class="w">    </span><span class="c">% Parameters:</span>
</span><span id="__span-2-140"><a id="__codelineno-2-140" name="__codelineno-2-140"></a><span class="w">    </span><span class="c">%   finalRoi: The ROI object to be saved.</span>
</span><span id="__span-2-141"><a id="__codelineno-2-141" name="__codelineno-2-141"></a><span class="w">    </span><span class="c">%   roiImgPath: The file path of the original ROI, used to extract the base file name.</span>
</span><span id="__span-2-142"><a id="__codelineno-2-142" name="__codelineno-2-142"></a><span class="w">    </span><span class="c">%   pThresh: The p-value threshold used, for inclusion in the file name.</span>
</span><span id="__span-2-143"><a id="__codelineno-2-143" name="__codelineno-2-143"></a><span class="w">    </span><span class="c">%   taskName: The name of the task associated with the ROI.</span>
</span><span id="__span-2-144"><a id="__codelineno-2-144" name="__codelineno-2-144"></a><span class="w">    </span><span class="c">%   contrastName: The original contrast name, to be simplified for file naming.</span>
</span><span id="__span-2-145"><a id="__codelineno-2-145" name="__codelineno-2-145"></a><span class="w">    </span><span class="c">%   outDir: The directory where the ROI files should be saved.</span>
</span><span id="__span-2-146"><a id="__codelineno-2-146" name="__codelineno-2-146"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-147"><a id="__codelineno-2-147" name="__codelineno-2-147"></a><span class="w">    </span><span class="c">% Example usage:</span>
</span><span id="__span-2-148"><a id="__codelineno-2-148" name="__codelineno-2-148"></a><span class="w">    </span><span class="c">%   saveROI(finalRoi, &#39;/path/to/original/roi.nii&#39;, 0.001, &#39;task1&#39;, &#39;Contrast 1&#39;, &#39;/path/to/output/dir&#39;);</span>
</span><span id="__span-2-149"><a id="__codelineno-2-149" name="__codelineno-2-149"></a>
</span><span id="__span-2-150"><a id="__codelineno-2-150" name="__codelineno-2-150"></a><span class="w">    </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;STEP: Saving ROI...\n&#39;</span><span class="p">);</span>
</span><span id="__span-2-151"><a id="__codelineno-2-151" name="__codelineno-2-151"></a>
</span><span id="__span-2-152"><a id="__codelineno-2-152" name="__codelineno-2-152"></a><span class="w">    </span><span class="c">% Extract the base file name of the original ROI for use in the output file names</span>
</span><span id="__span-2-153"><a id="__codelineno-2-153" name="__codelineno-2-153"></a><span class="w">    </span><span class="p">[</span><span class="o">~</span><span class="p">,</span><span class="w"> </span><span class="n">roiFileName</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fileparts</span><span class="p">(</span><span class="n">roiImgPath</span><span class="p">);</span>
</span><span id="__span-2-154"><a id="__codelineno-2-154" name="__codelineno-2-154"></a>
</span><span id="__span-2-155"><a id="__codelineno-2-155" name="__codelineno-2-155"></a><span class="w">    </span><span class="c">% Simplify the contrast name for use in the file name</span>
</span><span id="__span-2-156"><a id="__codelineno-2-156" name="__codelineno-2-156"></a><span class="w">    </span><span class="n">contrastNameSimple</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">simplifyContrastName</span><span class="p">(</span><span class="n">contrastName</span><span class="p">);</span>
</span><span id="__span-2-157"><a id="__codelineno-2-157" name="__codelineno-2-157"></a>
</span><span id="__span-2-158"><a id="__codelineno-2-158" name="__codelineno-2-158"></a><span class="w">    </span><span class="c">% Prepare the p-value string for inclusion in the file name</span>
</span><span id="__span-2-159"><a id="__codelineno-2-159" name="__codelineno-2-159"></a><span class="w">    </span><span class="n">pThreshStringSplit</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">split</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="n">pThresh</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;.&#39;</span><span class="p">);</span>
</span><span id="__span-2-160"><a id="__codelineno-2-160" name="__codelineno-2-160"></a><span class="w">    </span><span class="n">pThreshString</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">pThreshStringSplit</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="c">% Extracting decimal part for file naming</span>
</span><span id="__span-2-161"><a id="__codelineno-2-161" name="__codelineno-2-161"></a>
</span><span id="__span-2-162"><a id="__codelineno-2-162" name="__codelineno-2-162"></a><span class="w">    </span><span class="c">% Construct the output file name</span>
</span><span id="__span-2-163"><a id="__codelineno-2-163" name="__codelineno-2-163"></a><span class="w">    </span><span class="n">outFileName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">strcat</span><span class="p">(</span><span class="n">roiFileName</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;_task-&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">taskName</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;_contrast-&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">contrastNameSimple</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;_p&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">pThreshString</span><span class="p">);</span>
</span><span id="__span-2-164"><a id="__codelineno-2-164" name="__codelineno-2-164"></a>
</span><span id="__span-2-165"><a id="__codelineno-2-165" name="__codelineno-2-165"></a><span class="w">    </span><span class="c">% Define full paths for the NIfTI and .mat files</span>
</span><span id="__span-2-166"><a id="__codelineno-2-166" name="__codelineno-2-166"></a><span class="w">    </span><span class="n">niiFilePath</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">char</span><span class="p">(</span><span class="nb">fullfile</span><span class="p">(</span><span class="n">outDir</span><span class="p">,</span><span class="w"> </span><span class="nb">strcat</span><span class="p">(</span><span class="n">outFileName</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;.nii&#39;</span><span class="p">)));</span>
</span><span id="__span-2-167"><a id="__codelineno-2-167" name="__codelineno-2-167"></a><span class="w">    </span><span class="n">matFilePath</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">char</span><span class="p">(</span><span class="nb">fullfile</span><span class="p">(</span><span class="n">outDir</span><span class="p">,</span><span class="w"> </span><span class="nb">strcat</span><span class="p">(</span><span class="n">outFileName</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;.mat&#39;</span><span class="p">)));</span>
</span><span id="__span-2-168"><a id="__codelineno-2-168" name="__codelineno-2-168"></a>
</span><span id="__span-2-169"><a id="__codelineno-2-169" name="__codelineno-2-169"></a><span class="w">    </span><span class="c">% Save the ROI as an image file</span>
</span><span id="__span-2-170"><a id="__codelineno-2-170" name="__codelineno-2-170"></a><span class="w">    </span><span class="k">try</span>
</span><span id="__span-2-171"><a id="__codelineno-2-171" name="__codelineno-2-171"></a><span class="w">        </span><span class="n">save_as_image</span><span class="p">(</span><span class="n">finalRoi</span><span class="p">,</span><span class="w"> </span><span class="n">niiFilePath</span><span class="p">);</span>
</span><span id="__span-2-172"><a id="__codelineno-2-172" name="__codelineno-2-172"></a><span class="w">        </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;ROI image saved to: %s\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">niiFilePath</span><span class="p">);</span>
</span><span id="__span-2-173"><a id="__codelineno-2-173" name="__codelineno-2-173"></a><span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="n">ME</span>
</span><span id="__span-2-174"><a id="__codelineno-2-174" name="__codelineno-2-174"></a><span class="w">        </span><span class="nb">warning</span><span class="p">(</span><span class="s">&#39;Failed to save ROI image: %s&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">ME</span><span class="p">.</span><span class="n">message</span><span class="p">);</span>
</span><span id="__span-2-175"><a id="__codelineno-2-175" name="__codelineno-2-175"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-2-176"><a id="__codelineno-2-176" name="__codelineno-2-176"></a>
</span><span id="__span-2-177"><a id="__codelineno-2-177" name="__codelineno-2-177"></a><span class="w">    </span><span class="c">% Save the ROI as a MATLAB .mat file</span>
</span><span id="__span-2-178"><a id="__codelineno-2-178" name="__codelineno-2-178"></a><span class="w">    </span><span class="k">try</span>
</span><span id="__span-2-179"><a id="__codelineno-2-179" name="__codelineno-2-179"></a><span class="w">        </span><span class="n">saveroi</span><span class="p">(</span><span class="n">finalRoi</span><span class="p">,</span><span class="w"> </span><span class="n">matFilePath</span><span class="p">);</span>
</span><span id="__span-2-180"><a id="__codelineno-2-180" name="__codelineno-2-180"></a><span class="w">        </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;ROI MATLAB file saved to: %s\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">matFilePath</span><span class="p">);</span>
</span><span id="__span-2-181"><a id="__codelineno-2-181" name="__codelineno-2-181"></a><span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="n">ME</span>
</span><span id="__span-2-182"><a id="__codelineno-2-182" name="__codelineno-2-182"></a><span class="w">        </span><span class="nb">warning</span><span class="p">(</span><span class="s">&#39;Failed to save ROI MATLAB file: %s&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">ME</span><span class="p">.</span><span class="n">message</span><span class="p">);</span>
</span><span id="__span-2-183"><a id="__codelineno-2-183" name="__codelineno-2-183"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-2-184"><a id="__codelineno-2-184" name="__codelineno-2-184"></a><span class="k">end</span>
</span><span id="__span-2-185"><a id="__codelineno-2-185" name="__codelineno-2-185"></a>
</span><span id="__span-2-186"><a id="__codelineno-2-186" name="__codelineno-2-186"></a><span class="k">function</span><span class="w"> </span>finalRoi<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">createIntersectedROI</span><span class="p">(</span>thresholdedImage, roiImg, tStruct, roiName, contrastName<span class="p">)</span>
</span><span id="__span-2-187"><a id="__codelineno-2-187" name="__codelineno-2-187"></a><span class="w">    </span><span class="c">% Creates a new ROI object from the intersection of a thresholded T image and an ROI image.</span>
</span><span id="__span-2-188"><a id="__codelineno-2-188" name="__codelineno-2-188"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-189"><a id="__codelineno-2-189" name="__codelineno-2-189"></a><span class="w">    </span><span class="c">% This function performs a logical AND operation between a binary thresholded T image</span>
</span><span id="__span-2-190"><a id="__codelineno-2-190" name="__codelineno-2-190"></a><span class="w">    </span><span class="c">% and a binary ROI image, marking voxels included in both images. It then creates a new</span>
</span><span id="__span-2-191"><a id="__codelineno-2-191" name="__codelineno-2-191"></a><span class="w">    </span><span class="c">% ROI object with a label derived from the ROI name and a simplified contrast name.</span>
</span><span id="__span-2-192"><a id="__codelineno-2-192" name="__codelineno-2-192"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-193"><a id="__codelineno-2-193" name="__codelineno-2-193"></a><span class="w">    </span><span class="c">% Parameters:</span>
</span><span id="__span-2-194"><a id="__codelineno-2-194" name="__codelineno-2-194"></a><span class="w">    </span><span class="c">%   thresholdedImage: Binary image where voxels above a certain threshold are marked as 1.</span>
</span><span id="__span-2-195"><a id="__codelineno-2-195" name="__codelineno-2-195"></a><span class="w">    </span><span class="c">%   roiImg: The ROI image data.</span>
</span><span id="__span-2-196"><a id="__codelineno-2-196" name="__codelineno-2-196"></a><span class="w">    </span><span class="c">%   tStruct: The structure returned by spm_vol, containing the T image&#39;s affine matrix.</span>
</span><span id="__span-2-197"><a id="__codelineno-2-197" name="__codelineno-2-197"></a><span class="w">    </span><span class="c">%   roiName: The name of the ROI.</span>
</span><span id="__span-2-198"><a id="__codelineno-2-198" name="__codelineno-2-198"></a><span class="w">    </span><span class="c">%   contrastName: The name of the contrast used for thresholding.</span>
</span><span id="__span-2-199"><a id="__codelineno-2-199" name="__codelineno-2-199"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-200"><a id="__codelineno-2-200" name="__codelineno-2-200"></a><span class="w">    </span><span class="c">% Returns:</span>
</span><span id="__span-2-201"><a id="__codelineno-2-201" name="__codelineno-2-201"></a><span class="w">    </span><span class="c">%   finalRoi: The newly created ROI object.</span>
</span><span id="__span-2-202"><a id="__codelineno-2-202" name="__codelineno-2-202"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-203"><a id="__codelineno-2-203" name="__codelineno-2-203"></a><span class="w">    </span><span class="c">% Example usage:</span>
</span><span id="__span-2-204"><a id="__codelineno-2-204" name="__codelineno-2-204"></a><span class="w">    </span><span class="c">%   finalRoi = createIntersectedROI(thresholdedTImg, roiImgData, tImageStruct, &#39;ROI_Name&#39;, &#39;Contrast_Name&#39;);</span>
</span><span id="__span-2-205"><a id="__codelineno-2-205" name="__codelineno-2-205"></a>
</span><span id="__span-2-206"><a id="__codelineno-2-206" name="__codelineno-2-206"></a><span class="w">    </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;STEP: Intersecting thresholded T image with ROI...\n&#39;</span><span class="p">);</span>
</span><span id="__span-2-207"><a id="__codelineno-2-207" name="__codelineno-2-207"></a>
</span><span id="__span-2-208"><a id="__codelineno-2-208" name="__codelineno-2-208"></a><span class="w">    </span><span class="c">% Perform intersection by applying a logical AND operation</span>
</span><span id="__span-2-209"><a id="__codelineno-2-209" name="__codelineno-2-209"></a><span class="w">    </span><span class="n">intersectedImage</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">thresholdedImage</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">roiImg</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.5</span><span class="p">);</span>
</span><span id="__span-2-210"><a id="__codelineno-2-210" name="__codelineno-2-210"></a>
</span><span id="__span-2-211"><a id="__codelineno-2-211" name="__codelineno-2-211"></a><span class="w">    </span><span class="c">% Optionally, count the number of voxels in the intersection for reporting or further analysis</span>
</span><span id="__span-2-212"><a id="__codelineno-2-212" name="__codelineno-2-212"></a><span class="w">    </span><span class="n">numIntersectedVoxels</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">sum</span><span class="p">(</span><span class="n">intersectedImage</span><span class="p">(:));</span>
</span><span id="__span-2-213"><a id="__codelineno-2-213" name="__codelineno-2-213"></a><span class="w">    </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;Number of intersected voxels: %d\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">numIntersectedVoxels</span><span class="p">);</span>
</span><span id="__span-2-214"><a id="__codelineno-2-214" name="__codelineno-2-214"></a>
</span><span id="__span-2-215"><a id="__codelineno-2-215" name="__codelineno-2-215"></a><span class="w">    </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;STEP: Creating new ROI from intersected data...\n&#39;</span><span class="p">);</span>
</span><span id="__span-2-216"><a id="__codelineno-2-216" name="__codelineno-2-216"></a>
</span><span id="__span-2-217"><a id="__codelineno-2-217" name="__codelineno-2-217"></a><span class="w">    </span><span class="c">% Simplify the contrast name for labeling the ROI</span>
</span><span id="__span-2-218"><a id="__codelineno-2-218" name="__codelineno-2-218"></a><span class="w">    </span><span class="n">contrastNameSimple</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">simplifyContrastName</span><span class="p">(</span><span class="n">contrastName</span><span class="p">);</span>
</span><span id="__span-2-219"><a id="__codelineno-2-219" name="__codelineno-2-219"></a>
</span><span id="__span-2-220"><a id="__codelineno-2-220" name="__codelineno-2-220"></a><span class="w">    </span><span class="c">% Create the new ROI object with specified parameters</span>
</span><span id="__span-2-221"><a id="__codelineno-2-221" name="__codelineno-2-221"></a><span class="w">    </span><span class="n">finalRoi</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">maroi_matrix</span><span class="p">(</span><span class="nb">struct</span><span class="p">(</span><span class="s">&#39;dat&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">intersectedImage</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;mat&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">tStruct</span><span class="p">.</span><span class="n">mat</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;label&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">strcat</span><span class="p">([</span><span class="n">roiName</span><span class="p">,</span><span class="w"> </span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">contrastNameSimple</span><span class="p">]),</span><span class="w"> </span><span class="s">&#39;binarize&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;roithresh&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">1e-10</span><span class="p">));</span>
</span><span id="__span-2-222"><a id="__codelineno-2-222" name="__codelineno-2-222"></a>
</span><span id="__span-2-223"><a id="__codelineno-2-223" name="__codelineno-2-223"></a><span class="w">    </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;DONE: New ROI created successfully.\n&#39;</span><span class="p">);</span>
</span><span id="__span-2-224"><a id="__codelineno-2-224" name="__codelineno-2-224"></a><span class="k">end</span>
</span><span id="__span-2-225"><a id="__codelineno-2-225" name="__codelineno-2-225"></a>
</span><span id="__span-2-226"><a id="__codelineno-2-226" name="__codelineno-2-226"></a><span class="k">function</span><span class="w"> </span>contrastNameSimple<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">simplifyContrastName</span><span class="p">(</span>contrastName<span class="p">)</span>
</span><span id="__span-2-227"><a id="__codelineno-2-227" name="__codelineno-2-227"></a><span class="w">    </span><span class="c">% Simplifies the contrast name by removing non-alphabetic characters and parentheses.</span>
</span><span id="__span-2-228"><a id="__codelineno-2-228" name="__codelineno-2-228"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-229"><a id="__codelineno-2-229" name="__codelineno-2-229"></a><span class="w">    </span><span class="c">% Parameters:</span>
</span><span id="__span-2-230"><a id="__codelineno-2-230" name="__codelineno-2-230"></a><span class="w">    </span><span class="c">%   contrastName: The original contrast name as a string.</span>
</span><span id="__span-2-231"><a id="__codelineno-2-231" name="__codelineno-2-231"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-232"><a id="__codelineno-2-232" name="__codelineno-2-232"></a><span class="w">    </span><span class="c">% Returns:</span>
</span><span id="__span-2-233"><a id="__codelineno-2-233" name="__codelineno-2-233"></a><span class="w">    </span><span class="c">%   contrastNameSimple: The simplified contrast name, with only lowercase alphabetic characters.</span>
</span><span id="__span-2-234"><a id="__codelineno-2-234" name="__codelineno-2-234"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-235"><a id="__codelineno-2-235" name="__codelineno-2-235"></a><span class="w">    </span><span class="c">% Example usage:</span>
</span><span id="__span-2-236"><a id="__codelineno-2-236" name="__codelineno-2-236"></a><span class="w">    </span><span class="c">%   contrastNameSimple = simplifyContrastName(&#39;Contrast 1 (Session 1)&#39;);</span>
</span><span id="__span-2-237"><a id="__codelineno-2-237" name="__codelineno-2-237"></a>
</span><span id="__span-2-238"><a id="__codelineno-2-238" name="__codelineno-2-238"></a><span class="w">    </span><span class="n">contrastNameSimple</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">regexprep</span><span class="p">(</span><span class="nb">lower</span><span class="p">(</span><span class="n">contrastName</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;[^a-z]+|\([^)]*\)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;&#39;</span><span class="p">);</span>
</span><span id="__span-2-239"><a id="__codelineno-2-239" name="__codelineno-2-239"></a><span class="k">end</span>
</span><span id="__span-2-240"><a id="__codelineno-2-240" name="__codelineno-2-240"></a>
</span><span id="__span-2-241"><a id="__codelineno-2-241" name="__codelineno-2-241"></a><span class="k">function</span><span class="w"> </span>hasTask<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">checkSubjectHasTask</span><span class="p">(</span>subPath, taskName, subName<span class="p">)</span>
</span><span id="__span-2-242"><a id="__codelineno-2-242" name="__codelineno-2-242"></a><span class="w">    </span><span class="c">% Checks if the specified subject directory contains files related to the specified task.</span>
</span><span id="__span-2-243"><a id="__codelineno-2-243" name="__codelineno-2-243"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-244"><a id="__codelineno-2-244" name="__codelineno-2-244"></a><span class="w">    </span><span class="c">% Parameters:</span>
</span><span id="__span-2-245"><a id="__codelineno-2-245" name="__codelineno-2-245"></a><span class="w">    </span><span class="c">%   subPath: The full path to the subject&#39;s directory.</span>
</span><span id="__span-2-246"><a id="__codelineno-2-246" name="__codelineno-2-246"></a><span class="w">    </span><span class="c">%   taskName: The name of the task to check for.</span>
</span><span id="__span-2-247"><a id="__codelineno-2-247" name="__codelineno-2-247"></a><span class="w">    </span><span class="c">%   subName: The name of the subject being checked.</span>
</span><span id="__span-2-248"><a id="__codelineno-2-248" name="__codelineno-2-248"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-249"><a id="__codelineno-2-249" name="__codelineno-2-249"></a><span class="w">    </span><span class="c">% Returns:</span>
</span><span id="__span-2-250"><a id="__codelineno-2-250" name="__codelineno-2-250"></a><span class="w">    </span><span class="c">%   hasTask: A boolean indicating whether the task is present for the subject.</span>
</span><span id="__span-2-251"><a id="__codelineno-2-251" name="__codelineno-2-251"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-252"><a id="__codelineno-2-252" name="__codelineno-2-252"></a><span class="w">    </span><span class="c">% Example usage:</span>
</span><span id="__span-2-253"><a id="__codelineno-2-253" name="__codelineno-2-253"></a><span class="w">    </span><span class="c">%   hasTask = checkSubjectHasTask(&#39;/path/to/subject/directory&#39;, &#39;task_name&#39;, &#39;subject_name&#39;);</span>
</span><span id="__span-2-254"><a id="__codelineno-2-254" name="__codelineno-2-254"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-255"><a id="__codelineno-2-255" name="__codelineno-2-255"></a><span class="w">    </span><span class="c">% This function searches the subject&#39;s directory for files containing the task name,</span>
</span><span id="__span-2-256"><a id="__codelineno-2-256" name="__codelineno-2-256"></a><span class="w">    </span><span class="c">% and provides a warning if the task is not found, suggesting the iteration should be skipped.</span>
</span><span id="__span-2-257"><a id="__codelineno-2-257" name="__codelineno-2-257"></a>
</span><span id="__span-2-258"><a id="__codelineno-2-258" name="__codelineno-2-258"></a><span class="w">    </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;Checking for task %s in subject %s directory...\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">taskName</span><span class="p">,</span><span class="w"> </span><span class="n">subName</span><span class="p">);</span>
</span><span id="__span-2-259"><a id="__codelineno-2-259" name="__codelineno-2-259"></a>
</span><span id="__span-2-260"><a id="__codelineno-2-260" name="__codelineno-2-260"></a><span class="w">    </span><span class="c">% Construct the full path and list files</span>
</span><span id="__span-2-261"><a id="__codelineno-2-261" name="__codelineno-2-261"></a><span class="w">    </span><span class="n">files</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">dir</span><span class="p">(</span><span class="n">subPath</span><span class="p">);</span>
</span><span id="__span-2-262"><a id="__codelineno-2-262" name="__codelineno-2-262"></a><span class="w">    </span><span class="n">fileNames</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="n">files</span><span class="p">.</span><span class="n">name</span><span class="p">};</span>
</span><span id="__span-2-263"><a id="__codelineno-2-263" name="__codelineno-2-263"></a>
</span><span id="__span-2-264"><a id="__codelineno-2-264" name="__codelineno-2-264"></a><span class="w">    </span><span class="c">% Check for the presence of the task name in any file names</span>
</span><span id="__span-2-265"><a id="__codelineno-2-265" name="__codelineno-2-265"></a><span class="w">    </span><span class="n">hasTask</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">any</span><span class="p">(</span><span class="nb">contains</span><span class="p">(</span><span class="n">fileNames</span><span class="p">,</span><span class="w"> </span><span class="n">taskName</span><span class="p">));</span>
</span><span id="__span-2-266"><a id="__codelineno-2-266" name="__codelineno-2-266"></a>
</span><span id="__span-2-267"><a id="__codelineno-2-267" name="__codelineno-2-267"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="n">hasTask</span>
</span><span id="__span-2-268"><a id="__codelineno-2-268" name="__codelineno-2-268"></a><span class="w">        </span><span class="c">% If the task is not found, issue a warning</span>
</span><span id="__span-2-269"><a id="__codelineno-2-269" name="__codelineno-2-269"></a><span class="w">        </span><span class="nb">warning</span><span class="p">(</span><span class="s">&#39;Task %s not found for %s in %s. Skipping...&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">taskName</span><span class="p">,</span><span class="w"> </span><span class="n">subName</span><span class="p">,</span><span class="w"> </span><span class="n">subPath</span><span class="p">);</span>
</span><span id="__span-2-270"><a id="__codelineno-2-270" name="__codelineno-2-270"></a><span class="w">    </span><span class="k">else</span>
</span><span id="__span-2-271"><a id="__codelineno-2-271" name="__codelineno-2-271"></a><span class="w">        </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;Task %s found for subject %s.\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">taskName</span><span class="p">,</span><span class="w"> </span><span class="n">subName</span><span class="p">);</span>
</span><span id="__span-2-272"><a id="__codelineno-2-272" name="__codelineno-2-272"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-2-273"><a id="__codelineno-2-273" name="__codelineno-2-273"></a><span class="k">end</span>
</span><span id="__span-2-274"><a id="__codelineno-2-274" name="__codelineno-2-274"></a>
</span><span id="__span-2-275"><a id="__codelineno-2-275" name="__codelineno-2-275"></a><span class="k">function</span><span class="w"> </span><span class="nf">[tConImg, tStruct] = loadTContrastImage</span><span class="p">(</span>model, contrastName, GLMdir<span class="p">)</span>
</span><span id="__span-2-276"><a id="__codelineno-2-276" name="__codelineno-2-276"></a><span class="w">    </span><span class="c">% Loads T contrast image voxel data for a given contrast name and GLM directory.</span>
</span><span id="__span-2-277"><a id="__codelineno-2-277" name="__codelineno-2-277"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-278"><a id="__codelineno-2-278" name="__codelineno-2-278"></a><span class="w">    </span><span class="c">% Parameters:</span>
</span><span id="__span-2-279"><a id="__codelineno-2-279" name="__codelineno-2-279"></a><span class="w">    </span><span class="c">%   model: The loaded SPM model object for the current subject and task.</span>
</span><span id="__span-2-280"><a id="__codelineno-2-280" name="__codelineno-2-280"></a><span class="w">    </span><span class="c">%   contrastName: The name of the contrast to load.</span>
</span><span id="__span-2-281"><a id="__codelineno-2-281" name="__codelineno-2-281"></a><span class="w">    </span><span class="c">%   GLMdir: Directory containing the GLM results for the subject.</span>
</span><span id="__span-2-282"><a id="__codelineno-2-282" name="__codelineno-2-282"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-283"><a id="__codelineno-2-283" name="__codelineno-2-283"></a><span class="w">    </span><span class="c">% Returns:</span>
</span><span id="__span-2-284"><a id="__codelineno-2-284" name="__codelineno-2-284"></a><span class="w">    </span><span class="c">%   tConImg: The voxel data of the T contrast image.</span>
</span><span id="__span-2-285"><a id="__codelineno-2-285" name="__codelineno-2-285"></a><span class="w">    </span><span class="c">%   tStruct: The structure of the T contrast image.</span>
</span><span id="__span-2-286"><a id="__codelineno-2-286" name="__codelineno-2-286"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-287"><a id="__codelineno-2-287" name="__codelineno-2-287"></a><span class="w">    </span><span class="c">% Example usage:</span>
</span><span id="__span-2-288"><a id="__codelineno-2-288" name="__codelineno-2-288"></a><span class="w">    </span><span class="c">%   [tConImg, tStruct] = loadTContrastImage(model, &#39;contrastName&#39;, &#39;/path/to/GLMdir&#39;);</span>
</span><span id="__span-2-289"><a id="__codelineno-2-289" name="__codelineno-2-289"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-290"><a id="__codelineno-2-290" name="__codelineno-2-290"></a><span class="w">    </span><span class="c">% This function first attempts to find the specified contrast within the model.</span>
</span><span id="__span-2-291"><a id="__codelineno-2-291" name="__codelineno-2-291"></a><span class="w">    </span><span class="c">% If not found, it appends &#39; - All Sessions&#39; to the name and retries.</span>
</span><span id="__span-2-292"><a id="__codelineno-2-292" name="__codelineno-2-292"></a><span class="w">    </span><span class="c">% It then checks for the existence of the T contrast image file and loads its voxel data.</span>
</span><span id="__span-2-293"><a id="__codelineno-2-293" name="__codelineno-2-293"></a>
</span><span id="__span-2-294"><a id="__codelineno-2-294" name="__codelineno-2-294"></a><span class="w">    </span><span class="k">try</span>
</span><span id="__span-2-295"><a id="__codelineno-2-295" name="__codelineno-2-295"></a><span class="w">        </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;Attempting to load T contrast image for contrast: %s\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">contrastName</span><span class="p">);</span>
</span><span id="__span-2-296"><a id="__codelineno-2-296" name="__codelineno-2-296"></a>
</span><span id="__span-2-297"><a id="__codelineno-2-297" name="__codelineno-2-297"></a><span class="w">        </span><span class="c">% Attempt to find the specified contrast by name</span>
</span><span id="__span-2-298"><a id="__codelineno-2-298" name="__codelineno-2-298"></a><span class="w">        </span><span class="n">t_con</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">get_contrast_by_name</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">contrastName</span><span class="p">);</span>
</span><span id="__span-2-299"><a id="__codelineno-2-299" name="__codelineno-2-299"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nb">isempty</span><span class="p">(</span><span class="n">t_con</span><span class="p">)</span>
</span><span id="__span-2-300"><a id="__codelineno-2-300" name="__codelineno-2-300"></a><span class="w">            </span><span class="c">% If not found, try appending &#39; - All Sessions&#39; and search again</span>
</span><span id="__span-2-301"><a id="__codelineno-2-301" name="__codelineno-2-301"></a><span class="w">            </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;Contrast %s not found, trying with &quot; - All Sessions&quot; suffix.\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">contrastName</span><span class="p">);</span>
</span><span id="__span-2-302"><a id="__codelineno-2-302" name="__codelineno-2-302"></a><span class="w">            </span><span class="n">contrastName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">strcat</span><span class="p">(</span><span class="n">contrastName</span><span class="p">,</span><span class="w"> </span><span class="s">&#39; - All Sessions&#39;</span><span class="p">);</span>
</span><span id="__span-2-303"><a id="__codelineno-2-303" name="__codelineno-2-303"></a><span class="w">            </span><span class="n">t_con</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">get_contrast_by_name</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">contrastName</span><span class="p">);</span>
</span><span id="__span-2-304"><a id="__codelineno-2-304" name="__codelineno-2-304"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nb">isempty</span><span class="p">(</span><span class="n">t_con</span><span class="p">)</span>
</span><span id="__span-2-305"><a id="__codelineno-2-305" name="__codelineno-2-305"></a><span class="w">                </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;ContrastNotFound&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Cannot find the contrast %s in the design; has it been estimated?&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">contrastName</span><span class="p">);</span>
</span><span id="__span-2-306"><a id="__codelineno-2-306" name="__codelineno-2-306"></a><span class="w">            </span><span class="k">end</span>
</span><span id="__span-2-307"><a id="__codelineno-2-307" name="__codelineno-2-307"></a><span class="w">        </span><span class="k">end</span>
</span><span id="__span-2-308"><a id="__codelineno-2-308" name="__codelineno-2-308"></a>
</span><span id="__span-2-309"><a id="__codelineno-2-309" name="__codelineno-2-309"></a><span class="w">        </span><span class="c">% Construct the full path to the T contrast image file</span>
</span><span id="__span-2-310"><a id="__codelineno-2-310" name="__codelineno-2-310"></a><span class="w">        </span><span class="n">tConFname</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="n">GLMdir</span><span class="p">,</span><span class="w"> </span><span class="n">t_con</span><span class="p">.</span><span class="n">Vspm</span><span class="p">.</span><span class="n">fname</span><span class="p">);</span>
</span><span id="__span-2-311"><a id="__codelineno-2-311" name="__codelineno-2-311"></a>
</span><span id="__span-2-312"><a id="__codelineno-2-312" name="__codelineno-2-312"></a><span class="w">        </span><span class="c">% Verify the existence of the T contrast image file</span>
</span><span id="__span-2-313"><a id="__codelineno-2-313" name="__codelineno-2-313"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="nb">exist</span><span class="p">(</span><span class="n">tConFname</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;file&#39;</span><span class="p">)</span>
</span><span id="__span-2-314"><a id="__codelineno-2-314" name="__codelineno-2-314"></a><span class="w">            </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;FileNotFound&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Cannot find T image %s; has it been estimated?&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">tConFname</span><span class="p">);</span>
</span><span id="__span-2-315"><a id="__codelineno-2-315" name="__codelineno-2-315"></a><span class="w">        </span><span class="k">else</span>
</span><span id="__span-2-316"><a id="__codelineno-2-316" name="__codelineno-2-316"></a><span class="w">            </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;T contrast image found: %s\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">tConFname</span><span class="p">);</span>
</span><span id="__span-2-317"><a id="__codelineno-2-317" name="__codelineno-2-317"></a><span class="w">        </span><span class="k">end</span>
</span><span id="__span-2-318"><a id="__codelineno-2-318" name="__codelineno-2-318"></a>
</span><span id="__span-2-319"><a id="__codelineno-2-319" name="__codelineno-2-319"></a><span class="w">        </span><span class="c">% Load the voxel data from the T contrast image</span>
</span><span id="__span-2-320"><a id="__codelineno-2-320" name="__codelineno-2-320"></a><span class="w">        </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;Loading voxel data from T contrast image...\n&#39;</span><span class="p">);</span>
</span><span id="__span-2-321"><a id="__codelineno-2-321" name="__codelineno-2-321"></a><span class="w">        </span><span class="n">tStruct</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">spm_vol</span><span class="p">(</span><span class="n">tConFname</span><span class="p">);</span>
</span><span id="__span-2-322"><a id="__codelineno-2-322" name="__codelineno-2-322"></a><span class="w">        </span><span class="n">tConImg</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">spm_read_vols</span><span class="p">(</span><span class="n">tStruct</span><span class="p">);</span>
</span><span id="__span-2-323"><a id="__codelineno-2-323" name="__codelineno-2-323"></a><span class="w">        </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;Voxel data loaded successfully.\n&#39;</span><span class="p">);</span>
</span><span id="__span-2-324"><a id="__codelineno-2-324" name="__codelineno-2-324"></a>
</span><span id="__span-2-325"><a id="__codelineno-2-325" name="__codelineno-2-325"></a><span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="n">ME</span>
</span><span id="__span-2-326"><a id="__codelineno-2-326" name="__codelineno-2-326"></a><span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="n">ME</span><span class="p">.</span><span class="n">identifier</span>
</span><span id="__span-2-327"><a id="__codelineno-2-327" name="__codelineno-2-327"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="s">&#39;ContrastNotFound&#39;</span>
</span><span id="__span-2-328"><a id="__codelineno-2-328" name="__codelineno-2-328"></a><span class="w">                </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;Error: %s\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">ME</span><span class="p">.</span><span class="n">message</span><span class="p">);</span>
</span><span id="__span-2-329"><a id="__codelineno-2-329" name="__codelineno-2-329"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="s">&#39;FileNotFound&#39;</span>
</span><span id="__span-2-330"><a id="__codelineno-2-330" name="__codelineno-2-330"></a><span class="w">                </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;Error: %s\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">ME</span><span class="p">.</span><span class="n">message</span><span class="p">);</span>
</span><span id="__span-2-331"><a id="__codelineno-2-331" name="__codelineno-2-331"></a><span class="w">            </span><span class="k">otherwise</span>
</span><span id="__span-2-332"><a id="__codelineno-2-332" name="__codelineno-2-332"></a><span class="w">                </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;An unexpected error occurred: %s\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">ME</span><span class="p">.</span><span class="n">message</span><span class="p">);</span>
</span><span id="__span-2-333"><a id="__codelineno-2-333" name="__codelineno-2-333"></a><span class="w">        </span><span class="k">end</span>
</span><span id="__span-2-334"><a id="__codelineno-2-334" name="__codelineno-2-334"></a><span class="w">        </span><span class="n">tConImg</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[];</span><span class="w"> </span><span class="c">% Return empty in case of error</span>
</span><span id="__span-2-335"><a id="__codelineno-2-335" name="__codelineno-2-335"></a><span class="w">        </span><span class="n">tConFname</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;&#39;</span><span class="p">;</span>
</span><span id="__span-2-336"><a id="__codelineno-2-336" name="__codelineno-2-336"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-2-337"><a id="__codelineno-2-337" name="__codelineno-2-337"></a><span class="k">end</span>
</span><span id="__span-2-338"><a id="__codelineno-2-338" name="__codelineno-2-338"></a>
</span><span id="__span-2-339"><a id="__codelineno-2-339" name="__codelineno-2-339"></a><span class="k">function</span><span class="w"> </span><span class="nf">[model, loadSuccess] = loadSPMModel</span><span class="p">(</span>GLMdir, subName, taskName<span class="p">)</span>
</span><span id="__span-2-340"><a id="__codelineno-2-340" name="__codelineno-2-340"></a><span class="w">    </span><span class="c">% Attempts to load the SPM model for a given subject and task.</span>
</span><span id="__span-2-341"><a id="__codelineno-2-341" name="__codelineno-2-341"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-342"><a id="__codelineno-2-342" name="__codelineno-2-342"></a><span class="w">    </span><span class="c">% Parameters:</span>
</span><span id="__span-2-343"><a id="__codelineno-2-343" name="__codelineno-2-343"></a><span class="w">    </span><span class="c">%   GLMdir: The directory containing the GLM results for the subject.</span>
</span><span id="__span-2-344"><a id="__codelineno-2-344" name="__codelineno-2-344"></a><span class="w">    </span><span class="c">%   subName: The name of the current subject being processed.</span>
</span><span id="__span-2-345"><a id="__codelineno-2-345" name="__codelineno-2-345"></a><span class="w">    </span><span class="c">%   taskName: The name of the task for which the model is being loaded.</span>
</span><span id="__span-2-346"><a id="__codelineno-2-346" name="__codelineno-2-346"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-347"><a id="__codelineno-2-347" name="__codelineno-2-347"></a><span class="w">    </span><span class="c">% Returns:</span>
</span><span id="__span-2-348"><a id="__codelineno-2-348" name="__codelineno-2-348"></a><span class="w">    </span><span class="c">%   model: The loaded SPM model object, or empty if loading failed.</span>
</span><span id="__span-2-349"><a id="__codelineno-2-349" name="__codelineno-2-349"></a><span class="w">    </span><span class="c">%   loadSuccess: A boolean indicating whether the model was successfully loaded.</span>
</span><span id="__span-2-350"><a id="__codelineno-2-350" name="__codelineno-2-350"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-351"><a id="__codelineno-2-351" name="__codelineno-2-351"></a><span class="w">    </span><span class="c">% Example usage:</span>
</span><span id="__span-2-352"><a id="__codelineno-2-352" name="__codelineno-2-352"></a><span class="w">    </span><span class="c">%   [model, loadSuccess] = loadSPMModel(&#39;/path/to/GLMdir&#39;, &#39;subject1&#39;, &#39;task1&#39;);</span>
</span><span id="__span-2-353"><a id="__codelineno-2-353" name="__codelineno-2-353"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-354"><a id="__codelineno-2-354" name="__codelineno-2-354"></a><span class="w">    </span><span class="c">% This function tries to load the SPM.mat file and handles any errors that occur,</span>
</span><span id="__span-2-355"><a id="__codelineno-2-355" name="__codelineno-2-355"></a><span class="w">    </span><span class="c">% logging appropriate messages and returning a status indicator.</span>
</span><span id="__span-2-356"><a id="__codelineno-2-356" name="__codelineno-2-356"></a>
</span><span id="__span-2-357"><a id="__codelineno-2-357" name="__codelineno-2-357"></a><span class="w">    </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;Attempting to load SPM model for subject %s, task %s...\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">subName</span><span class="p">,</span><span class="w"> </span><span class="n">taskName</span><span class="p">);</span>
</span><span id="__span-2-358"><a id="__codelineno-2-358" name="__codelineno-2-358"></a><span class="w">    </span><span class="n">model</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[];</span><span class="w"> </span><span class="c">% Initialize model as empty</span>
</span><span id="__span-2-359"><a id="__codelineno-2-359" name="__codelineno-2-359"></a><span class="w">    </span><span class="n">loadSuccess</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="c">% Initialize success status as false</span>
</span><span id="__span-2-360"><a id="__codelineno-2-360" name="__codelineno-2-360"></a>
</span><span id="__span-2-361"><a id="__codelineno-2-361" name="__codelineno-2-361"></a><span class="w">    </span><span class="k">try</span>
</span><span id="__span-2-362"><a id="__codelineno-2-362" name="__codelineno-2-362"></a><span class="w">        </span><span class="c">% Construct the path to the SPM.mat file</span>
</span><span id="__span-2-363"><a id="__codelineno-2-363" name="__codelineno-2-363"></a><span class="w">        </span><span class="n">spmPath</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="n">GLMdir</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;SPM.mat&#39;</span><span class="p">);</span>
</span><span id="__span-2-364"><a id="__codelineno-2-364" name="__codelineno-2-364"></a>
</span><span id="__span-2-365"><a id="__codelineno-2-365" name="__codelineno-2-365"></a><span class="w">        </span><span class="c">% Attempt to load the SPM model</span>
</span><span id="__span-2-366"><a id="__codelineno-2-366" name="__codelineno-2-366"></a><span class="w">        </span><span class="n">model</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">mardo</span><span class="p">(</span><span class="n">spmPath</span><span class="p">);</span>
</span><span id="__span-2-367"><a id="__codelineno-2-367" name="__codelineno-2-367"></a>
</span><span id="__span-2-368"><a id="__codelineno-2-368" name="__codelineno-2-368"></a><span class="w">        </span><span class="c">% If successful, set the success status to true</span>
</span><span id="__span-2-369"><a id="__codelineno-2-369" name="__codelineno-2-369"></a><span class="w">        </span><span class="n">loadSuccess</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-2-370"><a id="__codelineno-2-370" name="__codelineno-2-370"></a><span class="w">        </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;SPM model loaded successfully.\n&#39;</span><span class="p">);</span>
</span><span id="__span-2-371"><a id="__codelineno-2-371" name="__codelineno-2-371"></a>
</span><span id="__span-2-372"><a id="__codelineno-2-372" name="__codelineno-2-372"></a><span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="n">ME</span>
</span><span id="__span-2-373"><a id="__codelineno-2-373" name="__codelineno-2-373"></a><span class="w">        </span><span class="c">% Handle errors that occur during model loading</span>
</span><span id="__span-2-374"><a id="__codelineno-2-374" name="__codelineno-2-374"></a><span class="w">        </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;WARNING: Error loading SPM model for %s, task %s: %s\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">subName</span><span class="p">,</span><span class="w"> </span><span class="n">taskName</span><span class="p">,</span><span class="w"> </span><span class="n">ME</span><span class="p">.</span><span class="n">message</span><span class="p">);</span>
</span><span id="__span-2-375"><a id="__codelineno-2-375" name="__codelineno-2-375"></a><span class="w">        </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;Skipping to the next iteration.\n&#39;</span><span class="p">);</span>
</span><span id="__span-2-376"><a id="__codelineno-2-376" name="__codelineno-2-376"></a><span class="w">        </span><span class="c">% No need to set model or loadSuccess as they are already initialized to their failure states</span>
</span><span id="__span-2-377"><a id="__codelineno-2-377" name="__codelineno-2-377"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-2-378"><a id="__codelineno-2-378" name="__codelineno-2-378"></a>
</span><span id="__span-2-379"><a id="__codelineno-2-379" name="__codelineno-2-379"></a><span class="w">    </span><span class="c">% Return the model (empty if failed) and the success status</span>
</span><span id="__span-2-380"><a id="__codelineno-2-380" name="__codelineno-2-380"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-2-381"><a id="__codelineno-2-381" name="__codelineno-2-381"></a><span class="k">end</span>
</span><span id="__span-2-382"><a id="__codelineno-2-382" name="__codelineno-2-382"></a>
</span><span id="__span-2-383"><a id="__codelineno-2-383" name="__codelineno-2-383"></a><span class="k">function</span><span class="w"> </span><span class="nf">[roiImg, roiStruct] = loadROIImageData</span><span class="p">(</span>roiImgPath<span class="p">)</span>
</span><span id="__span-2-384"><a id="__codelineno-2-384" name="__codelineno-2-384"></a><span class="w">    </span><span class="c">% Loads the ROI image and its voxel data from a specified path.</span>
</span><span id="__span-2-385"><a id="__codelineno-2-385" name="__codelineno-2-385"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-386"><a id="__codelineno-2-386" name="__codelineno-2-386"></a><span class="w">    </span><span class="c">% Parameters:</span>
</span><span id="__span-2-387"><a id="__codelineno-2-387" name="__codelineno-2-387"></a><span class="w">    </span><span class="c">%   roiImgPath: The file path to the ROI image.</span>
</span><span id="__span-2-388"><a id="__codelineno-2-388" name="__codelineno-2-388"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-389"><a id="__codelineno-2-389" name="__codelineno-2-389"></a><span class="w">    </span><span class="c">% Returns:</span>
</span><span id="__span-2-390"><a id="__codelineno-2-390" name="__codelineno-2-390"></a><span class="w">    </span><span class="c">%   roiImg: The voxel data of the ROI image.</span>
</span><span id="__span-2-391"><a id="__codelineno-2-391" name="__codelineno-2-391"></a><span class="w">    </span><span class="c">%   roiStruct: The structure returned by spm_vol, containing image volume information.</span>
</span><span id="__span-2-392"><a id="__codelineno-2-392" name="__codelineno-2-392"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-393"><a id="__codelineno-2-393" name="__codelineno-2-393"></a><span class="w">    </span><span class="c">% Example usage:</span>
</span><span id="__span-2-394"><a id="__codelineno-2-394" name="__codelineno-2-394"></a><span class="w">    </span><span class="c">%   [roiImg, roiStruct] = loadROIImageData(&#39;/path/to/roi/image.nii&#39;);</span>
</span><span id="__span-2-395"><a id="__codelineno-2-395" name="__codelineno-2-395"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-396"><a id="__codelineno-2-396" name="__codelineno-2-396"></a><span class="w">    </span><span class="c">% This function logs the process of loading ROI data, loads the ROI image,</span>
</span><span id="__span-2-397"><a id="__codelineno-2-397" name="__codelineno-2-397"></a><span class="w">    </span><span class="c">% and reads its voxel data, ensuring to handle any errors gracefully.</span>
</span><span id="__span-2-398"><a id="__codelineno-2-398" name="__codelineno-2-398"></a>
</span><span id="__span-2-399"><a id="__codelineno-2-399" name="__codelineno-2-399"></a><span class="w">    </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;Loading ROI data from: %s\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">roiImgPath</span><span class="p">);</span>
</span><span id="__span-2-400"><a id="__codelineno-2-400" name="__codelineno-2-400"></a>
</span><span id="__span-2-401"><a id="__codelineno-2-401" name="__codelineno-2-401"></a><span class="w">    </span><span class="k">try</span>
</span><span id="__span-2-402"><a id="__codelineno-2-402" name="__codelineno-2-402"></a><span class="w">        </span><span class="c">% Load the ROI image structure</span>
</span><span id="__span-2-403"><a id="__codelineno-2-403" name="__codelineno-2-403"></a><span class="w">        </span><span class="n">roiStruct</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">spm_vol</span><span class="p">(</span><span class="n">roiImgPath</span><span class="p">);</span>
</span><span id="__span-2-404"><a id="__codelineno-2-404" name="__codelineno-2-404"></a>
</span><span id="__span-2-405"><a id="__codelineno-2-405" name="__codelineno-2-405"></a><span class="w">        </span><span class="c">% Read the voxel data from the ROI image</span>
</span><span id="__span-2-406"><a id="__codelineno-2-406" name="__codelineno-2-406"></a><span class="w">        </span><span class="n">roiImg</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">spm_read_vols</span><span class="p">(</span><span class="n">roiStruct</span><span class="p">);</span>
</span><span id="__span-2-407"><a id="__codelineno-2-407" name="__codelineno-2-407"></a>
</span><span id="__span-2-408"><a id="__codelineno-2-408" name="__codelineno-2-408"></a><span class="w">        </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;ROI data successfully loaded.\n&#39;</span><span class="p">);</span>
</span><span id="__span-2-409"><a id="__codelineno-2-409" name="__codelineno-2-409"></a><span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="n">ME</span>
</span><span id="__span-2-410"><a id="__codelineno-2-410" name="__codelineno-2-410"></a><span class="w">        </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;Failed to load ROI data: %s&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">ME</span><span class="p">.</span><span class="n">message</span><span class="p">);</span>
</span><span id="__span-2-411"><a id="__codelineno-2-411" name="__codelineno-2-411"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-2-412"><a id="__codelineno-2-412" name="__codelineno-2-412"></a><span class="k">end</span>
</span><span id="__span-2-413"><a id="__codelineno-2-413" name="__codelineno-2-413"></a>
</span><span id="__span-2-414"><a id="__codelineno-2-414" name="__codelineno-2-414"></a><span class="k">function</span><span class="w"> </span>outDir<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">createOutputDir</span><span class="p">(</span>outRoot, outFolder, subName<span class="p">)</span>
</span><span id="__span-2-415"><a id="__codelineno-2-415" name="__codelineno-2-415"></a><span class="w">    </span><span class="c">% Creates an output directory for a given subject and ROI if it doesn&#39;t already exist.</span>
</span><span id="__span-2-416"><a id="__codelineno-2-416" name="__codelineno-2-416"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-417"><a id="__codelineno-2-417" name="__codelineno-2-417"></a><span class="w">    </span><span class="c">% Parameters:</span>
</span><span id="__span-2-418"><a id="__codelineno-2-418" name="__codelineno-2-418"></a><span class="w">    </span><span class="c">%   outRoot: The root directory under which all outputs are saved.</span>
</span><span id="__span-2-419"><a id="__codelineno-2-419" name="__codelineno-2-419"></a><span class="w">    </span><span class="c">%   outFolder: The folder name specific to the ROI or processing step.</span>
</span><span id="__span-2-420"><a id="__codelineno-2-420" name="__codelineno-2-420"></a><span class="w">    </span><span class="c">%   subName: The name of the subject being processed.</span>
</span><span id="__span-2-421"><a id="__codelineno-2-421" name="__codelineno-2-421"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-422"><a id="__codelineno-2-422" name="__codelineno-2-422"></a><span class="w">    </span><span class="c">% Example usage:</span>
</span><span id="__span-2-423"><a id="__codelineno-2-423" name="__codelineno-2-423"></a><span class="w">    </span><span class="c">%   createOutputDir(&#39;/path/to/output/root&#39;, &#39;roi_specific_folder&#39;, &#39;subject_name&#39;);</span>
</span><span id="__span-2-424"><a id="__codelineno-2-424" name="__codelineno-2-424"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-425"><a id="__codelineno-2-425" name="__codelineno-2-425"></a><span class="w">    </span><span class="c">% This function constructs the output directory path, checks if it exists,</span>
</span><span id="__span-2-426"><a id="__codelineno-2-426" name="__codelineno-2-426"></a><span class="w">    </span><span class="c">% and creates it if not, with logging at each step for clarity.</span>
</span><span id="__span-2-427"><a id="__codelineno-2-427" name="__codelineno-2-427"></a>
</span><span id="__span-2-428"><a id="__codelineno-2-428" name="__codelineno-2-428"></a><span class="w">    </span><span class="c">% Construct the full path to the output directory</span>
</span><span id="__span-2-429"><a id="__codelineno-2-429" name="__codelineno-2-429"></a><span class="w">    </span><span class="n">outDir</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="n">outRoot</span><span class="p">,</span><span class="w"> </span><span class="n">outFolder</span><span class="p">,</span><span class="w"> </span><span class="n">subName</span><span class="p">);</span>
</span><span id="__span-2-430"><a id="__codelineno-2-430" name="__codelineno-2-430"></a>
</span><span id="__span-2-431"><a id="__codelineno-2-431" name="__codelineno-2-431"></a><span class="w">    </span><span class="c">% Check if the output directory already exists</span>
</span><span id="__span-2-432"><a id="__codelineno-2-432" name="__codelineno-2-432"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="nb">exist</span><span class="p">(</span><span class="n">outDir</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;dir&#39;</span><span class="p">)</span>
</span><span id="__span-2-433"><a id="__codelineno-2-433" name="__codelineno-2-433"></a><span class="w">        </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;Creating output folder: %s\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">outDir</span><span class="p">);</span>
</span><span id="__span-2-434"><a id="__codelineno-2-434" name="__codelineno-2-434"></a><span class="w">        </span><span class="c">% Attempt to create the directory</span>
</span><span id="__span-2-435"><a id="__codelineno-2-435" name="__codelineno-2-435"></a><span class="w">        </span><span class="p">[</span><span class="n">mkdirSuccess</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">msgID</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">mkdir</span><span class="p">(</span><span class="n">outDir</span><span class="p">);</span>
</span><span id="__span-2-436"><a id="__codelineno-2-436" name="__codelineno-2-436"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">mkdirSuccess</span>
</span><span id="__span-2-437"><a id="__codelineno-2-437" name="__codelineno-2-437"></a><span class="w">            </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;Output folder created successfully: %s\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">outDir</span><span class="p">);</span>
</span><span id="__span-2-438"><a id="__codelineno-2-438" name="__codelineno-2-438"></a><span class="w">        </span><span class="k">else</span>
</span><span id="__span-2-439"><a id="__codelineno-2-439" name="__codelineno-2-439"></a><span class="w">            </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;Failed to create output folder: %s\nMessage ID: %s\n%s&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">outDir</span><span class="p">,</span><span class="w"> </span><span class="n">msgID</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">);</span>
</span><span id="__span-2-440"><a id="__codelineno-2-440" name="__codelineno-2-440"></a><span class="w">        </span><span class="k">end</span>
</span><span id="__span-2-441"><a id="__codelineno-2-441" name="__codelineno-2-441"></a><span class="w">    </span><span class="k">else</span>
</span><span id="__span-2-442"><a id="__codelineno-2-442" name="__codelineno-2-442"></a><span class="w">        </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;Output folder already exists: %s. No action needed.\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">outDir</span><span class="p">);</span>
</span><span id="__span-2-443"><a id="__codelineno-2-443" name="__codelineno-2-443"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-2-444"><a id="__codelineno-2-444" name="__codelineno-2-444"></a><span class="k">end</span>
</span><span id="__span-2-445"><a id="__codelineno-2-445" name="__codelineno-2-445"></a>
</span><span id="__span-2-446"><a id="__codelineno-2-446" name="__codelineno-2-446"></a><span class="k">function</span><span class="w"> </span><span class="nf">[thresholdedImage, finalPThresh] = calculateAndApplyThreshold</span><span class="p">(</span>tConImg, model, initialPThresh, adjustmentPThreshs, minVoxels<span class="p">)</span>
</span><span id="__span-2-447"><a id="__codelineno-2-447" name="__codelineno-2-447"></a><span class="w">    </span><span class="c">% Calculates and applies a threshold to T images based on uncorrected p-values,</span>
</span><span id="__span-2-448"><a id="__codelineno-2-448" name="__codelineno-2-448"></a><span class="w">    </span><span class="c">% adjusting the threshold if necessary to meet a minimum voxel count.</span>
</span><span id="__span-2-449"><a id="__codelineno-2-449" name="__codelineno-2-449"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-450"><a id="__codelineno-2-450" name="__codelineno-2-450"></a><span class="w">    </span><span class="c">% Parameters:</span>
</span><span id="__span-2-451"><a id="__codelineno-2-451" name="__codelineno-2-451"></a><span class="w">    </span><span class="c">%   tConImg: The voxel data of the T contrast image.</span>
</span><span id="__span-2-452"><a id="__codelineno-2-452" name="__codelineno-2-452"></a><span class="w">    </span><span class="c">%   model: The loaded SPM model object for obtaining error degrees of freedom.</span>
</span><span id="__span-2-453"><a id="__codelineno-2-453" name="__codelineno-2-453"></a><span class="w">    </span><span class="c">%   initialPThresh (optional): The initial p-value threshold. Default is 0.001.</span>
</span><span id="__span-2-454"><a id="__codelineno-2-454" name="__codelineno-2-454"></a><span class="w">    </span><span class="c">%   adjustmentPThreshs (optional): Array of p-value thresholds to try if initial thresholding is insufficient. Default is [0.01, 0.05].</span>
</span><span id="__span-2-455"><a id="__codelineno-2-455" name="__codelineno-2-455"></a><span class="w">    </span><span class="c">%   minVoxels (optional): Minimum number of voxels required after thresholding. Default is 25.</span>
</span><span id="__span-2-456"><a id="__codelineno-2-456" name="__codelineno-2-456"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-2-457"><a id="__codelineno-2-457" name="__codelineno-2-457"></a><span class="w">    </span><span class="c">% Returns:</span>
</span><span id="__span-2-458"><a id="__codelineno-2-458" name="__codelineno-2-458"></a><span class="w">    </span><span class="c">%   thresholdedImage: The T image after applying the final threshold.</span>
</span><span id="__span-2-459"><a id="__codelineno-2-459" name="__codelineno-2-459"></a><span class="w">    </span><span class="c">%   finalPThresh: The final p-value threshold used.</span>
</span><span id="__span-2-460"><a id="__codelineno-2-460" name="__codelineno-2-460"></a>
</span><span id="__span-2-461"><a id="__codelineno-2-461" name="__codelineno-2-461"></a><span class="w">    </span><span class="c">% Set default values if not provided</span>
</span><span id="__span-2-462"><a id="__codelineno-2-462" name="__codelineno-2-462"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">nargin</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">isempty</span><span class="p">(</span><span class="n">initialPThresh</span><span class="p">)</span>
</span><span id="__span-2-463"><a id="__codelineno-2-463" name="__codelineno-2-463"></a><span class="w">        </span><span class="n">initialPThresh</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.001</span><span class="p">;</span>
</span><span id="__span-2-464"><a id="__codelineno-2-464" name="__codelineno-2-464"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-2-465"><a id="__codelineno-2-465" name="__codelineno-2-465"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">nargin</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">isempty</span><span class="p">(</span><span class="n">adjustmentPThreshs</span><span class="p">)</span>
</span><span id="__span-2-466"><a id="__codelineno-2-466" name="__codelineno-2-466"></a><span class="w">        </span><span class="n">adjustmentPThreshs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mf">0.01</span><span class="p">,</span><span class="w"> </span><span class="mf">0.05</span><span class="p">];</span>
</span><span id="__span-2-467"><a id="__codelineno-2-467" name="__codelineno-2-467"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-2-468"><a id="__codelineno-2-468" name="__codelineno-2-468"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">nargin</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">isempty</span><span class="p">(</span><span class="n">minVoxels</span><span class="p">)</span>
</span><span id="__span-2-469"><a id="__codelineno-2-469" name="__codelineno-2-469"></a><span class="w">        </span><span class="n">minVoxels</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">25</span><span class="p">;</span>
</span><span id="__span-2-470"><a id="__codelineno-2-470" name="__codelineno-2-470"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-2-471"><a id="__codelineno-2-471" name="__codelineno-2-471"></a>
</span><span id="__span-2-472"><a id="__codelineno-2-472" name="__codelineno-2-472"></a><span class="w">    </span><span class="n">erdf</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">error_df</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
</span><span id="__span-2-473"><a id="__codelineno-2-473" name="__codelineno-2-473"></a><span class="w">    </span><span class="n">finalPThresh</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">initialPThresh</span><span class="p">;</span>
</span><span id="__span-2-474"><a id="__codelineno-2-474" name="__codelineno-2-474"></a><span class="w">    </span><span class="nb">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c">% Start with the first adjustment threshold if needed</span>
</span><span id="__span-2-475"><a id="__codelineno-2-475" name="__codelineno-2-475"></a>
</span><span id="__span-2-476"><a id="__codelineno-2-476" name="__codelineno-2-476"></a><span class="w">    </span><span class="c">% Initially apply threshold</span>
</span><span id="__span-2-477"><a id="__codelineno-2-477" name="__codelineno-2-477"></a><span class="w">    </span><span class="p">[</span><span class="n">thresholdedImage</span><span class="p">,</span><span class="w"> </span><span class="n">numCells</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">applyThreshold</span><span class="p">(</span><span class="n">tConImg</span><span class="p">,</span><span class="w"> </span><span class="n">finalPThresh</span><span class="p">,</span><span class="w"> </span><span class="n">erdf</span><span class="p">);</span>
</span><span id="__span-2-478"><a id="__codelineno-2-478" name="__codelineno-2-478"></a>
</span><span id="__span-2-479"><a id="__codelineno-2-479" name="__codelineno-2-479"></a><span class="w">    </span><span class="c">% Adjust threshold if necessary</span>
</span><span id="__span-2-480"><a id="__codelineno-2-480" name="__codelineno-2-480"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="n">numCells</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">minVoxels</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nb">length</span><span class="p">(</span><span class="n">adjustmentPThreshs</span><span class="p">)</span>
</span><span id="__span-2-481"><a id="__codelineno-2-481" name="__codelineno-2-481"></a><span class="w">        </span><span class="n">finalPThresh</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">adjustmentPThreshs</span><span class="p">(</span><span class="nb">i</span><span class="p">);</span>
</span><span id="__span-2-482"><a id="__codelineno-2-482" name="__codelineno-2-482"></a><span class="w">        </span><span class="p">[</span><span class="n">thresholdedImage</span><span class="p">,</span><span class="w"> </span><span class="n">numCells</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">applyThreshold</span><span class="p">(</span><span class="n">tConImg</span><span class="p">,</span><span class="w"> </span><span class="n">finalPThresh</span><span class="p">,</span><span class="w"> </span><span class="n">erdf</span><span class="p">);</span>
</span><span id="__span-2-483"><a id="__codelineno-2-483" name="__codelineno-2-483"></a><span class="w">        </span><span class="nb">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c">% Move to the next threshold for adjustment</span>
</span><span id="__span-2-484"><a id="__codelineno-2-484" name="__codelineno-2-484"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-2-485"><a id="__codelineno-2-485" name="__codelineno-2-485"></a>
</span><span id="__span-2-486"><a id="__codelineno-2-486" name="__codelineno-2-486"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">numCells</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">minVoxels</span>
</span><span id="__span-2-487"><a id="__codelineno-2-487" name="__codelineno-2-487"></a><span class="w">        </span><span class="nb">warning</span><span class="p">(</span><span class="s">&#39;Final voxel count below %d even after adjusting thresholds. Final count: %d&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">minVoxels</span><span class="p">,</span><span class="w"> </span><span class="n">numCells</span><span class="p">);</span>
</span><span id="__span-2-488"><a id="__codelineno-2-488" name="__codelineno-2-488"></a><span class="w">    </span><span class="k">else</span>
</span><span id="__span-2-489"><a id="__codelineno-2-489" name="__codelineno-2-489"></a><span class="w">        </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;Thresholding complete. Final p-value threshold: %f, Voxel count: %d\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">finalPThresh</span><span class="p">,</span><span class="w"> </span><span class="n">numCells</span><span class="p">);</span>
</span><span id="__span-2-490"><a id="__codelineno-2-490" name="__codelineno-2-490"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-2-491"><a id="__codelineno-2-491" name="__codelineno-2-491"></a><span class="k">end</span>
</span><span id="__span-2-492"><a id="__codelineno-2-492" name="__codelineno-2-492"></a>
</span><span id="__span-2-493"><a id="__codelineno-2-493" name="__codelineno-2-493"></a><span class="k">function</span><span class="w"> </span><span class="nf">[thresholdedImage, numCells] = applyThreshold</span><span class="p">(</span>tConImg, pThresh, erdf<span class="p">)</span>
</span><span id="__span-2-494"><a id="__codelineno-2-494" name="__codelineno-2-494"></a><span class="w">    </span><span class="c">% Helper function to apply threshold and count voxels</span>
</span><span id="__span-2-495"><a id="__codelineno-2-495" name="__codelineno-2-495"></a><span class="w">    </span><span class="n">tThresh</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">spm_invTcdf</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">pThresh</span><span class="p">,</span><span class="w"> </span><span class="n">erdf</span><span class="p">);</span><span class="w"> </span><span class="c">% Calculate T threshold</span>
</span><span id="__span-2-496"><a id="__codelineno-2-496" name="__codelineno-2-496"></a><span class="w">    </span><span class="n">thresholdedImage</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tConImg</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">tThresh</span><span class="p">;</span><span class="w"> </span><span class="c">% Apply threshold</span>
</span><span id="__span-2-497"><a id="__codelineno-2-497" name="__codelineno-2-497"></a><span class="w">    </span><span class="n">numCells</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">sum</span><span class="p">(</span><span class="n">thresholdedImage</span><span class="p">(:));</span><span class="w"> </span><span class="c">% Count voxels above threshold</span>
</span><span id="__span-2-498"><a id="__codelineno-2-498" name="__codelineno-2-498"></a><span class="k">end</span>
</span><span id="__span-2-499"><a id="__codelineno-2-499" name="__codelineno-2-499"></a>
</span><span id="__span-2-500"><a id="__codelineno-2-500" name="__codelineno-2-500"></a><span class="k">function</span><span class="w"> </span>[filteredFolderStructure]<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">findSubjectsFolders</span><span class="p">(</span>fmriprepRoot, selectedSubjectsList, excludedSubjectsList<span class="p">)</span>
</span><span id="__span-2-501"><a id="__codelineno-2-501" name="__codelineno-2-501"></a><span class="c">% FINDSUBJECTSFOLDERS Locate subject folders based on a list or wildcard.</span>
</span><span id="__span-2-502"><a id="__codelineno-2-502" name="__codelineno-2-502"></a><span class="c">%</span>
</span><span id="__span-2-503"><a id="__codelineno-2-503" name="__codelineno-2-503"></a><span class="c">% USAGE:</span>
</span><span id="__span-2-504"><a id="__codelineno-2-504" name="__codelineno-2-504"></a><span class="c">% sub_paths = findSubjectsFolders(fmriprepRoot, selectedSubjectsList)</span>
</span><span id="__span-2-505"><a id="__codelineno-2-505" name="__codelineno-2-505"></a><span class="c">%</span>
</span><span id="__span-2-506"><a id="__codelineno-2-506" name="__codelineno-2-506"></a><span class="c">% INPUTS:</span>
</span><span id="__span-2-507"><a id="__codelineno-2-507" name="__codelineno-2-507"></a><span class="c">% fmriprepRoot          - The root directory where &#39;sub-*&#39; folders are located.</span>
</span><span id="__span-2-508"><a id="__codelineno-2-508" name="__codelineno-2-508"></a><span class="c">%</span>
</span><span id="__span-2-509"><a id="__codelineno-2-509" name="__codelineno-2-509"></a><span class="c">% selectedSubjectsList  - Can be one of two things:</span>
</span><span id="__span-2-510"><a id="__codelineno-2-510" name="__codelineno-2-510"></a><span class="c">%                         1) A list of integers, each representing a subject ID.</span>
</span><span id="__span-2-511"><a id="__codelineno-2-511" name="__codelineno-2-511"></a><span class="c">%                            For example, [7,9] would search for folders &#39;sub-07&#39; </span>
</span><span id="__span-2-512"><a id="__codelineno-2-512" name="__codelineno-2-512"></a><span class="c">%                            and &#39;sub-09&#39; respectively.</span>
</span><span id="__span-2-513"><a id="__codelineno-2-513" name="__codelineno-2-513"></a><span class="c">%                         2) A single character string &#39;*&#39;. In this case, the function</span>
</span><span id="__span-2-514"><a id="__codelineno-2-514" name="__codelineno-2-514"></a><span class="c">%                            will return all folders starting with &#39;sub-*&#39;.</span>
</span><span id="__span-2-515"><a id="__codelineno-2-515" name="__codelineno-2-515"></a><span class="c">%</span>
</span><span id="__span-2-516"><a id="__codelineno-2-516" name="__codelineno-2-516"></a><span class="c">% OUTPUTS:</span>
</span><span id="__span-2-517"><a id="__codelineno-2-517" name="__codelineno-2-517"></a><span class="c">% sub_paths             - A structure array corresponding to the found directories.</span>
</span><span id="__span-2-518"><a id="__codelineno-2-518" name="__codelineno-2-518"></a><span class="c">%                         Each structure has fields: &#39;name&#39;, &#39;folder&#39;, &#39;date&#39;, </span>
</span><span id="__span-2-519"><a id="__codelineno-2-519" name="__codelineno-2-519"></a><span class="c">%                         &#39;bytes&#39;, &#39;isdir&#39;, and &#39;datenum&#39;.</span>
</span><span id="__span-2-520"><a id="__codelineno-2-520" name="__codelineno-2-520"></a><span class="c">%</span>
</span><span id="__span-2-521"><a id="__codelineno-2-521" name="__codelineno-2-521"></a><span class="c">% EXAMPLES:</span>
</span><span id="__span-2-522"><a id="__codelineno-2-522" name="__codelineno-2-522"></a><span class="c">% 1) To fetch directories for specific subjects:</span>
</span><span id="__span-2-523"><a id="__codelineno-2-523" name="__codelineno-2-523"></a><span class="c">%    sub_paths = findSubjectsFolders(&#39;/path/to/fmriprepRoot&#39;, [7,9]);</span>
</span><span id="__span-2-524"><a id="__codelineno-2-524" name="__codelineno-2-524"></a><span class="c">%</span>
</span><span id="__span-2-525"><a id="__codelineno-2-525" name="__codelineno-2-525"></a><span class="c">% 2) To fetch all directories starting with &#39;sub-*&#39;:</span>
</span><span id="__span-2-526"><a id="__codelineno-2-526" name="__codelineno-2-526"></a><span class="c">%    sub_paths = findSubjectsFolders(&#39;/path/to/fmriprepRoot&#39;, &#39;*&#39;);</span>
</span><span id="__span-2-527"><a id="__codelineno-2-527" name="__codelineno-2-527"></a><span class="c">%</span>
</span><span id="__span-2-528"><a id="__codelineno-2-528" name="__codelineno-2-528"></a><span class="c">% note:</span>
</span><span id="__span-2-529"><a id="__codelineno-2-529" name="__codelineno-2-529"></a><span class="c">% If a subject ID from the list does not match any directory, a warning is issued.</span>
</span><span id="__span-2-530"><a id="__codelineno-2-530" name="__codelineno-2-530"></a>
</span><span id="__span-2-531"><a id="__codelineno-2-531" name="__codelineno-2-531"></a><span class="c">% Start by fetching all directories with the &#39;sub-*&#39; pattern.</span>
</span><span id="__span-2-532"><a id="__codelineno-2-532" name="__codelineno-2-532"></a><span class="n">sub_paths</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">dir</span><span class="p">(</span><span class="nb">fullfile</span><span class="p">(</span><span class="n">fmriprepRoot</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;sub-*&#39;</span><span class="p">));</span>
</span><span id="__span-2-533"><a id="__codelineno-2-533" name="__codelineno-2-533"></a><span class="n">sub_paths</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sub_paths</span><span class="p">([</span><span class="n">sub_paths</span><span class="p">.</span><span class="n">isdir</span><span class="p">]);</span><span class="w"> </span><span class="c">% Keep only directories.</span>
</span><span id="__span-2-534"><a id="__codelineno-2-534" name="__codelineno-2-534"></a>
</span><span id="__span-2-535"><a id="__codelineno-2-535" name="__codelineno-2-535"></a><span class="c">% Check the type of selectedSubjectsList</span>
</span><span id="__span-2-536"><a id="__codelineno-2-536" name="__codelineno-2-536"></a><span class="k">if</span><span class="w"> </span><span class="nb">isnumeric</span><span class="p">(</span><span class="n">selectedSubjectsList</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-2-537"><a id="__codelineno-2-537" name="__codelineno-2-537"></a><span class="w">    </span><span class="c">% Case 1: selectedSubjectsList is a list of integers.</span>
</span><span id="__span-2-538"><a id="__codelineno-2-538" name="__codelineno-2-538"></a>
</span><span id="__span-2-539"><a id="__codelineno-2-539" name="__codelineno-2-539"></a><span class="w">    </span><span class="c">% Convert each integer in the list to a string of the form &#39;sub-XX&#39;.</span>
</span><span id="__span-2-540"><a id="__codelineno-2-540" name="__codelineno-2-540"></a><span class="w">    </span><span class="n">subIDs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cellfun</span><span class="p">(@(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nb">sprintf</span><span class="p">(</span><span class="s">&#39;sub-%02d&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="nb">num2cell</span><span class="p">(</span><span class="n">selectedSubjectsList</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;UniformOutput&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
</span><span id="__span-2-541"><a id="__codelineno-2-541" name="__codelineno-2-541"></a>
</span><span id="__span-2-542"><a id="__codelineno-2-542" name="__codelineno-2-542"></a><span class="w">    </span><span class="c">% Filter the sub_paths to keep only those directories matching the subIDs.</span>
</span><span id="__span-2-543"><a id="__codelineno-2-543" name="__codelineno-2-543"></a><span class="w">    </span><span class="n">sub_paths</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sub_paths</span><span class="p">(</span><span class="nb">ismember</span><span class="p">({</span><span class="n">sub_paths</span><span class="p">.</span><span class="n">name</span><span class="p">},</span><span class="w"> </span><span class="n">subIDs</span><span class="p">));</span>
</span><span id="__span-2-544"><a id="__codelineno-2-544" name="__codelineno-2-544"></a>
</span><span id="__span-2-545"><a id="__codelineno-2-545" name="__codelineno-2-545"></a><span class="w">    </span><span class="c">% Check and throw warnings for any missing subID.</span>
</span><span id="__span-2-546"><a id="__codelineno-2-546" name="__codelineno-2-546"></a><span class="w">    </span><span class="n">foundSubIDs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="n">sub_paths</span><span class="p">.</span><span class="n">name</span><span class="p">};</span>
</span><span id="__span-2-547"><a id="__codelineno-2-547" name="__codelineno-2-547"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">subIDs</span><span class="p">)</span>
</span><span id="__span-2-548"><a id="__codelineno-2-548" name="__codelineno-2-548"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="nb">ismember</span><span class="p">(</span><span class="n">subIDs</span><span class="p">{</span><span class="nb">i</span><span class="p">},</span><span class="w"> </span><span class="n">foundSubIDs</span><span class="p">)</span>
</span><span id="__span-2-549"><a id="__codelineno-2-549" name="__codelineno-2-549"></a><span class="w">            </span><span class="nb">warning</span><span class="p">([</span><span class="s">&#39;The subID &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">subIDs</span><span class="p">{</span><span class="nb">i</span><span class="p">},</span><span class="w"> </span><span class="s">&#39; was not found in sub_paths.name.&#39;</span><span class="p">]);</span>
</span><span id="__span-2-550"><a id="__codelineno-2-550" name="__codelineno-2-550"></a><span class="w">        </span><span class="k">end</span>
</span><span id="__span-2-551"><a id="__codelineno-2-551" name="__codelineno-2-551"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-2-552"><a id="__codelineno-2-552" name="__codelineno-2-552"></a>
</span><span id="__span-2-553"><a id="__codelineno-2-553" name="__codelineno-2-553"></a><span class="k">elseif</span><span class="w"> </span><span class="nb">ischar</span><span class="p">(</span><span class="n">selectedSubjectsList</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">strcmp</span><span class="p">(</span><span class="n">selectedSubjectsList</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;*&#39;</span><span class="p">)</span>
</span><span id="__span-2-554"><a id="__codelineno-2-554" name="__codelineno-2-554"></a><span class="w">    </span><span class="c">% Case 2: selectedSubjectsList is &#39;*&#39;. </span>
</span><span id="__span-2-555"><a id="__codelineno-2-555" name="__codelineno-2-555"></a><span class="w">    </span><span class="c">% No further action required as we&#39;ve already selected all &#39;sub-*&#39; folders.</span>
</span><span id="__span-2-556"><a id="__codelineno-2-556" name="__codelineno-2-556"></a>
</span><span id="__span-2-557"><a id="__codelineno-2-557" name="__codelineno-2-557"></a><span class="k">else</span>
</span><span id="__span-2-558"><a id="__codelineno-2-558" name="__codelineno-2-558"></a><span class="w">    </span><span class="c">% Invalid input.</span>
</span><span id="__span-2-559"><a id="__codelineno-2-559" name="__codelineno-2-559"></a><span class="w">    </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;Invalid format for selectedSubjects. It should be either &quot;*&quot; or a list of integers.&#39;</span><span class="p">);</span>
</span><span id="__span-2-560"><a id="__codelineno-2-560" name="__codelineno-2-560"></a><span class="k">end</span>
</span><span id="__span-2-561"><a id="__codelineno-2-561" name="__codelineno-2-561"></a>
</span><span id="__span-2-562"><a id="__codelineno-2-562" name="__codelineno-2-562"></a><span class="c">% Only process exclusion if the excludedSubjectsList is provided.</span>
</span><span id="__span-2-563"><a id="__codelineno-2-563" name="__codelineno-2-563"></a><span class="k">if</span><span class="w"> </span><span class="nb">nargin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span>
</span><span id="__span-2-564"><a id="__codelineno-2-564" name="__codelineno-2-564"></a><span class="w">    </span><span class="c">% Create a list of excluded folder names</span>
</span><span id="__span-2-565"><a id="__codelineno-2-565" name="__codelineno-2-565"></a><span class="w">    </span><span class="n">excludedNames</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cellfun</span><span class="p">(@(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nb">sprintf</span><span class="p">(</span><span class="s">&#39;sub-%02d&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="nb">num2cell</span><span class="p">(</span><span class="n">excludedSubjectsList</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;UniformOutput&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
</span><span id="__span-2-566"><a id="__codelineno-2-566" name="__codelineno-2-566"></a>
</span><span id="__span-2-567"><a id="__codelineno-2-567" name="__codelineno-2-567"></a><span class="w">    </span><span class="c">% Logical array of folders to exclude</span>
</span><span id="__span-2-568"><a id="__codelineno-2-568" name="__codelineno-2-568"></a><span class="w">    </span><span class="n">excludeMask</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">arrayfun</span><span class="p">(@(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nb">ismember</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">excludedNames</span><span class="p">),</span><span class="w"> </span><span class="n">sub_paths</span><span class="p">);</span>
</span><span id="__span-2-569"><a id="__codelineno-2-569" name="__codelineno-2-569"></a>
</span><span id="__span-2-570"><a id="__codelineno-2-570" name="__codelineno-2-570"></a><span class="w">    </span><span class="c">% Filtered structure</span>
</span><span id="__span-2-571"><a id="__codelineno-2-571" name="__codelineno-2-571"></a><span class="w">    </span><span class="n">filteredFolderStructure</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sub_paths</span><span class="p">(</span><span class="o">~</span><span class="n">excludeMask</span><span class="p">);</span>
</span><span id="__span-2-572"><a id="__codelineno-2-572" name="__codelineno-2-572"></a><span class="k">else</span>
</span><span id="__span-2-573"><a id="__codelineno-2-573" name="__codelineno-2-573"></a><span class="w">    </span><span class="c">% If no excludedSubjectsList is provided, just return the sub_paths.</span>
</span><span id="__span-2-574"><a id="__codelineno-2-574" name="__codelineno-2-574"></a><span class="w">    </span><span class="n">filteredFolderStructure</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sub_paths</span><span class="p">;</span>
</span><span id="__span-2-575"><a id="__codelineno-2-575" name="__codelineno-2-575"></a><span class="k">end</span>
</span><span id="__span-2-576"><a id="__codelineno-2-576" name="__codelineno-2-576"></a><span class="k">end</span>
</span></code></pre></div></td></tr></table></div>
</details>
<p>This code generates a new folder containing <strong>subject-specific ROIs</strong>. While previous spherical or anatomical masks were likely generic—created in a standard space (e.g., MNI) and therefore applicable to any subject within that space — these new ROIs are specific for each subject, since they are created by intersecting the generic mask with the subject's unique pattern of activation from the GLM t-map.</p>
<hr />
<p>Now that you have your beta images (from the GLM) and your ROIs, you have everything you need to run your multi-variate analysis. <a href="fmri-mvpa.html">&rarr; MVPA</a></p>
<hr />
<ul>
<li><strong>TODO:</strong>  mention the roi stuff Filippo did, and perhaps ask him to write something about it?</li>
</ul>
<p><a href="https://neuroimaging-core-docs.readthedocs.io/en/latest/pages/atlases.html#id4">https://neuroimaging-core-docs.readthedocs.io/en/latest/pages/atlases.html#id4</a>
<a href="https://neurosynth.org/">https://neurosynth.org/</a>
<a href="https://openneuro.org/">https://openneuro.org/</a></p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">October 26, 2024 20:13:50</span>
  </span>

    
    
    
      
  
  <span class="md-source-file__fact">
    <span class="md-icon" title="Contributors">
      
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 4a4 4 0 0 1 4 4 4 4 0 0 1-4 4 4 4 0 0 1-4-4 4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4"/></svg>
      
    </span>
    <nav>
      
        <a href="mailto:59078281+costantinoai@users.noreply.github.com">costantinoai</a>
    </nav>
  </span>

    
    
  </aside>


  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        Was this page helpful?
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page was helpful" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page could be improved" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              Thanks for your feedback!
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              Thanks for your feedback! Help us improve this page by opening a new <a href="https://github.com/HOPLAB-LBP/hoplab-wiki/issues/new/?title=[Feedback]+5.%20Regions%20of%20interest+-+/research/fmri/analysis/fmri-rois.html" target="_blank" rel="noopener">Issue</a>, or contact a Wiki manager.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      <a href="#__consent">Change cookie settings</a>            
    

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  


  
    
  



  


<h4>Cookie consent</h4>
<p>Please, consider disabling your ad-blocker and allowing cookies for this Wiki .  We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="github" checked>
          <span class="task-list-indicator"></span>
          GitHub
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.tabs.link", "content.code.copy", "content.code.select", "content.action.edit", "navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.sections", "search.highlight", "navigation.indexes"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="../../../assets/external/unpkg.com/mermaid@11/dist/mermaid.min.js"></script>
      
    
  </body>
</html>