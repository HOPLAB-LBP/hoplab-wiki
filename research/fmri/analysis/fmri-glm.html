
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="fmri-prepocessing-qa.html">
      
      
        <link rel="next" href="fmri-rois.html">
      
      
      <link rel="icon" href="../../../assets/hoplab_favicon_white.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.42">
    
    
      
        <title>4. First-level analysis - Hoplab Wiki</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
        <script src="../../../assets/external/unpkg.com/iframe-worker/shim.js"></script>
      
    
    
      
        
        
        
        <link rel="stylesheet" href="../../../assets/external/fonts.googleapis.com/css.49ea35f2.css">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-71T36SYGT2"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-71T36SYGT2",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-71T36SYGT2",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#general-linear-model-in-spm" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../index.html" title="Hoplab Wiki" class="md-header__button md-logo" aria-label="Hoplab Wiki" data-md-component="logo">
      
  <img src="../../../assets/thicker_white_brain.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Hoplab Wiki
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              4. First-level analysis
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/HOPLAB-LBP/hoplab-wiki/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    HOPLAB-LBP/hoplab-wiki
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html" class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../get-started/index.html" class="md-tabs__link">
          
  
    
  
  Getting started

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../index.html" class="md-tabs__link">
          
  
    
  
  Research

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../outreach.html" class="md-tabs__link">
        
  
    
  
  Science outreach

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../contribute.html" class="md-tabs__link">
        
  
    
  
  Contribute

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../index.html" title="Hoplab Wiki" class="md-nav__button md-logo" aria-label="Hoplab Wiki" data-md-component="logo">
      
  <img src="../../../assets/thicker_white_brain.svg" alt="logo">

    </a>
    Hoplab Wiki
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/HOPLAB-LBP/hoplab-wiki/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    HOPLAB-LBP/hoplab-wiki
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../get-started/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../get-started/useful-links.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Useful links
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../get-started/mailing-lists.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mailing lists
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../get-started/practical-setup.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practical set-up
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../get-started/computer-setup.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Computer set-up
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../get-started/admin-procedures.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Administrative procedures
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../get-started/student-starter-pack.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Student starter pack
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Research
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Research
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../ethics/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Ethical approval
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_2" id="__nav_3_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Ethical approval
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ethics/MEC.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EC onderzoek
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ethics/SMEC.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SMEC
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../coding/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Coding practices
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Coding practices
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../behaviour/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Behaviour
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_4" id="__nav_3_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Behaviour
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../behaviour/participants.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Find participants
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../behaviour/experimental-setup.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Set up your experiment
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    fMRI
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_5" id="__nav_3_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            fMRI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fmri-get-started.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    First steps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fmri-procedure.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scanning procedure and info
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5_4" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Analysis workflow
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_5_4" id="__nav_3_5_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_5_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_5_4">
            <span class="md-nav__icon md-icon"></span>
            Analysis workflow
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-general.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    0. General information
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-setup-env.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Set-up you environment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-bids-conversion.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. BIDS conversion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-prepocessing-qa.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Pre-processing and QA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    4. First-level analysis
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="fmri-glm.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    4. First-level analysis
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-data-preparation" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Data Preparation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-design-matrix-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Design Matrix Setup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-model-estimation-results" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Model Estimation &amp; Results
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-rois.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. Regions of interest
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-mvpa.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. Multi-variate analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-andrea-workflow.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fMRI workflow example
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../eeg/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    EEG
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            EEG
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../eyetracking/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Eye-tracking
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            Eye-tracking
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../dnn/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Neural Networks
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            Neural Networks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../outreach.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Science outreach
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contribute.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contribute
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-data-preparation" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Data Preparation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-design-matrix-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Design Matrix Setup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-model-estimation-results" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Model Estimation &amp; Results
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/HOPLAB-LBP/hoplab-wiki/edit/main/docs/research/fmri/analysis/fmri-glm.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="general-linear-model-in-spm">General Linear Model in SPM<a class="headerlink" href="#general-linear-model-in-spm" title="Permanent link">&para;</a></h1>
<p>You should land on this page after having collected your fMRI data, <a href="fmri-bids-conversion.html">converted it to BIDS</a> and <a href="fmri-prepocessing-qa.html">preprocessed it</a>. Your goal now is to model the BOLD activity with a Generalised Linear Model (GLM), in order to obtain the beta values on which to apply further analyses.</p>
<p>In this section, we will use the <a href="https://www.fil.ion.ucl.ac.uk/spm/">Statistical Parametric Mapping</a> (SPM) package to construct the GLM. Here’s an overview of the steps:</p>
<ol>
<li><strong>Data Preparation</strong>: Get your files ready for SPM.</li>
<li><strong>Design Matrix Setup</strong>: Define the model for your analysis.</li>
<li><strong>Model Estimation &amp; Results</strong>: Estimate your model and analyze contrasts.</li>
</ol>
<hr />
<h2 id="step-1-data-preparation">Step 1: Data Preparation<a class="headerlink" href="#step-1-data-preparation" title="Permanent link">&para;</a></h2>
<p>Before running the GLM, we need to make sure the data is compatible with SPM. There are two steps that need to be taken to bring your <code>.nii</code> files from fMRIPrep output to SPM input:</p>
<ol>
<li><strong>gunzipping</strong> (de-compressing <code>.nii.gz</code> files, which SPM can't handle natively)</li>
<li><strong>smoothing</strong> (mostly for localizer runs).</li>
</ol>
<p>The sugested way of proceeding is to create a <code>derivatives/pre-SPM</code> folder where to store a <code>gunzipped</code> output folder and a <code>smoothed</code> output folder.</p>
<h3 id="decompressing-nifti-files">Decompressing NIfTI Files<a class="headerlink" href="#decompressing-nifti-files" title="Permanent link">&para;</a></h3>
<p>SPM cannot process <code>.nii.gz</code> files directly, so we first need to decompress them:</p>
<ol>
<li>Create a directory for pre-processed files:</li>
</ol>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>mkdir<span class="w"> </span>derivatives/pre-SPM
</span></code></pre></div>
<ol>
<li>Decompress the files using <code>gunzip</code> in the terminal:</li>
</ol>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>gunzip<span class="w"> </span>path/to/your/files/*.nii.gz
</span></code></pre></div>
<ul>
<li>Store the decompressed files in a subdirectory called <code>gunzipped</code> inside <code>derivatives/pre-SPM</code>.</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Decompress with a right-click!</p>
<p>Most Operating Systems will let you decompress the <code>nii.gz</code> files directly from the File Explorer. Right click on the files you want to decompress, and extract them like you would do with a compressed folder.</p>
</div>
<h3 id="smoothing-functional-data">Smoothing Functional Data<a class="headerlink" href="#smoothing-functional-data" title="Permanent link">&para;</a></h3>
<p>Smoothing is required to increase signal-to-noise ratio, especially for localizer runs. Follow these steps:</p>
<ol>
<li>Launch the SPM GUI with the command:</li>
</ol>
<div class="language-matlab highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">spm</span><span class="w"> </span><span class="s">fmri</span>
</span></code></pre></div>
<ol>
<li>In the GUI, click on <code>Smooth</code>.</li>
<li>Select the decompressed <code>.nii</code> files.</li>
<li>Set the <strong>FWHM</strong> (Full Width at Half Maximum) to <code>[4 4 4]</code> or <code>[6 6 6]</code> for moderate smoothing.</li>
<li>Save the smoothed output in <code>derivatives/pre-SPM/smoothed</code>.</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Automated Preprocessing</p>
<p>You can integrate the decompression and smoothing steps into a script to streamline your workflow, avoiding manual steps (see the <a href="fmri-andrea-workflow.html">Analysis Workflow</a> for an example).</p>
</div>
<hr />
<h2 id="step-2-design-matrix-setup">Step 2: Design Matrix Setup<a class="headerlink" href="#step-2-design-matrix-setup" title="Permanent link">&para;</a></h2>
<p>To run a GLM, you need to create a design matrix that links the timing of experimental conditions to the observed BOLD response. The design matrix is specified in SPM’s <code>Specify 1st level</code> interface. While this can be done manually for simpler designs, for complex designs with many conditions, it’s more efficient to use externally generated <strong>onset time</strong> and <strong>confounds</strong> files.</p>
<h3 id="creating-onset-files">Creating Onset Files<a class="headerlink" href="#creating-onset-files" title="Permanent link">&para;</a></h3>
<p>For complex designs, you should create one onset file per run per subject, containing information about event <em>types</em>, <em>onsets</em>, and <em>durations</em>. The <code>eventsBIDS2SPM</code> function can help convert BIDS-formatted event files into the onset files that SPM requires.</p>
<ol>
<li>Use the <code>eventsBIDS2SPM</code> function to convert event files.</li>
<li>
<p>Store the onset files in the following structure:</p>
<ul>
<li><code>BIDS/sub-xx/func/sub-xx_run-x_eventsspm.mat</code>.</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>BIDS/
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>├──<span class="w"> </span>sub-01/
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>│<span class="w">   </span>└──<span class="w"> </span>func/
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>│<span class="w">       </span>├──<span class="w"> </span>sub-01_run-1_eventsspm.mat
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>│<span class="w">       </span>└──<span class="w"> </span>sub-01_run-2_eventsspm.mat
</span></code></pre></div>
</li>
</ol>
<details class="example">
<summary>eventsBIDS2SPM</summary>
<div class="language-matlab highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">function</span><span class="w"> </span>new_df<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">eventsBIDS2SPM</span><span class="p">(</span>tsv_file<span class="p">)</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">    </span><span class="c">% eventsBIDS2SPM - Convert BIDS event files to SPM format</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="c">% This function reads a BIDS event file and converts it to the format required by SPM.</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="c">% It extracts the unique trial types and their onsets and durations and stores them in a</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">    </span><span class="c">% Matlab structure.</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">    </span><span class="c">% Author: Andrea Costantino</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">    </span><span class="c">% Date: 23/1/2023</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">    </span><span class="c">% Usage:</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">    </span><span class="c">%   mat_dict = eventsBIDS2SPM(tsv_file, run_id)</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="w">    </span><span class="c">% Inputs:</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">    </span><span class="c">%   tsv_file - string, path to the tsv file containing the events</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">    </span><span class="c">% Outputs:</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="w">    </span><span class="c">%   mat_dict - struct, a Matlab structure containing the events in the format</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="w">    </span><span class="c">%              required by SPM. The structure contains three fields:</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="w">    </span><span class="c">%                - &#39;names&#39;: cell array of string, the names of the trial types</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="w">    </span><span class="c">%                - &#39;onsets&#39;: cell array of double, onset times of the trials</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="w">    </span><span class="c">%                - &#39;durations&#39;: cell array of double, duration of the trials</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="w">    </span><span class="c">% This function reads a BIDS event file and converts it to the format required by SPM.</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="w">    </span><span class="c">% It extracts the unique trial types and their onsets and durations and stores them in a</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="w">    </span><span class="c">% Matlab structure</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="w">    </span><span class="c">% read the tsv file</span>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="w">    </span><span class="n">df</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">readtable</span><span class="p">(</span><span class="n">tsv_file</span><span class="p">,</span><span class="s">&#39;FileType&#39;</span><span class="p">,</span><span class="s">&#39;text&#39;</span><span class="p">);</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="w">    </span><span class="c">% Select unique trial type name</span>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a><span class="w">    </span><span class="n">unique_names</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">unique</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">trial_type</span><span class="p">);</span>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a><span class="w">    </span><span class="c">% Make new table in a form that SPM can read</span>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a><span class="w">    </span><span class="n">new_df</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">table</span><span class="p">(</span><span class="s">&#39;Size&#39;</span><span class="p">,[</span><span class="nb">length</span><span class="p">(</span><span class="n">unique_names</span><span class="p">),</span><span class="mi">3</span><span class="p">],</span><span class="s">&#39;VariableTypes&#39;</span><span class="p">,{</span><span class="s">&#39;cellstr&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;cellstr&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;cellstr&#39;</span><span class="p">},</span><span class="s">&#39;VariableNames&#39;</span><span class="p">,{</span><span class="s">&#39;names&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;onsets&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;durations&#39;</span><span class="p">});</span>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a><span class="w">    </span><span class="c">% For each trial type (i.e., condition)</span>
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">unique_names</span><span class="p">)</span>
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a><span class="w">        </span><span class="c">% Select rows belonging to that condition</span>
</span><span id="__span-4-36"><a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a><span class="w">        </span><span class="n">filtered</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">df</span><span class="p">(</span><span class="nb">strcmp</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">trial_type</span><span class="p">,</span><span class="n">unique_names</span><span class="p">{</span><span class="n">k</span><span class="p">}),:);</span>
</span><span id="__span-4-37"><a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a><span class="w">        </span><span class="c">% Copy trial name, onset and duration to the new table</span>
</span><span id="__span-4-38"><a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a><span class="w">        </span><span class="n">new_df</span><span class="p">.</span><span class="n">names</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">unique</span><span class="p">(</span><span class="n">filtered</span><span class="p">.</span><span class="n">trial_type</span><span class="p">);</span>
</span><span id="__span-4-39"><a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a><span class="w">        </span><span class="n">new_df</span><span class="p">.</span><span class="n">onsets</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="n">filtered</span><span class="p">.</span><span class="n">onset</span><span class="p">};</span>
</span><span id="__span-4-40"><a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a><span class="w">        </span><span class="n">new_df</span><span class="p">.</span><span class="n">durations</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="n">filtered</span><span class="p">.</span><span class="n">duration</span><span class="p">};</span>
</span><span id="__span-4-41"><a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-4-42"><a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a><span class="w">    </span><span class="n">new_df</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">sortrows</span><span class="p">(</span><span class="n">new_df</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;names&#39;</span><span class="p">);</span>
</span><span id="__span-4-43"><a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a><span class="k">end</span>
</span></code></pre></div>
</details>
<h3 id="creating-confounds-files">Creating Confounds Files<a class="headerlink" href="#creating-confounds-files" title="Permanent link">&para;</a></h3>
<p>Head motion and other confound regressors from fMRIPrep need to be formatted to be compatible with SPM. The <code>fMRIprepConfounds2SPM</code> function can convert these files into the format required by SPM.</p>
<ol>
<li>Use the <code>fMRIprepConfounds2SPM</code> function to convert confounds from fMRIPrep.</li>
<li>Store the confounds files in the BIDS structure with SPM-compatible names:<ul>
<li><code>BIDS/sub-xx/func/sub-xx_run-x_confoundsspm.mat</code>.</li>
</ul>
</li>
</ol>
<details class="example">
<summary>fMRIprepConfounds2SPM</summary>
<div class="language-matlab highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">function</span><span class="w"> </span>confounds<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">fMRIprepConfounds2SPM</span><span class="p">(</span>json_path, tsv_path, pipeline<span class="p">)</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">    </span><span class="c">% fMRIprepConfounds2SPM - Extracts and formats fMRI confounds for SPM analysis</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">    </span><span class="c">% This function processes confound data from fMRIprep outputs, suitable for</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">    </span><span class="c">% Statistical Parametric Mapping (SPM) analysis. It reads a JSON file with</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">    </span><span class="c">% confound descriptions and a TSV file with confound values, then selects and</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">    </span><span class="c">% formats the required confounds based on the specified denoising pipeline.</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">    </span><span class="c">% Usage:</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">    </span><span class="c">%   confounds = fMRIprepConfounds2SPM(json_path, tsv_path, pipeline)</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">    </span><span class="c">% Inputs:</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">    </span><span class="c">%   json_path (string): Full path to the JSON file. This file contains metadata</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="w">    </span><span class="c">%                       about the confounds, such as their names and properties.</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="w">    </span><span class="c">%   tsv_path (string):  Full path to the TSV file. This file holds the actual</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="w">    </span><span class="c">%                       confound values in a tabular format for each fMRI run.</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="w">    </span><span class="c">%   pipeline (cell array of strings): Specifies the denoising strategies to be</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="w">    </span><span class="c">%                                     applied. Each element is a string in the</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="w">    </span><span class="c">%                                     format &#39;strategy-number&#39;. For example,</span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a><span class="w">    </span><span class="c">%                                     &#39;HMP-6&#39; indicates using 6 head motion</span>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a><span class="w">    </span><span class="c">%                                     parameters. Valid strategies include:</span>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="w">    </span><span class="c">%             &#39;HMP&#39;: Head Motion Parameters, options: 6, 12, 24</span>
</span><span id="__span-5-25"><a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a><span class="w">    </span><span class="c">%             &#39;GS&#39;: Global Signal, options: 1, 2, 4</span>
</span><span id="__span-5-26"><a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a><span class="w">    </span><span class="c">%             &#39;CSF_WM&#39;: CSF and White Matter signals, options: 2, 4, 8</span>
</span><span id="__span-5-27"><a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a><span class="w">    </span><span class="c">%             &#39;aCompCor&#39;: CompCor, options: 10, 50</span>
</span><span id="__span-5-28"><a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a><span class="w">    </span><span class="c">%             &#39;MotionOutlier&#39;: Motion Outliers, options: FD &gt; 0.5, DVARS &gt; 1.5</span>
</span><span id="__span-5-29"><a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a><span class="w">    </span><span class="c">%             &#39;Cosine&#39;: Discrete Cosine Transform based regressors for HPF</span>
</span><span id="__span-5-30"><a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a><span class="w">    </span><span class="c">%             &#39;FD&#39;: Framewise Displacement, a raw non-binary value</span>
</span><span id="__span-5-31"><a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a><span class="w">    </span><span class="c">%             &#39;Null&#39;: Returns an empty table if no confounds are to be applied</span>
</span><span id="__span-5-32"><a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-5-33"><a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a><span class="w">    </span><span class="c">% Outputs:</span>
</span><span id="__span-5-34"><a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a><span class="w">    </span><span class="c">%   confounds (table): A table containing the selected confounds, formatted for</span>
</span><span id="__span-5-35"><a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a><span class="w">    </span><span class="c">%                      use in SPM. Each column represents a different confound,</span>
</span><span id="__span-5-36"><a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a><span class="w">    </span><span class="c">%                      and each row corresponds to a time point in the fMRI data.</span>
</span><span id="__span-5-37"><a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-5-38"><a id="__codelineno-5-38" name="__codelineno-5-38" href="#__codelineno-5-38"></a><span class="w">    </span><span class="c">% Author: Andrea Costantino</span>
</span><span id="__span-5-39"><a id="__codelineno-5-39" name="__codelineno-5-39" href="#__codelineno-5-39"></a><span class="w">    </span><span class="c">% Date: 23/1/2023</span>
</span><span id="__span-5-40"><a id="__codelineno-5-40" name="__codelineno-5-40" href="#__codelineno-5-40"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-5-41"><a id="__codelineno-5-41" name="__codelineno-5-41" href="#__codelineno-5-41"></a><span class="w">    </span><span class="c">% Example:</span>
</span><span id="__span-5-42"><a id="__codelineno-5-42" name="__codelineno-5-42" href="#__codelineno-5-42"></a><span class="w">    </span><span class="c">%   confounds = fMRIprepConfounds2SPM(&#39;path/to/json&#39;, &#39;path/to/tsv&#39;, {&#39;HMP-6&#39;, &#39;GS-4&#39;});</span>
</span><span id="__span-5-43"><a id="__codelineno-5-43" name="__codelineno-5-43" href="#__codelineno-5-43"></a><span class="w">    </span><span class="c">%</span>
</span><span id="__span-5-44"><a id="__codelineno-5-44" name="__codelineno-5-44" href="#__codelineno-5-44"></a><span class="w">    </span><span class="c">% This example would extract and format 6 head motion parameters and the global</span>
</span><span id="__span-5-45"><a id="__codelineno-5-45" name="__codelineno-5-45" href="#__codelineno-5-45"></a><span class="w">    </span><span class="c">% signal (with raw, derivative, and squared derivative) for SPM analysis.</span>
</span><span id="__span-5-46"><a id="__codelineno-5-46" name="__codelineno-5-46" href="#__codelineno-5-46"></a>
</span><span id="__span-5-47"><a id="__codelineno-5-47" name="__codelineno-5-47" href="#__codelineno-5-47"></a><span class="w">    </span><span class="c">% Read the TSV file containing the confound values</span>
</span><span id="__span-5-48"><a id="__codelineno-5-48" name="__codelineno-5-48" href="#__codelineno-5-48"></a><span class="w">    </span><span class="n">tsv_run</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">readtable</span><span class="p">(</span><span class="n">tsv_path</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;FileType&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;text&#39;</span><span class="p">);</span>
</span><span id="__span-5-49"><a id="__codelineno-5-49" name="__codelineno-5-49" href="#__codelineno-5-49"></a>
</span><span id="__span-5-50"><a id="__codelineno-5-50" name="__codelineno-5-50" href="#__codelineno-5-50"></a><span class="w">    </span><span class="c">% Open and read the JSON file, then parse it into a MATLAB structure</span>
</span><span id="__span-5-51"><a id="__codelineno-5-51" name="__codelineno-5-51" href="#__codelineno-5-51"></a><span class="w">    </span><span class="n">fid</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fopen</span><span class="p">(</span><span class="n">json_path</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-5-52"><a id="__codelineno-5-52" name="__codelineno-5-52" href="#__codelineno-5-52"></a><span class="w">    </span><span class="n">raw</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fread</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span><span class="w"> </span><span class="n">inf</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-5-53"><a id="__codelineno-5-53" name="__codelineno-5-53" href="#__codelineno-5-53"></a><span class="w">    </span><span class="n">str</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">char</span><span class="p">(</span><span class="n">raw</span><span class="o">&#39;</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-5-54"><a id="__codelineno-5-54" name="__codelineno-5-54" href="#__codelineno-5-54"></a><span class="w">    </span><span class="nb">fclose</span><span class="p">(</span><span class="n">fid</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-5-55"><a id="__codelineno-5-55" name="__codelineno-5-55" href="#__codelineno-5-55"></a><span class="w">    </span><span class="n">json_run</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">jsondecode</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
</span><span id="__span-5-56"><a id="__codelineno-5-56" name="__codelineno-5-56" href="#__codelineno-5-56"></a>
</span><span id="__span-5-57"><a id="__codelineno-5-57" name="__codelineno-5-57" href="#__codelineno-5-57"></a><span class="w">    </span><span class="c">% Initialize an empty cell array to store the keys of the selected confounds</span>
</span><span id="__span-5-58"><a id="__codelineno-5-58" name="__codelineno-5-58" href="#__codelineno-5-58"></a><span class="w">    </span><span class="n">selected_keys</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{};</span>
</span><span id="__span-5-59"><a id="__codelineno-5-59" name="__codelineno-5-59" href="#__codelineno-5-59"></a>
</span><span id="__span-5-60"><a id="__codelineno-5-60" name="__codelineno-5-60" href="#__codelineno-5-60"></a><span class="w">    </span><span class="c">% If &#39;Null&#39; is found in the pipeline, return an empty table and exit the function</span>
</span><span id="__span-5-61"><a id="__codelineno-5-61" name="__codelineno-5-61" href="#__codelineno-5-61"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">any</span><span class="p">(</span><span class="nb">strcmp</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Null&#39;</span><span class="p">))</span>
</span><span id="__span-5-62"><a id="__codelineno-5-62" name="__codelineno-5-62" href="#__codelineno-5-62"></a><span class="w">        </span><span class="nb">disp</span><span class="p">(</span><span class="s">&#39;&quot;Null&quot; found in the pipeline. Returning an empty table.&#39;</span><span class="p">)</span>
</span><span id="__span-5-63"><a id="__codelineno-5-63" name="__codelineno-5-63" href="#__codelineno-5-63"></a><span class="w">        </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-5-64"><a id="__codelineno-5-64" name="__codelineno-5-64" href="#__codelineno-5-64"></a><span class="w">    </span><span class="k">else</span>
</span><span id="__span-5-65"><a id="__codelineno-5-65" name="__codelineno-5-65" href="#__codelineno-5-65"></a><span class="w">        </span><span class="c">% Process each specified strategy in the pipeline</span>
</span><span id="__span-5-66"><a id="__codelineno-5-66" name="__codelineno-5-66" href="#__codelineno-5-66"></a>
</span><span id="__span-5-67"><a id="__codelineno-5-67" name="__codelineno-5-67" href="#__codelineno-5-67"></a><span class="w">        </span><span class="c">% Head Motion Parameters (HMP)</span>
</span><span id="__span-5-68"><a id="__codelineno-5-68" name="__codelineno-5-68" href="#__codelineno-5-68"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nb">any</span><span class="p">(</span><span class="nb">contains</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;HMP&#39;</span><span class="p">))</span>
</span><span id="__span-5-69"><a id="__codelineno-5-69" name="__codelineno-5-69" href="#__codelineno-5-69"></a><span class="w">            </span><span class="c">% Extract and validate the specified number of head motion parameters</span>
</span><span id="__span-5-70"><a id="__codelineno-5-70" name="__codelineno-5-70" href="#__codelineno-5-70"></a><span class="w">            </span><span class="n">idx</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="nb">contains</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;HMP&#39;</span><span class="p">));</span>
</span><span id="__span-5-71"><a id="__codelineno-5-71" name="__codelineno-5-71" href="#__codelineno-5-71"></a><span class="w">            </span><span class="n">conf_num_str</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">pipeline</span><span class="p">(</span><span class="n">idx</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span><span class="w"> </span>
</span><span id="__span-5-72"><a id="__codelineno-5-72" name="__codelineno-5-72" href="#__codelineno-5-72"></a><span class="w">            </span><span class="n">conf_num_str_split</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">strsplit</span><span class="p">(</span><span class="n">conf_num_str</span><span class="p">{</span><span class="mi">1</span><span class="p">},</span><span class="w"> </span><span class="s">&#39;-&#39;</span><span class="p">);</span>
</span><span id="__span-5-73"><a id="__codelineno-5-73" name="__codelineno-5-73" href="#__codelineno-5-73"></a><span class="w">            </span><span class="n">conf_num</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">str2double</span><span class="p">(</span><span class="n">conf_num_str_split</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
</span><span id="__span-5-74"><a id="__codelineno-5-74" name="__codelineno-5-74" href="#__codelineno-5-74"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="nb">any</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">24</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">conf_num</span><span class="p">)</span>
</span><span id="__span-5-75"><a id="__codelineno-5-75" name="__codelineno-5-75" href="#__codelineno-5-75"></a><span class="w">                </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;HMP must be 6, 12, or 24.&#39;</span><span class="p">);</span>
</span><span id="__span-5-76"><a id="__codelineno-5-76" name="__codelineno-5-76" href="#__codelineno-5-76"></a><span class="w">            </span><span class="k">else</span>
</span><span id="__span-5-77"><a id="__codelineno-5-77" name="__codelineno-5-77" href="#__codelineno-5-77"></a><span class="w">                </span><span class="c">% Add the appropriate head motion parameters to selected_keys</span>
</span><span id="__span-5-78"><a id="__codelineno-5-78" name="__codelineno-5-78" href="#__codelineno-5-78"></a><span class="w">                </span><span class="n">hmp_id</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">floor</span><span class="p">(</span><span class="n">conf_num</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">6</span><span class="p">);</span>
</span><span id="__span-5-79"><a id="__codelineno-5-79" name="__codelineno-5-79" href="#__codelineno-5-79"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">hmp_id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-5-80"><a id="__codelineno-5-80" name="__codelineno-5-80" href="#__codelineno-5-80"></a><span class="w">                    </span><span class="n">selected_keys</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">selected_keys</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;rot_x&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;rot_y&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;rot_z&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;trans_x&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;trans_y&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;trans_z&#39;</span><span class="p">}];</span>
</span><span id="__span-5-81"><a id="__codelineno-5-81" name="__codelineno-5-81" href="#__codelineno-5-81"></a><span class="w">                </span><span class="k">end</span>
</span><span id="__span-5-82"><a id="__codelineno-5-82" name="__codelineno-5-82" href="#__codelineno-5-82"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">hmp_id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-5-83"><a id="__codelineno-5-83" name="__codelineno-5-83" href="#__codelineno-5-83"></a><span class="w">                    </span><span class="n">selected_keys</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">selected_keys</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;rot_x_derivative1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;rot_y_derivative1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;rot_z_derivative1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;trans_x_derivative1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;trans_y_derivative1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;trans_z_derivative1&#39;</span><span class="p">}];</span>
</span><span id="__span-5-84"><a id="__codelineno-5-84" name="__codelineno-5-84" href="#__codelineno-5-84"></a><span class="w">                </span><span class="k">end</span>
</span><span id="__span-5-85"><a id="__codelineno-5-85" name="__codelineno-5-85" href="#__codelineno-5-85"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">hmp_id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-5-86"><a id="__codelineno-5-86" name="__codelineno-5-86" href="#__codelineno-5-86"></a><span class="w">                    </span><span class="n">selected_keys</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">selected_keys</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;rot_x_power2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;rot_y_power2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;rot_z_power2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;trans_x_power2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;trans_y_power2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;trans_z_power2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;rot_x_derivative1_power2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;rot_y_derivative1_power2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;rot_z_derivative1_power2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;trans_x_derivative1_power2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;trans_y_derivative1_power2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;trans_z_derivative1_power2&#39;</span><span class="p">}];</span>
</span><span id="__span-5-87"><a id="__codelineno-5-87" name="__codelineno-5-87" href="#__codelineno-5-87"></a><span class="w">                </span><span class="k">end</span>
</span><span id="__span-5-88"><a id="__codelineno-5-88" name="__codelineno-5-88" href="#__codelineno-5-88"></a><span class="w">            </span><span class="k">end</span>
</span><span id="__span-5-89"><a id="__codelineno-5-89" name="__codelineno-5-89" href="#__codelineno-5-89"></a><span class="w">        </span><span class="k">end</span>
</span><span id="__span-5-90"><a id="__codelineno-5-90" name="__codelineno-5-90" href="#__codelineno-5-90"></a>
</span><span id="__span-5-91"><a id="__codelineno-5-91" name="__codelineno-5-91" href="#__codelineno-5-91"></a><span class="w">        </span><span class="c">% Global Signal (GS)</span>
</span><span id="__span-5-92"><a id="__codelineno-5-92" name="__codelineno-5-92" href="#__codelineno-5-92"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nb">any</span><span class="p">(</span><span class="nb">contains</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;GS&#39;</span><span class="p">))</span>
</span><span id="__span-5-93"><a id="__codelineno-5-93" name="__codelineno-5-93" href="#__codelineno-5-93"></a><span class="w">            </span><span class="c">% Extract and validate the specified level of global signal processing</span>
</span><span id="__span-5-94"><a id="__codelineno-5-94" name="__codelineno-5-94" href="#__codelineno-5-94"></a><span class="w">            </span><span class="n">idx</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="nb">contains</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;GS&#39;</span><span class="p">));</span>
</span><span id="__span-5-95"><a id="__codelineno-5-95" name="__codelineno-5-95" href="#__codelineno-5-95"></a><span class="w">            </span><span class="n">conf_num_str</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">pipeline</span><span class="p">(</span><span class="n">idx</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span><span class="w"> </span>
</span><span id="__span-5-96"><a id="__codelineno-5-96" name="__codelineno-5-96" href="#__codelineno-5-96"></a><span class="w">            </span><span class="n">conf_num_str_split</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">strsplit</span><span class="p">(</span><span class="n">conf_num_str</span><span class="p">{</span><span class="mi">1</span><span class="p">},</span><span class="w"> </span><span class="s">&#39;-&#39;</span><span class="p">);</span>
</span><span id="__span-5-97"><a id="__codelineno-5-97" name="__codelineno-5-97" href="#__codelineno-5-97"></a><span class="w">            </span><span class="n">conf_num</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">str2double</span><span class="p">(</span><span class="n">conf_num_str_split</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
</span><span id="__span-5-98"><a id="__codelineno-5-98" name="__codelineno-5-98" href="#__codelineno-5-98"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="nb">any</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">conf_num</span><span class="p">)</span>
</span><span id="__span-5-99"><a id="__codelineno-5-99" name="__codelineno-5-99" href="#__codelineno-5-99"></a><span class="w">                </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;GS must be 1, 2, or 4.&#39;</span><span class="p">);</span>
</span><span id="__span-5-100"><a id="__codelineno-5-100" name="__codelineno-5-100" href="#__codelineno-5-100"></a><span class="w">            </span><span class="k">else</span>
</span><span id="__span-5-101"><a id="__codelineno-5-101" name="__codelineno-5-101" href="#__codelineno-5-101"></a><span class="w">                </span><span class="c">% Add the global signal parameters to selected_keys based on the specified level</span>
</span><span id="__span-5-102"><a id="__codelineno-5-102" name="__codelineno-5-102" href="#__codelineno-5-102"></a><span class="w">                </span><span class="n">gs_id</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">conf_num</span><span class="p">;</span>
</span><span id="__span-5-103"><a id="__codelineno-5-103" name="__codelineno-5-103" href="#__codelineno-5-103"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">gs_id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-5-104"><a id="__codelineno-5-104" name="__codelineno-5-104" href="#__codelineno-5-104"></a><span class="w">                    </span><span class="n">selected_keys</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">selected_keys</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;global_signal&#39;</span><span class="p">}];</span>
</span><span id="__span-5-105"><a id="__codelineno-5-105" name="__codelineno-5-105" href="#__codelineno-5-105"></a><span class="w">                </span><span class="k">end</span>
</span><span id="__span-5-106"><a id="__codelineno-5-106" name="__codelineno-5-106" href="#__codelineno-5-106"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">gs_id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-5-107"><a id="__codelineno-5-107" name="__codelineno-5-107" href="#__codelineno-5-107"></a><span class="w">                    </span><span class="n">selected_keys</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">selected_keys</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;global_signal_derivative1&#39;</span><span class="p">}];</span>
</span><span id="__span-5-108"><a id="__codelineno-5-108" name="__codelineno-5-108" href="#__codelineno-5-108"></a><span class="w">                </span><span class="k">end</span>
</span><span id="__span-5-109"><a id="__codelineno-5-109" name="__codelineno-5-109" href="#__codelineno-5-109"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">gs_id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-5-110"><a id="__codelineno-5-110" name="__codelineno-5-110" href="#__codelineno-5-110"></a><span class="w">                    </span><span class="n">selected_keys</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">selected_keys</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;global_signal_derivative1_power2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;global_signal_power2&#39;</span><span class="p">}];</span>
</span><span id="__span-5-111"><a id="__codelineno-5-111" name="__codelineno-5-111" href="#__codelineno-5-111"></a><span class="w">                </span><span class="k">end</span>
</span><span id="__span-5-112"><a id="__codelineno-5-112" name="__codelineno-5-112" href="#__codelineno-5-112"></a><span class="w">            </span><span class="k">end</span>
</span><span id="__span-5-113"><a id="__codelineno-5-113" name="__codelineno-5-113" href="#__codelineno-5-113"></a><span class="w">        </span><span class="k">end</span>
</span><span id="__span-5-114"><a id="__codelineno-5-114" name="__codelineno-5-114" href="#__codelineno-5-114"></a>
</span><span id="__span-5-115"><a id="__codelineno-5-115" name="__codelineno-5-115" href="#__codelineno-5-115"></a><span class="w">        </span><span class="c">% CSF and WM masks global signal (CSF_WM)</span>
</span><span id="__span-5-116"><a id="__codelineno-5-116" name="__codelineno-5-116" href="#__codelineno-5-116"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nb">any</span><span class="p">(</span><span class="nb">contains</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;CSF_WM&#39;</span><span class="p">))</span>
</span><span id="__span-5-117"><a id="__codelineno-5-117" name="__codelineno-5-117" href="#__codelineno-5-117"></a><span class="w">            </span><span class="c">% Extract and validate the specified level of CSF/WM signal processing</span>
</span><span id="__span-5-118"><a id="__codelineno-5-118" name="__codelineno-5-118" href="#__codelineno-5-118"></a><span class="w">            </span><span class="n">idx</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="nb">contains</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;CSF_WM&#39;</span><span class="p">));</span>
</span><span id="__span-5-119"><a id="__codelineno-5-119" name="__codelineno-5-119" href="#__codelineno-5-119"></a><span class="w">            </span><span class="n">conf_num_str</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">pipeline</span><span class="p">(</span><span class="n">idx</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span><span class="w"> </span>
</span><span id="__span-5-120"><a id="__codelineno-5-120" name="__codelineno-5-120" href="#__codelineno-5-120"></a><span class="w">            </span><span class="n">conf_num_str_split</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">strsplit</span><span class="p">(</span><span class="n">conf_num_str</span><span class="p">{</span><span class="mi">1</span><span class="p">},</span><span class="w"> </span><span class="s">&#39;-&#39;</span><span class="p">);</span>
</span><span id="__span-5-121"><a id="__codelineno-5-121" name="__codelineno-5-121" href="#__codelineno-5-121"></a><span class="w">            </span><span class="n">conf_num</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">str2double</span><span class="p">(</span><span class="n">conf_num_str_split</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
</span><span id="__span-5-122"><a id="__codelineno-5-122" name="__codelineno-5-122" href="#__codelineno-5-122"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="nb">any</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">conf_num</span><span class="p">)</span>
</span><span id="__span-5-123"><a id="__codelineno-5-123" name="__codelineno-5-123" href="#__codelineno-5-123"></a><span class="w">                </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;CSF_WM must be 2, 4, or 8.&#39;</span><span class="p">);</span>
</span><span id="__span-5-124"><a id="__codelineno-5-124" name="__codelineno-5-124" href="#__codelineno-5-124"></a><span class="w">            </span><span class="k">else</span>
</span><span id="__span-5-125"><a id="__codelineno-5-125" name="__codelineno-5-125" href="#__codelineno-5-125"></a><span class="w">                </span><span class="c">% Add the CSF and WM parameters to selected_keys based on the specified level</span>
</span><span id="__span-5-126"><a id="__codelineno-5-126" name="__codelineno-5-126" href="#__codelineno-5-126"></a><span class="w">                </span><span class="n">phys_id</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">floor</span><span class="p">(</span><span class="n">conf_num</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
</span><span id="__span-5-127"><a id="__codelineno-5-127" name="__codelineno-5-127" href="#__codelineno-5-127"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">phys_id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-5-128"><a id="__codelineno-5-128" name="__codelineno-5-128" href="#__codelineno-5-128"></a><span class="w">                    </span><span class="n">selected_keys</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">selected_keys</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;white_matter&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;csf&#39;</span><span class="p">}];</span>
</span><span id="__span-5-129"><a id="__codelineno-5-129" name="__codelineno-5-129" href="#__codelineno-5-129"></a><span class="w">                </span><span class="k">end</span>
</span><span id="__span-5-130"><a id="__codelineno-5-130" name="__codelineno-5-130" href="#__codelineno-5-130"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">phys_id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-5-131"><a id="__codelineno-5-131" name="__codelineno-5-131" href="#__codelineno-5-131"></a><span class="w">                    </span><span class="n">selected_keys</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">selected_keys</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;white_matter_derivative1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;csf_derivative1&#39;</span><span class="p">}];</span>
</span><span id="__span-5-132"><a id="__codelineno-5-132" name="__codelineno-5-132" href="#__codelineno-5-132"></a><span class="w">                </span><span class="k">end</span>
</span><span id="__span-5-133"><a id="__codelineno-5-133" name="__codelineno-5-133" href="#__codelineno-5-133"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">phys_id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-5-134"><a id="__codelineno-5-134" name="__codelineno-5-134" href="#__codelineno-5-134"></a><span class="w">                    </span><span class="n">selected_keys</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">selected_keys</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;white_matter_derivative1_power2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;csf_derivative1_power2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;white_matter_power2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;csf_power2&#39;</span><span class="p">}];</span>
</span><span id="__span-5-135"><a id="__codelineno-5-135" name="__codelineno-5-135" href="#__codelineno-5-135"></a><span class="w">                </span><span class="k">end</span>
</span><span id="__span-5-136"><a id="__codelineno-5-136" name="__codelineno-5-136" href="#__codelineno-5-136"></a><span class="w">            </span><span class="k">end</span>
</span><span id="__span-5-137"><a id="__codelineno-5-137" name="__codelineno-5-137" href="#__codelineno-5-137"></a><span class="w">        </span><span class="k">end</span>
</span><span id="__span-5-138"><a id="__codelineno-5-138" name="__codelineno-5-138" href="#__codelineno-5-138"></a>
</span><span id="__span-5-139"><a id="__codelineno-5-139" name="__codelineno-5-139" href="#__codelineno-5-139"></a><span class="w">        </span><span class="c">% aCompCor</span>
</span><span id="__span-5-140"><a id="__codelineno-5-140" name="__codelineno-5-140" href="#__codelineno-5-140"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nb">any</span><span class="p">(</span><span class="nb">contains</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;aCompCor&#39;</span><span class="p">))</span>
</span><span id="__span-5-141"><a id="__codelineno-5-141" name="__codelineno-5-141" href="#__codelineno-5-141"></a><span class="w">            </span><span class="c">% Extract and format aCompCor confounds based on the specified number</span>
</span><span id="__span-5-142"><a id="__codelineno-5-142" name="__codelineno-5-142" href="#__codelineno-5-142"></a><span class="w">            </span><span class="n">csf_50_dict</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">json_run</span><span class="p">(</span><span class="nb">ismember</span><span class="p">({</span><span class="n">json_run</span><span class="p">.</span><span class="n">Mask</span><span class="p">},</span><span class="w"> </span><span class="s">&#39;CSF&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nb">ismember</span><span class="p">({</span><span class="n">json_run</span><span class="p">.</span><span class="n">Method</span><span class="p">},</span><span class="w"> </span><span class="s">&#39;aCompCor&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="o">~</span><span class="nb">contains</span><span class="p">({</span><span class="n">json_run</span><span class="p">.</span><span class="n">key</span><span class="p">},</span><span class="w"> </span><span class="s">&#39;dropped&#39;</span><span class="p">));</span>
</span><span id="__span-5-143"><a id="__codelineno-5-143" name="__codelineno-5-143" href="#__codelineno-5-143"></a><span class="w">            </span><span class="n">wm_50_dict</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">json_run</span><span class="p">(</span><span class="nb">ismember</span><span class="p">({</span><span class="n">json_run</span><span class="p">.</span><span class="n">Mask</span><span class="p">},</span><span class="w"> </span><span class="s">&#39;WM&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nb">ismember</span><span class="p">({</span><span class="n">json_run</span><span class="p">.</span><span class="n">Method</span><span class="p">},</span><span class="w"> </span><span class="s">&#39;aCompCor&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="o">~</span><span class="nb">contains</span><span class="p">({</span><span class="n">json_run</span><span class="p">.</span><span class="n">key</span><span class="p">},</span><span class="w"> </span><span class="s">&#39;dropped&#39;</span><span class="p">));</span>
</span><span id="__span-5-144"><a id="__codelineno-5-144" name="__codelineno-5-144" href="#__codelineno-5-144"></a><span class="w">            </span><span class="n">idx</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="nb">contains</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;aCompCor&#39;</span><span class="p">));</span>
</span><span id="__span-5-145"><a id="__codelineno-5-145" name="__codelineno-5-145" href="#__codelineno-5-145"></a><span class="w">            </span><span class="n">conf_num_str</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">pipeline</span><span class="p">{</span><span class="n">idx</span><span class="p">(</span><span class="mi">1</span><span class="p">)};</span><span class="w"> </span>
</span><span id="__span-5-146"><a id="__codelineno-5-146" name="__codelineno-5-146" href="#__codelineno-5-146"></a><span class="w">            </span><span class="n">conf_num_str_split</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">strsplit</span><span class="p">(</span><span class="n">conf_num_str</span><span class="p">{</span><span class="mi">1</span><span class="p">},</span><span class="w"> </span><span class="s">&#39;-&#39;</span><span class="p">);</span>
</span><span id="__span-5-147"><a id="__codelineno-5-147" name="__codelineno-5-147" href="#__codelineno-5-147"></a><span class="w">            </span><span class="n">conf_num</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">str2double</span><span class="p">(</span><span class="n">conf_num_str_split</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
</span><span id="__span-5-148"><a id="__codelineno-5-148" name="__codelineno-5-148" href="#__codelineno-5-148"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="nb">any</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">conf_num</span><span class="p">)</span>
</span><span id="__span-5-149"><a id="__codelineno-5-149" name="__codelineno-5-149" href="#__codelineno-5-149"></a><span class="w">                </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;aCompCor must be 10 or 50.&#39;</span><span class="p">);</span>
</span><span id="__span-5-150"><a id="__codelineno-5-150" name="__codelineno-5-150" href="#__codelineno-5-150"></a><span class="w">            </span><span class="k">else</span>
</span><span id="__span-5-151"><a id="__codelineno-5-151" name="__codelineno-5-151" href="#__codelineno-5-151"></a><span class="w">                </span><span class="c">% Select the appropriate aCompCor components and add them to selected_keys</span>
</span><span id="__span-5-152"><a id="__codelineno-5-152" name="__codelineno-5-152" href="#__codelineno-5-152"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">conf_num</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">10</span>
</span><span id="__span-5-153"><a id="__codelineno-5-153" name="__codelineno-5-153" href="#__codelineno-5-153"></a><span class="w">                    </span><span class="n">csf</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">sort</span><span class="p">(</span><span class="nb">cell2mat</span><span class="p">(</span><span class="n">csf_50_dict</span><span class="p">.</span><span class="n">keys</span><span class="p">()));</span>
</span><span id="__span-5-154"><a id="__codelineno-5-154" name="__codelineno-5-154" href="#__codelineno-5-154"></a><span class="w">                    </span><span class="n">csf_10</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">csf</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">);</span>
</span><span id="__span-5-155"><a id="__codelineno-5-155" name="__codelineno-5-155" href="#__codelineno-5-155"></a><span class="w">                    </span><span class="n">wm</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">sort</span><span class="p">(</span><span class="nb">cell2mat</span><span class="p">(</span><span class="n">wm_50_dict</span><span class="p">.</span><span class="n">keys</span><span class="p">()));</span>
</span><span id="__span-5-156"><a id="__codelineno-5-156" name="__codelineno-5-156" href="#__codelineno-5-156"></a><span class="w">                    </span><span class="n">wm_10</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">wm</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">);</span>
</span><span id="__span-5-157"><a id="__codelineno-5-157" name="__codelineno-5-157" href="#__codelineno-5-157"></a><span class="w">                    </span><span class="n">selected_keys</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">selected_keys</span><span class="p">,</span><span class="w"> </span><span class="n">csf_10</span><span class="p">,</span><span class="w"> </span><span class="n">wm_10</span><span class="p">];</span>
</span><span id="__span-5-158"><a id="__codelineno-5-158" name="__codelineno-5-158" href="#__codelineno-5-158"></a><span class="w">                </span><span class="k">elseif</span><span class="w"> </span><span class="n">conf_num</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">50</span>
</span><span id="__span-5-159"><a id="__codelineno-5-159" name="__codelineno-5-159" href="#__codelineno-5-159"></a><span class="w">                    </span><span class="n">csf_50</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cell2mat</span><span class="p">(</span><span class="n">csf_50_dict</span><span class="p">.</span><span class="n">keys</span><span class="p">());</span>
</span><span id="__span-5-160"><a id="__codelineno-5-160" name="__codelineno-5-160" href="#__codelineno-5-160"></a><span class="w">                    </span><span class="n">wm_50</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cell2mat</span><span class="p">(</span><span class="n">wm_50_dict</span><span class="p">.</span><span class="n">keys</span><span class="p">());</span>
</span><span id="__span-5-161"><a id="__codelineno-5-161" name="__codelineno-5-161" href="#__codelineno-5-161"></a><span class="w">                    </span><span class="n">selected_keys</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">selected_keys</span><span class="p">,</span><span class="w"> </span><span class="n">csf_50</span><span class="p">,</span><span class="w"> </span><span class="n">wm_50</span><span class="p">];</span>
</span><span id="__span-5-162"><a id="__codelineno-5-162" name="__codelineno-5-162" href="#__codelineno-5-162"></a><span class="w">                </span><span class="k">end</span>
</span><span id="__span-5-163"><a id="__codelineno-5-163" name="__codelineno-5-163" href="#__codelineno-5-163"></a><span class="w">            </span><span class="k">end</span>
</span><span id="__span-5-164"><a id="__codelineno-5-164" name="__codelineno-5-164" href="#__codelineno-5-164"></a><span class="w">        </span><span class="k">end</span>
</span><span id="__span-5-165"><a id="__codelineno-5-165" name="__codelineno-5-165" href="#__codelineno-5-165"></a>
</span><span id="__span-5-166"><a id="__codelineno-5-166" name="__codelineno-5-166" href="#__codelineno-5-166"></a><span class="w">        </span><span class="c">% Cosine</span>
</span><span id="__span-5-167"><a id="__codelineno-5-167" name="__codelineno-5-167" href="#__codelineno-5-167"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nb">any</span><span class="p">(</span><span class="nb">contains</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Cosine&#39;</span><span class="p">))</span>
</span><span id="__span-5-168"><a id="__codelineno-5-168" name="__codelineno-5-168" href="#__codelineno-5-168"></a><span class="w">            </span><span class="c">% Extract cosine-based regressors for high-pass filtering</span>
</span><span id="__span-5-169"><a id="__codelineno-5-169" name="__codelineno-5-169" href="#__codelineno-5-169"></a><span class="w">            </span><span class="n">cosine_keys</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tsv_run</span><span class="p">.</span><span class="n">Properties</span><span class="p">.</span><span class="n">VariableNames</span><span class="p">(</span><span class="nb">contains</span><span class="p">(</span><span class="n">tsv_run</span><span class="p">.</span><span class="n">Properties</span><span class="p">.</span><span class="n">VariableNames</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;cosine&#39;</span><span class="p">));</span>
</span><span id="__span-5-170"><a id="__codelineno-5-170" name="__codelineno-5-170" href="#__codelineno-5-170"></a><span class="w">            </span><span class="n">selected_keys</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">selected_keys</span><span class="p">,</span><span class="w"> </span><span class="n">cosine_keys</span><span class="p">];</span>
</span><span id="__span-5-171"><a id="__codelineno-5-171" name="__codelineno-5-171" href="#__codelineno-5-171"></a><span class="w">        </span><span class="k">end</span>
</span><span id="__span-5-172"><a id="__codelineno-5-172" name="__codelineno-5-172" href="#__codelineno-5-172"></a>
</span><span id="__span-5-173"><a id="__codelineno-5-173" name="__codelineno-5-173" href="#__codelineno-5-173"></a><span class="w">        </span><span class="c">% MotionOutlier</span>
</span><span id="__span-5-174"><a id="__codelineno-5-174" name="__codelineno-5-174" href="#__codelineno-5-174"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nb">any</span><span class="p">(</span><span class="nb">contains</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;MotionOutlier&#39;</span><span class="p">))</span>
</span><span id="__span-5-175"><a id="__codelineno-5-175" name="__codelineno-5-175" href="#__codelineno-5-175"></a><span class="w">            </span><span class="c">% Process motion outliers, either using pre-computed values or calculating them</span>
</span><span id="__span-5-176"><a id="__codelineno-5-176" name="__codelineno-5-176" href="#__codelineno-5-176"></a><span class="w">            </span><span class="n">motion_outlier_keys</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tsv_run</span><span class="p">.</span><span class="n">Properties</span><span class="p">.</span><span class="n">VariableNames</span><span class="p">(</span><span class="nb">find</span><span class="p">(</span><span class="nb">contains</span><span class="p">(</span><span class="n">tsv_run</span><span class="p">.</span><span class="n">Properties</span><span class="p">.</span><span class="n">VariableNames</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;non_steady_state_outlier&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;motion_outlier&#39;</span><span class="p">})));</span>
</span><span id="__span-5-177"><a id="__codelineno-5-177" name="__codelineno-5-177" href="#__codelineno-5-177"></a><span class="w">            </span><span class="n">selected_keys</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">selected_keys</span><span class="p">,</span><span class="w"> </span><span class="n">motion_outlier_keys</span><span class="p">];</span>
</span><span id="__span-5-178"><a id="__codelineno-5-178" name="__codelineno-5-178" href="#__codelineno-5-178"></a><span class="w">        </span><span class="k">end</span>
</span><span id="__span-5-179"><a id="__codelineno-5-179" name="__codelineno-5-179" href="#__codelineno-5-179"></a>
</span><span id="__span-5-180"><a id="__codelineno-5-180" name="__codelineno-5-180" href="#__codelineno-5-180"></a><span class="w">        </span><span class="c">% Framewise Displacement (FD)</span>
</span><span id="__span-5-181"><a id="__codelineno-5-181" name="__codelineno-5-181" href="#__codelineno-5-181"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nb">any</span><span class="p">(</span><span class="nb">contains</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;FD&#39;</span><span class="p">))</span>
</span><span id="__span-5-182"><a id="__codelineno-5-182" name="__codelineno-5-182" href="#__codelineno-5-182"></a><span class="w">            </span><span class="c">% Add raw framewise displacement values to selected_keys</span>
</span><span id="__span-5-183"><a id="__codelineno-5-183" name="__codelineno-5-183" href="#__codelineno-5-183"></a><span class="w">            </span><span class="c">% If the first row is &#39;n/a&#39;, replace it with 0</span>
</span><span id="__span-5-184"><a id="__codelineno-5-184" name="__codelineno-5-184" href="#__codelineno-5-184"></a><span class="w">            </span><span class="n">fd_values</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tsv_run</span><span class="p">.</span><span class="n">framewise_displacement</span><span class="p">;</span>
</span><span id="__span-5-185"><a id="__codelineno-5-185" name="__codelineno-5-185" href="#__codelineno-5-185"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nb">isnan</span><span class="p">(</span><span class="n">fd_values</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-5-186"><a id="__codelineno-5-186" name="__codelineno-5-186" href="#__codelineno-5-186"></a><span class="w">                </span><span class="n">fd_values</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-5-187"><a id="__codelineno-5-187" name="__codelineno-5-187" href="#__codelineno-5-187"></a><span class="w">            </span><span class="k">end</span>
</span><span id="__span-5-188"><a id="__codelineno-5-188" name="__codelineno-5-188" href="#__codelineno-5-188"></a><span class="w">            </span><span class="n">tsv_run</span><span class="p">.</span><span class="n">framewise_displacement</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fd_values</span><span class="p">;</span>
</span><span id="__span-5-189"><a id="__codelineno-5-189" name="__codelineno-5-189" href="#__codelineno-5-189"></a><span class="w">            </span><span class="n">selected_keys</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">selected_keys</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;framewise_displacement&#39;</span><span class="p">}];</span>
</span><span id="__span-5-190"><a id="__codelineno-5-190" name="__codelineno-5-190" href="#__codelineno-5-190"></a><span class="w">        </span><span class="k">end</span>
</span><span id="__span-5-191"><a id="__codelineno-5-191" name="__codelineno-5-191" href="#__codelineno-5-191"></a>
</span><span id="__span-5-192"><a id="__codelineno-5-192" name="__codelineno-5-192" href="#__codelineno-5-192"></a><span class="w">        </span><span class="c">% Retrieve the selected confounds and convert them into a table</span>
</span><span id="__span-5-193"><a id="__codelineno-5-193" name="__codelineno-5-193" href="#__codelineno-5-193"></a><span class="w">        </span><span class="n">confounds_table</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tsv_run</span><span class="p">(:,</span><span class="w"> </span><span class="nb">ismember</span><span class="p">(</span><span class="n">tsv_run</span><span class="p">.</span><span class="n">Properties</span><span class="p">.</span><span class="n">VariableNames</span><span class="p">,</span><span class="w"> </span><span class="n">selected_keys</span><span class="p">));</span>
</span><span id="__span-5-194"><a id="__codelineno-5-194" name="__codelineno-5-194" href="#__codelineno-5-194"></a><span class="w">        </span><span class="n">confounds</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fillmissing</span><span class="p">(</span><span class="n">confounds_table</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;constant&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-5-195"><a id="__codelineno-5-195" name="__codelineno-5-195" href="#__codelineno-5-195"></a><span class="k">end</span>
</span></code></pre></div>
</details>
<div class="admonition note">
<p class="admonition-title">BIDS-Compliant Naming</p>
<p>Ensure the files are saved with names that include:</p>
<ul>
<li><code>sub-xx</code>: subject identifier.</li>
<li><code>run-x</code>: run identifier.</li>
<li><code>confoundsspm</code> or <code>eventsspm</code> for confounds and timings, respectively.</li>
</ul>
</div>
<h3 id="using-the-functions-in-a-script">Using the Functions in a Script<a class="headerlink" href="#using-the-functions-in-a-script" title="Permanent link">&para;</a></h3>
<p>Both <code>eventsBIDS2SPM</code> and <code>fMRIprepConfounds2SPM</code> are MATLAB functions that can be integrated into scripts for batch processing in SPM. This allows you to automate the import of timing and confounds data or save them into SPM-compatible files for later use.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="directly-load-data-into-spm" name="__tabbed_1" type="radio" /><input id="save-spm-compatible-files" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="directly-load-data-into-spm">Directly Load Data into SPM</label><label for="save-spm-compatible-files">Save SPM-Compatible Files</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>You can use these functions within a MATLAB script to load onset times and confounds directly into an SPM batch job. This is useful when you want to process multiple subjects and runs in one go:</p>
<div class="language-matlab highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c">% Example script to use eventsBIDS2SPM and fMRIprepConfounds2SPM in batch jobs</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="n">subject_id</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;sub-01&#39;</span><span class="p">;</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="n">run_id</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;run-01&#39;</span><span class="p">;</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="c">% Paths to the BIDS event and confound files</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="n">tsv_file</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="s">&#39;BIDS&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">subject_id</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;func&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">subject_id</span><span class="w"> </span><span class="s">&#39;_&#39;</span><span class="w"> </span><span class="n">run_id</span><span class="w"> </span><span class="s">&#39;_events.tsv&#39;</span><span class="p">]);</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="n">json_file</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="s">&#39;BIDS&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">subject_id</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;func&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">subject_id</span><span class="w"> </span><span class="s">&#39;_&#39;</span><span class="w"> </span><span class="n">run_id</span><span class="w"> </span><span class="s">&#39;_desc-confounds_timeseries.json&#39;</span><span class="p">]);</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="n">confound_tsv</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="s">&#39;BIDS&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">subject_id</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;func&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">subject_id</span><span class="w"> </span><span class="s">&#39;_&#39;</span><span class="w"> </span><span class="n">run_id</span><span class="w"> </span><span class="s">&#39;_desc-confounds_timeseries.tsv&#39;</span><span class="p">]);</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="c">% Convert event files to SPM-compatible format</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="n">onset_data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">eventsBIDS2SPM</span><span class="p">(</span><span class="n">tsv_file</span><span class="p">);</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="c">% Convert confound files to SPM-compatible format with a chosen pipeline</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="n">pipeline</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;HMP-6&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;GS-1&#39;</span><span class="p">};</span><span class="w"> </span><span class="c">% Example: 6 head motion parameters + 1 global signal</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="n">confound_data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fMRIprepConfounds2SPM</span><span class="p">(</span><span class="n">json_file</span><span class="p">,</span><span class="w"> </span><span class="n">confound_tsv</span><span class="p">,</span><span class="w"> </span><span class="n">pipeline</span><span class="p">);</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="c">% Pass the resulting onset and confound data directly into SPM batch processing</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="n">matlabbatch</span><span class="p">{</span><span class="mi">1</span><span class="p">}.</span><span class="n">spm</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">fmri_spec</span><span class="p">.</span><span class="n">sess</span><span class="p">.</span><span class="n">multi</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="n">onset_data</span><span class="p">};</span>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="n">matlabbatch</span><span class="p">{</span><span class="mi">1</span><span class="p">}.</span><span class="n">spm</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">fmri_spec</span><span class="p">.</span><span class="n">sess</span><span class="p">.</span><span class="n">multi_reg</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="n">confound_data</span><span class="p">};</span>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="c">% Run the SPM batch</span>
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="n">spm_jobman</span><span class="p">(</span><span class="s">&#39;run&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">matlabbatch</span><span class="p">);</span>
</span></code></pre></div>
<p>This script converts the timing and confounds information, then immediately feeds them into an SPM batch, making it suitable for automated batch jobs over multiple runs or subject.</p>
</div>
<div class="tabbed-block">
<p>If you want to save the converted files for later use, you can use the functions to write them into files with BIDS-compliant names. This is helpful if you need to inspect the files or share them with collaborators before running the GLM analysis:</p>
<div class="language-matlab highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c">% Example script to convert and save files in SPM-compatible format</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="n">subject_id</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;sub-01&#39;</span><span class="p">;</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="n">run_id</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;run-01&#39;</span><span class="p">;</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="c">% Paths to the BIDS event and confound files</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="n">tsv_file</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="s">&#39;BIDS&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">subject_id</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;func&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">subject_id</span><span class="w"> </span><span class="s">&#39;_&#39;</span><span class="w"> </span><span class="n">run_id</span><span class="w"> </span><span class="s">&#39;_events.tsv&#39;</span><span class="p">]);</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="n">json_file</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="s">&#39;BIDS&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">subject_id</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;func&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">subject_id</span><span class="w"> </span><span class="s">&#39;_&#39;</span><span class="w"> </span><span class="n">run_id</span><span class="w"> </span><span class="s">&#39;_desc-confounds_timeseries.json&#39;</span><span class="p">]);</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="n">confound_tsv</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="s">&#39;BIDS&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">subject_id</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;func&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">subject_id</span><span class="w"> </span><span class="s">&#39;_&#39;</span><span class="w"> </span><span class="n">run_id</span><span class="w"> </span><span class="s">&#39;_desc-confounds_timeseries.tsv&#39;</span><span class="p">]);</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="c">% Specify output paths</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="n">onset_save_path</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="s">&#39;BIDS&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">subject_id</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;func&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">subject_id</span><span class="w"> </span><span class="s">&#39;_&#39;</span><span class="w"> </span><span class="n">run_id</span><span class="w"> </span><span class="s">&#39;_desc-events.mat&#39;</span><span class="p">]);</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="n">confound_save_path</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="s">&#39;BIDS&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">subject_id</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;func&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">subject_id</span><span class="w"> </span><span class="s">&#39;_&#39;</span><span class="w"> </span><span class="n">run_id</span><span class="w"> </span><span class="s">&#39;_desc-confoundsspm.mat&#39;</span><span class="p">]);</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="c">% Convert and save onset data</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="n">onset_data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">eventsBIDS2SPM</span><span class="p">(</span><span class="n">tsv_file</span><span class="p">);</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="nb">save</span><span class="p">(</span><span class="n">onset_save_path</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;onset_data&#39;</span><span class="p">);</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="c">% Convert and save confound data with a chosen pipeline</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a><span class="n">pipeline</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;HMP-6&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;GS-1&#39;</span><span class="p">};</span><span class="w"> </span><span class="c">% Example: 6 head motion parameters + 1 global signal</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a><span class="n">confound_data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fMRIprepConfounds2SPM</span><span class="p">(</span><span class="n">json_file</span><span class="p">,</span><span class="w"> </span><span class="n">confound_tsv</span><span class="p">,</span><span class="w"> </span><span class="n">pipeline</span><span class="p">);</span>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a><span class="nb">save</span><span class="p">(</span><span class="n">confound_save_path</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;confound_data&#39;</span><span class="p">);</span>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a><span class="c">% Now the onset and confound files can be loaded into SPM as needed.</span>
</span></code></pre></div>
<p>This script allows you to convert the timing and confound data and save them to files with clear, BIDS-compliant names. These files can later be imported into SPM using the GUI or through further scripting.</p>
</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Automating Batch Processing</p>
<p>By integrating these functions into a script, you can automate the entire process of setting up the design matrix for multiple subjects and runs. This approach is particularly useful for large datasets, allowing you to focus on refining the analysis rather than manual data preparation.</p>
</div>
<h3 id="specifying-the-1st-level-model-in-spm">Specifying the 1<sup>st</sup>-Level Model in SPM<a class="headerlink" href="#specifying-the-1st-level-model-in-spm" title="Permanent link">&para;</a></h3>
<p>Once you have your onset times and confound regressors files ready, you can set up the design matrix:</p>
<ol>
<li><strong>Open SPM</strong>: Launch the SPM GUI with <code>spm fmri</code></li>
<li><strong>Specify 1<sup>st</sup>-Level</strong>: Go to <code>Specify 1st Level</code> in the SPM menu.</li>
<li><strong>Set Parameters</strong>:<ul>
<li><strong>Units for design</strong>: Set to <code>seconds</code>.</li>
<li><strong>Interscan interval (TR)</strong>: Use your fMRI acquisition’s TR value.</li>
<li><strong>Microtime resolution</strong>: This should be the number of slices acquired per TR (e.g., <code>64</code> for a 64-slice scan).</li>
</ul>
</li>
<li><strong>Input Onset Files</strong>:<ul>
<li>Use the <em>multiple conditions</em> option to input onset time files (e.g., <code>sub-01_run-01_eventsspm.mat</code>).</li>
</ul>
</li>
<li><strong>Include Confound Regressors</strong>:<ul>
<li>Select the confound regressors from the confound files (e.g., <code>sub-01_run-01_confoundsspm.mat</code>).</li>
</ul>
</li>
</ol>
<h3 id="reviewing-the-design-matrix">Reviewing the Design Matrix<a class="headerlink" href="#reviewing-the-design-matrix" title="Permanent link">&para;</a></h3>
<p>After specifying the design matrix:</p>
<ol>
<li><strong>Click <code>Review</code></strong>: This will open a visualization of the design matrix.</li>
<li><strong>Check for the following</strong>:<ul>
<li>Clear separation between conditions.</li>
<li>Proper alignment of conditions with the expected timing.</li>
<li>Inclusion of nuisance regressors (e.g., head motion).</li>
</ul>
</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">What to Look For</p>
<ul>
<li><strong>Boxcar Patterns</strong>: Ensure that the regressors follow the expected patterns based on your design.</li>
<li><strong>Orthogonality</strong>: Verify that the conditions are not overly correlated, as this can impact the model’s stability.</li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">Saving the Design Matrix</p>
<p>To save the design matrix visualization for documentation:
- Right-click on the matrix plot and select <code>Save as Image</code>.
- Store the image in your documentation folder.</p>
</div>
<hr />
<h2 id="step-3-model-estimation-results">Step 3: Model Estimation &amp; Results<a class="headerlink" href="#step-3-model-estimation-results" title="Permanent link">&para;</a></h2>
<p>With your design matrix ready, you can estimate the model and define contrasts to test your hypotheses. This step will produce the beta values and residuals necessary for further analysis.</p>
<h3 id="estimating-the-model">Estimating the Model<a class="headerlink" href="#estimating-the-model" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Review the Design Matrix</strong>: Before estimation, ensure the design matrix looks correct by clicking <code>Review</code>.</li>
<li>
<p><strong>Estimate the Model</strong>: Select <code>Estimate</code> in the GUI and choose the <code>SPM.mat</code> file.</p>
<ul>
<li>Set <code>write residuals</code> to <code>yes</code> to save residual images.</li>
<li>
<p>Click <code>Run</code> to initiate the model estimation.</p>
</li>
<li>
<p>This process will generate beta images (one per regressor) and residual variance estimates.</p>
</li>
</ul>
</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Why Save Residuals?</p>
<p>Saving residuals can help diagnose issues with model fit by checking for any systematic patterns in the residual images.</p>
</div>
<h3 id="defining-and-evaluating-contrasts">Defining and Evaluating Contrasts<a class="headerlink" href="#defining-and-evaluating-contrasts" title="Permanent link">&para;</a></h3>
<p>Contrasts allow you to test specific hypotheses about the brain's response to different conditions, such as comparing activations between different task conditions or testing against a baseline.</p>
<ol>
<li>
<p><strong>Define New Contrasts</strong>:</p>
<ul>
<li>Go to <code>Results</code> &gt; <code>Define New Contrast</code>.</li>
<li>Enter a name for the contrast (e.g., <code>Condition1 &gt; Condition2</code>).</li>
<li>Specify the weights for each condition based on the order of the regressors (e.g., <code>[1 -1]</code>).</li>
</ul>
</li>
<li>
<p><strong>Evaluate the Contrasts</strong>:</p>
<ul>
<li>After defining contrasts, set the desired threshold (e.g., <code>p &lt; 0.001</code>) and click <code>Run</code> to see the results.</li>
<li>Review the statistical maps for significant clusters or activations.</li>
</ul>
</li>
</ol>
<div class="admonition example">
<p class="admonition-title">Example Contrast</p>
<p>For a comparison between two conditions (e.g., <code>Faces</code> vs. <code>Objects</code>), use:
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>[1 -1]
</span></code></pre></div>
This weights <code>Faces</code> positively and <code>Objects</code> negatively, highlighting brain regions more active during the <code>Faces</code> condition.</p>
</div>
<hr />
<h3 id="verifying-the-order-of-regressors">Verifying the Order of Regressors<a class="headerlink" href="#verifying-the-order-of-regressors" title="Permanent link">&para;</a></h3>
<p>It’s crucial to confirm the order of regressors in the design matrix before specifying contrasts to ensure that your weights align correctly with the conditions. Here’s how to verify this using both the SPM GUI and by inspecting the <code>SPM.mat</code> file directly.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="option-1-checking-regressor-order-using-the-spm-gui" name="__tabbed_2" type="radio" /><input id="option-2-inspecting-the-spmmat-file-directly" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="option-1-checking-regressor-order-using-the-spm-gui">Option 1: Checking Regressor Order Using the SPM GUI</label><label for="option-2-inspecting-the-spmmat-file-directly">Option 2: Inspecting the <code>SPM.mat</code> File Directly</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ol>
<li>
<p><strong>Review the Design Matrix</strong>:</p>
<ul>
<li>Open SPM and select <code>Review</code> &gt; <code>SPM.mat</code>.</li>
<li>This opens the design matrix in a new window.</li>
<li>In the design matrix window, each column represents a different regressor (condition or nuisance variable).</li>
</ul>
</li>
<li>
<p><strong>Interpret the Design Matrix</strong>:</p>
<ul>
<li>Hover over each column to see the name and description of the regressor.</li>
<li>Typically, the first set of columns corresponds to your experimental conditions (e.g., <code>Faces</code>, <code>Objects</code>), followed by any nuisance regressors (e.g., motion parameters).</li>
<li>Make a note of the order so that you can set your contrast weights accurately.</li>
</ul>
</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Use the Design Matrix Visualization</p>
<p>The design matrix visualization provides a graphical representation of each regressor. Patterns in the design matrix (e.g., boxcar shapes for task conditions) can help you verify the expected structure.</p>
</div>
</div>
<div class="tabbed-block">
<ol>
<li>
<p><strong>Load the <code>SPM.mat</code> File in MATLAB</strong>:</p>
<p>In the MATLAB command window, navigate to the folder containing your <code>SPM.mat</code> file:
 <div class="language-matlab highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nb">cd</span><span class="p">(</span><span class="s">&#39;/path/to/your/SPM_results_folder&#39;</span><span class="p">);</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="nb">load</span><span class="p">(</span><span class="s">&#39;SPM.mat&#39;</span><span class="p">);</span>
</span></code></pre></div>
This loads the <code>SPM</code> structure into your workspace.</p>
</li>
<li>
<p><strong>Explore the Regressors</strong>:</p>
<p>To see the names of the regressors, type:
 <div class="language-matlab highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">SPM</span><span class="p">.</span><span class="n">xX</span><span class="p">.</span><span class="n">name</span>
</span></code></pre></div>
This command will display a list of the regressor names in the order they appear in the design matrix.</p>
</li>
<li>
<p><strong>Interpret the Output</strong>:</p>
<p>The output will look something like this:
 <div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>&#39;Sn(1) condition1*bf(1)&#39;
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>&#39;Sn(1) condition2*bf(1)&#39;
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>&#39;Sn(1) condition3*bf(1)&#39;
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>&#39;Sn(1) motion_x&#39;
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>&#39;Sn(1) motion_y&#39;
</span></code></pre></div>
Each string corresponds to a regressor:</p>
<ul>
<li><code>Sn(1)</code>: Refers to session 1 (the run number).</li>
<li><code>condition1*bf(1)</code>: Represents a condition convolved with the basis function (e.g., <code>Faces</code>).</li>
<li><code>motion_x</code>, <code>motion_y</code>, etc.: These are motion parameters as nuisance regressors.</li>
</ul>
</li>
<li>
<p><strong>Align the Contrast Weights</strong>:</p>
<p>Based on this order, you can now set your contrast weights correctly. For instance, if <code>condition1</code> is the first regressor and <code>condition2</code> is the second, a contrast comparing them would be:
 <div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>[1 -1 0 0 0 ...]
</span></code></pre></div></p>
</li>
</ol>
<div class="admonition example">
<p class="admonition-title">Checking Regressors in a Script</p>
<p>If you are scripting the process, you can automate this check by including:
<div class="language-matlab highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c">% Load the design matrix and display regressor names</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="nb">load</span><span class="p">(</span><span class="s">&#39;SPM.mat&#39;</span><span class="p">);</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="nb">disp</span><span class="p">(</span><span class="n">SPM</span><span class="p">.</span><span class="n">xX</span><span class="p">.</span><span class="n">name</span><span class="p">);</span>
</span></code></pre></div>
This will print the regressor names directly in the MATLAB command window, helping you confirm the correct order before specifying your contrasts.</p>
</div>
</div>
</div>
</div>
<div class="admonition question">
<p class="admonition-title">Why Checking Regressor Order Matters?</p>
<ul>
<li><strong>Ensures Correct Contrast Specification</strong>: Mismatched contrasts can lead to incorrect interpretations of your data, as they might test unintended comparisons.</li>
<li><strong>Simplifies Troubleshooting</strong>: If the results look unexpected, double-checking the regressor order is one of the first steps to identify potential issues in the GLM setup.</li>
<li><strong>Consistency Across Sessions</strong>: If you’re analyzing multiple runs or sessions, verifying regressor order ensures consistency across sessions, which is crucial for second-level analyses.</li>
</ul>
</div>
<h3 id="visualizing-and-saving-results">Visualizing and Saving Results<a class="headerlink" href="#visualizing-and-saving-results" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Viewing Results</strong>: Use the SPM results viewer to explore significant clusters.</li>
<li><strong>Save the Statistical Maps</strong>:<ul>
<li>Save thresholded activation maps as <code>.nii</code> files using the <code>Save</code> button in the results window.</li>
</ul>
</li>
<li><strong>Generate Figures</strong>:<ul>
<li>Use the <code>Render</code> or <code>Surface</code> options to create visual summaries of your findings.</li>
<li>Save these figures for inclusion in reports or presentations.</li>
</ul>
</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Exporting Images</p>
<p>To include figures in publications or reports:
- Use <code>Export</code> in SPM to save figures as high-resolution images.
- For 3D brain renderings, adjust the orientation and threshold for a clear presentation.</p>
</div>
<hr />
<p>Continue to the next guide for instructions on setting up Regions of Interest (ROIs) to extract and analyze data from specific brain regions:
<a href="fmri-rois.html">&rarr; Regions of Interest</a></p>
<hr />
<ul>
<li><strong>[TODO]:</strong> Add example directories showing how files are organized before and after preprocessing.</li>
<li><strong>[TODO]:</strong> Include screenshots or illustrations for key steps (e.g., setting up the design matrix in SPM).</li>
<li><strong>[PLACEHOLDER]:</strong> Add a screenshot of the SPM results interface to illustrate how to set thresholds.</li>
<li><strong>[TODO]:</strong> Include instructions on visualizing and saving the design matrix in SPM for documentation.</li>
</ul>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">October 20, 2024 01:17:23</span>
  </span>

    
    
    
      
  
  <span class="md-source-file__fact">
    <span class="md-icon" title="Contributors">
      
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 5.5A3.5 3.5 0 0 1 15.5 9a3.5 3.5 0 0 1-3.5 3.5A3.5 3.5 0 0 1 8.5 9 3.5 3.5 0 0 1 12 5.5M5 8c.56 0 1.08.15 1.53.42-.15 1.43.27 2.85 1.13 3.96C7.16 13.34 6.16 14 5 14a3 3 0 0 1-3-3 3 3 0 0 1 3-3m14 0a3 3 0 0 1 3 3 3 3 0 0 1-3 3c-1.16 0-2.16-.66-2.66-1.62a5.54 5.54 0 0 0 1.13-3.96c.45-.27.97-.42 1.53-.42M5.5 18.25c0-2.07 2.91-3.75 6.5-3.75s6.5 1.68 6.5 3.75V20h-13zM0 20v-1.5c0-1.39 1.89-2.56 4.45-2.9-.59.68-.95 1.62-.95 2.65V20zm24 0h-3.5v-1.75c0-1.03-.36-1.97-.95-2.65 2.56.34 4.45 1.51 4.45 2.9z"/></svg>
      
    </span>
    <nav>
      
        <a href="mailto:61991543+timmaniquet@users.noreply.github.com">Tim Maniquet</a>, 
        <a href="mailto:59078281+costantinoai@users.noreply.github.com">costantinoai</a>
    </nav>
  </span>

    
    
  </aside>


  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        Was this page helpful?
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page was helpful" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page could be improved" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              Thanks for your feedback!
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              Thanks for your feedback! Help us improve this page by opening a new <a href="https://github.com/HOPLAB-LBP/hoplab-wiki/issues/new/?title=[Feedback]+4.%20First-level%20analysis+-+/research/fmri/analysis/fmri-glm.html" target="_blank" rel="noopener">Issue</a>, or contact a Wiki manager.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      <a href="#__consent">Change cookie settings</a>            
    

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  


  
    
  



  


<h4>Cookie consent</h4>
<p>Please, consider disabling your ad-blocker and allowing cookies for this Wiki .  We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="github" checked>
          <span class="task-list-indicator"></span>
          GitHub
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.tabs.link", "content.code.copy", "content.code.select", "content.action.edit", "navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.sections", "search.highlight", "navigation.indexes"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="../../../assets/external/unpkg.com/mermaid@11/dist/mermaid.min.js"></script>
      
    
  </body>
</html>