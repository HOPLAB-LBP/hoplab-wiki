
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="analysis/fmri-andrea-workflow.html">
      
      
        <link rel="next" href="fmri-hpc.html">
      
      
      <link rel="icon" href="../../assets/hoplab_favicon_white.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>Meta-analysis with NiMARE - Hoplab Wiki</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
        <script src="https://unpkg.com/iframe-worker/shim"></script>
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-71T36SYGT2"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-71T36SYGT2",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-71T36SYGT2",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#nimare-meta-analysis" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../index.html" title="Hoplab Wiki" class="md-header__button md-logo" aria-label="Hoplab Wiki" data-md-component="logo">
      
  <img src="../../assets/thicker_white_brain.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Hoplab Wiki
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Meta-analysis with NiMARE
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/HOPLAB-LBP/hoplab-wiki/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    HOPLAB-LBP/hoplab-wiki
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html" class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../get-started/index.html" class="md-tabs__link">
          
  
  
    
  
  Getting started

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../index.html" class="md-tabs__link">
          
  
  
    
  
  Research

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../outreach.html" class="md-tabs__link">
        
  
  
    
  
  Science outreach

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../contribute.html" class="md-tabs__link">
        
  
  
    
  
  Contribute

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="Hoplab Wiki" class="md-nav__button md-logo" aria-label="Hoplab Wiki" data-md-component="logo">
      
  <img src="../../assets/thicker_white_brain.svg" alt="logo">

    </a>
    Hoplab Wiki
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/HOPLAB-LBP/hoplab-wiki/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    HOPLAB-LBP/hoplab-wiki
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../get-started/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../get-started/useful-links.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Useful links
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../get-started/mailing-lists.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mailing lists
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../get-started/practical-setup.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Practical set-up
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../get-started/computer-setup.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Computer set-up
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../get-started/admin-procedures.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Administrative procedures
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../get-started/student-starter-pack.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Student starter pack
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Research
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Research
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../ethics/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Ethical approval
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_2" id="__nav_3_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Ethical approval
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ethics/MEC.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    EC onderzoek
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ethics/SMEC.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SMEC
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../coding/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Coding practices
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Coding practices
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../behaviour/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Behaviour
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_4" id="__nav_3_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Behaviour
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../behaviour/bh-participants.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Find participants
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../behaviour/experimental-setup/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Set up your experiment
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_4_3" id="__nav_3_4_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_3">
            <span class="md-nav__icon md-icon"></span>
            Set up your experiment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../behaviour/experimental-setup/pavlovia-jspsych.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Online Experiments (jsPsych)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../behaviour/experimental-setup/pavlovia-psychopy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Online Experiments (PsychoPy)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../behaviour/experimental-setup/bh-onsite.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    On-site Experiments
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../behaviour/bh-tasks.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Behavioural tasks
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    fMRI
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_5" id="__nav_3_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            fMRI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-get-started.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    First steps
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-procedure.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Scanning procedure and info
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="analysis/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Analysis workflow
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_5_4" id="__nav_3_5_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5_4">
            <span class="md-nav__icon md-icon"></span>
            Analysis workflow
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="analysis/fmri-general.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0. General information
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="analysis/fmri-setup-env.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1. Set-up you environment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="analysis/fmri-bids-conversion.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2. BIDS conversion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="analysis/fmri-prepocessing-qa.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3. Pre-processing and QA
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="analysis/fmri-glm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4a. First-level analysis - GUI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="analysis/fmri-glm-script.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4b. First-level analysis - Scripting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="analysis/fmri-rois.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5. Regions of interest
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="analysis/fmri-mvpa.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6. Multi-variate analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="analysis/fmri-andrea-workflow.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fMRI workflow example
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Meta-analysis with NiMARE
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="fmri-nimare.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Meta-analysis with NiMARE
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-importing-necessary-packages" class="md-nav__link">
    <span class="md-ellipsis">
      1. Importing Necessary Packages
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-downloading-the-neurosynth-database" class="md-nav__link">
    <span class="md-ellipsis">
      2. Downloading the Neurosynth Database
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-converting-downloaded-neurosynth-data-into-a-nimare-compatible-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      3. Converting Downloaded Neurosynth Data into a NiMARE-Compatible Dataset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-creating-a-subset-of-data" class="md-nav__link">
    <span class="md-ellipsis">
      4. Creating a Subset of Data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-running-meta-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      5. Running Meta-Analysis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-extracting-peak-activation-coordinates" class="md-nav__link">
    <span class="md-ellipsis">
      6. Extracting Peak Activation Coordinates
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#full-code-example" class="md-nav__link">
    <span class="md-ellipsis">
      Full code example
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fmri-hpc.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fMRIprep on HPC
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../eeg/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    EEG
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_6" id="__nav_3_6_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            EEG
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../eeg/eeg-acquisition.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data acquisition
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../dnn/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Neural Networks
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            Neural Networks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../outreach.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Science outreach
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contribute.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contribute
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-importing-necessary-packages" class="md-nav__link">
    <span class="md-ellipsis">
      1. Importing Necessary Packages
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-downloading-the-neurosynth-database" class="md-nav__link">
    <span class="md-ellipsis">
      2. Downloading the Neurosynth Database
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-converting-downloaded-neurosynth-data-into-a-nimare-compatible-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      3. Converting Downloaded Neurosynth Data into a NiMARE-Compatible Dataset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-creating-a-subset-of-data" class="md-nav__link">
    <span class="md-ellipsis">
      4. Creating a Subset of Data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-running-meta-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      5. Running Meta-Analysis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-extracting-peak-activation-coordinates" class="md-nav__link">
    <span class="md-ellipsis">
      6. Extracting Peak Activation Coordinates
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#full-code-example" class="md-nav__link">
    <span class="md-ellipsis">
      Full code example
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/HOPLAB-LBP/hoplab-wiki/edit/main/docs/research/fmri/fmri-nimare.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="nimare-meta-analysis">NiMARE Meta-Analysis<a class="headerlink" href="#nimare-meta-analysis" title="Permanent link">&para;</a></h1>
<p>This guide demonstrates how to <strong>download and process the Neurosynth database using NiMARE</strong>, a Python-based framework designed for neuroimaging meta-analyses.</p>
<p>This step-by-step tutorial covers downloading the Neurosynth data, converting it into a NiMARE-compatible dataset, enriching it with article abstracts, filtering studies based on specific criteria, and performing custom meta-analyses.</p>
<p>Before starting, ensure NiMARE and required <strong>dependencies</strong> are installed in your environment:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>pip<span class="w"> </span>install<span class="w"> </span>numpy<span class="w"> </span>pandas<span class="w"> </span>pprint<span class="w"> </span>scipy<span class="w"> </span>nimare<span class="w"> </span>biopython<span class="w"> </span>nibabel<span class="w"> </span>nilearn
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Before starting a new project, make sure you set up your environment correctly. Each project should have its own dedicated environment. Please, follow the instructions provided in <a href="analysis/fmri-setup-env.html#python-and-conda">this</a> and <a href="../coding/index.html#setting-up-a-conda-environment">this</a> section.</p>
</div>
<hr />
<h2 id="1-importing-necessary-packages">1. Importing Necessary Packages<a class="headerlink" href="#1-importing-necessary-packages" title="Permanent link">&para;</a></h2>
<p>Begin by <strong>importing all necessary libraries</strong> required throughout the script. These libraries are essential for downloading data, processing datasets, running analyses, and visualizing results.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># --- Step 1: Import All Necessary Packages ---</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">norm</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">nimare.dataset</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dataset</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">nimare.extract</span><span class="w"> </span><span class="kn">import</span> <span class="n">download_abstracts</span><span class="p">,</span> <span class="n">fetch_neurosynth</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="kn">from</span><span class="w"> </span><span class="nn">nimare.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">convert_neurosynth_to_dataset</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">nimare.meta.cbma.ale</span><span class="w"> </span><span class="kn">import</span> <span class="n">ALE</span>  <span class="c1"># ALE algorithm for meta-analysis</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="kn">from</span><span class="w"> </span><span class="nn">nimare.correct</span><span class="w"> </span><span class="kn">import</span> <span class="n">FWECorrector</span>  <span class="c1"># Family-wise error correction</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pprint</span><span class="w"> </span><span class="kn">import</span> <span class="n">pprint</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="kn">from</span><span class="w"> </span><span class="nn">nilearn.plotting</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_stat_map</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="kn">from</span><span class="w"> </span><span class="nn">nilearn</span><span class="w"> </span><span class="kn">import</span> <span class="n">datasets</span>  <span class="c1"># Neuroimaging datasets</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="kn">from</span><span class="w"> </span><span class="nn">nilearn.reporting</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_clusters_table</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="kn">import</span><span class="w"> </span><span class="nn">nibabel</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nib</span>
</span></code></pre></div>
<hr />
<hr />
<h2 id="2-downloading-the-neurosynth-database">2. Downloading the Neurosynth Database<a class="headerlink" href="#2-downloading-the-neurosynth-database" title="Permanent link">&para;</a></h2>
<p>In this section, weâ€™ll create an output directory where the downloaded Neurosynth data will be stored. The NiMARE function <code>fetch_neurosynth</code> is used to download the data.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Ensure that you replace the path in <code>out_dir</code> with one that matches your own directory structure.</p>
</div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1"># --- Step 2: Downloading the Neurosynth Database ---</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="c1"># Set the output directory for storing downloaded Neurosynth data</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="c1"># Make sure to change this to a directory path on your own machine</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="n">out_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;./nimare_data&quot;</span><span class="p">)</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Create the directory if it doesn&#39;t already exist</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="c1"># Download Neurosynth data using NiMAREâ€™s `fetch_neurosynth` function</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="c1"># Set version to the latest available (version &quot;7&quot; as of October 2024)</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="n">files</span> <span class="o">=</span> <span class="n">fetch_neurosynth</span><span class="p">(</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>    <span class="n">data_dir</span><span class="o">=</span><span class="n">out_dir</span><span class="p">,</span>  <span class="c1"># Specify directory to save data</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>    <span class="n">version</span><span class="o">=</span><span class="s2">&quot;7&quot;</span><span class="p">,</span>  <span class="c1"># Neurosynth data version to download</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>    <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Set to True to re-download data if it already exists</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>    <span class="n">source</span><span class="o">=</span><span class="s2">&quot;abstract&quot;</span><span class="p">,</span>  <span class="c1"># Use article abstracts as the source</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>    <span class="n">vocab</span><span class="o">=</span><span class="s2">&quot;terms&quot;</span><span class="p">,</span>  <span class="c1"># Use &quot;terms&quot; as the vocabulary type</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="p">)</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="n">files</span> <span class="o">=</span> <span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="c1"># Print details of the downloaded files to understand the data structure</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="n">pprint</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
</span></code></pre></div>
<p>The <code>pprint</code> command should output something like this:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>pprint<span class="o">(</span>files<span class="o">)</span><span class="w">  </span><span class="c1"># Display information about the downloaded files</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="o">{</span><span class="s1">&#39;coordinates&#39;</span>:<span class="w"> </span><span class="s1">&#39;./nimare_data/neurosynth/data-neurosynth_version-7_coordinates.tsv.gz&#39;</span>,
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w"> </span><span class="s1">&#39;features&#39;</span>:<span class="w"> </span><span class="o">[{</span><span class="s1">&#39;features&#39;</span>:<span class="w"> </span><span class="s1">&#39;./nimare_data/neurosynth/data-neurosynth_version-7_vocab-terms_source-abstract_type-tfidf_features.npz&#39;</span>,
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">               </span><span class="s1">&#39;vocabulary&#39;</span>:<span class="w"> </span><span class="s1">&#39;./nimare_data/neurosynth/data-neurosynth_version-7_vocab-terms_vocabulary.txt&#39;</span><span class="o">}]</span>,
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w"> </span><span class="s1">&#39;metadata&#39;</span>:<span class="w"> </span><span class="s1">&#39;./nimare_data/neurosynth/data-neurosynth_version-7_metadata.tsv.gz&#39;</span><span class="o">}</span>
</span></code></pre></div>
<hr />
<h2 id="3-converting-downloaded-neurosynth-data-into-a-nimare-compatible-dataset">3. Converting Downloaded Neurosynth Data into a NiMARE-Compatible Dataset<a class="headerlink" href="#3-converting-downloaded-neurosynth-data-into-a-nimare-compatible-dataset" title="Permanent link">&para;</a></h2>
<p>Once Neurosynth data is downloaded, we convert it to NiMAREâ€™s dataset format for easier manipulation and analysis. Weâ€™ll then add abstracts to this dataset using study PMIDs.</p>
<ol>
<li><strong>Define the path for saving the dataset</strong>.</li>
<li><strong>Convert the data</strong> using <code>convert_neurosynth_to_dataset</code>.</li>
<li><strong>Add article abstracts</strong> with <code>download_abstracts</code>.</li>
</ol>
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># --- Step 3: Converting Neurosynth Data to a NiMARE-Compatible Dataset ---</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="c1"># Define the path for the NiMARE-compatible dataset file</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="n">dataset_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;neurosynth_dataset.pkl.gz&quot;</span><span class="p">)</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="c1"># Convert and save Neurosynth data to NiMARE dataset format if it doesnâ€™t already exist</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">):</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>    <span class="n">neurosynth_dset</span> <span class="o">=</span> <span class="n">convert_neurosynth_to_dataset</span><span class="p">(</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>        <span class="n">coordinates_file</span><span class="o">=</span><span class="n">files</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">],</span>  <span class="c1"># Path to Neurosynth coordinates</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>        <span class="n">metadata_file</span><span class="o">=</span><span class="n">files</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">],</span>  <span class="c1"># Path to metadata file</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>        <span class="n">annotations_files</span><span class="o">=</span><span class="n">files</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">],</span>  <span class="c1"># Path to feature files</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>        <span class="n">target</span><span class="o">=</span><span class="s2">&quot;mni152_2mm&quot;</span><span class="p">,</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>    <span class="p">)</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>    <span class="n">neurosynth_dset</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">)</span>  <span class="c1"># Save the converted dataset</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset saved to: </span><span class="si">{</span><span class="n">dataset_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="k">else</span><span class="p">:</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>    <span class="n">neurosynth_dset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>        <span class="n">dataset_path</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>    <span class="p">)</span>  <span class="c1"># Load existing dataset if already created</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset loaded from: </span><span class="si">{</span><span class="n">dataset_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="c1"># Define path for saving the dataset with abstracts</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="n">abstracts_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;neurosynth_dataset_with_abstracts.pkl.gz&quot;</span><span class="p">)</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="c1"># Download and add abstracts to the dataset if it doesnâ€™t already include them</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">abstracts_path</span><span class="p">):</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a>    <span class="c1"># Note: Replace &quot;example@example.edu&quot; with your email address for access to PubMed</span>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a>    <span class="n">neurosynth_dset</span> <span class="o">=</span> <span class="n">download_abstracts</span><span class="p">(</span><span class="n">neurosynth_dset</span><span class="p">,</span> <span class="s2">&quot;example@example.edu&quot;</span><span class="p">)</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a>    <span class="n">neurosynth_dset</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">abstracts_path</span><span class="p">)</span>  <span class="c1"># Save dataset with abstracts</span>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset with abstracts saved to: </span><span class="si">{</span><span class="n">abstracts_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a><span class="k">else</span><span class="p">:</span>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a>    <span class="n">neurosynth_dset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a>        <span class="n">abstracts_path</span>
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a>    <span class="p">)</span>  <span class="c1"># Load dataset with abstracts if already created</span>
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset with abstracts loaded from: </span><span class="si">{</span><span class="n">abstracts_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-4-36"><a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a>
</span><span id="__span-4-37"><a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a><span class="c1"># Verify dataset by printing a sample of the abstracts and counting entries</span>
</span><span id="__span-4-38"><a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a><span class="n">pprint</span><span class="p">(</span><span class="n">neurosynth_dset</span><span class="o">.</span><span class="n">texts</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>  <span class="c1"># Display the first few entries of abstracts</span>
</span><span id="__span-4-39"><a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of abstracts: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">neurosynth_dset</span><span class="o">.</span><span class="n">texts</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></code></pre></div>
<hr />
<h2 id="4-creating-a-subset-of-data">4. Creating a Subset of Data<a class="headerlink" href="#4-creating-a-subset-of-data" title="Permanent link">&para;</a></h2>
<p>The NiMARE dataset allows data manipulation to create subsets that meet specific requirements. This enables running <strong>custom meta-analyses on targeted data</strong>. You can, for instance, retrieve studies based on specific MNI coordinates, labels (included as features in the Neurosynth database), or search abstracts using specific keywords.</p>
<p>The following code example demonstrates how to <strong>search for abstracts containing specific keywords</strong>.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1"># --- Step 4: Creating a Subset of Data ---</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="c1"># Define a function to search abstracts for specific keywords, which helps create a filtered subset</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">search_abstracts</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">keywords</span><span class="p">):</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="sd">    Search for abstracts containing specified keywords.</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="sd">    Parameters:</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="sd">    - dataset (NiMARE Dataset): Dataset with abstracts.</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="sd">    - keywords (list of str): Keywords to search for in abstracts.</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="sd">    Returns:</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="sd">    - list of str: Study IDs of abstracts containing specified keywords.</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>    <span class="n">keyword_ids</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Initialize list for storing IDs of matching studies</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>    <span class="n">abstracts</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">get_texts</span><span class="p">(</span><span class="n">text_type</span><span class="o">=</span><span class="s2">&quot;abstract&quot;</span><span class="p">)</span>  <span class="c1"># Retrieve abstracts</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>    <span class="n">study_ids</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>  <span class="c1"># Retrieve study IDs for each abstract</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">abstract</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">abstracts</span><span class="p">):</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>            <span class="c1"># Check if abstract is a string and contains any keyword</span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">abstract</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>                <span class="n">keyword</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">abstract</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">keywords</span>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a>            <span class="p">):</span>
</span><span id="__span-5-25"><a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a>                <span class="n">study_id</span> <span class="o">=</span> <span class="n">study_ids</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>  <span class="c1"># Get corresponding study ID</span>
</span><span id="__span-5-26"><a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a>                <span class="n">keyword_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">study_id</span><span class="p">)</span>  <span class="c1"># Add matching study ID to list</span>
</span><span id="__span-5-27"><a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-5-28"><a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a>            <span class="c1"># Print error details if an exception occurs</span>
</span><span id="__span-5-29"><a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing abstract ID </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-5-30"><a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Abstract content (partial): </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">abstract</span><span class="p">)[:</span><span class="mi">100</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</span><span id="__span-5-31"><a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Skipping this abstract.&quot;</span><span class="p">)</span>
</span><span id="__span-5-32"><a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a>
</span><span id="__span-5-33"><a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a>    <span class="k">return</span> <span class="n">keyword_ids</span>
</span><span id="__span-5-34"><a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a>
</span><span id="__span-5-35"><a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a><span class="c1"># Define keywords to search for in the abstracts</span>
</span><span id="__span-5-36"><a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a><span class="n">keywords</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;face recognition&quot;</span><span class="p">]</span>
</span><span id="__span-5-37"><a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a>
</span><span id="__span-5-38"><a id="__codelineno-5-38" name="__codelineno-5-38" href="#__codelineno-5-38"></a><span class="c1"># Execute the search function and print matching study IDs</span>
</span><span id="__span-5-39"><a id="__codelineno-5-39" name="__codelineno-5-39" href="#__codelineno-5-39"></a><span class="n">matching_ids</span> <span class="o">=</span> <span class="n">search_abstracts</span><span class="p">(</span><span class="n">neurosynth_dset</span><span class="p">,</span> <span class="n">keywords</span><span class="p">)</span>
</span><span id="__span-5-40"><a id="__codelineno-5-40" name="__codelineno-5-40" href="#__codelineno-5-40"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of abstracts containing </span><span class="si">{</span><span class="n">keywords</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">matching_ids</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-5-41"><a id="__codelineno-5-41" name="__codelineno-5-41" href="#__codelineno-5-41"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;IDs of matching abstracts: </span><span class="si">{</span><span class="n">matching_ids</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-5-42"><a id="__codelineno-5-42" name="__codelineno-5-42" href="#__codelineno-5-42"></a>
</span><span id="__span-5-43"><a id="__codelineno-5-43" name="__codelineno-5-43" href="#__codelineno-5-43"></a><span class="c1"># Filter dataset to include only studies with keywords in abstracts</span>
</span><span id="__span-5-44"><a id="__codelineno-5-44" name="__codelineno-5-44" href="#__codelineno-5-44"></a><span class="n">dset_filtered_by_abstract</span> <span class="o">=</span> <span class="n">neurosynth_dset</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span>
</span><span id="__span-5-45"><a id="__codelineno-5-45" name="__codelineno-5-45" href="#__codelineno-5-45"></a>    <span class="n">matching_ids</span>
</span><span id="__span-5-46"><a id="__codelineno-5-46" name="__codelineno-5-46" href="#__codelineno-5-46"></a><span class="p">)</span>  <span class="c1"># Keep only selected studies</span>
</span><span id="__span-5-47"><a id="__codelineno-5-47" name="__codelineno-5-47" href="#__codelineno-5-47"></a><span class="n">pprint</span><span class="p">(</span><span class="n">dset_filtered_by_abstract</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>  <span class="c1"># Verify metadata of the filtered dataset</span>
</span></code></pre></div>
<hr />
<h2 id="5-running-meta-analysis">5. Running Meta-Analysis<a class="headerlink" href="#5-running-meta-analysis" title="Permanent link">&para;</a></h2>
<p>With the filtered studies, we can now perform meta-analyses using algorithms available in NiMARE.</p>
<ol>
<li>
<p><strong>Available algorithms</strong>:</p>
<ul>
<li><strong>ALE</strong>: Identifies regions where studies converge on activation with a probabilistic approach.</li>
<li><strong>MKDA</strong>: Focuses on the consistency of findings across studies, considering dispersed activations.</li>
</ul>
</li>
<li>
<p><strong>Correction methods</strong>:</p>
<ul>
<li><strong>FDR</strong>: Controls for expected false positives across rejected hypotheses.</li>
<li><strong>FWER (Bonferroni)</strong>: Controls for a single false positive but is highly conservative.</li>
<li><strong>FWER (Monte Carlo)</strong>: Suitable for spatially dependent data and ideal for whole-brain analyses.</li>
</ul>
</li>
</ol>
<p>The following code exmple shows how to run an ALE meta-analysis with Monte Carlo correction</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1"># --- Step 5: Running Meta-Analysis ---</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="c1"># Create dir to store cache (useful for low memory)</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="n">cache_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;cache&quot;</span><span class="p">)</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">):</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">)</span> <span class="c1"># Delete the old cache folder if it exists</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="c1"># Set up the ALE meta-analysis algorithm for activation likelihood estimation</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="n">ale</span> <span class="o">=</span> <span class="n">ALE</span><span class="p">(</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>    <span class="n">kernel__sample_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>    <span class="n">memory</span><span class="o">=</span><span class="n">cache_dir</span><span class="p">,</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>    <span class="n">n_cores</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>    <span class="n">memory_level</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="p">)</span>  <span class="c1"># Set sample size to control for experiment variability</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="n">ale_results</span> <span class="o">=</span> <span class="n">ale</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dset_filtered_by_abstract</span><span class="p">)</span>  <span class="c1"># Run ALE on the filtered dataset</span>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="c1"># Apply Monte Carlo correction to the ALE results to control for family-wise error</span>
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="n">corr</span> <span class="o">=</span> <span class="n">FWECorrector</span><span class="p">(</span>
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;montecarlo&quot;</span><span class="p">,</span> <span class="n">n_iters</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">n_cores</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">voxel_thresh</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">vfwe_only</span><span class="o">=</span><span class="kc">True</span>
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a><span class="p">)</span>  <span class="c1"># Set up Monte Carlo correction, 10k iterations for publication level</span>
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a><span class="n">cres</span> <span class="o">=</span> <span class="n">corr</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">ale_results</span><span class="p">)</span>  <span class="c1"># Apply correction</span>
</span><span id="__span-6-25"><a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>
</span><span id="__span-6-26"><a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a><span class="c1"># Save corrected maps, such as z-scores and p-values, to the output directory</span>
</span><span id="__span-6-27"><a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a><span class="n">cres</span><span class="o">.</span><span class="n">save_maps</span><span class="p">(</span><span class="s2">&quot;./nimare_data&quot;</span><span class="p">)</span>  <span class="c1"># Save results in the specified directory</span>
</span></code></pre></div>
<hr />
<h2 id="6-extracting-peak-activation-coordinates">6. Extracting Peak Activation Coordinates<a class="headerlink" href="#6-extracting-peak-activation-coordinates" title="Permanent link">&para;</a></h2>
<p>The results of the meta-analysis can now be used for further analysis and reporting, such as <strong>plotting</strong> and extracting the <strong>ROIs names</strong> at the clusters peak activations.</p>
<p>This can be done for the uncorrected z maps, or for the Montecarlo corrected ones.</p>
<p>To plot the maps:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1"># --- Step 6: Plot Peak Activation Coordinates in MNI ---</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="c1"># Get z-statistics map</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="n">z_img</span> <span class="o">=</span> <span class="n">cres</span><span class="o">.</span><span class="n">get_map</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">)</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="n">stat_threshold</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">isf</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="n">plot_stat_map</span><span class="p">(</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>    <span class="n">z_img</span><span class="p">,</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>    <span class="n">display_mode</span><span class="o">=</span><span class="s2">&quot;mosaic&quot;</span><span class="p">,</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>    <span class="n">draw_cross</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu_r&quot;</span><span class="p">,</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>    <span class="n">symmetric_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>    <span class="n">threshold</span><span class="o">=</span><span class="n">stat_threshold</span><span class="p">,</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Uncorrected z maps (p&lt;.001)&quot;</span><span class="p">,</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="p">)</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="c1"># Get FWE-corrected z-statistics map</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="n">z_corr_img</span> <span class="o">=</span> <span class="n">cres</span><span class="o">.</span><span class="n">get_map</span><span class="p">(</span><span class="s2">&quot;z_level-voxel_corr-FWE_method-montecarlo&quot;</span><span class="p">)</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a><span class="n">stat_threshold</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">isf</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a><span class="c1"># Display the thresholded z-statistics map in MNI space</span>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a><span class="n">plot_stat_map</span><span class="p">(</span>
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a>    <span class="n">z_corr_img</span><span class="p">,</span>
</span><span id="__span-7-24"><a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a>    <span class="n">display_mode</span><span class="o">=</span><span class="s2">&quot;mosaic&quot;</span><span class="p">,</span>
</span><span id="__span-7-25"><a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a>    <span class="n">draw_cross</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-7-26"><a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a>    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu_r&quot;</span><span class="p">,</span>
</span><span id="__span-7-27"><a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a>    <span class="n">symmetric_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-7-28"><a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a>    <span class="n">threshold</span><span class="o">=</span><span class="n">stat_threshold</span><span class="p">,</span>
</span><span id="__span-7-29"><a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a>    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Montecarlo corrected z maps (p &lt; .05)&quot;</span><span class="p">,</span>
</span><span id="__span-7-30"><a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a><span class="p">)</span>
</span><span id="__span-7-31"><a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a>
</span><span id="__span-7-32"><a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a><span class="c1"># Generate cluster table and image based on the corrected z-statistics map</span>
</span><span id="__span-7-33"><a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a><span class="n">cluster_table</span> <span class="o">=</span> <span class="n">get_clusters_table</span><span class="p">(</span>
</span><span id="__span-7-34"><a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a>    <span class="n">z_corr_img</span><span class="p">,</span> <span class="n">stat_threshold</span><span class="o">=</span><span class="n">stat_threshold</span><span class="p">,</span> <span class="n">cluster_threshold</span><span class="o">=</span><span class="mi">20</span>
</span><span id="__span-7-35"><a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a><span class="p">)</span>
</span></code></pre></div>
<p>Which should produce the following plots for the uncorrected z scores and Montecarlo corrected scores:</p>
<p><img alt="Z scores map uncorrected" src="../../assets/nimare-uncorr.png" /></p>
<p><img alt="Z scores map corrected" src="../../assets/nimare-corr.png" /></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The Monte Carlo algorithm may produce slightly different results, nd will be more precise with more iterations (10.000 iterations are reccommended for publication-level analyses).</p>
</div>
<p>And for the region names:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1"># --- Step 7: Extracting Peak Activation Region Names ---</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="c1"># Load the Harvard-Oxford atlas</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="c1"># All the Harvard-Oxford atlases can be visualized here:</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="c1"># https://neurovault.org/collections/262/</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="c1"># The nomenclature for these atlases follow this structure:</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="c1"># HarvardOxford &lt;area&gt; maxprob thr&lt;threshold&gt; &lt;resolution&gt;mm, where:</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="c1"># &lt;area&gt; can be &quot;cort&quot; for cortex, &quot;sub&quot; for sub-cortical</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="c1"># &lt;threshold&gt; is the probability threshold: 0 (bigger ROIs), 25, 50 (smaller ROIs)</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="c1"># &lt;resolution&gt; the resolution of the atlas. Can be 1 or 2 mm (same as your images).</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="n">atlas</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">fetch_atlas_harvard_oxford</span><span class="p">(</span><span class="s2">&quot;cort-maxprob-thr0-2mm&quot;</span><span class="p">)</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="c1"># Function to map MNI coordinates to the corresponding ROI name</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_region_name</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">atlas</span><span class="p">):</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>    <span class="c1"># Get data from the atlas</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>    <span class="n">atlas_img</span> <span class="o">=</span> <span class="n">atlas</span><span class="o">.</span><span class="n">maps</span>  <span class="c1"># Load the atlas map</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>    <span class="n">atlas_data</span> <span class="o">=</span> <span class="n">atlas_img</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span>  <span class="c1"># Get the atlas data</span>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>    <span class="n">affine</span> <span class="o">=</span> <span class="n">atlas_img</span><span class="o">.</span><span class="n">affine</span>  <span class="c1"># The affine matrix for the atlas</span>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>    <span class="n">atlas_labels</span> <span class="o">=</span> <span class="n">atlas</span><span class="o">.</span><span class="n">labels</span>  <span class="c1"># The list of atlas labels (region names)</span>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>    <span class="c1"># Convert MNI coordinates to voxel indices</span>
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>    <span class="n">voxel_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span>
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>        <span class="n">nib</span><span class="o">.</span><span class="n">affines</span><span class="o">.</span><span class="n">apply_affine</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">affine</span><span class="p">),</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span>
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>    <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a>
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a>    <span class="c1"># Get the label index at the voxel location</span>
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a>    <span class="n">label_index</span> <span class="o">=</span> <span class="n">atlas_data</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">voxel_indices</span><span class="p">)]</span>
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a>
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a>    <span class="c1"># Map label index to region name, with a check for out-of-bound or unknown regions</span>
</span><span id="__span-8-31"><a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a>    <span class="k">return</span> <span class="p">(</span>
</span><span id="__span-8-32"><a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a>        <span class="n">atlas_labels</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">label_index</span><span class="p">)]</span>
</span><span id="__span-8-33"><a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a>        <span class="k">if</span> <span class="n">label_index</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">label_index</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">atlas_labels</span><span class="p">)</span>
</span><span id="__span-8-34"><a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a>        <span class="k">else</span> <span class="s2">&quot;Unknown&quot;</span>
</span><span id="__span-8-35"><a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a>    <span class="p">)</span>
</span><span id="__span-8-36"><a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a>
</span><span id="__span-8-37"><a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a><span class="c1"># Retrieve the ROI name for each MNI coordinate</span>
</span><span id="__span-8-38"><a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a><span class="n">cluster_table</span><span class="p">[</span><span class="s2">&quot;Region&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cluster_table</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span><span id="__span-8-39"><a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a>    <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">get_region_name</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Z&quot;</span><span class="p">],</span> <span class="n">atlas</span><span class="p">),</span>
</span><span id="__span-8-40"><a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a>    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-8-41"><a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a><span class="p">)</span>
</span><span id="__span-8-42"><a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a>
</span><span id="__span-8-43"><a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a><span class="c1"># Display the updated table with voxel values</span>
</span><span id="__span-8-44"><a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a><span class="nb">print</span><span class="p">(</span><span class="n">cluster_table</span><span class="p">)</span>
</span><span id="__span-8-45"><a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a>
</span><span id="__span-8-46"><a id="__codelineno-8-46" name="__codelineno-8-46" href="#__codelineno-8-46"></a><span class="n">cluster_table</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
</span><span id="__span-8-47"><a id="__codelineno-8-47" name="__codelineno-8-47" href="#__codelineno-8-47"></a>    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;peak_activation_coordinates.csv&quot;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span>
</span><span id="__span-8-48"><a id="__codelineno-8-48" name="__codelineno-8-48" href="#__codelineno-8-48"></a><span class="p">)</span>  <span class="c1"># Save CSV without row index</span>
</span><span id="__span-8-49"><a id="__codelineno-8-49" name="__codelineno-8-49" href="#__codelineno-8-49"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Peak information saved to peak_activation_coordinates.csv&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p>Which should output:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="w">  </span>Cluster<span class="w"> </span>ID<span class="w">     </span>X<span class="w">  </span>...<span class="w">  </span>Cluster<span class="w"> </span>Size<span class="w"> </span><span class="o">(</span>mm3<span class="o">)</span><span class="w">                                    </span>Region
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="m">0</span><span class="w">          </span><span class="m">1</span><span class="w"> </span>-36.0<span class="w">  </span>...<span class="w">                </span><span class="m">6840</span><span class="w">                  </span>Occipital<span class="w"> </span>Fusiform<span class="w"> </span>Gyrus
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="m">1</span><span class="w">         </span>1a<span class="w"> </span>-38.0<span class="w">  </span>...<span class="w">                            </span>Temporal<span class="w"> </span>Occipital<span class="w"> </span>Fusiform<span class="w"> </span>Cortex
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="m">2</span><span class="w">          </span><span class="m">2</span><span class="w"> </span>-18.0<span class="w">  </span>...<span class="w">                </span><span class="m">1016</span><span class="w">                                   </span>Unknown
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="m">3</span><span class="w">          </span><span class="m">3</span><span class="w">  </span><span class="m">20</span>.0<span class="w">  </span>...<span class="w">                 </span><span class="m">784</span><span class="w">                                   </span>Unknown
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="m">4</span><span class="w">          </span><span class="m">4</span><span class="w">  </span><span class="m">42</span>.0<span class="w">  </span>...<span class="w">                </span><span class="m">8264</span><span class="w">                  </span>Occipital<span class="w"> </span>Fusiform<span class="w"> </span>Gyrus
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="m">5</span><span class="w">          </span><span class="m">5</span><span class="w">  </span><span class="m">44</span>.0<span class="w">  </span>...<span class="w">                 </span><span class="m">544</span><span class="w">  </span>Inferior<span class="w"> </span>Frontal<span class="w"> </span>Gyrus,<span class="w"> </span>pars<span class="w"> </span>opercularis
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the table above, the "Unknown" labels are automatically assigned to un-labeled voxels -- i.e., voxels not belonging to any ROI in the atlas (sub-cortical, outside the brain, etc.). In this specific example, the "Unknown" ROIs are the two anterior small blobs, visible in the second plot at <code>z = -14</code>. These voxels are not part of any ROI in the Harvard-Oxford atlas, but seem to fall close to the inferior frontal gyrus.</p>
</div>
<h2 id="full-code-example">Full code example<a class="headerlink" href="#full-code-example" title="Permanent link">&para;</a></h2>
<p>Here you can find the full code example:</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">  1</a></span>
<span class="normal"><a href="#__codelineno-10-2">  2</a></span>
<span class="normal"><a href="#__codelineno-10-3">  3</a></span>
<span class="normal"><a href="#__codelineno-10-4">  4</a></span>
<span class="normal"><a href="#__codelineno-10-5">  5</a></span>
<span class="normal"><a href="#__codelineno-10-6">  6</a></span>
<span class="normal"><a href="#__codelineno-10-7">  7</a></span>
<span class="normal"><a href="#__codelineno-10-8">  8</a></span>
<span class="normal"><a href="#__codelineno-10-9">  9</a></span>
<span class="normal"><a href="#__codelineno-10-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-10-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-10-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-10-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-10-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-10-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-10-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-10-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-10-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-10-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-10-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-10-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-10-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-10-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-10-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-10-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-10-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-10-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-10-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-10-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-10-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-10-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-10-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-10-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-10-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-10-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-10-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-10-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-10-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-10-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-10-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-10-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-10-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-10-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-10-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-10-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-10-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-10-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-10-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-10-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-10-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-10-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-10-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-10-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-10-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-10-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-10-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-10-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-10-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-10-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-10-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-10-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-10-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-10-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-10-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-10-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-10-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-10-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-10-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-10-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-10-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-10-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-10-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-10-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-10-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-10-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-10-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-10-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-10-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-10-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-10-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-10-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-10-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-10-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-10-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-10-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-10-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-10-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-10-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-10-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-10-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-10-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-10-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-10-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-10-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-10-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-10-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-10-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-10-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-10-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-10-100">100</a></span>
<span class="normal"><a href="#__codelineno-10-101">101</a></span>
<span class="normal"><a href="#__codelineno-10-102">102</a></span>
<span class="normal"><a href="#__codelineno-10-103">103</a></span>
<span class="normal"><a href="#__codelineno-10-104">104</a></span>
<span class="normal"><a href="#__codelineno-10-105">105</a></span>
<span class="normal"><a href="#__codelineno-10-106">106</a></span>
<span class="normal"><a href="#__codelineno-10-107">107</a></span>
<span class="normal"><a href="#__codelineno-10-108">108</a></span>
<span class="normal"><a href="#__codelineno-10-109">109</a></span>
<span class="normal"><a href="#__codelineno-10-110">110</a></span>
<span class="normal"><a href="#__codelineno-10-111">111</a></span>
<span class="normal"><a href="#__codelineno-10-112">112</a></span>
<span class="normal"><a href="#__codelineno-10-113">113</a></span>
<span class="normal"><a href="#__codelineno-10-114">114</a></span>
<span class="normal"><a href="#__codelineno-10-115">115</a></span>
<span class="normal"><a href="#__codelineno-10-116">116</a></span>
<span class="normal"><a href="#__codelineno-10-117">117</a></span>
<span class="normal"><a href="#__codelineno-10-118">118</a></span>
<span class="normal"><a href="#__codelineno-10-119">119</a></span>
<span class="normal"><a href="#__codelineno-10-120">120</a></span>
<span class="normal"><a href="#__codelineno-10-121">121</a></span>
<span class="normal"><a href="#__codelineno-10-122">122</a></span>
<span class="normal"><a href="#__codelineno-10-123">123</a></span>
<span class="normal"><a href="#__codelineno-10-124">124</a></span>
<span class="normal"><a href="#__codelineno-10-125">125</a></span>
<span class="normal"><a href="#__codelineno-10-126">126</a></span>
<span class="normal"><a href="#__codelineno-10-127">127</a></span>
<span class="normal"><a href="#__codelineno-10-128">128</a></span>
<span class="normal"><a href="#__codelineno-10-129">129</a></span>
<span class="normal"><a href="#__codelineno-10-130">130</a></span>
<span class="normal"><a href="#__codelineno-10-131">131</a></span>
<span class="normal"><a href="#__codelineno-10-132">132</a></span>
<span class="normal"><a href="#__codelineno-10-133">133</a></span>
<span class="normal"><a href="#__codelineno-10-134">134</a></span>
<span class="normal"><a href="#__codelineno-10-135">135</a></span>
<span class="normal"><a href="#__codelineno-10-136">136</a></span>
<span class="normal"><a href="#__codelineno-10-137">137</a></span>
<span class="normal"><a href="#__codelineno-10-138">138</a></span>
<span class="normal"><a href="#__codelineno-10-139">139</a></span>
<span class="normal"><a href="#__codelineno-10-140">140</a></span>
<span class="normal"><a href="#__codelineno-10-141">141</a></span>
<span class="normal"><a href="#__codelineno-10-142">142</a></span>
<span class="normal"><a href="#__codelineno-10-143">143</a></span>
<span class="normal"><a href="#__codelineno-10-144">144</a></span>
<span class="normal"><a href="#__codelineno-10-145">145</a></span>
<span class="normal"><a href="#__codelineno-10-146">146</a></span>
<span class="normal"><a href="#__codelineno-10-147">147</a></span>
<span class="normal"><a href="#__codelineno-10-148">148</a></span>
<span class="normal"><a href="#__codelineno-10-149">149</a></span>
<span class="normal"><a href="#__codelineno-10-150">150</a></span>
<span class="normal"><a href="#__codelineno-10-151">151</a></span>
<span class="normal"><a href="#__codelineno-10-152">152</a></span>
<span class="normal"><a href="#__codelineno-10-153">153</a></span>
<span class="normal"><a href="#__codelineno-10-154">154</a></span>
<span class="normal"><a href="#__codelineno-10-155">155</a></span>
<span class="normal"><a href="#__codelineno-10-156">156</a></span>
<span class="normal"><a href="#__codelineno-10-157">157</a></span>
<span class="normal"><a href="#__codelineno-10-158">158</a></span>
<span class="normal"><a href="#__codelineno-10-159">159</a></span>
<span class="normal"><a href="#__codelineno-10-160">160</a></span>
<span class="normal"><a href="#__codelineno-10-161">161</a></span>
<span class="normal"><a href="#__codelineno-10-162">162</a></span>
<span class="normal"><a href="#__codelineno-10-163">163</a></span>
<span class="normal"><a href="#__codelineno-10-164">164</a></span>
<span class="normal"><a href="#__codelineno-10-165">165</a></span>
<span class="normal"><a href="#__codelineno-10-166">166</a></span>
<span class="normal"><a href="#__codelineno-10-167">167</a></span>
<span class="normal"><a href="#__codelineno-10-168">168</a></span>
<span class="normal"><a href="#__codelineno-10-169">169</a></span>
<span class="normal"><a href="#__codelineno-10-170">170</a></span>
<span class="normal"><a href="#__codelineno-10-171">171</a></span>
<span class="normal"><a href="#__codelineno-10-172">172</a></span>
<span class="normal"><a href="#__codelineno-10-173">173</a></span>
<span class="normal"><a href="#__codelineno-10-174">174</a></span>
<span class="normal"><a href="#__codelineno-10-175">175</a></span>
<span class="normal"><a href="#__codelineno-10-176">176</a></span>
<span class="normal"><a href="#__codelineno-10-177">177</a></span>
<span class="normal"><a href="#__codelineno-10-178">178</a></span>
<span class="normal"><a href="#__codelineno-10-179">179</a></span>
<span class="normal"><a href="#__codelineno-10-180">180</a></span>
<span class="normal"><a href="#__codelineno-10-181">181</a></span>
<span class="normal"><a href="#__codelineno-10-182">182</a></span>
<span class="normal"><a href="#__codelineno-10-183">183</a></span>
<span class="normal"><a href="#__codelineno-10-184">184</a></span>
<span class="normal"><a href="#__codelineno-10-185">185</a></span>
<span class="normal"><a href="#__codelineno-10-186">186</a></span>
<span class="normal"><a href="#__codelineno-10-187">187</a></span>
<span class="normal"><a href="#__codelineno-10-188">188</a></span>
<span class="normal"><a href="#__codelineno-10-189">189</a></span>
<span class="normal"><a href="#__codelineno-10-190">190</a></span>
<span class="normal"><a href="#__codelineno-10-191">191</a></span>
<span class="normal"><a href="#__codelineno-10-192">192</a></span>
<span class="normal"><a href="#__codelineno-10-193">193</a></span>
<span class="normal"><a href="#__codelineno-10-194">194</a></span>
<span class="normal"><a href="#__codelineno-10-195">195</a></span>
<span class="normal"><a href="#__codelineno-10-196">196</a></span>
<span class="normal"><a href="#__codelineno-10-197">197</a></span>
<span class="normal"><a href="#__codelineno-10-198">198</a></span>
<span class="normal"><a href="#__codelineno-10-199">199</a></span>
<span class="normal"><a href="#__codelineno-10-200">200</a></span>
<span class="normal"><a href="#__codelineno-10-201">201</a></span>
<span class="normal"><a href="#__codelineno-10-202">202</a></span>
<span class="normal"><a href="#__codelineno-10-203">203</a></span>
<span class="normal"><a href="#__codelineno-10-204">204</a></span>
<span class="normal"><a href="#__codelineno-10-205">205</a></span>
<span class="normal"><a href="#__codelineno-10-206">206</a></span>
<span class="normal"><a href="#__codelineno-10-207">207</a></span>
<span class="normal"><a href="#__codelineno-10-208">208</a></span>
<span class="normal"><a href="#__codelineno-10-209">209</a></span>
<span class="normal"><a href="#__codelineno-10-210">210</a></span>
<span class="normal"><a href="#__codelineno-10-211">211</a></span>
<span class="normal"><a href="#__codelineno-10-212">212</a></span>
<span class="normal"><a href="#__codelineno-10-213">213</a></span>
<span class="normal"><a href="#__codelineno-10-214">214</a></span>
<span class="normal"><a href="#__codelineno-10-215">215</a></span>
<span class="normal"><a href="#__codelineno-10-216">216</a></span>
<span class="normal"><a href="#__codelineno-10-217">217</a></span>
<span class="normal"><a href="#__codelineno-10-218">218</a></span>
<span class="normal"><a href="#__codelineno-10-219">219</a></span>
<span class="normal"><a href="#__codelineno-10-220">220</a></span>
<span class="normal"><a href="#__codelineno-10-221">221</a></span>
<span class="normal"><a href="#__codelineno-10-222">222</a></span>
<span class="normal"><a href="#__codelineno-10-223">223</a></span>
<span class="normal"><a href="#__codelineno-10-224">224</a></span>
<span class="normal"><a href="#__codelineno-10-225">225</a></span>
<span class="normal"><a href="#__codelineno-10-226">226</a></span>
<span class="normal"><a href="#__codelineno-10-227">227</a></span>
<span class="normal"><a href="#__codelineno-10-228">228</a></span>
<span class="normal"><a href="#__codelineno-10-229">229</a></span>
<span class="normal"><a href="#__codelineno-10-230">230</a></span>
<span class="normal"><a href="#__codelineno-10-231">231</a></span>
<span class="normal"><a href="#__codelineno-10-232">232</a></span>
<span class="normal"><a href="#__codelineno-10-233">233</a></span>
<span class="normal"><a href="#__codelineno-10-234">234</a></span>
<span class="normal"><a href="#__codelineno-10-235">235</a></span>
<span class="normal"><a href="#__codelineno-10-236">236</a></span>
<span class="normal"><a href="#__codelineno-10-237">237</a></span>
<span class="normal"><a href="#__codelineno-10-238">238</a></span>
<span class="normal"><a href="#__codelineno-10-239">239</a></span>
<span class="normal"><a href="#__codelineno-10-240">240</a></span>
<span class="normal"><a href="#__codelineno-10-241">241</a></span>
<span class="normal"><a href="#__codelineno-10-242">242</a></span>
<span class="normal"><a href="#__codelineno-10-243">243</a></span>
<span class="normal"><a href="#__codelineno-10-244">244</a></span>
<span class="normal"><a href="#__codelineno-10-245">245</a></span>
<span class="normal"><a href="#__codelineno-10-246">246</a></span>
<span class="normal"><a href="#__codelineno-10-247">247</a></span>
<span class="normal"><a href="#__codelineno-10-248">248</a></span>
<span class="normal"><a href="#__codelineno-10-249">249</a></span>
<span class="normal"><a href="#__codelineno-10-250">250</a></span>
<span class="normal"><a href="#__codelineno-10-251">251</a></span>
<span class="normal"><a href="#__codelineno-10-252">252</a></span>
<span class="normal"><a href="#__codelineno-10-253">253</a></span>
<span class="normal"><a href="#__codelineno-10-254">254</a></span>
<span class="normal"><a href="#__codelineno-10-255">255</a></span>
<span class="normal"><a href="#__codelineno-10-256">256</a></span>
<span class="normal"><a href="#__codelineno-10-257">257</a></span>
<span class="normal"><a href="#__codelineno-10-258">258</a></span>
<span class="normal"><a href="#__codelineno-10-259">259</a></span>
<span class="normal"><a href="#__codelineno-10-260">260</a></span>
<span class="normal"><a href="#__codelineno-10-261">261</a></span>
<span class="normal"><a href="#__codelineno-10-262">262</a></span>
<span class="normal"><a href="#__codelineno-10-263">263</a></span>
<span class="normal"><a href="#__codelineno-10-264">264</a></span>
<span class="normal"><a href="#__codelineno-10-265">265</a></span>
<span class="normal"><a href="#__codelineno-10-266">266</a></span>
<span class="normal"><a href="#__codelineno-10-267">267</a></span>
<span class="normal"><a href="#__codelineno-10-268">268</a></span>
<span class="normal"><a href="#__codelineno-10-269">269</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="sd">NiMARE Meta-Analysis</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5"></a>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="sd">This guide demonstrates how to download and process the Neurosynth database using NiMARE,</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="sd">a Python-based framework designed for neuroimaging meta-analyses.</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8"></a>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="sd">This step-by-step script covers:</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="sd">1. Downloading the Neurosynth data</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="sd">2. Converting it into a NiMARE-compatible dataset</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12"></a><span class="sd">3. Adding article abstracts</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13"></a><span class="sd">4. Filtering studies based on specific abstract keywords.</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14"></a><span class="sd">5. Extracting and plotting significant voxels clusters.</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15"></a>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16"></a><span class="sd">Before starting, ensure NiMARE and required dependencies are installed in your environment. Open your terminal and install the required packages with:</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17"></a>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18"></a><span class="sd">pip install nimare biopython pprint scipy nibabel numpy pandas nilearn</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19"></a>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20"></a><span class="sd">Created on Tue Oct 29 13:45:16 2024</span>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21"></a>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22"></a><span class="sd">@authors: Emma Goris, Andrea Costantino</span>
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23"></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24"></a>
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25"></a><span class="c1"># --- Step 1: Import All Necessary Packages ---</span>
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26"></a>
</span><span id="__span-10-27"><a id="__codelineno-10-27" name="__codelineno-10-27"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-10-28"><a id="__codelineno-10-28" name="__codelineno-10-28"></a><span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
</span><span id="__span-10-29"><a id="__codelineno-10-29" name="__codelineno-10-29"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="__span-10-30"><a id="__codelineno-10-30" name="__codelineno-10-30"></a><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">norm</span>
</span><span id="__span-10-31"><a id="__codelineno-10-31" name="__codelineno-10-31"></a><span class="kn">from</span><span class="w"> </span><span class="nn">nimare.dataset</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dataset</span>
</span><span id="__span-10-32"><a id="__codelineno-10-32" name="__codelineno-10-32"></a><span class="kn">from</span><span class="w"> </span><span class="nn">nimare.extract</span><span class="w"> </span><span class="kn">import</span> <span class="n">download_abstracts</span><span class="p">,</span> <span class="n">fetch_neurosynth</span>
</span><span id="__span-10-33"><a id="__codelineno-10-33" name="__codelineno-10-33"></a><span class="kn">from</span><span class="w"> </span><span class="nn">nimare.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">convert_neurosynth_to_dataset</span>
</span><span id="__span-10-34"><a id="__codelineno-10-34" name="__codelineno-10-34"></a><span class="kn">from</span><span class="w"> </span><span class="nn">nimare.meta.cbma.ale</span><span class="w"> </span><span class="kn">import</span> <span class="n">ALE</span>  <span class="c1"># ALE algorithm for meta-analysis</span>
</span><span id="__span-10-35"><a id="__codelineno-10-35" name="__codelineno-10-35"></a><span class="kn">from</span><span class="w"> </span><span class="nn">nimare.correct</span><span class="w"> </span><span class="kn">import</span> <span class="n">FWECorrector</span>  <span class="c1"># Family-wise error correction</span>
</span><span id="__span-10-36"><a id="__codelineno-10-36" name="__codelineno-10-36"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pprint</span><span class="w"> </span><span class="kn">import</span> <span class="n">pprint</span>
</span><span id="__span-10-37"><a id="__codelineno-10-37" name="__codelineno-10-37"></a><span class="kn">from</span><span class="w"> </span><span class="nn">nilearn.plotting</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_stat_map</span>
</span><span id="__span-10-38"><a id="__codelineno-10-38" name="__codelineno-10-38"></a><span class="kn">from</span><span class="w"> </span><span class="nn">nilearn</span><span class="w"> </span><span class="kn">import</span> <span class="n">datasets</span>  <span class="c1"># Neuroimaging datasets</span>
</span><span id="__span-10-39"><a id="__codelineno-10-39" name="__codelineno-10-39"></a><span class="kn">from</span><span class="w"> </span><span class="nn">nilearn.reporting</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_clusters_table</span>
</span><span id="__span-10-40"><a id="__codelineno-10-40" name="__codelineno-10-40"></a><span class="kn">import</span><span class="w"> </span><span class="nn">nibabel</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nib</span>
</span><span id="__span-10-41"><a id="__codelineno-10-41" name="__codelineno-10-41"></a>
</span><span id="__span-10-42"><a id="__codelineno-10-42" name="__codelineno-10-42"></a><span class="c1"># --- Step 2: Downloading the Neurosynth Database ---</span>
</span><span id="__span-10-43"><a id="__codelineno-10-43" name="__codelineno-10-43"></a>
</span><span id="__span-10-44"><a id="__codelineno-10-44" name="__codelineno-10-44"></a><span class="c1"># Set the output directory for storing downloaded Neurosynth data</span>
</span><span id="__span-10-45"><a id="__codelineno-10-45" name="__codelineno-10-45"></a><span class="c1"># Make sure to change this to a directory path on your own machine</span>
</span><span id="__span-10-46"><a id="__codelineno-10-46" name="__codelineno-10-46"></a><span class="n">out_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;./nimare_data&quot;</span><span class="p">)</span>
</span><span id="__span-10-47"><a id="__codelineno-10-47" name="__codelineno-10-47"></a><span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Create the directory if it doesn&#39;t already exist</span>
</span><span id="__span-10-48"><a id="__codelineno-10-48" name="__codelineno-10-48"></a>
</span><span id="__span-10-49"><a id="__codelineno-10-49" name="__codelineno-10-49"></a><span class="c1"># Download Neurosynth data using NiMAREâ€™s `fetch_neurosynth` function</span>
</span><span id="__span-10-50"><a id="__codelineno-10-50" name="__codelineno-10-50"></a><span class="c1"># Set version to the latest available (version &quot;7&quot; as of October 2024)</span>
</span><span id="__span-10-51"><a id="__codelineno-10-51" name="__codelineno-10-51"></a><span class="n">files</span> <span class="o">=</span> <span class="n">fetch_neurosynth</span><span class="p">(</span>
</span><span id="__span-10-52"><a id="__codelineno-10-52" name="__codelineno-10-52"></a>    <span class="n">data_dir</span><span class="o">=</span><span class="n">out_dir</span><span class="p">,</span>  <span class="c1"># Specify directory to save data</span>
</span><span id="__span-10-53"><a id="__codelineno-10-53" name="__codelineno-10-53"></a>    <span class="n">version</span><span class="o">=</span><span class="s2">&quot;7&quot;</span><span class="p">,</span>  <span class="c1"># Neurosynth data version to download</span>
</span><span id="__span-10-54"><a id="__codelineno-10-54" name="__codelineno-10-54"></a>    <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Set to True to re-download data if it already exists</span>
</span><span id="__span-10-55"><a id="__codelineno-10-55" name="__codelineno-10-55"></a>    <span class="n">source</span><span class="o">=</span><span class="s2">&quot;abstract&quot;</span><span class="p">,</span>  <span class="c1"># Use article abstracts as the source</span>
</span><span id="__span-10-56"><a id="__codelineno-10-56" name="__codelineno-10-56"></a>    <span class="n">vocab</span><span class="o">=</span><span class="s2">&quot;terms&quot;</span><span class="p">,</span>  <span class="c1"># Use &quot;terms&quot; as the vocabulary type</span>
</span><span id="__span-10-57"><a id="__codelineno-10-57" name="__codelineno-10-57"></a><span class="p">)</span>
</span><span id="__span-10-58"><a id="__codelineno-10-58" name="__codelineno-10-58"></a><span class="n">files</span> <span class="o">=</span> <span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-10-59"><a id="__codelineno-10-59" name="__codelineno-10-59"></a>
</span><span id="__span-10-60"><a id="__codelineno-10-60" name="__codelineno-10-60"></a><span class="c1"># Print details of the downloaded files to understand the data structure</span>
</span><span id="__span-10-61"><a id="__codelineno-10-61" name="__codelineno-10-61"></a><span class="n">pprint</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
</span><span id="__span-10-62"><a id="__codelineno-10-62" name="__codelineno-10-62"></a>
</span><span id="__span-10-63"><a id="__codelineno-10-63" name="__codelineno-10-63"></a><span class="c1"># Expected output:</span>
</span><span id="__span-10-64"><a id="__codelineno-10-64" name="__codelineno-10-64"></a><span class="c1"># {&#39;coordinates&#39;: &#39;./nimare_data/neurosynth/data-neurosynth_version-7_coordinates.tsv.gz&#39;,</span>
</span><span id="__span-10-65"><a id="__codelineno-10-65" name="__codelineno-10-65"></a><span class="c1">#  &#39;features&#39;: [{&#39;features&#39;: &#39;./nimare_data/neurosynth/data-neurosynth_version-7_vocab-terms_source-abstract_type-tfidf_features.npz&#39;,</span>
</span><span id="__span-10-66"><a id="__codelineno-10-66" name="__codelineno-10-66"></a><span class="c1">#                &#39;vocabulary&#39;: &#39;./nimare_data/neurosynth/data-neurosynth_version-7_vocab-terms_vocabulary.txt&#39;}],</span>
</span><span id="__span-10-67"><a id="__codelineno-10-67" name="__codelineno-10-67"></a><span class="c1">#  &#39;metadata&#39;: &#39;./nimare_data/neurosynth/data-neurosynth_version-7_metadata.tsv.gz&#39;}</span>
</span><span id="__span-10-68"><a id="__codelineno-10-68" name="__codelineno-10-68"></a>
</span><span id="__span-10-69"><a id="__codelineno-10-69" name="__codelineno-10-69"></a><span class="c1"># --- Step 3: Converting Neurosynth Data to a NiMARE-Compatible Dataset ---</span>
</span><span id="__span-10-70"><a id="__codelineno-10-70" name="__codelineno-10-70"></a>
</span><span id="__span-10-71"><a id="__codelineno-10-71" name="__codelineno-10-71"></a><span class="c1"># Define the path for the NiMARE-compatible dataset file</span>
</span><span id="__span-10-72"><a id="__codelineno-10-72" name="__codelineno-10-72"></a><span class="n">dataset_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;neurosynth_dataset.pkl.gz&quot;</span><span class="p">)</span>
</span><span id="__span-10-73"><a id="__codelineno-10-73" name="__codelineno-10-73"></a>
</span><span id="__span-10-74"><a id="__codelineno-10-74" name="__codelineno-10-74"></a><span class="c1"># Convert and save Neurosynth data to NiMARE dataset format if it doesnâ€™t already exist</span>
</span><span id="__span-10-75"><a id="__codelineno-10-75" name="__codelineno-10-75"></a><span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">):</span>
</span><span id="__span-10-76"><a id="__codelineno-10-76" name="__codelineno-10-76"></a>    <span class="n">neurosynth_dset</span> <span class="o">=</span> <span class="n">convert_neurosynth_to_dataset</span><span class="p">(</span>
</span><span id="__span-10-77"><a id="__codelineno-10-77" name="__codelineno-10-77"></a>        <span class="n">coordinates_file</span><span class="o">=</span><span class="n">files</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">],</span>  <span class="c1"># Path to Neurosynth coordinates</span>
</span><span id="__span-10-78"><a id="__codelineno-10-78" name="__codelineno-10-78"></a>        <span class="n">metadata_file</span><span class="o">=</span><span class="n">files</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">],</span>  <span class="c1"># Path to metadata file</span>
</span><span id="__span-10-79"><a id="__codelineno-10-79" name="__codelineno-10-79"></a>        <span class="n">annotations_files</span><span class="o">=</span><span class="n">files</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">],</span>  <span class="c1"># Path to feature files</span>
</span><span id="__span-10-80"><a id="__codelineno-10-80" name="__codelineno-10-80"></a>        <span class="n">target</span><span class="o">=</span><span class="s2">&quot;mni152_2mm&quot;</span><span class="p">,</span>
</span><span id="__span-10-81"><a id="__codelineno-10-81" name="__codelineno-10-81"></a>    <span class="p">)</span>
</span><span id="__span-10-82"><a id="__codelineno-10-82" name="__codelineno-10-82"></a>    <span class="n">neurosynth_dset</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">)</span>  <span class="c1"># Save the converted dataset</span>
</span><span id="__span-10-83"><a id="__codelineno-10-83" name="__codelineno-10-83"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset saved to: </span><span class="si">{</span><span class="n">dataset_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-10-84"><a id="__codelineno-10-84" name="__codelineno-10-84"></a><span class="k">else</span><span class="p">:</span>
</span><span id="__span-10-85"><a id="__codelineno-10-85" name="__codelineno-10-85"></a>    <span class="n">neurosynth_dset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
</span><span id="__span-10-86"><a id="__codelineno-10-86" name="__codelineno-10-86"></a>        <span class="n">dataset_path</span>
</span><span id="__span-10-87"><a id="__codelineno-10-87" name="__codelineno-10-87"></a>    <span class="p">)</span>  <span class="c1"># Load existing dataset if already created</span>
</span><span id="__span-10-88"><a id="__codelineno-10-88" name="__codelineno-10-88"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset loaded from: </span><span class="si">{</span><span class="n">dataset_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-10-89"><a id="__codelineno-10-89" name="__codelineno-10-89"></a>
</span><span id="__span-10-90"><a id="__codelineno-10-90" name="__codelineno-10-90"></a><span class="c1"># Define path for saving the dataset with abstracts</span>
</span><span id="__span-10-91"><a id="__codelineno-10-91" name="__codelineno-10-91"></a><span class="n">abstracts_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;neurosynth_dataset_with_abstracts.pkl.gz&quot;</span><span class="p">)</span>
</span><span id="__span-10-92"><a id="__codelineno-10-92" name="__codelineno-10-92"></a>
</span><span id="__span-10-93"><a id="__codelineno-10-93" name="__codelineno-10-93"></a><span class="c1"># Download and add abstracts to the dataset if it doesnâ€™t already include them</span>
</span><span id="__span-10-94"><a id="__codelineno-10-94" name="__codelineno-10-94"></a><span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">abstracts_path</span><span class="p">):</span>
</span><span id="__span-10-95"><a id="__codelineno-10-95" name="__codelineno-10-95"></a>    <span class="c1"># Note: Replace &quot;example@example.edu&quot; with your email address for access to PubMed</span>
</span><span id="__span-10-96"><a id="__codelineno-10-96" name="__codelineno-10-96"></a>    <span class="n">neurosynth_dset</span> <span class="o">=</span> <span class="n">download_abstracts</span><span class="p">(</span><span class="n">neurosynth_dset</span><span class="p">,</span> <span class="s2">&quot;example@example.edu&quot;</span><span class="p">)</span>
</span><span id="__span-10-97"><a id="__codelineno-10-97" name="__codelineno-10-97"></a>    <span class="n">neurosynth_dset</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">abstracts_path</span><span class="p">)</span>  <span class="c1"># Save dataset with abstracts</span>
</span><span id="__span-10-98"><a id="__codelineno-10-98" name="__codelineno-10-98"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset with abstracts saved to: </span><span class="si">{</span><span class="n">abstracts_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-10-99"><a id="__codelineno-10-99" name="__codelineno-10-99"></a><span class="k">else</span><span class="p">:</span>
</span><span id="__span-10-100"><a id="__codelineno-10-100" name="__codelineno-10-100"></a>    <span class="n">neurosynth_dset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
</span><span id="__span-10-101"><a id="__codelineno-10-101" name="__codelineno-10-101"></a>        <span class="n">abstracts_path</span>
</span><span id="__span-10-102"><a id="__codelineno-10-102" name="__codelineno-10-102"></a>    <span class="p">)</span>  <span class="c1"># Load dataset with abstracts if already created</span>
</span><span id="__span-10-103"><a id="__codelineno-10-103" name="__codelineno-10-103"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset with abstracts loaded from: </span><span class="si">{</span><span class="n">abstracts_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-10-104"><a id="__codelineno-10-104" name="__codelineno-10-104"></a>
</span><span id="__span-10-105"><a id="__codelineno-10-105" name="__codelineno-10-105"></a><span class="c1"># Verify dataset by printing a sample of the abstracts and counting entries</span>
</span><span id="__span-10-106"><a id="__codelineno-10-106" name="__codelineno-10-106"></a><span class="n">pprint</span><span class="p">(</span><span class="n">neurosynth_dset</span><span class="o">.</span><span class="n">texts</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>  <span class="c1"># Display the first few entries of abstracts</span>
</span><span id="__span-10-107"><a id="__codelineno-10-107" name="__codelineno-10-107"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of abstracts: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">neurosynth_dset</span><span class="o">.</span><span class="n">texts</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-10-108"><a id="__codelineno-10-108" name="__codelineno-10-108"></a>
</span><span id="__span-10-109"><a id="__codelineno-10-109" name="__codelineno-10-109"></a><span class="c1"># --- Step 4: Creating a Subset of Data ---</span>
</span><span id="__span-10-110"><a id="__codelineno-10-110" name="__codelineno-10-110"></a>
</span><span id="__span-10-111"><a id="__codelineno-10-111" name="__codelineno-10-111"></a><span class="c1"># Define a function to search abstracts for specific keywords, which helps create a filtered subset</span>
</span><span id="__span-10-112"><a id="__codelineno-10-112" name="__codelineno-10-112"></a><span class="k">def</span><span class="w"> </span><span class="nf">search_abstracts</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">keywords</span><span class="p">):</span>
</span><span id="__span-10-113"><a id="__codelineno-10-113" name="__codelineno-10-113"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-10-114"><a id="__codelineno-10-114" name="__codelineno-10-114"></a><span class="sd">    Search for abstracts containing specified keywords.</span>
</span><span id="__span-10-115"><a id="__codelineno-10-115" name="__codelineno-10-115"></a>
</span><span id="__span-10-116"><a id="__codelineno-10-116" name="__codelineno-10-116"></a><span class="sd">    Parameters:</span>
</span><span id="__span-10-117"><a id="__codelineno-10-117" name="__codelineno-10-117"></a><span class="sd">    - dataset (NiMARE Dataset): Dataset with abstracts.</span>
</span><span id="__span-10-118"><a id="__codelineno-10-118" name="__codelineno-10-118"></a><span class="sd">    - keywords (list of str): Keywords to search for in abstracts.</span>
</span><span id="__span-10-119"><a id="__codelineno-10-119" name="__codelineno-10-119"></a>
</span><span id="__span-10-120"><a id="__codelineno-10-120" name="__codelineno-10-120"></a><span class="sd">    Returns:</span>
</span><span id="__span-10-121"><a id="__codelineno-10-121" name="__codelineno-10-121"></a><span class="sd">    - list of str: Study IDs of abstracts containing specified keywords.</span>
</span><span id="__span-10-122"><a id="__codelineno-10-122" name="__codelineno-10-122"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-10-123"><a id="__codelineno-10-123" name="__codelineno-10-123"></a>    <span class="n">keyword_ids</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Initialize list for storing IDs of matching studies</span>
</span><span id="__span-10-124"><a id="__codelineno-10-124" name="__codelineno-10-124"></a>    <span class="n">abstracts</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">get_texts</span><span class="p">(</span><span class="n">text_type</span><span class="o">=</span><span class="s2">&quot;abstract&quot;</span><span class="p">)</span>  <span class="c1"># Retrieve abstracts</span>
</span><span id="__span-10-125"><a id="__codelineno-10-125" name="__codelineno-10-125"></a>    <span class="n">study_ids</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>  <span class="c1"># Retrieve study IDs for each abstract</span>
</span><span id="__span-10-126"><a id="__codelineno-10-126" name="__codelineno-10-126"></a>
</span><span id="__span-10-127"><a id="__codelineno-10-127" name="__codelineno-10-127"></a>    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">abstract</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">abstracts</span><span class="p">):</span>
</span><span id="__span-10-128"><a id="__codelineno-10-128" name="__codelineno-10-128"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-10-129"><a id="__codelineno-10-129" name="__codelineno-10-129"></a>            <span class="c1"># Check if abstract is a string and contains any keyword</span>
</span><span id="__span-10-130"><a id="__codelineno-10-130" name="__codelineno-10-130"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">abstract</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span>
</span><span id="__span-10-131"><a id="__codelineno-10-131" name="__codelineno-10-131"></a>                <span class="n">keyword</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">abstract</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">keywords</span>
</span><span id="__span-10-132"><a id="__codelineno-10-132" name="__codelineno-10-132"></a>            <span class="p">):</span>
</span><span id="__span-10-133"><a id="__codelineno-10-133" name="__codelineno-10-133"></a>                <span class="n">study_id</span> <span class="o">=</span> <span class="n">study_ids</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>  <span class="c1"># Get corresponding study ID</span>
</span><span id="__span-10-134"><a id="__codelineno-10-134" name="__codelineno-10-134"></a>                <span class="n">keyword_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">study_id</span><span class="p">)</span>  <span class="c1"># Add matching study ID to list</span>
</span><span id="__span-10-135"><a id="__codelineno-10-135" name="__codelineno-10-135"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-10-136"><a id="__codelineno-10-136" name="__codelineno-10-136"></a>            <span class="c1"># Print error details if an exception occurs</span>
</span><span id="__span-10-137"><a id="__codelineno-10-137" name="__codelineno-10-137"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing abstract ID </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-10-138"><a id="__codelineno-10-138" name="__codelineno-10-138"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Abstract content (partial): </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">abstract</span><span class="p">)[:</span><span class="mi">100</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</span><span id="__span-10-139"><a id="__codelineno-10-139" name="__codelineno-10-139"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Skipping this abstract.&quot;</span><span class="p">)</span>
</span><span id="__span-10-140"><a id="__codelineno-10-140" name="__codelineno-10-140"></a>
</span><span id="__span-10-141"><a id="__codelineno-10-141" name="__codelineno-10-141"></a>    <span class="k">return</span> <span class="n">keyword_ids</span>
</span><span id="__span-10-142"><a id="__codelineno-10-142" name="__codelineno-10-142"></a>
</span><span id="__span-10-143"><a id="__codelineno-10-143" name="__codelineno-10-143"></a><span class="c1"># Define keywords to search for in the abstracts</span>
</span><span id="__span-10-144"><a id="__codelineno-10-144" name="__codelineno-10-144"></a><span class="n">keywords</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;face recognition&quot;</span><span class="p">]</span>
</span><span id="__span-10-145"><a id="__codelineno-10-145" name="__codelineno-10-145"></a>
</span><span id="__span-10-146"><a id="__codelineno-10-146" name="__codelineno-10-146"></a><span class="c1"># Execute the search function and print matching study IDs</span>
</span><span id="__span-10-147"><a id="__codelineno-10-147" name="__codelineno-10-147"></a><span class="n">matching_ids</span> <span class="o">=</span> <span class="n">search_abstracts</span><span class="p">(</span><span class="n">neurosynth_dset</span><span class="p">,</span> <span class="n">keywords</span><span class="p">)</span>
</span><span id="__span-10-148"><a id="__codelineno-10-148" name="__codelineno-10-148"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of abstracts containing </span><span class="si">{</span><span class="n">keywords</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">matching_ids</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-10-149"><a id="__codelineno-10-149" name="__codelineno-10-149"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;IDs of matching abstracts: </span><span class="si">{</span><span class="n">matching_ids</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-10-150"><a id="__codelineno-10-150" name="__codelineno-10-150"></a>
</span><span id="__span-10-151"><a id="__codelineno-10-151" name="__codelineno-10-151"></a><span class="c1"># Filter dataset to include only studies with keywords in abstracts</span>
</span><span id="__span-10-152"><a id="__codelineno-10-152" name="__codelineno-10-152"></a><span class="n">dset_filtered_by_abstract</span> <span class="o">=</span> <span class="n">neurosynth_dset</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span>
</span><span id="__span-10-153"><a id="__codelineno-10-153" name="__codelineno-10-153"></a>    <span class="n">matching_ids</span>
</span><span id="__span-10-154"><a id="__codelineno-10-154" name="__codelineno-10-154"></a><span class="p">)</span>  <span class="c1"># Keep only selected studies</span>
</span><span id="__span-10-155"><a id="__codelineno-10-155" name="__codelineno-10-155"></a><span class="n">pprint</span><span class="p">(</span><span class="n">dset_filtered_by_abstract</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>  <span class="c1"># Verify metadata of the filtered dataset</span>
</span><span id="__span-10-156"><a id="__codelineno-10-156" name="__codelineno-10-156"></a>
</span><span id="__span-10-157"><a id="__codelineno-10-157" name="__codelineno-10-157"></a><span class="c1"># --- Step 5: Running Meta-Analysis ---</span>
</span><span id="__span-10-158"><a id="__codelineno-10-158" name="__codelineno-10-158"></a>
</span><span id="__span-10-159"><a id="__codelineno-10-159" name="__codelineno-10-159"></a><span class="c1"># Create dir to store cache (useful for low memory)</span>
</span><span id="__span-10-160"><a id="__codelineno-10-160" name="__codelineno-10-160"></a><span class="n">cache_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;cache&quot;</span><span class="p">)</span>
</span><span id="__span-10-161"><a id="__codelineno-10-161" name="__codelineno-10-161"></a>
</span><span id="__span-10-162"><a id="__codelineno-10-162" name="__codelineno-10-162"></a><span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">):</span>
</span><span id="__span-10-163"><a id="__codelineno-10-163" name="__codelineno-10-163"></a>    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">)</span> <span class="c1"># Delete the old cache folder if it exists</span>
</span><span id="__span-10-164"><a id="__codelineno-10-164" name="__codelineno-10-164"></a>
</span><span id="__span-10-165"><a id="__codelineno-10-165" name="__codelineno-10-165"></a><span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-10-166"><a id="__codelineno-10-166" name="__codelineno-10-166"></a>
</span><span id="__span-10-167"><a id="__codelineno-10-167" name="__codelineno-10-167"></a><span class="c1"># Set up the ALE meta-analysis algorithm for activation likelihood estimation</span>
</span><span id="__span-10-168"><a id="__codelineno-10-168" name="__codelineno-10-168"></a><span class="n">ale</span> <span class="o">=</span> <span class="n">ALE</span><span class="p">(</span>
</span><span id="__span-10-169"><a id="__codelineno-10-169" name="__codelineno-10-169"></a>    <span class="n">kernel__sample_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
</span><span id="__span-10-170"><a id="__codelineno-10-170" name="__codelineno-10-170"></a>    <span class="n">memory</span><span class="o">=</span><span class="n">cache_dir</span><span class="p">,</span>
</span><span id="__span-10-171"><a id="__codelineno-10-171" name="__codelineno-10-171"></a>    <span class="n">n_cores</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-10-172"><a id="__codelineno-10-172" name="__codelineno-10-172"></a>    <span class="n">memory_level</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span><span id="__span-10-173"><a id="__codelineno-10-173" name="__codelineno-10-173"></a><span class="p">)</span>  <span class="c1"># Set sample size to control for experiment variability</span>
</span><span id="__span-10-174"><a id="__codelineno-10-174" name="__codelineno-10-174"></a><span class="n">ale_results</span> <span class="o">=</span> <span class="n">ale</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dset_filtered_by_abstract</span><span class="p">)</span>  <span class="c1"># Run ALE on the filtered dataset</span>
</span><span id="__span-10-175"><a id="__codelineno-10-175" name="__codelineno-10-175"></a>
</span><span id="__span-10-176"><a id="__codelineno-10-176" name="__codelineno-10-176"></a><span class="c1"># Apply Monte Carlo correction to the ALE results to control for family-wise error</span>
</span><span id="__span-10-177"><a id="__codelineno-10-177" name="__codelineno-10-177"></a><span class="n">corr</span> <span class="o">=</span> <span class="n">FWECorrector</span><span class="p">(</span>
</span><span id="__span-10-178"><a id="__codelineno-10-178" name="__codelineno-10-178"></a>    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;montecarlo&quot;</span><span class="p">,</span> <span class="n">n_iters</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">n_cores</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">voxel_thresh</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">vfwe_only</span><span class="o">=</span><span class="kc">True</span>
</span><span id="__span-10-179"><a id="__codelineno-10-179" name="__codelineno-10-179"></a><span class="p">)</span>  <span class="c1"># Set up Monte Carlo correction, 10k iterations for publication level</span>
</span><span id="__span-10-180"><a id="__codelineno-10-180" name="__codelineno-10-180"></a><span class="n">cres</span> <span class="o">=</span> <span class="n">corr</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">ale_results</span><span class="p">)</span>  <span class="c1"># Apply correction</span>
</span><span id="__span-10-181"><a id="__codelineno-10-181" name="__codelineno-10-181"></a>
</span><span id="__span-10-182"><a id="__codelineno-10-182" name="__codelineno-10-182"></a><span class="c1"># Save corrected maps, such as z-scores and p-values, to the output directory</span>
</span><span id="__span-10-183"><a id="__codelineno-10-183" name="__codelineno-10-183"></a><span class="n">cres</span><span class="o">.</span><span class="n">save_maps</span><span class="p">(</span><span class="s2">&quot;./nimare_data&quot;</span><span class="p">)</span>  <span class="c1"># Save results in the specified directory</span>
</span><span id="__span-10-184"><a id="__codelineno-10-184" name="__codelineno-10-184"></a>
</span><span id="__span-10-185"><a id="__codelineno-10-185" name="__codelineno-10-185"></a><span class="c1"># --- Step 6: Plot Peak Activation Coordinates in MNI ---</span>
</span><span id="__span-10-186"><a id="__codelineno-10-186" name="__codelineno-10-186"></a>
</span><span id="__span-10-187"><a id="__codelineno-10-187" name="__codelineno-10-187"></a><span class="c1"># Get z-statistics map</span>
</span><span id="__span-10-188"><a id="__codelineno-10-188" name="__codelineno-10-188"></a><span class="n">z_img</span> <span class="o">=</span> <span class="n">cres</span><span class="o">.</span><span class="n">get_map</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">)</span>
</span><span id="__span-10-189"><a id="__codelineno-10-189" name="__codelineno-10-189"></a><span class="n">stat_threshold</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">isf</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>
</span><span id="__span-10-190"><a id="__codelineno-10-190" name="__codelineno-10-190"></a>
</span><span id="__span-10-191"><a id="__codelineno-10-191" name="__codelineno-10-191"></a><span class="n">plot_stat_map</span><span class="p">(</span>
</span><span id="__span-10-192"><a id="__codelineno-10-192" name="__codelineno-10-192"></a>    <span class="n">z_img</span><span class="p">,</span>
</span><span id="__span-10-193"><a id="__codelineno-10-193" name="__codelineno-10-193"></a>    <span class="n">display_mode</span><span class="o">=</span><span class="s2">&quot;mosaic&quot;</span><span class="p">,</span>
</span><span id="__span-10-194"><a id="__codelineno-10-194" name="__codelineno-10-194"></a>    <span class="n">draw_cross</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-10-195"><a id="__codelineno-10-195" name="__codelineno-10-195"></a>    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu_r&quot;</span><span class="p">,</span>
</span><span id="__span-10-196"><a id="__codelineno-10-196" name="__codelineno-10-196"></a>    <span class="n">symmetric_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-10-197"><a id="__codelineno-10-197" name="__codelineno-10-197"></a>    <span class="n">threshold</span><span class="o">=</span><span class="n">stat_threshold</span><span class="p">,</span>
</span><span id="__span-10-198"><a id="__codelineno-10-198" name="__codelineno-10-198"></a>    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Uncorrected z maps (p&lt;.001)&quot;</span><span class="p">,</span>
</span><span id="__span-10-199"><a id="__codelineno-10-199" name="__codelineno-10-199"></a><span class="p">)</span>
</span><span id="__span-10-200"><a id="__codelineno-10-200" name="__codelineno-10-200"></a>
</span><span id="__span-10-201"><a id="__codelineno-10-201" name="__codelineno-10-201"></a><span class="c1"># Get FWE-corrected z-statistics map</span>
</span><span id="__span-10-202"><a id="__codelineno-10-202" name="__codelineno-10-202"></a><span class="n">z_corr_img</span> <span class="o">=</span> <span class="n">cres</span><span class="o">.</span><span class="n">get_map</span><span class="p">(</span><span class="s2">&quot;z_level-voxel_corr-FWE_method-montecarlo&quot;</span><span class="p">)</span>
</span><span id="__span-10-203"><a id="__codelineno-10-203" name="__codelineno-10-203"></a><span class="n">stat_threshold</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">isf</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
</span><span id="__span-10-204"><a id="__codelineno-10-204" name="__codelineno-10-204"></a>
</span><span id="__span-10-205"><a id="__codelineno-10-205" name="__codelineno-10-205"></a><span class="c1"># Display the thresholded z-statistics map in MNI space</span>
</span><span id="__span-10-206"><a id="__codelineno-10-206" name="__codelineno-10-206"></a><span class="n">plot_stat_map</span><span class="p">(</span>
</span><span id="__span-10-207"><a id="__codelineno-10-207" name="__codelineno-10-207"></a>    <span class="n">z_corr_img</span><span class="p">,</span>
</span><span id="__span-10-208"><a id="__codelineno-10-208" name="__codelineno-10-208"></a>    <span class="n">display_mode</span><span class="o">=</span><span class="s2">&quot;mosaic&quot;</span><span class="p">,</span>
</span><span id="__span-10-209"><a id="__codelineno-10-209" name="__codelineno-10-209"></a>    <span class="n">draw_cross</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-10-210"><a id="__codelineno-10-210" name="__codelineno-10-210"></a>    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu_r&quot;</span><span class="p">,</span>
</span><span id="__span-10-211"><a id="__codelineno-10-211" name="__codelineno-10-211"></a>    <span class="n">symmetric_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-10-212"><a id="__codelineno-10-212" name="__codelineno-10-212"></a>    <span class="n">threshold</span><span class="o">=</span><span class="n">stat_threshold</span><span class="p">,</span>
</span><span id="__span-10-213"><a id="__codelineno-10-213" name="__codelineno-10-213"></a>    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Montecarlo corrected z maps (p &lt; .05)&quot;</span><span class="p">,</span>
</span><span id="__span-10-214"><a id="__codelineno-10-214" name="__codelineno-10-214"></a><span class="p">)</span>
</span><span id="__span-10-215"><a id="__codelineno-10-215" name="__codelineno-10-215"></a>
</span><span id="__span-10-216"><a id="__codelineno-10-216" name="__codelineno-10-216"></a><span class="c1"># Generate cluster table and image based on the corrected z-statistics map</span>
</span><span id="__span-10-217"><a id="__codelineno-10-217" name="__codelineno-10-217"></a><span class="n">cluster_table</span> <span class="o">=</span> <span class="n">get_clusters_table</span><span class="p">(</span>
</span><span id="__span-10-218"><a id="__codelineno-10-218" name="__codelineno-10-218"></a>    <span class="n">z_corr_img</span><span class="p">,</span> <span class="n">stat_threshold</span><span class="o">=</span><span class="n">stat_threshold</span><span class="p">,</span> <span class="n">cluster_threshold</span><span class="o">=</span><span class="mi">20</span>
</span><span id="__span-10-219"><a id="__codelineno-10-219" name="__codelineno-10-219"></a><span class="p">)</span>
</span><span id="__span-10-220"><a id="__codelineno-10-220" name="__codelineno-10-220"></a>
</span><span id="__span-10-221"><a id="__codelineno-10-221" name="__codelineno-10-221"></a><span class="c1"># --- Step 7: Extracting Peak Activation Region Names ---</span>
</span><span id="__span-10-222"><a id="__codelineno-10-222" name="__codelineno-10-222"></a><span class="c1"># Load the Harvard-Oxford atlas</span>
</span><span id="__span-10-223"><a id="__codelineno-10-223" name="__codelineno-10-223"></a>
</span><span id="__span-10-224"><a id="__codelineno-10-224" name="__codelineno-10-224"></a><span class="c1"># All the Harvard-Oxford atlases can be visualized here:</span>
</span><span id="__span-10-225"><a id="__codelineno-10-225" name="__codelineno-10-225"></a><span class="c1"># https://neurovault.org/collections/262/</span>
</span><span id="__span-10-226"><a id="__codelineno-10-226" name="__codelineno-10-226"></a><span class="c1"># The nomenclature for these atlases follow this structure:</span>
</span><span id="__span-10-227"><a id="__codelineno-10-227" name="__codelineno-10-227"></a><span class="c1"># HarvardOxford &lt;area&gt; maxprob thr&lt;threshold&gt; &lt;resolution&gt;mm, where:</span>
</span><span id="__span-10-228"><a id="__codelineno-10-228" name="__codelineno-10-228"></a><span class="c1"># &lt;area&gt; can be &quot;cort&quot; for cortex, &quot;sub&quot; for sub-cortical</span>
</span><span id="__span-10-229"><a id="__codelineno-10-229" name="__codelineno-10-229"></a><span class="c1"># &lt;threshold&gt; is the probability threshold: 0 (bigger ROIs), 25, 50 (smaller ROIs)</span>
</span><span id="__span-10-230"><a id="__codelineno-10-230" name="__codelineno-10-230"></a><span class="c1"># &lt;resolution&gt; the resolution of the atlas. Can be 1 or 2 mm (same as your images).</span>
</span><span id="__span-10-231"><a id="__codelineno-10-231" name="__codelineno-10-231"></a><span class="n">atlas</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">fetch_atlas_harvard_oxford</span><span class="p">(</span><span class="s2">&quot;cort-maxprob-thr0-2mm&quot;</span><span class="p">)</span>
</span><span id="__span-10-232"><a id="__codelineno-10-232" name="__codelineno-10-232"></a>
</span><span id="__span-10-233"><a id="__codelineno-10-233" name="__codelineno-10-233"></a><span class="c1"># Function to map MNI coordinates to the corresponding ROI name</span>
</span><span id="__span-10-234"><a id="__codelineno-10-234" name="__codelineno-10-234"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_region_name</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">atlas</span><span class="p">):</span>
</span><span id="__span-10-235"><a id="__codelineno-10-235" name="__codelineno-10-235"></a>
</span><span id="__span-10-236"><a id="__codelineno-10-236" name="__codelineno-10-236"></a>    <span class="c1"># Get data from the atlas</span>
</span><span id="__span-10-237"><a id="__codelineno-10-237" name="__codelineno-10-237"></a>    <span class="n">atlas_img</span> <span class="o">=</span> <span class="n">atlas</span><span class="o">.</span><span class="n">maps</span>  <span class="c1"># Load the atlas map</span>
</span><span id="__span-10-238"><a id="__codelineno-10-238" name="__codelineno-10-238"></a>    <span class="n">atlas_data</span> <span class="o">=</span> <span class="n">atlas_img</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span>  <span class="c1"># Get the atlas data</span>
</span><span id="__span-10-239"><a id="__codelineno-10-239" name="__codelineno-10-239"></a>    <span class="n">affine</span> <span class="o">=</span> <span class="n">atlas_img</span><span class="o">.</span><span class="n">affine</span>  <span class="c1"># The affine matrix for the atlas</span>
</span><span id="__span-10-240"><a id="__codelineno-10-240" name="__codelineno-10-240"></a>    <span class="n">atlas_labels</span> <span class="o">=</span> <span class="n">atlas</span><span class="o">.</span><span class="n">labels</span>  <span class="c1"># The list of atlas labels (region names)</span>
</span><span id="__span-10-241"><a id="__codelineno-10-241" name="__codelineno-10-241"></a>
</span><span id="__span-10-242"><a id="__codelineno-10-242" name="__codelineno-10-242"></a>    <span class="c1"># Convert MNI coordinates to voxel indices</span>
</span><span id="__span-10-243"><a id="__codelineno-10-243" name="__codelineno-10-243"></a>    <span class="n">voxel_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span>
</span><span id="__span-10-244"><a id="__codelineno-10-244" name="__codelineno-10-244"></a>        <span class="n">nib</span><span class="o">.</span><span class="n">affines</span><span class="o">.</span><span class="n">apply_affine</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">affine</span><span class="p">),</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span>
</span><span id="__span-10-245"><a id="__codelineno-10-245" name="__codelineno-10-245"></a>    <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="__span-10-246"><a id="__codelineno-10-246" name="__codelineno-10-246"></a>
</span><span id="__span-10-247"><a id="__codelineno-10-247" name="__codelineno-10-247"></a>    <span class="c1"># Get the label index at the voxel location</span>
</span><span id="__span-10-248"><a id="__codelineno-10-248" name="__codelineno-10-248"></a>    <span class="n">label_index</span> <span class="o">=</span> <span class="n">atlas_data</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">voxel_indices</span><span class="p">)]</span>
</span><span id="__span-10-249"><a id="__codelineno-10-249" name="__codelineno-10-249"></a>
</span><span id="__span-10-250"><a id="__codelineno-10-250" name="__codelineno-10-250"></a>    <span class="c1"># Map label index to region name, with a check for out-of-bound or unknown regions</span>
</span><span id="__span-10-251"><a id="__codelineno-10-251" name="__codelineno-10-251"></a>    <span class="k">return</span> <span class="p">(</span>
</span><span id="__span-10-252"><a id="__codelineno-10-252" name="__codelineno-10-252"></a>        <span class="n">atlas_labels</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">label_index</span><span class="p">)]</span>
</span><span id="__span-10-253"><a id="__codelineno-10-253" name="__codelineno-10-253"></a>        <span class="k">if</span> <span class="n">label_index</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">label_index</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">atlas_labels</span><span class="p">)</span>
</span><span id="__span-10-254"><a id="__codelineno-10-254" name="__codelineno-10-254"></a>        <span class="k">else</span> <span class="s2">&quot;Unknown&quot;</span>
</span><span id="__span-10-255"><a id="__codelineno-10-255" name="__codelineno-10-255"></a>    <span class="p">)</span>
</span><span id="__span-10-256"><a id="__codelineno-10-256" name="__codelineno-10-256"></a>
</span><span id="__span-10-257"><a id="__codelineno-10-257" name="__codelineno-10-257"></a><span class="c1"># Retrieve the ROI name for each MNI coordinate</span>
</span><span id="__span-10-258"><a id="__codelineno-10-258" name="__codelineno-10-258"></a><span class="n">cluster_table</span><span class="p">[</span><span class="s2">&quot;Region&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cluster_table</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span><span id="__span-10-259"><a id="__codelineno-10-259" name="__codelineno-10-259"></a>    <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">get_region_name</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Z&quot;</span><span class="p">],</span> <span class="n">atlas</span><span class="p">),</span>
</span><span id="__span-10-260"><a id="__codelineno-10-260" name="__codelineno-10-260"></a>    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-10-261"><a id="__codelineno-10-261" name="__codelineno-10-261"></a><span class="p">)</span>
</span><span id="__span-10-262"><a id="__codelineno-10-262" name="__codelineno-10-262"></a>
</span><span id="__span-10-263"><a id="__codelineno-10-263" name="__codelineno-10-263"></a><span class="c1"># Display the updated table with voxel values</span>
</span><span id="__span-10-264"><a id="__codelineno-10-264" name="__codelineno-10-264"></a><span class="nb">print</span><span class="p">(</span><span class="n">cluster_table</span><span class="p">)</span>
</span><span id="__span-10-265"><a id="__codelineno-10-265" name="__codelineno-10-265"></a>
</span><span id="__span-10-266"><a id="__codelineno-10-266" name="__codelineno-10-266"></a><span class="n">cluster_table</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
</span><span id="__span-10-267"><a id="__codelineno-10-267" name="__codelineno-10-267"></a>    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;peak_activation_coordinates.csv&quot;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span>
</span><span id="__span-10-268"><a id="__codelineno-10-268" name="__codelineno-10-268"></a><span class="p">)</span>  <span class="c1"># Save CSV without row index</span>
</span><span id="__span-10-269"><a id="__codelineno-10-269" name="__codelineno-10-269"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Peak information saved to peak_activation_coordinates.csv&quot;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="October 31, 2024 11:37:05 CET">October 31, 2024 11:37:05</span>
  </span>

    
    
    
      
  
  <span class="md-source-file__fact">
    <span class="md-icon" title="Contributors">
      
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 5.5A3.5 3.5 0 0 1 15.5 9a3.5 3.5 0 0 1-3.5 3.5A3.5 3.5 0 0 1 8.5 9 3.5 3.5 0 0 1 12 5.5M5 8c.56 0 1.08.15 1.53.42-.15 1.43.27 2.85 1.13 3.96C7.16 13.34 6.16 14 5 14a3 3 0 0 1-3-3 3 3 0 0 1 3-3m14 0a3 3 0 0 1 3 3 3 3 0 0 1-3 3c-1.16 0-2.16-.66-2.66-1.62a5.54 5.54 0 0 0 1.13-3.96c.45-.27.97-.42 1.53-.42M5.5 18.25c0-2.07 2.91-3.75 6.5-3.75s6.5 1.68 6.5 3.75V20h-13zM0 20v-1.5c0-1.39 1.89-2.56 4.45-2.9-.59.68-.95 1.62-.95 2.65V20zm24 0h-3.5v-1.75c0-1.03-.36-1.97-.95-2.65 2.56.34 4.45 1.51 4.45 2.9z"/></svg>
      
    </span>
    <nav>
      
        <a href="mailto:59078281+costantinoai@users.noreply.github.com">costantinoai</a>, 
        <a href="mailto:emma.goris1@kuleuven.be">emma-goris</a>
    </nav>
  </span>

    
    
  </aside>


  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        Was this page helpful?
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page was helpful" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page could be improved" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              
              
                
                
              
              Thanks for your feedback!
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              
              
                
                
              
              Thanks for your feedback! Help us improve this page by opening a new <a href="https://github.com/HOPLAB-LBP/hoplab-wiki/issues/new/?title=[Feedback]+Meta-analysis%20with%20NiMARE+-+/research/fmri/fmri-nimare.html" target="_blank" rel="noopener">Issue</a>, or contact a Wiki manager.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="analysis/fmri-andrea-workflow.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: fMRI workflow example">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                fMRI workflow example
              </div>
            </div>
          </a>
        
        
          
          <a href="fmri-hpc.html" class="md-footer__link md-footer__link--next" aria-label="Next: fMRIprep on HPC">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                fMRIprep on HPC
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      <a href="#__consent">Change cookie settings</a>            
    

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            


  


<h4>Cookie consent</h4>
<p>Please, consider disabling your ad-blocker and allowing cookies for this Wiki .  We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="analytics" checked>
      <span class="task-list-indicator"></span>
      Google Analytics
    </label>
  </li>

      
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="github" checked>
      <span class="task-list-indicator"></span>
      GitHub
    </label>
  </li>

      
    
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.tabs.link", "content.code.copy", "content.code.select", "content.action.edit", "navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.sections", "search.highlight", "navigation.indexes", "navigation.footer"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
    
  </body>
</html>